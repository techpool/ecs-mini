
<dom-module id="pratilipi-author-details">
	<style>
		:host {
			display: block;
			margin-bottom: 8px;
		}
		.cover-image {
			display: flex;
			justify-content: center;
			width: 100%;
			height: 350px;
			border-radius: 0;
			background-image: url(https://0.ptlp.co/author/cover);
			background-color: #FFF;
			background-repeat: no-repeat;
			background-position: top;
			background-size: cover;
			text-align: center;
		}
		.author-detail-container {
			align-self: center;
			padding: 12px 16px;
		}
		.profile-picture, .pratilipi-file-upload {
			width: 150px;
			height: 150px;
			border: 2px solid #fbfbfb;
			border-radius: 50%;
			overflow: hidden;
			box-shadow: 0 0 8px rgba(0, 0, 0, .8);
			-webkit-box-shadow: 0 0 8px rgba(0, 0, 0, .8);
			-moz-box-shadow: 0 0 8px rgba(0, 0, 0, .8);
		}
		.pratilipi-file-upload .pratilipi-file-upload-caption {
			transition: none;
		}
		.pratilipi-file-upload iron-icon, .pratilipi-file-upload .pratilipi-file-upload-caption iron-icon {
			left: 32px;
			margin: 0;
		}
		.profile-picture, .pratilipi-file-upload paper-spinner {
			width: 146px;
			height: 147px;
			margin: 0;
			--paper-spinner-layer-1-color: #D0021B;
			--paper-spinner-layer-2-color: #107FE5;
			--paper-spinner-layer-3-color: #D0021B;
			--paper-spinner-layer-4-color: #107FE5;
		}
		.author-name {
			margin: 12px auto;
			color: #fbfbfb;
			font-size: 20px;
			font-weight: 700;
			text-shadow: 4px 1px 4px rgba(0,0,0,0.50);
		}
		.follow-author {
			clear: both;
		}
		.follow-author button {
			display: block;
			margin: 0 auto;
			font-weight: 400;
			font-size: 13px;
			letter-spacing: 0;
			border-radius: 4px;
			background: #FFFFFF;
			color: #d0021b;
			border: 1px solid #d0021b;
			-webkit-box-shadow: none;
			-moz-box-shadow: none;
			box-shadow: none;
			outline: none;
			padding: 4px 8px;
		}
		.follow-author button iron-icon {
			width: 20px;
			height: 20px;
			color: inherit;
			margin-top: -4px;
			margin-right: 1px;
		}
		.user-logout-container span {
			font-size: 14px;
			color: #FFF;
			font-weight: 700;
			margin-bottom: 4px;
			display: block;
		}
		.user-logout-container .pratilipi-light-blue-button {
			display: block;
			margin: 0 auto;
			border-radius: 5px;
			font-weight: 400;
			font-size: 14px;
			letter-spacing: 0;
		}
		.user-logout-container .pratilipi-light-blue-button iron-icon {
			width: 20px;
			height: 20px;
			margin-top: -2px;
		}
		.edit-profile, .edit-account-info, .notification-settings {
			position: absolute;
			top: 16px;
		}
		.edit-profile {
			right: 64px;
		}
		.edit-account-info {
			right: 108px;
		}
		.notification-settings {
			right: 152px;
		}
		paper-fab {
			width: 36px!important;
			height: 36px!important;
			--paper-fab-background: #F5F5F5;
			--paper-fab-keyboard-focus-background: #F5F5F5;
			--paper-fab-iron-icon: {
				color: #333;
			}
		}
		.share-author {
			position: absolute;
			top: 8px;
			right: 8px;
		}
		.share-author paper-menu-button paper-menu {
			padding: 0;
			cursor: pointer;
			--paper-menu-color: #333;
			--paper-menu-focused-item: {
				color: #333;
			};
		}
		.share-author paper-item {
			padding: 0 8px;
		}
		.meta-data {
			padding: 12px 16px;
			margin: 4px auto 0 auto;
			text-align: center;
		}
		.meta-data span {
			display: block;
			font-size: 13px;
		}
		.meta-data div.numbers {
			font-size: 20px;
			font-weight: 500;
		}
		.upload-cover {
			position: absolute;
			right: 12px;
			bottom: 12px;
		}
	</style>
	<template>
		<paper-card class="cover-image pratilipi-shadow" style="background-image: url('{{ coverImageUrl }}');">
		
			<template is="dom-if" if="{{ hasAccessToUpdate }}">
				<div class="edit-profile">
					<paper-fab mini icon="icons:settings" on-click="editAuthorProfile" onclick="ga_CA( 'User', 'Settings' )"></paper-fab>
				</div>
				<div class="edit-account-info">
					<paper-fab mini icon="social:person" on-click="openAccountSettings"></paper-fab>
				</div>
							</template>
			
			<div class="share-author">
				<paper-menu-button no-animations vertical-offset=48 noink horizontal-align="right" vertical-align="top">
					<paper-fab icon="social:share" mini class="dropdown-trigger" onclick="ga_CA( 'Author', 'Share' );"></paper-fab>
					<paper-menu class="dropdown-content">
						<paper-item on-click="shareAuthorOnFacebook"><span class="icon icon-facebook"></span></paper-item>
						<paper-item on-click="shareAuthorOnTwitter"><span class="icon icon-twitter"></span></paper-item>
						<paper-item on-click="shareAuthorOnGplus"><span class="icon icon-google-plus"></span></paper-item>
					</paper-menu>
				</paper-menu-button>
			</div>
			<div style="position: absolute; top: -1000px;">
				<form id="uploadAuthorImage" method="post" enctype="multipart/form-data" action="/api/author/image?authorId={{ author.authorId }}" target="upload_target">
					<input id="uploadAuthorImageInput" type="file" on-change="_uploadImage" name="{{ author.authorId }}-image" accept="image/*" />
				</form>
				<form id="uploadAuthorCover" method="post" enctype="multipart/form-data" action="/api/author/cover?authorId={{ author.authorId }}" target="upload_target">
					<input id="uploadAuthorCoverInput" type="file" on-change="_uploadCover" name="{{ author.authorId }}-cover" accept="image/*" />
				</form>
				<iframe id="upload_target" name="upload_target" style="display: none;" on-load="_onchangeiframe"></iframe>
			</div>
			<div class="author-detail-container">
				<template is="dom-if" if="{{ hasAccessToUpdate }}">
					<div class="pratilipi-file-upload">
						<template is="dom-if" if="{{ !imageUploaded }}">
							<img src="{{ imageUrl }}" alt="{{ author.fullName }}" title="{{ author.fullNameEn }}"/>
						</template>
						<template is="dom-if" if="{{ imageUploaded }}">
							<paper-spinner active></paper-spinner>
						</template>
						<iron-icon icon="image:photo-camera"></iron-icon>
						<div class="pratilipi-file-upload-caption" on-click="_chooseImageFile" onclick="ga_CA( 'User', 'UserProfileImageChange' )">
							<iron-icon icon="image:photo-camera"></iron-icon>
						</div>
					</div>
				</template>
				<template is="dom-if" if="{{ !hasAccessToUpdate }}">
					<iron-image class="profile-picture" 
								style="background-color: #f5f5f5" 
								fade preload
								sizing="contain" 
								src="{{ imageUrl }}" 
								alt="{{ author.fullName }}" 
								title="{{ author.fullNameEn }}"></iron-image>
				</template>
				<div class="author-name">{{ name }}</div>
				<template is="dom-if" if="{{ hasAccessToFollow }}">
					<div class="follow-author">
						<template is="dom-if" if="{{ !following }}">
							<button class="pratilipi-author-follow-button" on-click="followAuthor">
								<iron-icon icon="social:person-add"></iron-icon>
								Follow{{ followCountAbbr }}
							</button>
						</template>
						<template is="dom-if" if="{{ following }}">
							<button class="pratilipi-author-unfollow-button" on-click="unFollowAuthor">
								<iron-icon icon="icons:done"></iron-icon>
								Following{{ followCountAbbr }}
							</button>
						</template>
					</div>
				</template>
				<template is="dom-if" if="{{ !hasAccessToFollow }}">
					<div class="user-logout-container">
						<span>{{ followCount }}&nbsp;Followers</span>
					</div>
				</template>
			</div>
			<template is="dom-if" if="{{ hasAccessToUpdate }}">
				<div class="upload-cover">
					<paper-fab mini icon="image:photo-camera" on-click="_chooseCoverFile" onclick="ga_CA( 'User', 'UserCoverImageChange' )"></paper-fab>
				</div>
			</template>
		</paper-card>
		<div class="secondary-500 meta-data pratilipi-shadow">
			<div class="row">
				<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
					<span>WORKS</span>
					<div class="numbers">{{ contentPublished }}</div>
				</div>
				<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
					<span>READS</span>
					<div class="numbers">{{ totalReadCount }}</div>
				</div>
				<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
					<span>LIKES</span>
					<div class="numbers">{{ totalFbLikeShareCount }}</div>
				</div>
			</div>
		</div>
		
		<iron-ajax
				id="UserAuthorFollowPostApi"
				url="/api/userauthor/follow"
				method="POST"
				content-type="application/x-www-form-urlencoded"
				handle-as="json"
				on-response="_userAuthorFollowPostApiResponse"
				on-error="_userAuthorFollowPostApiError"
				></iron-ajax>
	</template>
	<script>
	Polymer({

		is: 'pratilipi-author-details',
		
		properties: {
			author: { type: Object, observer: "_authorObserver" },
			userAuthor: { type: Object, observer: "_userAuthorObserver" },
			
			followCount: { type: Object, observer: "_followCountObserver" },
			imageUploaded: { type: Boolean, value: false },
			coverUploaded: { type: Boolean, value: false }
		},
		
		attached: function() {
			this._authorObserver(); 
		},

		_authorObserver: function() {
			if( document.querySelector( 'pratilipi-user' ) == null ) return;
			this.set( 'hasAccessToFollow', this.author.user == null || this.author.user.userId != document.querySelector( 'pratilipi-user' ).getCurrentUser().userId );
			this.set( 'hasAccessToUpdate', this.author.hasAccessToUpdate );
			this.set( 'name', this.author.name != null ? this.author.name : this.author.nameEn );
			this.set( 'imageUrl', this.author.imageUrl + ( this.author.imageUrl.indexOf( '?' ) == -1 ? "?" : "&" ) + "width=150" );
			this.set( 'coverImageUrl', this.author.coverImageUrl );
			this.set( 'followCount', this.author.followCount != null ? this.author.followCount : 0 );
			this.set( 'contentPublished', commaSeparatedNumber( this.author.contentPublished ) );
			this.set( 'totalReadCount', commaSeparatedNumber( this.author.totalReadCount ) );
			this.set( 'totalFbLikeShareCount', commaSeparatedNumber( this.author.totalFbLikeShareCount ) );
		},

		_userAuthorObserver: function( userAuthor ) {
			this.set( 'following', ( userAuthor != null && userAuthor.following != null ) ? userAuthor.following : false )
		},
		
		_followCountObserver: function() {
			this.followCountAbbr = this.followCount > 0 ? ( "  |  " + abbrNum( this.followCount ) ) : null;
		},
		
		_checkUserLoginStatus: function() {
			if( document.querySelector( 'pratilipi-user' ).getCurrentUser().isGuest ) {
				document.querySelector( 'pratilipi-user' ).logIn( true );
				return false;
			}
			return true;
		},
		
		_disableFollowButtons: function() {
			this.async( function() {
				jQuery( this.querySelector( '.follow-author .pratilipi-author-follow-button' ) ).prop( 'disabled', true );
				jQuery( this.querySelector( '.follow-author .pratilipi-author-unfollow-button' ) ).prop( 'disabled', true );
			});
		},

		_enableFollowButtons: function() {
			jQuery( this.querySelector( '.follow-author .pratilipi-author-follow-button' ) ).prop( 'disabled', false );
			jQuery( this.querySelector( '.follow-author .pratilipi-author-unfollow-button' ) ).prop( 'disabled', false );
		},

		_postFollowApi: function( following ) {
			if( ! this._checkUserLoginStatus() )
				return;
			this._swapFollowButton();
			this._disableFollowButtons();
			var body = { authorId: this.author.authorId, following: following };
			this.$.UserAuthorFollowPostApi.body = jQuery.param( body );
			this.$.UserAuthorFollowPostApi.generateRequest();
		},
		
		followAuthor: function() {
			this._postFollowApi( true );
			ga_CA( 'Author', 'Follow' );
		},
		
		unFollowAuthor: function() {
			this._postFollowApi( false );
			ga_CA( 'Author', 'UnFollow' );
		},
		
		_swapFollowButton: function() {
			this.set( 'following', ! this.following );
			this.set( 'followCount', this.following ? this.followCount + 1 : this.followCount - 1 );
		},
		
		_userAuthorFollowPostApiResponse: function( response ) {
			var following = response.detail.response.following;
			this._enableFollowButtons();
			if( this.following != following ) {
				this._userAuthorFollowPostApiError();
			}
		},
		
		_userAuthorFollowPostApiError: function( response ) {
			this._swapFollowButton();
			this._enableFollowButtons();
			if( response != null && response.detail.request.xhr.response.message != null ) {
				document.querySelector( 'pratilipi-alert' ).alert( response.detail.request.xhr.response.message, false );
			} else {
				document.querySelector( 'pratilipi-alert' ).alert( "Some error Occurred! Please try again!", false );
			}
		},
		
		editAuthorProfile: function() {
			this.domHost.editAuthorProfile();
		},

		openAccountSettings: function() {
			document.querySelector( 'pratilipi-edit-account' ).open();
		},

		_getShareUrl: function( utm_source ) {
			if( utm_source == null ) return;
			var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
			return encodeURIComponent( 
					"http://www.pratilipi.com" + this.author.pageUrl 
					+ ( this.author.pageUrl.indexOf( '?' ) == -1 ? "?" : "&" )
					+ "utm_language=english" + "&"
					+ "utm_version=standard" + "&"
					+ "utm_device=" + ( width < 600 ? "mobile" : "desktop" ) + "&"
					+ "utm_parent=profile" + "&"
					+ "utm_action=share" + "&"
					+ "utm_source=" + utm_source
				);
		},

		shareAuthorOnFacebook: function() {
			window.open( "http://www.facebook.com/sharer.php?u=" + this._getShareUrl( "facebook" ), 
					"share", "width=1100,height=500,left=70px,top=60px" );
		},
		
		shareAuthorOnTwitter: function() {
			window.open( "http://twitter.com/share?url=" + this._getShareUrl( "twitter" ),
					"share", "width=1100,height=500,left=70px,top=60px" );
		},
		
		shareAuthorOnGplus: function() {
			window.open( "https://plus.google.com/share?url=" + this._getShareUrl( "gplus" ),
					"share", "width=1100,height=500,left=70px,top=60px" );
		},

		_chooseImageFile: function() {
			this.querySelector( "#uploadAuthorImageInput" ).click();
		},
		
		_chooseCoverFile: function() {
			this.querySelector( "#uploadAuthorCoverInput" ).click();
		},

		_uploadImage: function( event ) {
			if( this.imageUploaded ) return;
			var FileList = event.target.files;
			if( FileList.length != 1 ) return; // No file or more than 1 file is selected.
			var file = FileList[0];
			if( file == null ) return;
			var fileName = file.name.toLowerCase();
			if( ! ( fileName.match( ".*\.jpg" ) || fileName.match( ".*\.png" ) ) ) return; // Only jpg and png
			this.querySelector( "#uploadAuthorImage" ).submit();
			this.imageUploaded = true;
		},

		_uploadCover: function( event ) {
			if( this.coverUploaded ) return;
			var FileList = event.target.files;
			if( FileList.length != 1 ) return; // No file or more than 1 file is selected.
			var file = FileList[0];
			if( file == null ) return;
			var fileName = file.name.toLowerCase();
			if( ! ( fileName.match( ".*\.jpg" ) || fileName.match( ".*\.png" ) ) ) return; // Only jpg and png
			this.querySelector( "#uploadAuthorCover" ).submit();
			this.coverUploaded = true;
		},

		_onchangeiframe: function( response ) {
			if( this.imageUploaded ) {
				this.async( function() { this.imageUploaded = false; }, 500 );
			}
			if( this.coverUploaded ) {
				this.async( function() { this.coverUploaded = false; }, 500 );
			}
			this.domHost.getAuthor();
		}

	});
	</script>
</dom-module><dom-module id="pratilipi-author-drafted-contents">
	<style>
		:host {
			display: block;
			margin-top: 6px;
		}
		.secondary-500 {
			padding: 12px 8px;
		}
		h6 {
			font-weight: 700;
		}
		hr {
			margin-top: 0.5em;
			margin-bottom: 1.2em;
			border: 0;
			border-top: 2px solid #eee;
		}
		.add-new-card {
			text-align: center;
			display: block;
			cursor: pointer;
			margin: 0 auto;
			margin-bottom: 16px;
			background: linear-gradient(to bottom, #f5f5f5 0%, #d3d3d3 100%);
			padding: 0 12px;
		}
		.add-new-card iron-icon {
			display: block;
			margin: 0 auto;
			margin-bottom: 12px;
		}
		.add-new-card span {
			display: inline-block;
			vertical-align: middle;
			line-height: 1.5em;  
			margin-top: 10px;
		}
		@media only screen and (max-width: 599px) {
			.add-new-card {
				width: 110px;
				height: 165px;
				line-height: 165px;
			}
			.add-new-card iron-icon {
				width: 28px;
				height: 28px;
			}
			.add-new-card span {
				font-size: 12px;
			}
		}
		@media only screen and (min-width: 600px) {
			.add-new-card {
				width: 160px;
				height: 240px;
				line-height: 240px;
			}
			.add-new-card iron-icon {
				width: 48px;
				height: 40px;
			}
			.add-new-card span {
				font-size: 14px;
			}
		}
		.more-button {
			margin-top: 16px;
			background: #F1F8FB;
			padding: 16px;
			text-align: center;
			color: #0C68BD;
			cursor: pointer;
			font-size: 14px;
			font-weight: 700;
			line-height: 14px;
			text-shadow: 0px 1px 2px #FFFFFF;
		}
		paper-spinner {
			margin: 16px auto;
			display: block;
			--paper-spinner-layer-1-color: #D0021B;
			--paper-spinner-layer-2-color: #107FE5;
			--paper-spinner-layer-3-color: #D0021B;
			--paper-spinner-layer-4-color: #107FE5;
		}

		/* Bootstrap overrides */
		.row {
			margin-left: -8px;
			margin-right: -8px;
		}
		.col-xs-4, .col-sm-3, .col-md-3, .col-lg-3 {
			padding-left: 8px;
			padding-right: 8px;
		}
	</style>
	<template>
		<div class="secondary-500 pratilipi-shadow">
			<h6 class="text-center pratilipi-red">
				Drafts
			</h6>
			<hr/>
			<div class="row text-center">
				<div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
					<div class="add-new-card pratilipi-shadow" on-click="_write">
						<span>
							<iron-icon icon="add-circle"></iron-icon>
							Add New Content
						</span>
					</div>
				</div>
				<template is="dom-repeat" items="{{ pratilipiList }}" as="pratilipi">
					<div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
						<pratilipi-card-mini show-edit-option state="DRAFTED" pratilipi="{{ pratilipi }}"></pratilipi-card-mini>
					</div>
				</template>
			</div>
			<template is="dom-if" if="{{ isLoading }}">
				<paper-spinner active></paper-spinner>
			</template>
			<template is="dom-if" if="{{ showMore }}">
				<div class="more-button" on-click="loadMore" onclick="ga_CA( 'Pratilipi', 'LoadMoreDrafts' )">show more...</div>
			</template>
		</div>
		<iron-ajax
				id="PratilipiListApi"
				url="/api/pratilipi/list"
				method="GET"
				params='{"_apiVer": "2"}'
				content-type="application/json"
				handle-as="json"
				on-response="_pratilipiListApiResponse"
				on-error="_pratilipiListApiError"
				></iron-ajax>
	</template>

	<script>
		Polymer({

			is: 'pratilipi-author-drafted-contents',

			properties: {
				author: { type: Object },

				pratilipiList: { type: Array, value: function() { return []; } },
				cursor: { type: String, value: null },
				showMore: { type: Boolean, value: false }
			},

			_write: function() {
				if( isMobile() )
					document.querySelector( 'pratilipi-alert' ).alert( "Please login to write content on desktop website!", false, 10 * 6000 );
				else
					document.querySelector( 'pratilipi-write' ).createNewPratilipi( this.author.authorId );
			},

			removeFromPratilipiList: function( pratilipiId ) {
				var index = -1;
				for( var i = 0; i < this.pratilipiList.length; i++ ) {
					if( pratilipiId == this.pratilipiList[i].pratilipiId ) {
						index = i;
						break;
					}
				}
				
				if( index != -1 ) {
					this.splice( 'pratilipiList', index, 1 );
				}
			},

			getPratilipiById: function( pratilipiId ) {
				if( pratilipiId == null ) return null;
				var pratilipi = null;
				for( var i = 0; i < this.pratilipiList.length; i++ ) {
					if( pratilipiId == this.pratilipiList[i].pratilipiId ) {
						pratilipi = this.pratilipiList[i];
						break;
					}
				}
				return pratilipi;
			},

			addToPratilipiList: function( pratilipi ) {
				this.unshift( 'pratilipiList', pratilipi );
			},

			processPratilipiListObject: function( pratilipiListObject ) {
				var pratilipiList = pratilipiListObject.pratilipiList;
				for( var i = 0; i < pratilipiList.length; i++ )
					this.push( 'pratilipiList', pratilipiList[i] );
				this.set( 'cursor', pratilipiListObject.cursor );
				this.set( 'showMore', pratilipiList.length == 20 );
			},

			ready: function() {
				this.loadMore();
			},
			
			loadMore: function() {
				this.set( 'isLoading', true );
				this.set( 'showMore', false );
				this.$.PratilipiListApi.params.authorId = this.author.authorId;
				this.$.PratilipiListApi.params.state = "DRAFTED";
				if( this.cursor != null )
					this.$.PratilipiListApi.params.cursor = this.cursor;
				else
					delete this.$.PratilipiListApi.params.cursor;
				this.$.PratilipiListApi.generateRequest();
			},

			_pratilipiListApiResponse: function( response ) {
				this.set( 'isLoading', false );
				this.processPratilipiListObject( response.detail.response );
			},

			_pratilipiListApiError: function( response ) {
				this.set( 'isLoading', false );
				this.set( 'showMore', true );
				var message = response.detail.request.xhr.response.message != null ? 
						response.detail.request.xhr.response.message : "Some error Occurred! Please try again!";
				document.querySelector( 'pratilipi-alert' ).alert( message, false );
			},

			publishContent: function( pratilipiId ) {
				this.domHost.publishContent( pratilipiId );
			},

			deleteContent: function( pratilipiId ) {
				this.domHost.deleteContent( pratilipiId );
			},

		});
	</script>
</dom-module><dom-module id="pratilipi-author-published-contents">
	<style>
		:host {
			display: block;
			margin-top: 6px;
		}
		.secondary-500 {
			padding: 12px 8px;
		}
		.works-number {
			font-size: 14px;
		}
		h6 {
			font-weight: 700;
		}
		hr {
			margin-top: 0.8em;
			margin-bottom: 1.2em;
			border: 0;
			border-top: 2px solid #eee;
		}
		.more-button {
			margin-top: 16px;
			background: #F1F8FB;
			padding: 18px;
			text-align: center;
			color: #0C68BD;
			cursor: pointer;
			font-size: 14px;
			font-weight: 700;
			line-height: 14px;
			text-shadow: 0px 1px 2px #FFFFFF;
		}
		paper-spinner {
			margin: 16px auto;
			display: block;
			--paper-spinner-layer-1-color: #D0021B;
			--paper-spinner-layer-2-color: #107FE5;
			--paper-spinner-layer-3-color: #D0021B;
			--paper-spinner-layer-4-color: #107FE5;
		}
		.author-no-works {
			text-align: center;
			padding: 16px;
			display: none;
		}
		.author-no-works iron-icon {
			margin: 16px auto;
			width: 46px;
			height: 46px;
		}
		.author-no-works h6 {
			font-weight: 500;
			line-height: 24px;
			font-size: 15px;
		}

		/* Bootstrap overrides */
		.row {
			margin-left: -8px;
			margin-right: -8px;
		}
		.col-xs-4, .col-sm-3, .col-md-3, .col-lg-3 {
			padding-left: 8px;
			padding-right: 8px;
		}
	</style>
	<template>
		<div class="secondary-500 pratilipi-shadow">
			<h6 class="text-center pratilipi-red">
				Published Works
			</h6>
			<div class="works-number text-center">{{ numberFound }} WORKS</div>
			<hr/>
			<div class="row text-center">
				<template is="dom-repeat" items="{{ pratilipiList }}" as="pratilipi">
					<div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
						<pratilipi-card-mini show-edit-option state="PUBLISHED" pratilipi="{{ pratilipi }}"></pratilipi-card-mini>
					</div>
				</template>
			</div>
			<template is="dom-if" if="{{ isLoading }}">
				<paper-spinner active></paper-spinner>
			</template>
			<template is="dom-if" if="{{ showMore }}">
				<div class="more-button" on-click="loadMore" onclick="ga_CA( 'Pratilipi', 'LoadMore' )">show more...</div>
			</template>
				
			<div class="author-no-works">
				<iron-icon icon="icons:info-outline"></iron-icon>
				<h6>Sorry! This Author doesn't have any books published!</h6>
			</div>
		</div>
		<iron-ajax
				id="PratilipiListApi"
				url="/api/pratilipi/list"
				params='{"_apiVer": "2"}'
				method="GET"
				content-type="application/json"
				handle-as="json"
				on-response="_pratilipiListApiResponse"
				on-error="_pratilipiListApiError"
				></iron-ajax>
	</template>

	<script>
		Polymer({

			is: 'pratilipi-author-published-contents',

			properties: {
				author: { type: Object, observer: "_authorObserver" },

				pratilipiList: { type: Array, value: function() { return []; } },
				cursor: { type: String, value: null },
				resultCount: { type: Number, value: 12 },
				numberFound: { type: Number, observer: "_numberFoundObserver" },
				showMore: { type: Boolean, value: false }
			},

			_authorObserver: function() {
				/* Called before first rendering */
				if( this.pratilipiListObject == null ) return;
				/* Executed whenever author changes */
				this.set( 'pratilipiList', [] );
				this.set( 'cursor', null );
				this.loadMore();
			},
			
			_numberFoundObserver: function() {
				jQuery( this ).css( 'display', this.author.hasAccessToUpdate && this.numberFound == 0 ? 'none' : 'block' );
				jQuery( this.querySelector( '.works-number' ) ).css( 'display', this.numberFound > 0 ? 'block' : 'none' );
				jQuery( this.querySelector( '.author-no-works' ) ).css( 'display', this.numberFound > 0 ? 'none' : 'block' );
			},

			getPratilipiById: function( pratilipiId ) {
				if( pratilipiId == null ) return null;
				var pratilipi = null;
				for( var i = 0; i < this.pratilipiList.length; i++ ) {
					if( pratilipiId == this.pratilipiList[i].pratilipiId ) {
						pratilipi = this.pratilipiList[i];
						break;
					}
				}
				return pratilipi;
			},

			removeFromPratilipiList: function( pratilipiId ) {
				var index = -1;
				for( var i = 0; i < this.pratilipiList.length; i++ ) {
					if( pratilipiId == this.pratilipiList[i].pratilipiId ) {
						index = i;
						break;
					}
				}
				
				if( index != -1 ) {
					this.splice( 'pratilipiList', index, 1 );
					this.set( 'numberFound', this.numberFound - 1 );
				}

			},
			
			addToPratilipiList: function( pratilipi ) {
				this.unshift( 'pratilipiList', pratilipi );
				this.set( 'numberFound', this.numberFound + 1 );
			},
			
			processPratilipiListObject: function( pratilipiListObject ) {
				var pratilipiList = pratilipiListObject.pratilipiList;
				for( var i = 0; i < pratilipiList.length; i++ )
					this.push( 'pratilipiList', pratilipiList[i] );
				this.set( 'cursor', pratilipiListObject.cursor != null ? pratilipiListObject.cursor : null );
				this.set( 'numberFound', pratilipiListObject.numberFound != null ? pratilipiListObject.numberFound : 0 );
				this.set( 'showMore', pratilipiList.length == this.resultCount && this.pratilipiList.length < this.numberFound );
			},
			
			ready: function() {
				this.loadMore();
			},

			loadMore: function() {
				this.set( 'isLoading', true );
				this.set( 'showMore', false );
				this.$.PratilipiListApi.params.authorId = this.author.authorId;
				this.$.PratilipiListApi.params.state = "PUBLISHED";
				this.$.PratilipiListApi.params.resultCount = this.resultCount;
				if( this.cursor != null )
					this.$.PratilipiListApi.params.cursor = this.cursor;
				else
					delete this.$.PratilipiListApi.params.cursor;
				this.$.PratilipiListApi.generateRequest();
			},

			_pratilipiListApiResponse: function( response ) {
				this.set( 'isLoading', false );
				this.processPratilipiListObject( response.detail.response );
			},

			_pratilipiListApiError: function( response ) {
				this.set( 'isLoading', false );
				this.set( 'showMore', true );
				var message = response.detail.request.xhr.response.message != null ? 
						response.detail.request.xhr.response.message : "Some error Occurred! Please try again!";
				document.querySelector( 'pratilipi-alert' ).alert( message, false );
			},

			moveContentToDrafts: function( pratilipiId ) {
				this.domHost.moveContentToDrafts( pratilipiId );
			},

			deleteContent: function( pratilipiId ) {
				this.domHost.deleteContent( pratilipiId );
			},
			
		});
	</script>
</dom-module><dom-module id="pratilipi-author-biography">
	<style>
		:host {
			display: block;
			margin-top: 6px;
		}
		.author-biography {
			padding: 8px;
		}
		.author-biography .author-biography-header h6 {
			font-weight: 700;
			margin-top: 12px;
			margin-bottom: 12px;
			text-align: center;
		}
				.author-details table {
			margin-left: 6px;
		}
		.author-details table th {
			padding: 6px 32px 6px 12px;
			font-size: 14px;
		}
		.author-details td {
			font-size: 14px;
		}
		.author-summary-container {
			font-family: inherit!important;
			font-size: 14px!important;
			line-height: 23px!important;
			color: #333;
			padding: 12px 16px;
		}
		.author-summary-container h6 {
			font-size: 15px;
			margin-top: 12px;
			font-weight: bold;
		}
		
		@media only screen and (max-width: 600px) {
			.author-summary-container {
				text-align: left;
			}
		}
		@media only screen and (min-width: 601px) {
			.author-summary-container {
				text-align: justify;
			}
		}
		.more-button {
			background: #F1F8FB;
			padding: 16px;
			text-align: center;
			color: #0C68BD;
			cursor: pointer;
			font-size: 14px;
			font-weight: 700;
			line-height: 14px;
			text-shadow: 0px 1px 2px #FFFFFF;
		}
		
		hr {
			margin-top: 0.5em;
			margin-bottom: 0.8em;
			border: 0;
			border-top: 2px solid #eee;
		}
		
		.complete-summary {
			max-height: auto;
			overflow: visible;
		}
		.reduced-summary {
			max-height: 46px; 
			overflow: hidden;
		}
	</style>
	<template>
		<div class="secondary-500 author-biography pratilipi-shadow">
			<div class="author-biography-header">
				<h6 class="pratilipi-red">Biography</h6>
			</div>
			<hr/>
			<div class="author-details">
				<table>
					<tr>
						<th>Author Since</th>
						<td>{{ registrationDate }}</td>
					</tr>
					<template is="dom-if" if="{{ hasLocation }}">
						<tr>
							<th>Location</th>
							<td>{{ location }}</td>
						</tr>
					</template>
					<template is="dom-if" if="{{ hasDateOfBirth }}">
						<tr>
							<th>Date Of Birth</th>
							<td>{{ dateOfBirth }}</td>
						</tr>
					</template>
				</table>
				
				<div class="author-summary-container" id="author-summary-container">
					<h6>About</h6>
					<div id="author-summary"></div>
				</div>
				<div class="more-button" id="more-button" on-click="toggleSnippet" onclick="ga_CA( 'Author', 'LoadMore' )">show more...</div>
			</div>
		</div>
	</template>

	<script>
	
		Polymer({

			is: 'pratilipi-author-biography',
			
			properties: {
			 	author: { type: Object, observer: "_authorObserver" },
			 	summary: { type: String, observer: "_summaryObserver" }
			},
			
			_authorObserver: function() {
				this.set( 'summary', this.author == null ? null : this.author.summary );
				this.set( 'registrationDate', this.author == null ? null : convertDate( this.author.registrationDateMillis ) );
				this.set( 'hasLocation', this.author.location != null );
				this.set( 'location', this.author.location );
				this.set( 'hasDateOfBirth', this.author.dateOfBirth != null );
				this.set( 'dateOfBirth', this.author.dateOfBirth == null ? null : convertDate( this.author.dateOfBirth ) );
			},

			attached: function() {
				this._summaryObserver();
			},

			_summaryObserver: function() {

				if( this.summary == null || this.summary.trim() == "" ) {
					jQuery( this.querySelector( '.author-summary-container' ) ).css( 'display', 'none' );
					jQuery( this.querySelector( '.more-button' ) ).css( 'display', 'none' );
					return;
				}

				jQuery( this.querySelector( '.author-summary-container' ) ).css( 'display', 'block' );

				/* Called before DOM is attached */
				if( document.getElementById( "author-summary" ) == null )
					return;

				var author_summary = document.getElementById( "author-summary" );
				jQuery( author_summary ).html( this.summary.replace(/\n/g, "<br />") );
				
				// Calculating summary height
				var height = 0;
				var clone = author_summary.cloneNode( true );
				clone.style.position = "absolute";
				clone.style.top = "-1000px";
				clone.style.width = ( jQuery( 'pratilipi-author-tabs' ).width() - 32 ) + "px"; /* 32px for padding */
				document.body.appendChild( clone );
				height = clone.clientHeight;
				document.body.removeChild( clone );
				
				if( height < 92 ) {
					jQuery( this.querySelector( '#author-summary' ) ).removeClass( 'complete-summary' );
					jQuery( this.querySelector( '#author-summary' ) ).removeClass( 'reduced-summary' );
					jQuery( this.querySelector( '#more-button' ) ).css( 'display', 'none' );
				} else {
					jQuery( this.querySelector( '#author-summary' ) ).addClass( 'reduced-summary' );
					jQuery( this.querySelector( '#author-summary' ) ).removeClass( 'complete-summary' );
					jQuery( this.querySelector( '#more-button' ) ).css( 'display', 'block' );
				}
			},
			
			toggleSnippet: function() {
				jQuery( this.querySelector( '#author-summary' ) ).toggleClass( 'reduced-summary' );
				jQuery( this.querySelector( '#author-summary' ) ).toggleClass( 'complete-summary' );
				jQuery( this.querySelector( '#more-button' ) ).css( 'display', 'none' );
			}
 
		});

	</script>

</dom-module><dom-module id="pratilipi-author-following">

	<template>
				<template is="dom-if" if="{{ !noDisplay }}">
			<pratilipi-follow-author-grid 
				follow-list="{{ followList }}"
				number-found="{{ numberFound }}"
				title="Following"
				empty-list="{{ emptyList }}"
				empty-list-message="Sorry! This author is not following anyone!"
				show-modal-button="{{ showModalButton }}"
				is-loading="[[ isLoading ]]"
				is-finished="{{ isFinished }}"></pratilipi-follow-author-grid>
		</template>

		<iron-ajax
				id="UserAuthorFollowListApi"
				url="/api/userauthor/follow/list"
				method="GET"
				content-type="application/json"
				handle-as="json"
				on-response="_userAuthorFollowListApiResponse"
				on-error="_userAuthorFollowListApiError"
				></iron-ajax>
	</template>

	<script>

		Polymer({

			is: 'pratilipi-author-following',
			
			properties: {
				author: { type: Object, observer: "_authorObserver" },
				userId: { type: String },
				authorList: { type: Object },
				followList: { type: Array, value: function() { return []; } },
				cursor: { type: String },
				numberFound: { type: Number },
				resultCount: { type: Number, value: 20 },
				isLoading: { type: Boolean, value: false },
				isFinished: { type: Boolean, value: false },
				emptyList: { type: Boolean, value: true },
				noDisplay: { type: Boolean, value: false }
			},

			_authorObserver: function() {
				/* numberFound will be null only before dom-ready is called */
				if( this.numberFound == null ) return;
				this.resetList();
			},
			
			processAuthorListObject: function( authorListObject ) {
				var followList = [];
				var authorList = authorListObject.authorList != null ? authorListObject.authorList : [];
				for( var i = 0; i < authorList.length; i++ ) {
					var author = authorList[i];
					var follow = {
							authorId: author.authorId,
							name: author.name,
							pageUrl: author.pageUrl,
							followCount: author.followCount,
							imageUrl: author.imageUrl,
							following: author.following,
							canFollow: author.user.userId != document.querySelector( 'pratilipi-user' ).getCurrentUser().userId 
					};
					followList.push( follow );
				}

				return { followList: followList,
						cursor: authorListObject.cursor,
						numberFound: authorListObject.numberFound != null ? authorListObject.numberFound : 0 };
			},

			_pushToFollowList: function( followListObject ) {
				var followList = followListObject.followList;
				for( var i = 0; i < followList.length; i++ )
					this.push( 'followList', followList[i] );
				this.set( 'cursor', followListObject.cursor );
				this.set( 'numberFound', followListObject.numberFound );
				this.set( 'isFinished', followListObject.cursor == null || followList.length < this.resultCount );
				this.set( "emptyList", followListObject.numberFound == 0 );
				this.set( "showModalButton", followListObject.numberFound > 4 );
			},
			
			attached: function() {
				this.loadMore();
			},

			resetList: function() {
				this.set( 'followList', [] );
				this.set( 'cursor', null );
				this.set( 'numberFound', 0 );
				this.set( 'isFinished', false );
				this.loadMore();
			},

			loadMore: function() {
				this.set( 'isLoading', true );
				this.$.UserAuthorFollowListApi.params.userId = this.userId;
				if( this.cursor != null )
					this.$.UserAuthorFollowListApi.params.cursor = this.cursor;
				else
					delete this.$.UserAuthorFollowListApi.params.cursor;
				this.$.UserAuthorFollowListApi.params.resultCount = this.resultCount;
				this.$.UserAuthorFollowListApi.generateRequest();
			},

			_userAuthorFollowListApiResponse: function( response ) {
				this.set( 'isLoading', false );
				this._pushToFollowList( this.processAuthorListObject( response.detail.response ) );
			},

			_userAuthorFollowListApiError: function( response ) {
				this.set( 'isLoading', false );
			}

		});

	</script>

</dom-module><dom-module id="pratilipi-author-followers">

	<template>
				<template is="dom-if" if="{{ !noDisplay }}">
			<pratilipi-follow-author-grid 
				follow-list="{{ followList }}"
				number-found="{{ numberFound }}"
				title="Followers"
				empty-list="{{ emptyList }}"
				empty-list-message="Sorry! This author doesn't have any followers"
				show-modal-button="{{ showModalButton }}"
				is-loading="[[ isLoading ]]"
				is-finished="{{ isFinished }}"></pratilipi-follow-author-grid>
		</template>

		<iron-ajax
				id="UserAuthorFollowListApi"
				url="/api/userauthor/follow/list"
				method="GET"
				content-type="application/json"
				handle-as="json"
				on-response="_userAuthorFollowListApiResponse"
				on-error="_userAuthorFollowListApiError"
				></iron-ajax>

	</template>

	<script>

		Polymer({

			is: 'pratilipi-author-followers',
			
			properties: {
				author: { type: Object, observer: "_authorObserver" },
				authorId: { type: String },
				userList: { type: Object },
				followList: { type: Array, value: function() { return []; } },
				cursor: { type: String },
				numberFound: { type: Number },
				resultCount: { type: Number, value: 20 },
				isLoading: { type: Boolean, value: false },
				isFinished: { type: Boolean, value: false },
				emptyList: { type: Boolean, value: true },
				noDisplay: { type: Boolean, value: false }
			},

			_authorObserver: function() {
				/* numberFound will be null only before dom-ready is called */
				if( this.numberFound == null ) return;
				this.resetList();
			},

			processUserListObject: function( userListObject ) {
				var followList = [];
				var userList = userListObject.userList != null ? userListObject.userList : [];
				for( var i = 0; i < userList.length; i++ ) {
					var user = userList[i];
					var follow = {
						authorId: user.author.authorId,
						name: user.author.name,
						pageUrl: user.profilePageUrl,
						followCount: user.author.followCount,
						imageUrl: user.profileImageUrl,
						following: user.author.following,
						canFollow: user.userId != document.querySelector( 'pratilipi-user' ).getCurrentUser().userId 
					};
					followList.push( follow );
				}

				return { followList: followList,
						cursor: userListObject.cursor,
						numberFound: userListObject.numberFound != null ? userListObject.numberFound : 0 };
			},

			_pushToFollowList: function( followListObject ) {
				var followList = followListObject.followList;
				for( var i = 0; i < followList.length; i++ )
					this.push( 'followList', followList[i] );
				this.set( 'cursor', followListObject.cursor );
				this.set( 'numberFound', followListObject.numberFound );
				this.set( 'isFinished', followListObject.cursor == null || followList.length < this.resultCount );
				this.set( "emptyList", followListObject.numberFound == 0 );
				this.set( "showModalButton", followListObject.numberFound > 4 );
			},
			
			attached: function() {
				this.loadMore();
			},
			
			resetList: function() {
				this.set( 'followList', [] );
				this.set( 'cursor', null );
				this.set( 'numberFound', 0 );
				this.set( 'isFinished', false );
				this.loadMore();
			},
			
			loadMore: function() {
				this.set( 'isLoading', true );
				this.$.UserAuthorFollowListApi.params.authorId = this.authorId;
				if( this.cursor != null )
					this.$.UserAuthorFollowListApi.params.cursor = this.cursor;
				else
					delete this.$.UserAuthorFollowListApi.params.cursor;
				this.$.UserAuthorFollowListApi.params.resultCount = this.resultCount;
				this.$.UserAuthorFollowListApi.generateRequest();
			},

			_userAuthorFollowListApiResponse: function( response ) {
				this.set( 'isLoading', false );
				this._pushToFollowList( this.processUserListObject( response.detail.response ) );
			},

			_userAuthorFollowListApiError: function( response ) {
				this.set( 'isLoading', false );
			}

		});

	</script>

</dom-module>
<dom-module id="pratilipi-author-tabs">
	<style>
		:host {
			display: block;
			margin-bottom: 12px;
		}
		.nav-tabs>li>a {
			font-size: 14px;
			line-height: 32px;
			border: none;
			color: #333;
			letter-spacing: 0;
		}
		.nav-tabs, .nav-tabs>li>a:hover {
			border-bottom: none;
			border-top: none;
			border-left: none;
			border-right: none;
			background: none;
		}
		.nav-tabs>li.active>a, .nav-tabs>li.active>a:focus, .nav-tabs>li.active>a:hover {
			border-bottom: 3px solid #D0021B;
			border-top: none;
			border-left: none;
			border-right: none;
			background: none;
			font-weight: 700;
		}
		.fade {
			opacity: 0;
			-webkit-transition: opacity 0.05s linear;
			-moz-transition: opacity 0.05s linear;
			-o-transition: opacity 0.05s linear;
			transition: opacity 0.05s linear;
		}
		.fade.in {
			opacity: 1;
			-webkit-transition: opacity 0.05s linear;
			-moz-transition: opacity 0.05s linear;
			-o-transition: opacity 0.05s linear;
			transition: opacity 0.05s linear;
	}
	</style>
	<template>
		<div class="secondary-500 pratilipi-shadow">
			<ul class="nav nav-tabs" role="tablist">
				<li id="author-activity-tab" style="width: 50%;" role="presentation" class="active">	<a href="#author-activity" 	class="text-center" aria-controls="author-activity" role="tab" data-toggle="tab">Activity</a>	</li>
				<li id="author-about-tab" style="width: 50%;" role="presentation">				<a href="#author-about" 	class="text-center" aria-controls="author-about" 	role="tab" data-toggle="tab">About</a>		</li>
			</ul>
		</div>
		<div class="tab-content">
			<div role="tabpanel" class="tab-pane fade in active" id="author-activity">

				<template is="dom-if" if="{{ hasAccessToUpdate }}">
					<pratilipi-author-drafted-contents 
						author="[[ author ]]"></pratilipi-author-drafted-contents>
				</template>

				<pratilipi-author-published-contents 
						author="[[ author ]]"></pratilipi-author-published-contents>

			</div>
			<div role="tabpanel" class="tab-pane fade" id="author-about">
				<pratilipi-author-biography author="[[ author ]]"></pratilipi-author-biography>
				<template is="dom-if" if="{{ hasUserId }}">
					<pratilipi-author-following author="[[ author ]]" user-id="{{ userId }}"></pratilipi-author-following>
				</template>
				<pratilipi-author-followers author="[[ author ]]" author-id="{{ authorId }}"></pratilipi-author-followers>
			</div>
		</div>
		<iron-ajax
				id="PratilipiApi"
				url="/api/pratilipi?_apiVer=2"
				method="POST"
				content-type="application/x-www-form-urlencoded"
				handle-as="json"
				on-response="_pratilipiApiResponse"
				on-error="_pratilipiApiError"
				></iron-ajax>
	</template>
	<script>
	Polymer({

		is: 'pratilipi-author-tabs',
		
		properties: {
			author: { type: Object, observer: "_authorObserver" },
		},
		
		_authorObserver: function() {
			this.set( 'hasAccessToUpdate', this.author.hasAccessToUpdate );
			this.set( 'hasUserId', this.author.user != null && this.author.user.userId != null );
			this.set( 'userId', this.author.user ? this.author.user.userId : null );
			this.set( 'authorId', this.author.authorId );
		},

		moveContentToDrafts: function( pratilipiId ) {
			var pratilipi = this.querySelector( 'pratilipi-author-published-contents' ).getPratilipiById( pratilipiId );
			this.querySelector( 'pratilipi-author-published-contents' ).removeFromPratilipiList( pratilipiId );
			this.querySelector( 'pratilipi-author-drafted-contents' ).addToPratilipiList( pratilipi );
			this._pratilipiApiPostCall( pratilipiId, "DRAFTED" );
		},

		publishContent: function( pratilipiId ) {
			var pratilipi = this.querySelector( 'pratilipi-author-drafted-contents' ).getPratilipiById( pratilipiId );
			this.querySelector( 'pratilipi-author-drafted-contents' ).removeFromPratilipiList( pratilipiId );
			this.querySelector( 'pratilipi-author-published-contents' ).addToPratilipiList( pratilipi );
			this._pratilipiApiPostCall( pratilipiId, "PUBLISHED" );
		},

		deleteContent: function( pratilipiId ) {
			this._pratilipiApiPostCall( pratilipiId, "DELETED" );
		},

		_pratilipiApiPostCall: function( pratilipiId, state ) {
			this.$.PratilipiApi.body = jQuery.param( { "pratilipiId": pratilipiId, "state": state } );
			this.$.PratilipiApi.generateRequest();
		},

		_pratilipiApiResponse: function( response ) {
			var pratilipi = response.detail.response;
			if( pratilipi.state == "DELETED" ) {
				document.querySelector( 'pratilipi-alert' ).alert( "The content has been deleted successfully!" );
				window.location.reload();
			}
		},

		_pratilipiApiError: function( response ) {
			document.querySelector( 'pratilipi-alert' ).alert( response != null && response.detail.request.xhr.response.message != null ? 
						response.detail.request.xhr.response.message : "Some error Occurred! Please try again!", false );
			this.async( function() { window.location.reload(); }, 2000 );
		},

		switchTabs: function() {
			if( jQuery( ".nav-tabs li.active" ).attr( 'id' ) == "author-activity-tab" ) {
				jQuery( '.nav-tabs a[href="#author-about"]' ).tab( 'show' );
			} else if( jQuery( ".nav-tabs li.active" ).attr( 'id' ) == "author-about-tab" ) {
				jQuery( '.nav-tabs a[href="#author-activity"]' ).tab( 'show' );
			}
		}
		
	});
	</script>
</dom-module><dom-module id="pratilipi-author-settings">

	<style>

		:host {
			display: block;
		}

		.pratilipi-logo {
			width: 64px;
			height: 64px;
			display: block;
			margin: auto;
		}

		textarea {
			display: block;
			width: 100%;
		}

		paper-dropdown-menu {
			width: 100%;
			--paper-dropdown-menu-focus-color: #107FE5;
			--paper-dropdown-menu-input-color: #333;
			--paper-input-container-input: {
				font-family: inherit;
			};
			--paper-input-container-underline: {
				background: #107FE5;
			};
			--paper-input-container-label: {
				font-size: 15px;
				font-family: inherit;
				text-align: left;
				color: #107FE5;
			};
		}

		paper-menu {
			--paper-menu-color: #333;
			width: 100%;
			--paper-menu-focused-item: {
				color: #107FE5;
			};
		}

		paper-menu paper-item {
			font-size: 15px;
			font-family: inherit;
			color: #333;
			white-space: nowrap;
		}

		.modal-fullscreen .modal-dialog .modal-content {max-width: 768px;padding-top:5px;}
	</style>

	<template>
		<div class="modal modal-fullscreen fade" id="pratilipiAuthorSettings" role="dialog" tabindex="-1">
			<div class="modal-dialog" role="document">
				<div class="modal-content">

					<div class="modal-fullscreen-close-button">
						<paper-icon-button noink icon="close" data-dismiss="modal"></paper-icon-button>
					</div>

					<iron-image class="pratilipi-logo" 
										style="background-color: #f5f5f5" 
										fade preload
										sizing="cover" 
										src="http://public.pratilipi.com/pratilipi-logo/png/Logo-2C-RGB-80px.png"  
										alt="Pratilipi"  
										title="Pratilipi"></iron-image>

					<h6 class="text-center">{{ author.fullName }}</h6>

					<div class="row">
						<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
							<pratilipi-input icon="social:person" label="First Name( Vernacular )" value="{{ firstName::input }}"></pratilipi-input>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
							<pratilipi-input label="Last Name( Vernacular )" value="{{ lastName::input }}"></pratilipi-input>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
							<pratilipi-input icon="social:person-outline" label="First Name( English )" value="{{ firstNameEn::input }}"></pratilipi-input>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
							<pratilipi-input label="Last Name( English )" value="{{ lastNameEn::input }}"></pratilipi-input>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
							<pratilipi-input icon="editor:format-quote" label="Pen Name ( Vernacular )" value="{{ penName::input }}"></pratilipi-input>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
							<pratilipi-input label="Pen Name ( English )" value="{{ penNameEn::input }}"></pratilipi-input>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
							<paper-dropdown-menu id="authorGender" no-animations noink label="Gender">
								<paper-menu noink selected="[[ selectedGender ]]" class="dropdown-content" style="white-space: nowrap; width: auto;">
									<paper-item value="MALE">Male</paper-item>
									<paper-item value="FEMALE">Female</paper-item>
									<paper-item value="OTHER">Other</paper-item>
								</paper-menu>
							</paper-dropdown-menu>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
							<pratilipi-input icon="social:location-city" label="Location" value="{{ location::input }}"></pratilipi-input>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
							<pratilipi-input type="date" icon="icons:date-range" label="Birthday (dd-mm-yyyy)" always-float-label value="{{ dateOfBirth::input }}"></pratilipi-input>
						</div>
						<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
							<paper-dropdown-menu id="authorLanguage" no-animations noink label="Select Language">
								<paper-menu noink selected="[[ selectedLanguage ]]" class="dropdown-content" style="white-space: nowrap; width: auto;">
									<paper-item value="BENGALI">Bengali</paper-item>
									<paper-item value="GUJARATI">Gujarati</paper-item>
									<paper-item value="HINDI">Hindi</paper-item>
									<paper-item value="MALAYALAM">Malayalam</paper-item>
									<paper-item value="MARATHI">Marathi</paper-item>
									<paper-item value="TAMIL">Tamil</paper-item>
									<paper-item value="TELUGU">Telugu</paper-item>
									<paper-item value="KANNADA">Kannada</paper-item>
								</paper-menu>
							</paper-dropdown-menu>
						</div>
						<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
							<div style="margin-top: 25px; margin-bottom: 5px; text-align: left;"><span class="pratilipi-blue" style="font-size: 14px;">Summary ( Optional )</span></div>
							<textarea rows="10" value="{{ summary::input }}"></textarea>
						</div>
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<div class="display-message-div"><p>{{ message }}</p></div>
				<button id="authorSaveChangesButton" style="position: fixed; bottom: 15px; right: 15px;" class="pratilipi-dark-blue-button" type="button" on-click="onSubmit">Save Changes</button>
			</div>
		</div>
		<iron-ajax
				id="AuthorApi"
				url="/api/author"
				method="POST"
				content-type="application/x-www-form-urlencoded"
				handle-as="json"
				on-response="_authorApiResponse"
				on-error="_authorApiError"
				></iron-ajax>
	</template>

	<script>
		function updateObject( o1, o2 ) {
			if( o2 == null || typeof(o2) != 'object' ) return o2;
			for( var key in o2 ) {
				if( o1[key] == null ) o1[key] = new o2[key].constructor()
				o1[key] = updateObject( o1[key], o2[key] );
			}
			return o1;
		}
		Polymer({

			is: 'pratilipi-author-settings',

			properties: {
				author: { type: Object },
				user: { type: Object },

				// Specific to input fields
				authorId: { type: String },
				firstName: { type: String },
				lastName: { type: String },
				penName: { type: String },
				firstNameEn: { type: String },
				lastNameEn: { type: String },
				penNameEn: { type: String },
				gender: { type: String },
				dateOfBirth: { type: String },
				language: { type: String },
				location: { type: String },
				summary: { type: String },

				// Specific to the modal
				selectedLanguage: { type: Number },
				selectedGender: { type: Number },
 				message: { type: String }
			},

			_processDateOfBirth: function( input ) {
				var datePart = input.match(/\d+/g);
				if( parseInt( datePart[0] ) < 1800 ) return input;
				var year = datePart[0], month = datePart[1], day = datePart[2];
				return day+'-'+month+'-'+year;
			},

			_setDateProcess: function( input ) {
				var date = input.split( "-" );
				if( date[2] > 1800 ) return date[2] + "-" + date[1] + "-" + date[0];
				return input;
			},

			process: function( author ) {
				this.set( 'message', null );
				this.set( 'authorId', author.authorId );
				this.set( 'firstName', author.firstName );
				this.set( 'lastName', author.lastName );
				this.set( 'penName', author.penName );
				this.set( 'firstNameEn', author.firstNameEn );
				this.set( 'lastNameEn', author.lastNameEn );
				this.set( 'penNameEn', author.penNameEn );
				this.set( 'dateOfBirth', author.dateOfBirth == null ? null : this._setDateProcess( author.dateOfBirth ) );
				this.set( 'location', author.location );
				this.set( 'summary', author.summary );

				// paper-dropdown-menu for language
				this.set( 'language', author.language );
				this.set( 'selectedLanguage', null );
				if( this.language == "BENGALI" )
					this.set( 'selectedLanguage', 0 );
				else if( this.language == "GUJARATI" )
					this.set( 'selectedLanguage', 1 );
				else if( this.language == "HINDI" )
					this.set( 'selectedLanguage', 2 );
				else if( this.language == "MALAYALAM" )
					this.set( 'selectedLanguage', 3 );
				else if( this.language == "MARATHI" )
					this.set( 'selectedLanguage', 4 );
				else if( this.language == "TAMIL" )
					this.set( 'selectedLanguage', 5 );
				else if( this.language == "TELUGU" )
					this.set( 'selectedLanguage', 6 );
				else if( this.language == "KANNADA" )
					this.set( 'selectedLanguage', 7 );

				// paper-dropdown-menu for language
				this.set( 'gender', author.gender == null ? null : author.gender.toUpperCase() );
				this.set( 'selectedGender', null );
				if( this.gender == "MALE" )
					this.set( 'selectedGender', 0 );
				else if( this.gender == "FEMALE" )
					this.set( 'selectedGender', 1 );
				else if( this.gender == "OTHER" )
					this.set( 'selectedGender', 2 );
			},

			editAuthor: function() {
				this.process( this.author );
				this.async( function() {
					jQuery( "#pratilipiAuthorSettings" ).modal();
				});
			},

			close: function() {
				jQuery( "#pratilipiAuthorSettings" ).modal( 'hide' );
			},

			onSubmit: function( event ) {
				/* Mandatory fields */
				if( ( this.firstName == null || this.firstName.trim() == "" ) 
					&& ( this.firstNameEn == null || this.firstNameEn.trim() == "" ) ) {
					this.message = "Please enter your first name!";
					return;
				}
				if( this.$.authorLanguage.selectedItem == null ) {
					this.message = "Please enter your language!";
					return;
				}

				this.message = "Working ...";
				jQuery( '#authorSaveChangesButton' ).prop( 'disabled', true );

				this.language = this.$.authorLanguage.selectedItem.getAttribute( "value" );
				if( this.$.authorGender.selectedItem )
					this.gender = this.$.authorGender.selectedItem.getAttribute( "value" );

				var body = {
						authorId: this.authorId,
						language: this.language,
						summary: this.summary
				};

				if( this.firstName != null ) body.firstName = this.firstName;
				if( this.lastName != null ) body.lastName = this.lastName;
				if( this.penName != null ) body.penName = this.penName;
				if( this.firstNameEn != null ) body.firstNameEn = this.firstNameEn;
				if( this.lastNameEn != null ) body.lastNameEn = this.lastNameEn;
				if( this.penNameEn != null ) body.penNameEn = this.penNameEn;
				if( this.gender != null ) body.gender = this.gender;
				if( this.dateOfBirth != null ) body.dateOfBirth = this._processDateOfBirth( this.dateOfBirth );
				if( this.location != null ) body.location = this.location;

				this.$.AuthorApi.body = jQuery.param( body );
				this.$.AuthorApi.generateRequest();				
			},

			_authorApiResponse: function( event ) {
				this.message = "Success !";
				jQuery( '#authorSaveChangesButton' ).prop( 'disabled', false );
				var author = event.detail.response;
				author.user = this.author.user;
				this.domHost.updateAuthor( author );
				this.async( function() {
					this.message = null;
					this.close();
				}, 1000 );
			},

			_authorApiError: function( event ) {
				jQuery( '#authorSaveChangesButton' ).prop( 'disabled', false );
				this.message = event.detail.request.xhr.response.message != null ? 
						event.detail.request.xhr.response.message : "Some error Occurred! Please try again!";   
			}

		});
	</script>
	
</dom-module>
<dom-module id="pratilipi-author-page">
	<style>
		:host {
			display: block;
		}
	</style>
	
	<template>
		<pratilipi-user user='{{ user }}' user-data="[[ userData ]]"></pratilipi-user>
		<pratilipi-edit-account show-logout-button user='[[ user ]]'></pratilipi-edit-account>
		<pratilipi-write language-map="[[ languageMap ]]" pratilipi-types='[[ pratilipiTypes ]]'></pratilipi-write>
		<pratilipi-alert></pratilipi-alert>

		<div class="header-pos">
<pratilipi-android-launch-test></pratilipi-android-launch-test>		   		</div>
   		<main>
   			<pratilipi-header language-map="[[ languageMap ]]" user='[[ user ]]'></pratilipi-header>
   			<div class="parent-container margin-top-bottom">
				<div class="container">
					<pratilipi-navigation
							class='pull-left hidden-xs hidden-sm'
							navigation-list='[[ navigationList ]]'
							></pratilipi-navigation>
					<pratilipi-navigation-drawer with-backdrop navigation-list='[[ navigationList ]]'></pratilipi-navigation-drawer>
					<div style="overflow:hidden; padding: 0 2px;">
						<div id="androidLaunchBottom">
							<pratilipi-author-details
									author='[[ author ]]'
									user-author='[[ userAuthor ]]'></pratilipi-author-details>
							<pratilipi-author-tabs 
									user="[[ user ]]"
									author="[[ author ]]"></pratilipi-author-tabs>
							<pratilipi-author-settings author="[[ author ]]" user="[[ user ]]"></pratilipi-author-settings>
						</div>
					</div>
				</div>
			</div>
   		</main>
		<footer>
   			<pratilipi-footer></pratilipi-footer>
		</footer>
		<div class="scroll-top-button">
			<a id="scrollToTop" on-click="scrollToTop"><paper-fab mini noink style="background: #c0c0c0;" icon="icons:arrow-upward"></paper-fab></a>
		</div>
		<iron-ajax
				id="AuthorGetApi"
				url="/api/author"
				method="GET"
				content-type="application/json"
				handle-as="json"
				on-response="_authorGetApiResponse"
				></iron-ajax>
				
		<iron-ajax
				id="UserAuthorGetApi"
				url="/api/userauthor/follow"
				method="GET"
				content-type="application/json"
				handle-as="json"
				on-response="_userAuthorGetApiResponse"
				></iron-ajax>
	</template>

	<script>
		Polymer({

			is: 'pratilipi-author-page',
			
			properties: {
				userData: { type: Object },
				user: { type: Object, observer: "_userObserver" },
				author: { type: Object },
				userAuthor: { type: Object },
				loadUser: { type: Boolean, value: false },
				
				pratilipiTypes: { types: Object },
				navigationList: { type: Array },
				languageMap: { type: Object },
				lastScrollTop: { type: Number, value: 0 }
			},
			
			_userObserver: function() {
				if( ! this.loadUser ) {
					this.loadUser = true;
					return;
				}
				this.getAuthor();
				this.getUserAuthor();
			},

			getAuthor: function() {
				if( this.author == null ) return;
				this.$.AuthorGetApi.params.authorId = this.author.authorId;
				this.$.AuthorGetApi.generateRequest();
			},

			getUserAuthor: function() {
				if( this.author == null ) return;
				this.$.UserAuthorGetApi.params.authorId = this.author.authorId;
				this.$.UserAuthorGetApi.generateRequest();
			},
			
			updateAuthor: function( author ) {
				this.set( 'author', author );
			},
			
			updateUserAuthor: function( userAuthor ) {
				this.set( 'userAuthor', userAuthor );
			},
			
			_authorGetApiResponse: function( response ) {
				this.updateAuthor( response.detail.response );
			},
			
			_userAuthorGetApiResponse: function( response ) {
				this.updateUserAuthor( response.detail.response );
			},
			
			editAuthorProfile: function() {
				this.querySelector( 'pratilipi-author-settings' ).editAuthor();
			},
			
			ready: function() {
				jQuery( '#scrollToTop' ).css( "display", "none" );
			},
			
			scrollToTop: function() {
				$( 'html, body' ).animate( { scrollTop : 0 },800 );
			},
			
			scrollHandler: function( st ) {
				if( st > this.lastScrollTop || st < 100 )
					jQuery( '#scrollToTop' ).fadeOut();
				else
					jQuery( '#scrollToTop' ).fadeIn();
			
				this.lastScrollTop = st;
			
			}

		});

	</script>

</dom-module>