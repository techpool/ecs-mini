<dom-module id="pratilipi-facebook-login">
<style>
:host {
display: block;
text-align: center;
}
button.fb-button {
margin: 0 auto;
margin-bottom: 12px;
background-color: #3b5998;
color: #FFFFFF;
border: none;
border-radius: 2px;
white-space: nowrap;
outline: none;
padding: 2px;
width: 320px;
}
button.fb-button span.icon {
display: inline-block;
background-image: url('https://0.ptlp.co/resource-all/icon/png/fb-logo-64.png');
background-size: contain;
vertical-align: middle;
width: 36px;
height: 36px;
float: left;
}
button.fb-button span.button-text {
display: inline-block;
vertical-align: middle;
text-align: center;
font-size: 14px;
font-weight: bold;
line-height: 36px;
}
</style>
<template>
<button class="fb-button" on-click="fb_login">
<span class="icon"></span>
<span class="button-text">ഫേസ്ബുക്ക് സൈനിന്‍</span>
</button>
<iron-ajax
id="AjaxPost"
url="/api/user/login/facebook"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_handleAjaxPostResponse"
on-error="_handleAjaxPostError"
></iron-ajax>
</template>
<script>
Polymer ({
is: 'pratilipi-facebook-login',
properties: {
requestOnFlight: { type: Boolean, value: false }
},
sendData: function( authResponse ) {
if( this.requestOnFlight )
return;
if( authResponse != null ) {
this.requestOnFlight = true;
this.$.AjaxPost.body = ( "fbUserAccessToken=" + authResponse.accessToken );
this.$.AjaxPost.generateRequest();
}
},
fb_login: function() {
FB.init({
appId: 293990794105516,
cookie : true,
xfbml: true,
version: 'v2.6'
});
FB.login( function( response ) {
document.querySelector( 'pratilipi-facebook-login' ).sendData( response.authResponse );
}, { scope: 'public_profile,email,user_birthday' } );
},
attached: function() {
this.async( function() {
if( typeof(FB) == 'undefined' ) {
(function(d, s, id) {
var js, fjs = d.getElementsByTagName(s)[0];
if (d.getElementById(id)) return;
js = d.createElement(s); js.id = id;
js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
}
});
},
_handleAjaxPostResponse: function( event ) {
this.requestOnFlight = false;
document.querySelector( 'pratilipi-user' ).updateUser( event.detail.response );
document.querySelector( 'pratilipi-user' ).closeAllElements();
},
_handleAjaxPostError: function( event ) {
this.requestOnFlight = false;
alert( event.detail.request.xhr.response.message );
},
});
</script>
</dom-module><dom-module id="pratilipi-google-login">
<style>
:host {
display: block;
text-align: center;
}
button.google-button {
margin: 0 auto;
margin-bottom: 12px;
background-color: #4285F4;
color: #FFFFFF;
border: none;
border-radius: 2px;
white-space: nowrap;
outline: none;
padding: 2px;
width: 320px;
}
button.google-button span.icon {
display: inline-block;
background-image: url('https://0.ptlp.co/resource-all/icon/png/g-logo.png');
background-size: contain;
vertical-align: middle;
width: 36px;
height: 36px;
float: left;
}
button.google-button span.button-text {
display: inline-block;
vertical-align: middle;
text-align: center;
font-size: 14px;
font-weight: bold;
line-height: 36px;
}
</style>
<template>
<button id="googleLoginButton" class="google-button">
<span class="icon"></span>
<span class="button-text">ഗൂഗിള്‍ ഉപയോഗിച്ച് സൈനിന്‍</span>
</button>
<iron-ajax
id="AjaxPost"
url="/api/user/login/google"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_handleAjaxPostResponse"
on-error="_handleAjaxPostError"
></iron-ajax>
</template>
<script>
function sendData( googleIdToken ) {
document.querySelector( 'pratilipi-google-login' ).sendData( googleIdToken );
}
Polymer ({
is: 'pratilipi-google-login',
properties: {
requestOnFlight: { type: Boolean, value: false }
},
attached: function() {
var element = this.querySelector( '#googleLoginButton' );
gapi.load( 'auth2', function() {
auth2 = gapi.auth2.init({
client_id: '659873510744-kfim969enh181h4gbctffrjg5j47tfuq.apps.googleusercontent.com',
cookiepolicy: 'single_host_origin',
});
auth2.attachClickHandler( element, {},
function( googleUser ) {
this.requestOnFlight = true;
sendData( googleUser.getAuthResponse().id_token );
}, function( error ) {
console.log( JSON.stringify( error, undefined, 2 ) );
});
});
},
sendData: function( googleIdToken ) {
if( this.requestOnFlight || googleIdToken == null )
return;
this.requestOnFlight = true;
this.$.AjaxPost.body = ( "googleIdToken=" + googleIdToken );
this.$.AjaxPost.generateRequest();
},
_handleAjaxPostResponse: function( event ) {
this.requestOnFlight = false;
document.querySelector( 'pratilipi-user' ).updateUser( event.detail.response );
document.querySelector( 'pratilipi-user' ).closeAllElements();
},
_handleAjaxPostError: function( event ) {
this.requestOnFlight = false;
alert( event.detail.request.xhr.response.googleIdToken != null ? event.detail.request.xhr.response.googleIdToken : event.detail.request.xhr.response.message );
}
});
</script>
</dom-module><dom-module id="pratilipi-user-login">
<style>
.modal-fullscreen {
padding: 0;
}
.modal-fullscreen .modal-dialog {
height: 100%;
}
.modal-fullscreen .modal-dialog .modal-content {
padding-top: 1px;
padding-bottom: 24px;
max-width: 400px;
}
.forgot-password {
display: block;
text-align: center;
margin-top: 24px;
}
.register {
margin-top: 6px;
text-align: center;
}
.custom-message {
font-size: 15px;
margin-bottom: 20px;
line-height: 24px;
}
</style>
<template>
<div class="modal modal-fullscreen fade" id="pratilipiUserLogin" role="dialog" tabindex="-1">
<div class="modal-dialog" role="document">
<div class="modal-content" on-keyup="onSubmit">
<div class="modal-fullscreen-close-button">
<paper-icon-button noink icon="close" data-dismiss="modal"></paper-icon-button>
</div>
<img title="പ്രതിലിപി" alt="പ്രതിലിപി" src="http://public.pratilipi.com/pratilipi-logo/png/Logo-2C-RGB-80px.png" />
<template is="dom-if" if="{{ requireAccess }}">
<h6 class="text-center custom-message">{{ customMessage }}</h6>
</template>
<pratilipi-facebook-login></pratilipi-facebook-login>
<pratilipi-google-login></pratilipi-google-login>
<div style="height: 2px; background-color: #FFF; text-align: center; margin-top: 12px;"></div>
<h6 class="modal-fullscreen-heading">പ്രതിലിപിയിലേക്ക് സൈനിന്‍ ചെയ്യൂ</h6>
<pratilipi-input label="ഇമെയില്‍ അഡ്രസ്സ്" value="{{ email::input }}" icon="icons:mail" type="email"></pratilipi-input>
<pratilipi-input label="പാസ്സ്‌വേര്‍ഡ്‌" value="{{ password::input }}" icon="icons:lock" type="password"></pratilipi-input>
<div class="display-message-div">
<p>{{ message }}</p>
</div>
<button id="loginButton" class="pratilipi-blue-button" on-click="onSubmit">സൈനിന്‍</button>
<a class="pratilipi-red forgot-password" on-click="resetPassword">പാസ്സ്‌വേര്‍ഡ്‌ മറന്നുപോയോ?</a>
<div class="text-muted register">പുതിയ യൂസര്‍ ആണോ?&nbsp;&nbsp;<a class="pratilipi-blue" on-click="register">സൈനപ്പ് ചെയ്യൂ !</a></div>
</div>
</div>
</div>
<iron-ajax
id="AjaxPost"
url="/api/user/login"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_handleAjaxPostResponse"
on-error="_handleAjaxPostError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-user-login',
properties: {
email: { type: String, value: null },
password: { type: String, value: null },
message: { type: String, value: null }
},
register: function() {
document.querySelector( 'pratilipi-user' ).register();
},
resetPassword: function() {
document.querySelector( 'pratilipi-user' ).resetPassword();
},
open: function( requireAccess, customMessage ) {
this.set( 'requireAccess', requireAccess );
this.set( 'customMessage', customMessage != null ? customMessage : "ഇത് ചെയ്യണമെങ്കില്‍ താങ്കള്‍ ലോഗ് ഇന്‍ ചെയ്യണം!" );
this.async( function() {
jQuery( "#pratilipiUserLogin" ).modal( {backdrop: 'static'} );
});
},
close: function() {
jQuery( "#pratilipiUserLogin" ).modal( 'hide' );
},
onSubmit: function( event ) {
if( event.keyCode != null && event.keyCode != 0 && event.keyCode != 13 || jQuery( '#loginButton' ).prop( 'disabled' ) )
return;
this.message = null;
if( this.email == null || this.password == null || this.email.trim() == "" || this.password == "" ) {
this.message = "Please fill in the details";
return;
}
this.message = "പ്രവര്‍ത്തിച്ചുകൊണ്ടിരിക്കുന്നു. . .";
jQuery( '#loginButton' ).prop( 'disabled', true );
var body = { email: this.email, password: this.password };
this.$.AjaxPost.body = jQuery.param( body );
this.$.AjaxPost.generateRequest();
},
_handleAjaxPostResponse: function( event ) {
this.message = null;
if( event.detail.xhr.status == 0 ) {
this.message = "Could not connect to server !";
} else {
this.message = "വിജയകരമായി പൂര്‍ത്തീകരിച്ചിരിക്കുന്നു !";
this.async( function() {
this.email = null;
this.password = null;
this.message = null;
jQuery( '#loginButton' ).prop( 'disabled', false );
this.close();
}, 1000 );
document.querySelector( 'pratilipi-user' ).updateUser( event.detail.response );
}
},
_handleAjaxPostError: function( event ) {
this.message = null;
jQuery( '#loginButton' ).prop( 'disabled', false );
if( event.detail.request.xhr.status == 400 || event.detail.request.xhr.status == 401 || event.detail.request.xhr.status == 500 ) {
if( event.detail.request.xhr.response.email != null )
this.message = event.detail.request.xhr.response.email;
else if( event.detail.request.xhr.response.password != null )
this.message = event.detail.request.xhr.response.password;
else if( event.detail.request.xhr.response.message != null )
this.message = event.detail.request.xhr.response.message;
else
this.message = "Invalid Credentials!";
} else {
if( event.detail.request.xhr.response != null )
this.message = event.detail.request.xhr.response.message;
else
this.message = "Some exception occurred at the server, please try again!";
}
},
});
</script>
</dom-module><dom-module id="pratilipi-user-register">
<style>
.modal-fullscreen {
padding: 0;
}
.modal-fullscreen .modal-dialog {
height: 100%;
}
.modal-fullscreen .modal-dialog .modal-content {
padding-top: 4px;
padding-bottom: 24px;
max-width: 400px;
}
</style>
<template>
<div class="modal modal-fullscreen fade" id="pratilipiUserRegister" role="dialog" tabindex="-1">
<div class="modal-dialog" role="document">
<div class="modal-content" on-keyup="onSubmit">
<div class="modal-fullscreen-close-button">
<paper-icon-button noink icon="close" data-dismiss="modal"></paper-icon-button>
</div>
<img title="പ്രതിലിപി" alt="പ്രതിലിപി" src="http://public.pratilipi.com/pratilipi-logo/png/Logo-2C-RGB-80px.png" />
<pratilipi-facebook-login></pratilipi-facebook-login>
<pratilipi-google-login></pratilipi-google-login>
<div style="height: 2px; background-color: #FFF; text-align: center; margin-top: 12px;"></div>
<h6 class="modal-fullscreen-heading">സൈനപ്പ് ചെയ്യൂ !</h6>
<pratilipi-input label="മുഴുവന്‍ പേര്" value="{{ name::input }}" icon="icons:account-box"></pratilipi-input>
<pratilipi-input label="ഇമെയില്‍ അഡ്രസ്സ്" type="email" value="{{ email::input }}" icon="icons:mail"></pratilipi-input>
<pratilipi-input label="പാസ്സ്‌വേര്‍ഡ്‌" type="password" value="{{ password::input }}" icon="icons:lock"></pratilipi-input>
<div class="display-message-div">
<p>{{ message }}</p>
</div>
<div style="padding: 12px 0px;">
<input style="position: absolute; margin-top: 8px;" type="checkbox" name="acceptTerms" id="acceptTerms">
<p style="text-align: center; display: inline-block; margin-left: 16px;">
ഇത് ചെയ്യുന്നതോടെ താങ്കള്‍
<a class="pratilipi-blue" style="white-space: nowrap;" href="/privacy-policy">പ്രൈവസി പോളിസി</a>
&nbsp;യും&nbsp;
<a class="pratilipi-blue" style="white-space: nowrap;" href="/terms-of-service">നിബന്ധനകള്‍</a>
&nbsp;ഉം അംഗീകരിക്കുന്നു.
</p>
</div>
<button id="registerButton" class="pratilipi-blue-button" on-click="onSubmit">സൈനപ്പ് ചെയ്യൂ !</button>
<div class="text-center" style="margin-top: 24px;">
<span class="text-muted">പ്രതിലിപിയില്‍ നിലവിലുള്ള അംഗമാണോ?&nbsp;</span>
<a class="pratilipi-blue" on-click="logIn">സൈനിന്‍ ചെയ്യാന്‍</a>
</div>
</div>
</div>
</div>
<iron-ajax
id="AjaxPost"
url="/api/user/register"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_handleAjaxPostResponse"
on-error="_handleAjaxPostError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-user-register',
properties: {
name: { type: String },
email: { type: String },
password: { type: String },
language: { type: String, value: "MALAYALAM" },
message: { type: String, value: null }
},
logIn: function() {
document.querySelector( 'pratilipi-user' ).logIn();
},
defaultMessages: function() {
this.message = null;
},
open: function() {
this.async( function() {
jQuery( "#pratilipiUserRegister" ).modal( {backdrop: 'static'} );
});
},
close: function() {
jQuery( "#pratilipiUserRegister" ).modal( 'hide' );
},
onSubmit: function( event ) {
if( event.keyCode != null && event.keyCode != 0 && event.keyCode != 13 || jQuery( '#registerButton' ).prop( 'disabled' ) )
return;
this.message = null;
if( this.name == null || this.email == null || this.password == null || this.name.trim() == "" || this.email.trim() == "" ) {
this.message = "ദയവായി വിവരങ്ങള്‍ ചേര്‍ക്കുക!";
return;
}
if( !document.getElementById( "acceptTerms" ).checked ) {
this.message = "ദയവായി നിബന്ധനകള്‍ അംഗീകരിക്കുക!";
return;
}
this.message = "പ്രവര്‍ത്തിച്ചുകൊണ്ടിരിക്കുന്നു. . .";
jQuery( '#registerButton' ).prop( 'disabled', true );
var body = {
name: this.name,
email: this.email,
password: this.password,
language: this.language
};
this.$.AjaxPost.body = jQuery.param( body );
this.$.AjaxPost.generateRequest();
},
_handleAjaxPostResponse: function( event ) {
if( event.detail.xhr.status == 0 ) {
this.message = "സെര്‍വറുമായി ബന്ധം സ്ഥാപിക്കാനാവുന്നില്ല!";
} else {
this.message = "വിജയകരമായി പൂര്‍ത്തീകരിച്ചിരിക്കുന്നു !";
this.async( function() {
this.message = null;
this.name = null;
this.email = null;
this.password = null;
jQuery( '#registerButton' ).prop( 'disabled', false );
this.close();
}, 1000 );
document.querySelector( 'pratilipi-user' ).updateUser( event.detail.response );
}
},
_handleAjaxPostError: function( event ) {
this.message = null;
jQuery( '#registerButton' ).prop( 'disabled', false );
if( event.detail.request.xhr.status == 400 ) {
if( event.detail.request.xhr.response.email != null ) {
this.message = event.detail.request.xhr.response.email;
return;
}
this.message = event.detail.request.xhr.response.password != null ? event.detail.request.xhr.response.password : "Invalid Data!";
}
else
this.message = event.detail.request.xhr.response.message;
},
});
</script>
</dom-module><dom-module id="pratilipi-user-password-reset">
<style>
.modal-fullscreen {
padding: 0;
}
.modal-fullscreen .modal-dialog {
height: 100%;
}
.modal-fullscreen .modal-dialog .modal-content {
padding-top: 64px;
padding-bottom: 24px;
max-width: 450px;
}
</style>
<template>
<div class="modal modal-fullscreen fade" id="pratilipiUserPasswordReset" role="dialog" tabindex="-1">
<div class="modal-dialog" role="document">
<div class="modal-content" on-keyup="onSubmit">
<div class="modal-fullscreen-close-button">
<paper-icon-button noink icon="close" data-dismiss="modal"></paper-icon-button>
</div>
<img title="പ്രതിലിപി" alt="പ്രതിലിപി" src="http://public.pratilipi.com/pratilipi-logo/png/Logo-2C-RGB-80px.png" />
<h6 class="modal-fullscreen-heading">പാസ്സ്‌വേര്‍ഡ്‌ മറന്നുപോയോ?</h6>
<p style="text-align: justify; margin-top: 15px;">
താങ്കള്‍ സൈനപ്പ് ചെയ്ത ഇ മെയില്‍ അഡ്രസ്‌ നല്‍കുക. പാസ്സ്‌വേര്‍ഡ്‌ റീസെറ്റ്‌ ചെയ്യാന്‍ വേണ്ട ലിങ്ക് ഞങ്ങള്‍ അയച്ചു തരാം.
</p>
<pratilipi-input type="email" label="ഇമെയില്‍ അഡ്രസ്സ്" value="{{ email::input }}" icon="icons:mail"></pratilipi-input>
<div class="display-message-div">
<p>{{ message }}</p>
</div>
<button id="passwordResetButton" class="pratilipi-blue-button" on-click="onSubmit">പാസ്സ്‌വേര്‍ഡ്‌ റീസെറ്റ് ചെയ്യൂ</button>
<div class="text-center" style="margin-top: 24px;">
<a class="pratilipi-blue" on-click="logIn">സൈനിന്‍ ചെയ്യാന്‍</a>
</div>
</div>
</div>
</div>
<iron-ajax
id="AjaxPost"
url="/api/user/email"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_handleAjaxPostResponse"
on-error="_handleAjaxPostError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-user-password-reset',
properties: {
email: { type: String, value: null },
message: { type: String, value: null }
},
logIn: function() {
document.querySelector( 'pratilipi-user' ).logIn();
},
open: function() {
this.async( function() {
jQuery( "#pratilipiUserPasswordReset" ).modal( {backdrop: 'static'} );
});
},
close: function() {
jQuery( "#pratilipiUserPasswordReset" ).modal( 'hide' );
},
onSubmit: function( event ) {
if( event.keyCode != null && event.keyCode != 0 && event.keyCode != 13 || jQuery( '#passwordResetButton' ).prop( 'disabled' ) )
return;
this.message = null;
if( this.email == null || this.email.trim() == "" ) {
this.message = "Please enter your email";
return;
}
this.message = "പ്രവര്‍ത്തിച്ചുകൊണ്ടിരിക്കുന്നു. . .";
jQuery( '#passwordResetButton' ).prop( 'disabled', true );
var ajaxPost = this.$.AjaxPost;
ajaxPost.body = jQuery.param( { "email": this.email, "sendPasswordResetMail": true } );
ajaxPost.generateRequest();
},
_handleAjaxPostResponse: function( event ) {
this.message = null;
if( event.detail.xhr.status == 0 ) {
this.message = "സെര്‍വറുമായി ബന്ധം സ്ഥാപിക്കാനാവുന്നില്ല!";
} else {
this.message= "താങ്കളുടെ ഇ മെയില്‍ ഐ ഡി യിലേക്ക് ഒരു മെയില്‍ അയച്ചിരിക്കുന്നു!";
this.async( function() {
this.email = null;
this.message = null;
this.close();
}, 3000 );
jQuery( '#passwordResetButton' ).prop( 'disabled', false );
}
},
_handleAjaxPostError: function( event ) {
this.message = null;
jQuery( '#passwordResetButton' ).prop( 'disabled', false );
if( event.detail.request.xhr.response.email != null )
this.message = event.detail.request.xhr.response.email;
else
this.message = event.detail.request.xhr.response.message;
},
});
</script>
</dom-module><dom-module id="pratilipi-user-password-update">
<style>
.modal-fullscreen {
padding: 0;
}
.modal-fullscreen .modal-dialog {
height: 100%;
}
.modal-fullscreen .modal-dialog .modal-content {
padding-top: 64px;
padding-bottom: 24px;
max-width: 400px;
}
</style>
<template>
<div class="modal modal-fullscreen fade" id="pratilipiUserPasswordUpdate" role="dialog" tabindex="-1">
<div class="modal-dialog" role="document">
<div class="modal-content" on-keyup="onSubmit">
<div class="modal-fullscreen-close-button">
<paper-icon-button noink icon="close" data-dismiss="modal"></paper-icon-button>
</div>
<img title="പ്രതിലിപി" alt="പ്രതിലിപി" src="http://public.pratilipi.com/pratilipi-logo/png/Logo-2C-RGB-80px.png" />
<h6 class="modal-fullscreen-heading">പാസ്സ്‌വേര്‍ഡ്‌ റീസെറ്റ് ചെയ്യൂ</h6>
<template is="dom-if" if="{{ showCurrentPassword }}">
<pratilipi-input label="നിലവിലുള്ള പാസ്സ്‌വേര്‍ഡ്‌" type="password" value="{{ password::input }}" icon="icons:lock-open"></pratilipi-input>
</template>
<pratilipi-input label="പുതിയ പാസ്സ്‌വേര്‍ഡ്‌" type="password" value="{{ newPassword::input }}" icon="icons:lock-outline"></pratilipi-input>
<pratilipi-input label="പാസ്സ്‌വേര്‍ഡ്‌ ഒന്നു കൂടി ടൈപ്പ് ചെയ്യൂ" type="password" value="{{ newPassword2::input }}" icon="icons:lock"></pratilipi-input>
<div class="display-message-div">
<p>{{ message }}</p>
</div>
<button id="passwordUpdateButton" class="pratilipi-blue-button" on-click="onSubmit">പുതുക്കുക</button>
</div>
</div>
</div>
<iron-ajax
id="AjaxPost"
url="/api/user/passwordupdate"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_handleAjaxPostResponse"
on-error="_handleAjaxPostError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-user-password-update',
properties: {
email: { type: String, value: null },
verificationToken: { type: String, value: null },
password: { type: String, value: null },
newPassword: { type: String, value: null },
newPassword2: { type: String, value: null },
showCurrentPassword: { type: Boolean, value: true },
message: { type: String, value: null },
},
openPasswordUpdate: function( email, token ) {
this.email = email;
this.verificationToken = token;
this.showCurrentPassword = false;
this.open();
},
clearMessages: function() {
this.message = null;
this.password = null;
this.newPassword = null;
this.newPassword2 = null;
this.email = null;
this.verificationToken = null;
this.showCurrentPassword = true;
},
open: function() {
this.async( function() {
jQuery( "#pratilipiUserPasswordUpdate" ).modal( {backdrop: 'static'} );
});
},
close: function() {
this.clearMessages();
jQuery( "#pratilipiUserPasswordUpdate" ).modal( 'hide' );
},
onSubmit: function( event ) {
if( event.keyCode != null && event.keyCode != 0 && event.keyCode != 13 || jQuery( '#passwordUpdateButton' ).prop( 'disabled' ) )
return;
this.message = null;
if( this.showCurrentPassword && this.password == null ) {
this.message = "Please enter your current password!";
return;
}
if( this.newPassword == null ) {
this.message = "Please enter the password!";
return;
}
if( this.newPassword2 == null ) {
this.message = "Please re-enter the password!";
return;
}
if( this.newPassword != this.newPassword2 ) {
this.message = "Passwords doesn't match!";
return;
}
this.message = "പ്രവര്‍ത്തിച്ചുകൊണ്ടിരിക്കുന്നു. . .";
jQuery( '#passwordUpdateButton' ).prop( 'disabled', true );
var ajaxBody = {};
if( this.email != null && this.verificationToken != null )
ajaxBody = { "email" : this.email, "verificationToken" : this.verificationToken };
else if( this.password != null )
ajaxBody = { "password" : this.password };
ajaxBody[ "newPassword" ] = this.newPassword;
this.$.AjaxPost.body = jQuery.param( ajaxBody );
this.$.AjaxPost.generateRequest();
ga_CA( 'User', 'SubmitPassword' );
},
_handleAjaxPostResponse: function( event ) {
if( event.detail.xhr.status == 0 ) {
this.message = "Could not connect to server !";
} else {
this.message= "പാസ്സ്‌വേര്‍ഡ്‌ വിജയകരമായി മാറ്റിയിരിക്കുന്നു!";
this.async( function() {
this.clearMessages();
jQuery( '#passwordUpdateButton' ).prop( 'disabled', false );
this.close();
}, 2000 );
}
document.querySelector( 'pratilipi-user' ).updateUser( event.detail.response );
},
_handleAjaxPostError: function( event ) {
jQuery( '#passwordUpdateButton' ).prop( 'disabled', false );
if( event.detail.request.xhr.status == 400 ) {
if( event.detail.request.xhr.response.password != null )
this.message = event.detail.request.xhr.response.password;
else if( event.detail.request.xhr.response.newPassword != null )
this.message = event.detail.request.xhr.response.newPassword;
else if( event.detail.request.xhr.response.token != null )
this.message = event.detail.request.xhr.response.token;
else if( event.detail.request.xhr.response.errMessage != null )
this.message = event.detail.request.xhr.response.errMessage;
else
this.message = "Invalid Input";
} else {
this.message = event.detail.request.xhr.response.message;
}
},
});
</script>
</dom-module><dom-module id="pratilipi-user-verification">
<template>
<div class="modal modal-fullscreen fade" id=pratilipiUserVerification role="dialog" tabindex="-1">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-fullscreen-close-button">
<paper-icon-button noink icon="close" data-dismiss="modal"></paper-icon-button>
</div>
<img title="പ്രതിലിപി" alt="പ്രതിലിപി" src="http://public.pratilipi.com/pratilipi-logo/png/Logo-2C-RGB-80px.png" />
<h6 class="modal-fullscreen-heading">ഇ മെയില്‍ വെരിഫിക്കേഷന്‍</h6>
<div class="display-message-div">
<p style="margin-top: 50px; font-size: 20px;">{{ message }}</p>
</div>
</div>
</div>
</div>
<iron-ajax
id="verifyEmail"
url="/api/user/verification"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_handleVerifyEmailPostResponse"
on-error="_handleVerifyEmailPostError"
></iron-ajax>
<iron-ajax
id="sendVerificationEmail"
url="/api/user/email"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_handleSendVerificationPostResponse"
on-error="_handleSendVerificationPostError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-user-verification',
properties: {
message: { type: String }
},
open: function() {
this.async( function() {
jQuery( "#pratilipiUserVerification" ).modal( {backdrop: 'static'} );
});
},
close: function() {
jQuery( "#pratilipiUserVerification" ).modal( 'hide' );
},
clearMessages: function() {
this.message = null;
},
sendVerificationMail: function( email ) {
this.open();
this.message = "പ്രവര്‍ത്തിച്ചുകൊണ്ടിരിക്കുന്നു. . .";
this.$.sendVerificationEmail.body = jQuery.param( { "email": email, "sendEmailVerificationMail": true } );
this.$.sendVerificationEmail.generateRequest();
},
verifyUser: function( email, verificationToken ) {
this.open();
this.message = "പ്രവര്‍ത്തിച്ചുകൊണ്ടിരിക്കുന്നു. . .";
var body = { email: email, verificationToken: verificationToken };
this.$.verifyEmail.body = jQuery.param( body );
this.$.verifyEmail.generateRequest();
},
_handleVerifyEmailPostResponse: function( event ) {
this.clearMessages();
if( event.detail.xhr.status == 0 ) {
this.message = "Could not connect to server !";
} else {
this.message = "വെരിഫിക്കേഷന്‍ വിജയകരമായി പൂര്‍ത്തീകരിച്ചിരിക്കുന്നു !";
this.async( function() {
this.clearMessages();
this.close();
document.querySelector( 'pratilipi-user' ).updateUser( event.detail.response );
window.location = "https://" + window.location.host;
}, 2000 );
}
},
_handleVerifyEmailPostError: function( event ) {
this.clearMessages();
if( event.detail.request.xhr.status == 400 ) {
if( event.detail.request.xhr.response.message != null )
this.message = event.detail.request.xhr.response.message;
else
this.message = "Invalid Input!";
} else {
this.message = event.detail.request.xhr.response.message;
}
},
_handleSendVerificationPostResponse: function( event ) {
this.clearMessages();
if( event.detail.xhr.status == 0 ) {
this.message = "Could not connect to server !";
} else {
this.message = "ഇ മെയില്‍ വിജയകരമായി അയച്ചിരിക്കുന്നു !";
this.async( function() {
this.clearMessages();
this.close();
}, 2000 );
}
},
_handleSendVerificationPostError: function( event ) {
this.clearMessages();
if( event.detail.request.xhr.status == 400 ) {
if( event.detail.request.xhr.response.message != null )
this.message = event.detail.request.xhr.response.message;
else
this.message = "Invalid Input!";
} else {
this.message = event.detail.request.xhr.response.message;
}
}
});
</script>
</dom-module>
<dom-module id="pratilipi-user">
<template>
<pratilipi-user-password-update></pratilipi-user-password-update>
<pratilipi-user-verification></pratilipi-user-verification>
<pratilipi-user-login></pratilipi-user-login>
<pratilipi-user-register></pratilipi-user-register>
<pratilipi-user-password-reset></pratilipi-user-password-reset>
<iron-ajax
id="AjaxGet"
url="/api/user/logout"
method="GET"
content-type="application/json"
handle-as="json"
on-response="_handleAjaxGetResponse"
on-error="_handleAjaxGetError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-user',
properties: {
user: { type: Object, notify: true, observer: "_userChanged" },
userData: { type: Object }
},
_userChanged: function() {
userChanged( this.user );
},
getCurrentUser: function() {
return this.user;
},
updateUser: function( user ) {
this.set( 'user', user );
},
closeAllElements: function() {
jQuery( '.modal' ).modal( 'hide' );
},
logIn: function( requireAccess, customMessage ) {
this.closeAllElements();
this.querySelector( 'pratilipi-user-login' ).open( requireAccess, customMessage );
},
register: function() {
this.closeAllElements();
this.querySelector( 'pratilipi-user-register' ).open();
},
startWriting: function() {
this.closeAllElements();
document.querySelector( 'pratilipi-header' ).write();
},
resetPassword: function() {
this.closeAllElements();
this.querySelector( 'pratilipi-user-password-reset' ).open();
},
changePassword: function() {
this.closeAllElements();
this.querySelector( 'pratilipi-user-password-update' ).open();
},
sendVerificationMail: function() {
this.closeAllElements();
this.querySelector( 'pratilipi-user-verification' ).sendVerificationMail( this.user.email );
},
logOut: function() {
this.$.AjaxGet.generateRequest();
},
_handleAjaxGetResponse: function( request ) {
if( ! request.detail.response ) {
// TODO: show error
this._handleAjaxGetError();
return;
}
this.updateUser( request.detail.response );
},
_handleAjaxGetError: function() {
// TODO: show error
alert( "ലോഗൌട്ട് ആയിട്ടില്ല! വീണ്ടും ശ്രമിക്കൂ!" );
},
attached: function() {
this.updateUser( this.userData );
if( getUrlParameter( 'action' ) != null ) {
if( getUrlParameter( 'action' ) == "login" && this.user.isGuest )
this.logIn();
else if( getUrlParameter( 'action' ) == "register" && this.user.isGuest )
this.register();
else if( getUrlParameter( 'action' ) == "start_writing" )
this.startWriting();
return;
}
if( getUrlParameter( 'email' ) != null && getUrlParameter( 'token' ) != null ) {
this.closeAllElements();
if( getUrlParameter( 'verifyUser' ) == "true" ) {
this.querySelector( 'pratilipi-user-verification' ).verifyUser( getUrlParameter( 'email' ), getUrlParameter( 'token' ) );
}
else if( getUrlParameter( 'passwordReset' ) == "true" ) {
this.querySelector( 'pratilipi-user-password-update' ).openPasswordUpdate( getUrlParameter( 'email' ), getUrlParameter( 'token' ) );
}
}
}
});
</script>
</dom-module><dom-module id="pratilipi-search-bar">
<style>
:host {
display: block;
position: relative;
background: #FFF;
border-bottom: 1px solid #d3d3d3;
box-shadow: 0 3px 2px -2px rgba(200,200,200,0.2);
padding-top: 52px;
}
.flex-container {
display: flex;
}
.flex-container form {
margin-top: -36px;
margin-left: 4px;
margin-right: 8px;
flex-grow: 1;
}
.flex-container .pratilipi-text {
font-size: 14px;
font-size: 12px;
font-weight: bold;
text-align: center;
white-space: nowrap;
}
.flex-container .pratilipi-text iron-icon {
margin-left: -8px;
}
.flex-container paper-menu {
padding: 0;
width: 100px;
}
.flex-container paper-menu-button {
cursor: pointer;
padding-top: 0;
}
.flex-container paper-menu-button.language {
--iron-dropdown: {
top: 0;
}
}
.flex-container paper-item.language-font {
font-size: 12px;
font-weight: 700;
}
a.pratilipi-black {
color: #333 !important;
}
paper-input.search {
--paper-input-container-focus-color: #d0021b;
font-size: 13px;
--paper-input-container-input: {
font-size: 16px;
};
}
paper-input.search /deep/ ::-webkit-input-placeholder {
font-size: 13px;
font-family: inherit;
}
paper-input.search /deep/ ::-moz-placeholder {
font-size: 13px;
font-family: inherit;
}
paper-input.search /deep/ :-ms-input-placeholder {
font-size: 13px;
font-family: inherit;
}
</style>
<template>
<div class="flex-container">
<paper-menu-button allow-outside-scroll no-animations vertical-offset=24 class="language" horizontal-align="left" vertical-align="top">
<div class="pratilipi-red pratilipi-text dropdown-trigger">
പ്രതിലിപി
<iron-icon icon="icons:arrow-drop-down" onclick="ga_CA( 'Header', 'Get Languages' )"></iron-icon>
</div>
<paper-menu class="dropdown-content" role="listbox">
<template is="dom-repeat" items="{{ languageArray }}" as="language">
<template is="dom-if" if="{{ !language.current }}">
<a class="pratilipi-black" href="{{ language.link }}" data-arg="language_selection" onclick="ga_CA( 'Header', 'Change Language' );">
<paper-item class="language-font">{{ language.value }}</paper-item>
</a>
</template>
<template is="dom-if" if="{{ language.current }}">
<paper-item class="language-font pratilipi-red" selected>{{ language.value }}</paper-item>
</template>
</template>
</paper-menu>
</paper-menu-button>
<form id="searchBarForm" action="javascript:void(0);" on-keyup="onSubmit">
<paper-input id="searchBarInput" name="q" class="search" type="search" placeholder="പുസ്തകങ്ങള്‍,കഥകള്‍,കവിതകള്‍ തുടങ്ങിയവയ്ക്കായി തിരയൂ ..." onfocus="this.placeholder = ''" onblur="this.placeholder = 'പുസ്തകങ്ങള്‍,കഥകള്‍,കവിതകള്‍ തുടങ്ങിയവയ്ക്കായി തിരയൂ ...'" value="{{ query::input }}">
<paper-icon-button style="width: 32px; height: 32px; padding: 4px;" suffix icon="icons:search" noink="true" on-click="onSubmit" ></paper-icon-button>
</paper-input>
</form>
</div>
</template>
<script>
Polymer({
is: 'pratilipi-search-bar',
properties: {
query: { type: String },
languageMap: { type: Object },
languageArray: { type: Array, value: function() { return []; } }
},
onSubmit: function( event ) {
if( event.keyCode != null && event.keyCode != 0 && event.keyCode != 13 || this.query == null || this.query.trim() == "" )
return;
var query = jQuery( "#searchBarInput" ).val();
/* query = query.replace( /[^A-Z0-9]+/ig, " " ); */
this.set( 'query', query );
var str = decodeURI( window.location.pathname );
if( str == "/search" ) {
document.querySelector( 'pratilipi-card-grid' ).setSearchQuery( this.query );
} else {
jQuery( "#searchBarInput" ).val( query );
jQuery( "#searchBarForm" ).prop( "action", "/search" );
jQuery( "#searchBarForm" ).submit();
}
},
ready: function() {
for( var language in this.languageMap ) {
this.push( 'languageArray', {
"link": "https://" + language.toLowerCase() + ".pratilipi.com/",
"value": this.languageMap[ language ],
"current" : language == "MALAYALAM"
} );
}
},
});
</script>
</dom-module><dom-module id="pratilipi-notification-snippet">
<style>
.notification-unread-state, .notification-unread-state:hover {
background-color: #f7f7f7;
}
.notification-read-state, .notification-read-state:hover {
background-color: #ffffff;
}
.list-group-item {
border: 1px solid #d3d3d3;
border-top: none;
}
.vertical-align {
display: -webkit-flex;
display: flex;
-webkit-flex-flow: row;
flex-flow: row;
}
.vertical-align span {
align-self: center;
float: right;
}
</style>
<template>
<a class="notification-message list-group-item" style="border-radius: 0px;" href="{{ sourceUrl }}">
<span class="vertical-align">
<span style="margin-right: 12px;">
<img style="width: 48px; height: 48px;" class="img-circle pratilipi-shadow pull-left" src="{{ displayImageUrl }}" />
</span>
<span style="margin-right: 12px;">
<span style="white-space: normal;" class="notification-message-snippet"></span>
<br/>
<span style="float: left; white-space: normal;"><iron-icon icon="social:person" style="height: 18px;width: 18px;"></iron-icon>&nbsp;<span class="text-muted">{{ time }}</span></span>
</span>
<template is="dom-if" if="{{ hasSourceImage }}">
<span style="margin-left: auto;">
<img class="pratilipi-shadow pull-right" src="{{ sourceImageUrl }}" />
</span>
</template>
</span>
</a>
</template>
<script>
Polymer({
is: 'pratilipi-notification-snippet',
properties: {
notification: { type: Object, observer: "_notificationObserver" },
notificationId: { type: String },
message: { type: String },
sourceUrl: { type: String },
state: { type: String }
},
_notificationObserver: function() {
this.set( 'notificationId', this.notification.notificationId );
this.set( 'message', this.notification.message );
this.set( 'sourceUrl', this.notification.sourceUrl );
this.set( 'displayImageUrl', this.notification.displayImageUrl != null ?
this.notification.displayImageUrl + ( this.notification.displayImageUrl.indexOf( "?" ) == -1 ? "?" : "&" ) + "width=48"
: "http://public.pratilipi.com/pratilipi-logo/png/Logo-2C-RGB-80px.png" );
this.set( 'time', convertDate( this.notification.lastUpdatedMillis ) );
this.set( 'hasSourceImage', this.notification.sourceImageUrl != null );
this.set( 'sourceImageUrl', this.notification.sourceImageUrl != null ?
this.notification.sourceImageUrl + ( this.notification.sourceImageUrl.indexOf( "?" ) == -1 ? "?" : "&" ) + "width=48"
: null );
jQuery( this.querySelector( '.notification-message-snippet' ) ).html( this.message );
jQuery( this.querySelector( '.notification-message' ) ).addClass( this.notification.state == "UNREAD" ?
"notification-unread-state" : "notification-read-state" );
},
});
</script>
</dom-module>
<dom-module id="pratilipi-notification-popup">
<template>
<template is="dom-repeat" items="{{ popupNotificationList }}" as="notification">
<template is="dom-if" if="{{ notification.message }}">
<pratilipi-notification-snippet notification="{{ notification }}"></pratilipi-notification-snippet>
</template>
</template>
</template>
<script>
Polymer({
is: 'pratilipi-notification-popup',
properties: {
popupNotificationList: { type: Array, notify: true }
},
});
</script>
</dom-module>
<dom-module id="pratilipi-header">
<style>
:host {
width: 100%;
display: block;
}
#header-card {
position: relative;
z-index: 1;
width: 100%;
display: block;
border-bottom: 1px solid #d3d3d3;
box-shadow: 0 3px 2px -2px rgba(200,200,200,0.2);
}
@media only screen and (min-width: 768px) {
#header-card {
height: 52px;
}
}
.notification-dropdown-menu {
position: absolute !important;
top: 140%;
padding: 0px;
border-radius: 1px;
margin-right: -1px;
border-left: none;
border-right: none;
}
.notification-count {
top: -23%;
right: -32%;
position: absolute !important;
background-color: #d0021b;
padding: 3px 6px;
}
.vertical-align {
display: -webkit-flex;
display: flex;
-webkit-flex-flow: row;
flex-flow: row;
height: 52px;
position: relative;
float: left;
}
.vertical-align * {
align-self: center;
position: relative;
}
.pratilipi-logo {
-webkit-flex-basis: 46px;
flex-basis: 46px;
}
.pratilipi-text {
font-size: 18px;
font-size: 16px;
margin-left: 0px;
font-weight: 700;
white-space: nowrap;
cursor: pointer;
}
.pratilipi-text paper-menu {
width: 108px;
padding: 0;
}
.pratilipi-text paper-item.language-font {
font-size: 14px;
font-weight: 700;
}
a.pratilipi-black {
color: #333 !important;
}
form.search-form {
margin-top: -20px;
}
form.search-form paper-input paper-icon-button {
width: 32px;
height: 32px;
padding: 4px;
}
.search-input paper-icon-button.menu-icon-search-bar {
margin-left: -4px;
}
.button-holder {
flex-basis: 48px;
white-space: nowrap;
text-align: right;
}
.button-holder a, .button-holder a:hover, .button-holder a:focus {
color: #4c4c4c!important;
}
.button-holder iron-icon {
color: #4c4c4c!important;
height: 28px;
width: 28px;
cursor: pointer;
}
.sign-in-button {
white-space: nowrap;
}
.sign-in-button a span {
color: #4c4c4c!important;
font-size: 13px;
font-weight: 400;
margin-left: 2px;
}
.sign-in-button .btn-primary {
color: #fff;
background-color: #107fe5;
border-color: #107fe5;
border-radius: 0;
outline: none;
padding: 6px 8px;
}
.sign-in-button .btn-primary iron-icon {
width: 20px;
height: 20px;
}
.sign-in-button .btn-primary span {
font-size: 12px;
font-weight: 400;
}
.button-outside-container {
display: none;
}
@media only screen and (max-width: 767px) {
.vertical-align {
height: 48px;
}
.pratilipi-logo {
-webkit-flex: 1;
flex: 1;
padding-left: 8px;
}
#header-card {
border: none;
box-shadow: none;
}
.pratilipi-text {
display: none;
}
.search-bar {
display: none;
}
.button-holder {
flex: 1;
text-align: center;
}
.sign-in-button {
display: none;
}
}
@media only screen and (min-width: 768px) and (max-width: 1199px) {
.search-bar {
flex-grow: 1;
padding-left: 4px;
padding-right: 4px;
}
.sign-in-text, .menu-icon, .search-icon {
display: none;
}
.sign-in-button {
margin-left: 12px;
margin-top: 2px;
}
}
@media only screen and (min-width: 992px) {
.pratilipi-text {
-webkit-flex-basis: 139px;
flex-basis: 139px;
}
.search-input paper-icon-button.menu-icon-search-bar {
display: none;
}
}
@media only screen and (min-width: 1200px) {
.search-bar {
flex-grow: 1;
}
.sign-in-text, .menu-icon, .search-icon {
display: none;
}
.button-inside-container {
display: none;
}
.button-outside-container {
display: inline-block;
position: relative;
left: 12px;
line-height: 52px;
}
}
paper-input.search-input {
--paper-input-container-focus-color: #d0021b;
font-size: 13px;
--paper-input-container-input: {
font-size: 16px;
};
}
paper-input.search-input /deep/ ::-webkit-input-placeholder {
font-size: 13px;
font-family: inherit;
}
paper-input.search-input /deep/ ::-moz-placeholder {
font-size: 13px;
font-family: inherit;
}
paper-input.search-input /deep/ :-ms-input-placeholder {
font-size: 13px;
font-family: inherit;
}
paper-badge.pratilipi-red {
--paper-badge-background: #d0021b;
--paper-badge-width: 16px;
--paper-badge-height: 16px;
--paper-badge-margin-left: 4px;
--paper-badge: {
position: static;
}
}
paper-spinner.pratilipi-spinner {
display: block;
margin: 8px auto;
width: 24px;
height: 24px;
--paper-spinner-layer-1-color: #D0021B;
--paper-spinner-layer-2-color: #107FE5;
--paper-spinner-layer-3-color: #D0021B;
--paper-spinner-layer-4-color: #107FE5;
}
.view-more-button {
display: block;
text-align: center;
padding-top: 10px;
padding-bottom: 10px;
font-size: 17px;
font-weight: 700;
border-left: 1px solid #d3d3d3;
border-right: 1px solid #d3d3d3;
letter-spacing: 0px;
font-size: 15px;
}
/* Bootstrap overrides */
.dropdown-menu-right {
right: -20px;
}
</style>
<template>
<div class="secondary-500" id="header-card">
<div class="parent-container">
<div class="vertical-align container">
<div class="pratilipi-logo">
<a href="/">
<iron-image sizing="contain" style="width: 46px; height: 46px; margin-top: 6px;"
title="പ്രതിലിപി" alt="പ്രതിലിപി"
src="http://public.pratilipi.com/pratilipi-logo/png/Logo-2C-RGB-80px.png"></iron-image>
</a>
</div>
<div class="pratilipi-text">
<paper-menu-button allow-outside-scroll no-animations vertical-offset=36 class="language" horizontal-align="left" vertical-align="top">
<div class="pratilipi-red dropdown-trigger" style="height: 100%;" onclick="ga_CA( 'Header', 'Get Languages' )">
പ്രതിലിപി
<iron-icon icon="icons:arrow-drop-down"></iron-icon>
</div>
<paper-menu class="dropdown-content" role="listbox">
<template is="dom-repeat" items="{{ languageArray }}" as="language">
<template is="dom-if" if="{{ !language.current }}">
<a class="pratilipi-black" href="{{ language.link }}" onclick="ga_CA( 'Header', 'Change Language' );">
<paper-item class="language-font">{{ language.value }}</paper-item>
</a>
</template>
<template is="dom-if" if="{{ language.current }}">
<paper-item class="language-font pratilipi-red" selected>{{ language.value }}</paper-item>
</template>
</template>
</paper-menu>
</paper-menu-button>
</div>
<div class="button-holder menu-icon">
<a on-click="_openMenuNavigation">
<iron-icon icon="icons:menu"></iron-icon>
</a>
</div>
<div class="search-bar">
<form id="search-form" class="search-form" action="javascript:void(0);" on-keyup="onSubmit">
<paper-input id="search-input" class="search-input" name="q" type="search" placeholder="പുസ്തകങ്ങള്‍,കഥകള്‍,കവിതകള്‍ തുടങ്ങിയവയ്ക്കായി തിരയൂ ..." onfocus="this.placeholder = ''" onblur="this.placeholder = 'പുസ്തകങ്ങള്‍,കഥകള്‍,കവിതകള്‍ തുടങ്ങിയവയ്ക്കായി തിരയൂ ...'" value="{{ query::input }}">
<paper-icon-button suffix icon="icons:search" noink on-click="onSubmit" ></paper-icon-button>
<paper-icon-button prefix class="menu-icon-search-bar" icon="icons:menu" noink on-click="_openMenuNavigation"></paper-icon-button>
</paper-input>
</form>
</div>
<div class="button-holder">
<a onclick="ga_CA( 'Header', 'Write' )" on-click="write">
<iron-icon icon="icons:create"></iron-icon>
</a>
</div>
<div class="button-holder">
<a onclick="ga_CA( 'Header', 'Library' )" on-click="_gotoLibrary">
<iron-icon icon="av:library-books"></iron-icon>
</a>
</div>
<div class="button-holder dropdown">
<div style="display: inline-block" class="dropdown">
<template is="dom-if" if="{{ isGuest }}">
<a onclick="ga_CA( 'Header', 'Notification' )" on-click="_logInToViewNotifications">
<iron-icon icon="social:notifications"></iron-icon>
</a>
</template>
<template is="dom-if" if="{{ !isGuest }}">
<template is="dom-if" if="{{ isBigWindow }}">
<iron-icon icon="social:notifications" class="dropdown-toggle" id="notification-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" on-click="_hideNotificationCount" onclick="ga_CA( 'Header', 'Notification' )"></iron-icon>
<div style="min-width: 400px; height: auto; overflow-x: hidden; max-height: 70vh;" class="dropdown-menu dropdown-menu-right list-group notification-dropdown-menu" aria-labelledby="notification-dropdown">
<template is="dom-if" if="{{ loadingNotifications }}">
<paper-spinner class="pratilipi-spinner" active></paper-spinner>
</template>
<pratilipi-notification-popup popup-notification-list="[[ popupNotificationList ]]"></pratilipi-notification-popup>
<a href="/notifications" style="color: #d0021b!important;" class="view-more-button" onclick="ga_CA( 'Notification', 'Load More' )">കൂടുതല്‍ കാണൂ...</a>
</div>
</template>
<template is="dom-if" if="{{ !isBigWindow }}">
<a on-click="_hideNotificationCount"><iron-icon icon="social:notifications" id="notification-dropdown"></iron-icon></a>
</template>
<template is="dom-if" if="{{ showNotificationCount }}">
<span class="badge notification-count">{{ newNotificationCount }}</span>
</template>
</template>
</div>
</div>
<div class="button-holder sign-in-text">
<template is="dom-if" if="{{ isGuest }}">
<a on-click="_logIn" onclick="ga_CA( 'Header', 'Login' )">
<iron-icon icon="social:person"></iron-icon>
</a>
</template>
<template is="dom-if" if="{{ !isGuest }}">
<a href="{{ profilePageUrl }}" onclick="ga_CA( 'Header', 'User' )">
<img class="img-circle pratilipi-shadow" style="width: 32px; height: 32px;"
alt="{{ displayName }}" src="{{ profileImageUrl }}" />
</a>
</template>
</div>
<div class="sign-in-button button-inside-container">
<template is="dom-if" if="{{ isGuest }}">
<button class="btn btn-primary" on-click="_logIn" onclick="ga_CA( 'Header', 'Login' )">
<iron-icon icon="social:person"></iron-icon>
<span>സൈനിന്‍</span>
</button>
</template>
<template is="dom-if" if="{{ !isGuest }}">
<a href="{{ profilePageUrl }}" onclick="ga_CA( 'Header', 'User' )">
<img class="img-circle pratilipi-shadow" style="width: 32px; height: 32px;"
alt="{{ displayName }}" src="{{ profileImageUrl }}" />
<span>{{ displayName }}</span>
</a>
</template>
</div>
</div>
<div class="sign-in-button button-outside-container">
<template is="dom-if" if="{{ isGuest }}">
<button class="btn btn-primary" on-click="_logIn" onclick="ga_CA( 'Header', 'Login' )">
<iron-icon icon="social:person"></iron-icon>
<span>സൈനിന്‍</span>
</button>
</template>
<template is="dom-if" if="{{ !isGuest }}">
<a href="{{ profilePageUrl }}" onclick="ga_CA( 'Header', 'User' )">
<img class="img-circle pratilipi-shadow" style="width: 32px; height: 32px;"
alt="{{ displayName }}" src="{{ profileImageUrl }}" />
<span>{{ displayName }}</span>
</a>
</template>
</div>
</div>
</div>
<pratilipi-search-bar language-map="{{ languageMap }}" query="{{ query }}" class="visible-xs hidden-sm hidden-md hidden-lg"></pratilipi-search-bar>
<iron-ajax
id="NotificationListApi"
url="/api/notification/list"
params='{"resultCount": 9}'
method="GET"
content-type="application/json"
handle-as="json"
on-response="_notificationListApiResponse"
on-error="_notificationListApiError"
></iron-ajax>
</template>
<script>
$( document ).ready( function() {
$( document ).on( 'click', '.dropdown-menu', function (e) {
e.stopPropagation();
});
});
Polymer({
is: 'pratilipi-header',
properties: {
user: { type: Object, observer: "_userChanged" },
query: { type: String },
isGuest: { type: Boolean },
profilePageUrl: { type: String },
profileImageUrl: { type: String },
displayName: { type: String },
newNotificationCount: { type: Number, observer: "_notificationCountObserver" },
showNotificationCount: { type: Boolean, value: false },
writeButtonActive: { type: Boolean, value: false },
languageMap: { type: Object },
languageArray: { type: Array, value: function() { return []; } },
popupNotificationList: { type: Array, value: function() { return []; } },
isBigWindow: { type: Boolean },
loadingNotifications: { type: Boolean, value: false }
},
behaviors: [
Polymer.IronResizableBehavior
],
listeners: {
'iron-resize': '_onIronResize'
},
_onIronResize: function() {
var windowsize = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
this.set( 'isBigWindow', windowsize > 768 );
},
_userChanged: function() {
if( ! this.user.isGuest && this.writeButtonActive ) {
this.set( 'writeButtonActive', false );
this.async( function() {
this.write();
}, 1000 );
}
this.set( 'isGuest', this.user.isGuest );
this.set( 'profilePageUrl', this.user.profilePageUrl );
this.set( 'displayName', this.user.displayName );
this.set( 'profileImageUrl', this.user.profileImageUrl != null ?
( this.user.profileImageUrl + ( this.user.profileImageUrl.indexOf( '?' ) == -1 ? '?' : '&' ) + "width=48" )
: "https://0.ptlp.co/author/image?width=48" );
if( this.user.isGuest )
this.set( 'newNotificationCount', 0 );
},
_notificationCountObserver: function() {
this.set( 'showNotificationCount', this.newNotificationCount > 0 );
},
_logIn: function() {
document.querySelector( 'pratilipi-user' ).logIn();
},
_logInToViewNotifications: function() {
document.querySelector( 'pratilipi-user' ).logIn( true, "താങ്കള്‍ ഫോളോ ചെയ്യുന്നവരില്‍ നിന്നും നോട്ടിഫിക്കേഷന്‍സ് ലഭിക്കാന്‍ ലോഗിന്‍ ചെയ്യൂ" );
},
write: function() {
if( this.user.isGuest ) {
this.set( 'writeButtonActive', true );
document.querySelector( 'pratilipi-user' ).logIn( true, "പ്രതിലിപിയില്‍ എഴുതാന്‍ ,താങ്കളുടെ കമ്പ്യൂട്ടറില്‍ നിന്നും malayalam.pratilipi.com എന്ന വെബ്സൈറ്റില്‍ ലോഗിന്‍ ചെയ്യുക." );
return;
}
this.set( 'writeButtonActive', false );
if( isMobile() ) {
document.querySelector( 'pratilipi-alert' ).alert( 'പ്രതിലിപിയില്‍ എഴുതാന്‍ ,താങ്കളുടെ കമ്പ്യൂട്ടറില്‍ നിന്നും malayalam.pratilipi.com എന്ന വെബ്സൈറ്റില്‍ ലോഗിന്‍ ചെയ്യുക.' );
return;
}
document.querySelector( 'pratilipi-write' ).createNewPratilipi();
},
_gotoLibrary: function() {
if( this.user.isGuest )
document.querySelector( 'pratilipi-user' ).logIn( true, "താങ്കളുടെ ലൈബ്രറിയിലേക്ക് രചനകള്‍ ചേര്‍ക്കാന്‍ ലോഗിന്‍ ചെയ്യൂ" );
else
window.location.href = "/library";
},
_hideNotificationCount: function() {
resetNewNotificationCount();
if( !this.isBigWindow )
window.location.href = "/notifications";
},
_openMenuNavigation: function() {
document.querySelector( 'pratilipi-navigation-drawer' ).show();
},
onSubmit: function( event ) {
if( event.keyCode != null && event.keyCode != 0 && event.keyCode != 13 || this.query == null || this.query.trim() == "" )
return;
var query = jQuery( "#search-input" ).val();
/* query = query.replace( /[^A-Z0-9]+/ig, " " ); */
this.set( 'query', query );
var str = decodeURI( window.location.pathname );
if( str == "/search" ) {
document.querySelector( 'pratilipi-card-grid' ).setSearchQuery( this.query );
} else {
jQuery( "#search-input" ).val( query );
jQuery( "#search-form" ).prop( "action", "/search" );
jQuery( "#search-form" ).submit();
}
},
ready: function() {
for( var language in this.languageMap ) {
this.push( 'languageArray', {
"link": "https://" + language.toLowerCase() + ".pratilipi.com/",
"value": this.languageMap[ language ],
"current" : language == "MALAYALAM"
} );
}
},
getNotificationData: function() {
this.set( 'loadingNotifications', true );
this.$.NotificationListApi.generateRequest();
},
_notificationListApiResponse: function( ajaxResponse ) {
this.set( 'loadingNotifications', false );
var response = ajaxResponse.detail.response;
if( response != null && response.notificationList != null )
this.set( 'popupNotificationList', response.notificationList );
},
_notificationListApiError: function( ajaxResponse ) {
this.set( 'loadingNotifications', false );
},
updateNewNotificationCount: function( newNotificationCount ) {
if( newNotificationCount != this.newNotificationCount ) {
this.set( 'newNotificationCount', newNotificationCount );
this.getNotificationData();
}
}
});
</script>
</dom-module>
<dom-module id="pratilipi-edit-account">
<style>
.modal-fullscreen {
padding: 0;
}
.modal-fullscreen .modal-dialog {
height: 100%;
}
.modal-fullscreen .modal-dialog .modal-content {
padding-top: 100px;
padding-bottom: 24px;
max-width: 600px;
}
iron-icon {
color: #107FE5;
width: 32px;
height: 32px;
}
.pratilipi-new-blue-button {
border-radius: 4px;
}
.logout-button {
margin: 24px auto 0 auto;
display: block;
}
paper-spinner.new-spinner {
position: absolute;
top: 0;
left: 0;
right: 0;
bottom: 0;
margin: auto;
--paper-spinner-layer-1-color: #D0021B;
--paper-spinner-layer-2-color: #107FE5;
--paper-spinner-layer-3-color: #D0021B;
--paper-spinner-layer-4-color: #107FE5;
}
</style>
<template>
<div class="modal modal-fullscreen fade" id="pratilipiEditAccount" role="dialog" tabindex="-1">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-fullscreen-close-button">
<paper-icon-button noink icon="close" data-dismiss="modal"></paper-icon-button>
</div>
<img title="പ്രതിലിപി" alt="പ്രതിലിപി" src="http://public.pratilipi.com/pratilipi-logo/png/Logo-2C-RGB-80px.png" />
<h6 class="modal-fullscreen-heading">എന്‍റെ അക്കൗണ്ട്‌ എഡിറ്റ്‌ ചെയ്യൂ</h6>
<div class="row">
<div class="col-xs-11 col-sm-11 col-md-11 col-lg-11">
<pratilipi-input type="email" disabled="{{ emailDisabled }}" label="ഇമെയില്‍ അഡ്രസ്സ്" value="{{ email::input }}" icon="icons:mail"></pratilipi-input>
</div>
<div class="col-xs-1 col-sm-1 col-md-1 col-lg-1">
<iron-icon icon="{{ emailIcon }}" style="margin-top: 24px; width: 28px; height: 28px; cursor: pointer;" on-click="editEmail"></iron-icon>
</div>
</div>
<div class="row">
<div class="col-xs-11 col-sm-11 col-md-11 col-lg-11">
<pratilipi-input type="tel" disabled="{{ phoneDisabled }}" label="ഫോണ്‍ നമ്പര്‍" value="{{ phone::input }}" icon="icons:settings-phone"></pratilipi-input>
</div>
<div class="col-xs-1 col-sm-1 col-md-1 col-lg-1">
<iron-icon icon="{{ phoneIcon }}" style="margin-top: 24px; width: 28px; height: 28px; cursor: pointer;" on-click="editPhone"></iron-icon>
</div>
</div>
<div class="row">
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6 text-center">
<template is="dom-if" if="{{ ! user.isEmailVerified }}">
<button class="pratilipi-new-blue-button pratilipi-center-div" on-click="verifyEmail">ഇമെയില്‍ വെരിഫൈ ചെയ്യൂ</button>
</template>
<template is="dom-if" if="{{ user.isEmailVerified }}">
<div class="pratilipi-center-div">
<span style="font-size: 14px;"><iron-icon icon="icons:verified-user"></iron-icon>ഇമെയില്‍ വെരിഫൈ ചെയ്ത് കഴിഞ്ഞു</span>
</div>
</template>
</div>
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<button class="pratilipi-new-blue-button pratilipi-center-div" on-click="changePassword" onclick="ga_CA( 'User', 'Password' )">പാസ്സ്‌വേര്‍ഡ്‌ മാറ്റൂ</button>
</div>
</div>
<template is="dom-if" if="{{ showLogoutButton }}">
<button class="pratilipi-new-blue-button logout-button" on-click="logoutUser" onclick="ga_CA( 'User', 'Logout' )">
സൈന്‍ ഔട്ട്‌
</button>
</template>
<paper-spinner active="{{ spinnerActive }}" class="new-spinner"><</paper-spinner>
</div>
</div>
</div>
<iron-ajax
id="UserApi"
url="/api/user"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_apiResponse"
on-error="_apiError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-edit-account',
properties: {
user: { type: Object, observer: "_userChanged" },
emailDisabled: { type: Boolean, value: true },
emailIcon: { type: String, value: "icons:create" },
email: { type: String },
phoneDisabled: { type: Boolean, value: true },
phoneIcon: { type: String, value: "icons:create" },
phone: { type: String },
showLogoutButton: { type: Boolean, value: false },
spinnerActive: { type: Boolean, value: false }
},
_userChanged: function() {
if( this.user.email != null )
this.set( "email", this.user.email );
if( this.user.phone != null )
this.set( "phone", this.user.phone );
},
_disableEditEmail: function() {
this.set( 'emailDisabled', true );
this.set( 'emailIcon', "icons:create" );
},
_disableEditPhone: function() {
this.set( 'phoneDisabled', true );
this.set( 'phoneIcon', "icons:create" );
},
editEmail: function() {
if( this.emailDisabled ) {
this.set( 'emailDisabled', false );
this.set( 'emailIcon', "icons:save" );
} else {
if( this.email == this.user.email ) {
this._disableEditEmail();
return;
}
// Make Api call
var ajaxPost = this.$.UserApi;
delete ajaxPost.params[ "phone" ];
ajaxPost.params.email = this.email;
ajaxPost.generateRequest();
this.set( 'spinnerActive', true );
}
},
editPhone: function() {
if( this.phoneDisabled ) {
this.set( 'phoneDisabled', false );
this.set( 'phoneIcon', "icons:save" );
} else {
if( this.phone == this.user.phone ) {
this._disableEditPhone();
return;
}
// Make Api call
var ajaxPost = this.$.UserApi;
delete ajaxPost.params[ "email" ];
if ( isNaN( this.phone ) || this.phone.length != 10 ) {
alert( "Invalid Phone Number. Please enter the 10-digit phone Number!" );
return;
}
ajaxPost.params.phone = this.phone;
ajaxPost.generateRequest();
this.set( 'spinnerActive', true );
}
},
_apiResponse: function() {
var user = event.detail.response;
document.querySelector( 'pratilipi-user' ).updateUser( user );
this.set( 'spinnerActive', false );
this._disableEditEmail();
this._disableEditPhone();
},
_apiError: function() {
this.set( 'spinnerActive', false );
if( event.detail.request.xhr.status === 400 || event.detail.request.xhr.status === 401 || event.detail.request.xhr.status === 500 )
alert( event.detail.request.xhr.response.email != null ? event.detail.request.xhr.response.email : event.detail.request.xhr.response.message );
else
alert( "Some Error occurred! Please try Again." );
this.set( 'email', this.user.email );
this.set( 'phone', this.user.phone );
this._disableEditEmail();
this._disableEditPhone();
},
open: function() {
this.async( function() {
jQuery( "#pratilipiEditAccount" ).modal();
});
},
close: function() {
this._userChanged();
this._disableEditEmail();
this._disableEditPhone();
jQuery( "#pratilipiEditAccount" ).modal( 'hide' );
},
changePassword: function() {
this.close();
document.querySelector( 'pratilipi-user' ).changePassword();
},
verifyEmail: function() {
this.close();
document.querySelector( 'pratilipi-user' ).sendVerificationMail();
},
logoutUser: function() {
this.close();
document.querySelector( 'pratilipi-user' ).logOut();
}
});
</script>
</dom-module><dom-module id="pratilipi-write">
<style>
:host {
display: block;
}
textarea {
display: block;
width: 100%;
}
paper-dropdown-menu {
width: 100%;
--paper-dropdown-menu-focus-color: #333;
--paper-dropdown-menu-input-color: #333;
--primary-text-color: #333;
--paper-input-container: {
color: #333;
};
--paper-input-container-input: {
font-family: inherit;
color: #333;
};
--paper-input-container-underline: {
background: #333;
color: #333;
};
--paper-input-container-label: {
font-size: 15px;
font-family: inherit;
text-align: left;
color: #333;
};
--paper-input-container-focus:{
color: #333;
};
}
paper-menu {
--paper-menu-color: #333;
width: 100%;
--paper-menu-focused-item: {
color: #333;
};
--paper-item-focused-before: {
color: #333;
background: #fff;
};
}
paper-menu paper-item {
font-size: 15px;
font-family: inherit;
color: #333;
white-space: nowrap;
}
#pratilipiWriteButton {
color: #fff;
border: 1px solid #d3d3d3;
background: #d0021b;
outline: none;
padding: 6px 12px;
font-weight: normal;
}
.row {padding-left: 10px;padding-right: 10px;}
.modal-content {border-radius: 0;}
.pull-center {display:block;margin-left:auto;margin-right:auto;text-align:center;}
paper-checkbox.pratilipi-red {
align-self: center;
--paper-checkbox-checked-color: #d0021b;
--paper-checkbox-checked-ink-color: #333;
--paper-checkbox-unchecked-color: #333;
--paper-checkbox-unchecked-ink-color: #333;
--paper-checkbox-label-color: #333;
--paper-checkbox-label-spacing: 0;
--paper-checkbox-margin: 0 8px 8px 0;
--paper-checkbox-vertical-align: top;
}
input {
border: none;
box-shadow: none !important;
border-bottom: 1px solid black;
border-radius: 0px;
width: 100%;
outline: none;
margin-top: 20px;
}
</style>
<template>
<div class="modal fade" id="pratilipiWrite" role="dialog">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header">
<button style="opacity: 1; outline: none;" type="button" class="close" data-dismiss="modal" aria-label="Close"><iron-icon style="color: #333;" icon="icons:close"></iron-icon></button>
<h6 style="min-height: 20px; line-height: 20px;" class="modal-title">
<template is="dom-if" if="{{ createPratilipi }}">തലവാചകം ചേര്‍ക്കൂ</template>
<template is="dom-if" if="{{ editPratilipi }}">വിവരങ്ങള്‍ തിരുത്തൂ</template>
</h6>
</div>
<div class="modal-body" style="padding-bottom: 0px;">
<div class="row">
<div hidden$="{{ editPratilipi }}" class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
<paper-dropdown-menu id="selectPratilipiLanguage" on-click="_languageChanged" noink label="നിങ്ങള്‍ എഴുതുന്ന ഭാഷ *" vertical-align="top" horizontal-align="right">
<paper-menu noink class="dropdown-content" selected="[[ selectedLanguage ]]" style="white-space: nowrap; width: auto;">
<paper-item value="BENGALI">{{ languageMap.BENGALI }}</paper-item>
<paper-item value="MARATHI">{{ languageMap.MARATHI }}</paper-item>
<paper-item value="HINDI">{{ languageMap.HINDI }}</paper-item>
<paper-item value="GUJARATI">{{ languageMap.GUJARATI }}</paper-item>
<paper-item value="TAMIL">{{ languageMap.TAMIL }}</paper-item>
<paper-item value="MALAYALAM">{{ languageMap.MALAYALAM }}</paper-item>
<paper-item value="TELUGU">{{ languageMap.TELUGU }}</paper-item>
<paper-item value="KANNADA">{{ languageMap.KANNADA }}</paper-item>
</paper-menu>
</paper-dropdown-menu>
</div>
<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
<input name="pratilipiInputTransliterable" id="titleInput" placeholder="തലവാചകം ഇവിടെ എഴുതൂ *" value="{{ title::input }}">
</div>
<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
<input id="titleInputEn" placeholder="തലവാചകം ഇംഗ്ലീഷില്‍ എഴുതൂ" value="{{ titleEn::input }}">
</div>
<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
<paper-dropdown-menu id="selectPratilipiType" noink label="വിഭാഗം തെരഞ്ഞെടുക്കൂ *" vertical-align="bottom" horizontal-align="right">
<paper-menu noink class="dropdown-content" selected="[[ selectedType ]]" style="white-space: nowrap; width: auto;">
<paper-item value="BOOK">{{ pratilipiTypes.BOOK.name }}</paper-item>
<paper-item value="POEM">{{ pratilipiTypes.POEM.name }}</paper-item>
<paper-item value="STORY">{{ pratilipiTypes.STORY.name }}</paper-item>
<paper-item value="ARTICLE">{{ pratilipiTypes.ARTICLE.name }}</paper-item>
<paper-item value="MAGAZINE">{{ pratilipiTypes.MAGAZINE.name }}</paper-item>
</paper-menu>
</paper-dropdown-menu>
</div>
</div>
<template is="dom-if" if="{{ createPratilipi }}">
<div style="padding: 16px 0 16px 16px;">
<paper-checkbox checked="{{ acceptedTerms }}" class="pratilipi-red" noink>ഞാൻ പകർപ്പവകാശ നയം ഒപ്പം സേവന നിബന്ധനകൾ സമ്മതിക്കുന്നു</paper-checkbox>
<br/>
<a target="_blank" style="color: #333; text-decoration: underline;" href="/terms-of-service">പകര്‍പ്പവകാശ നിബന്ധനകള്‍ വായിക്കൂ</a>
</div>
</template>
<div class="display-message-div pratilipi-red"><p>{{ message }}</p></div>
</div>
<div class="modal-footer" style="border: none; padding-top: 0px;">
<button id="pratilipiWriteButton" type="button" on-click="onSubmit">
<template is="dom-if" if="{{ createPratilipi }}">അടുത്തത്</template>
<template is="dom-if" if="{{ editPratilipi }}">മാറ്റങ്ങള്‍ സേവ് ചെയ്യുക</template>
</button>
</div>
</div>
</div>
</div>
<iron-ajax
id="AjaxPost"
url="/api/pratilipi?_apiVer=2"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_handleAjaxPostResponse"
on-error="_handleAjaxPostError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-write',
properties: {
authorId: { type: String },
pratilipiId: { type: String },
title: { type: String },
titleEn: { type: String },
type: { type: String, observer: "_typeObserver" },
language: { type: String, observer: "_languageObserver" },
state: { type: String },
createPratilipi: { type: Boolean },
editPratilipi: { type: Boolean },
pratilipiTypes: { types: Object },
languageMap: { type: Object },
selectedType: { type: Number },
selectedLanguage: { type: Number },
acceptedTerms: { type: Boolean, value: false },
message: { type: String }
},
attached: function() {
this.pratilipiTypes = jQuery.parseJSON( this.pratilipiTypes );
},
createNewPratilipi: function( authorId ) {
this.set( 'createPratilipi', true );
this.set( 'editPratilipi', false );
this.set( 'authorId', authorId );
this.process( {} );
},
editExistingPratilipi: function( pratilipi ) {
this.set( 'editPratilipi', true );
this.set( 'createPratilipi', false );
this.set( 'authorId', null );
this.process( pratilipi );
},
process: function( pratilipi ) {
this.set( 'message' , null );
this.set( 'pratilipiId', pratilipi.pratilipiId == null ? null : pratilipi.pratilipiId );
this.set( 'title', pratilipi.title == null ? null : pratilipi.title );
this.set( 'titleEn', pratilipi.titleEn == null ? null : pratilipi.titleEn );
this.set( 'state', pratilipi.state == null ? "DRAFTED" : pratilipi.state );
this.set( 'language', pratilipi.language == null ? "MALAYALAM" : pratilipi.language );
this.set( 'type', pratilipi.type == null ? null : pratilipi.type );
this.async( function() { jQuery( "#pratilipiWrite" ).modal(); });
},
_typeObserver: function() {
if( this.type != null ) {
if( this.type == "BOOK" )
this.set( 'selectedType', 0 );
else if( this.type == "POEM" )
this.set( 'selectedType', 1 );
else if( this.type == "STORY" )
this.set( 'selectedType', 2 );
else if( this.type == "ARTICLE" )
this.set( 'selectedType', 3 );
else if( this.type == "MAGAZINE" )
this.set( 'selectedType', 4 );
} else {
this.set( 'selectedType', null );
}
},
_languageObserver: function() {
var languageVernacular = {
"HINDI" : this.languageMap[ "HINDI" ],
"GUJARATI" : this.languageMap[ "GUJARATI" ],
"TAMIL" : this.languageMap[ "TAMIL" ],
"MARATHI" : this.languageMap[ "MARATHI" ],
"MALAYALAM" : this.languageMap[ "MALAYALAM" ],
"BENGALI" : this.languageMap[ "BENGALI" ],
"TELUGU" : this.languageMap[ "TELUGU" ],
"KANNADA" : this.languageMap[ "KANNADA" ]
};
this.set( 'languageVernacular', languageVernacular[ this.language ] );
if( this.language != null ) {
if( this.language == "BENGALI" ) this.set( 'selectedLanguage', 0 );
else if( this.language == "MARATHI" ) this.set( 'selectedLanguage', 1 );
else if( this.language == "HINDI" ) this.set( 'selectedLanguage', 2 );
else if( this.language == "GUJARATI" ) this.set( 'selectedLanguage', 3 );
else if( this.language == "TAMIL" ) this.set( 'selectedLanguage', 4 );
else if( this.language == "MALAYALAM" ) this.set( 'selectedLanguage', 5 );
else if( this.language == "TELUGU" ) this.set( 'selectedLanguage', 6 );
else if( this.language == "KANNADA" ) this.set( 'selectedLanguage', 7 );
} else {
this.set( 'selectedLanguage', null );
}
},
_languageChanged: function() {
if( this.editPratilipi ) return;
if( this.$.selectPratilipiLanguage.selectedItem == null ) return;
var language = this.$.selectPratilipiLanguage.selectedItem.getAttribute( "value" );
if( language == "MALAYALAM" ) return;
window.location = "https://" + language.toLowerCase() + ".pratilipi.com/?action=start_writing";
},
clearAndClose: function() {
this.set( 'message', null );
this.set( 'authorId', null );
this.set( 'title', null );
this.set( 'titleEn', null );
this.set( 'type', null );
this.set( 'state', null );
this.set( 'createPratilipi', false );
this.set( 'editPratilipi', false );
jQuery( "#pratilipiWrite" ).modal( 'hide' );
},
onSubmit: function( event ) {
var title = this.$.titleInput.value;
if( title == null || title.trim() == "" ) {
this.message = "ഒരു ശീർഷകം നൽകുക";
return;
}
this.type = this.$.selectPratilipiType.selectedItem != null ? this.$.selectPratilipiType.selectedItem.getAttribute( "value" ) : null;
if( this.type == null ) {
this.message = "ഒരു വിഭാഗം തിരഞ്ഞെടുക്കുക";
return;
}
this.language = this.$.selectPratilipiLanguage.selectedItem != null ? this.$.selectPratilipiLanguage.selectedItem.getAttribute( "value" ) : null;
if( this.createPratilipi && this.language != "MALAYALAM" ) {
window.location = "https://" + language.toLowerCase() + ".pratilipi.com";
return;
}
if( this.createPratilipi && !this.acceptedTerms ) {
this.message = "ഞാൻ പകർപ്പവകാശ നയം ഒപ്പം സേവന നിബന്ധനകൾ സമ്മതിക്കുന്നു";
return;
}
this.message = "പ്രവര്‍ത്തിച്ചുകൊണ്ടിരിക്കുന്നു. . .";
var body = {
title: title,
type: this.type,
state: this.state
};
if( this.pratilipiId != null )
body.pratilipiId = this.pratilipiId;
if( this.titleEn != null )
body.titleEn = this.titleEn;
if( this.authorId != null )
body.authorId = this.authorId;
if( this.createPratilipi ) {
body.oldContent = false;
body.language = "MALAYALAM";
}
jQuery( '#pratilipiWriteButton' ).prop( 'disabled', true );
this.$.AjaxPost.body = jQuery.param( body );
this.$.AjaxPost.generateRequest();
ga_CA( 'Pratilipi', 'Create' );
},
_handleAjaxPostResponse: function( event ) {
var pratilipi = event.detail.response;
if( this.createPratilipi )
this.message = "വിജയകരമായി പൂര്‍ത്തീകരിച്ചിരിക്കുന്നു !";
else if( this.editPratilipi )
this.message = "വിജയകരമായി പൂര്‍ത്തീകരിച്ചിരിക്കുന്നു !";
jQuery( '#pratilipiWriteButton' ).prop( 'disabled', false );
if( this.createPratilipi ) {
// Redirect to writer with return option to pratilipi page
this.async( function() {
this.clearAndClose();
window.location.href = pratilipi.writePageUrl;
}, 1000 );
} else if( this.editPratilipi ) {
document.querySelector( 'pratilipi-pratilipi' ).updatePratilipi( pratilipi );
this.async( function() {
this.clearAndClose();
}, 1000 );
}
},
_handleAjaxPostError: function( event ) {
jQuery( '#pratilipiWriteButton' ).prop( 'disabled', false );
if( event.detail.request.xhr.status === 400 || event.detail.request.xhr.status === 401 || event.detail.request.xhr.status === 500 && event.detail.request.xhr.response.message != null )
this.message = event.detail.request.xhr.response.message;
else
this.message = "എന്തോ സാങ്കേതിക പ്രശ്നം സംഭവിച്ചിരിക്കുന്നു. വീണ്ടും ശ്രമിക്കൂ"
}
});
</script>
</dom-module>
<dom-module id="pratilipi-navigation-drawer">
<style>
:host pratilipi-navigation {
position: fixed;
top: 0px;
left: 0px;
overflow-y: scroll;
}
</style>
<template>
<pratilipi-navigation navigation-list='[[ navigationList ]]'></pratilipi-navigation>
</template>
<script>
Polymer({
is: 'pratilipi-navigation-drawer',
behaviors: [
Polymer.IronOverlayBehavior
],
properties: {
navigationList: { type: Array },
},
show: function() {
this.open();
jQuery( this.querySelector( 'pratilipi-navigation' ) ).height( jQuery( window ).height() );
}
});
</script>
</dom-module><dom-module id="pratilipi-navigation">
<style>
:host {
display: block;
margin-right: 10px;
}
.secondary-500 {
min-width: 175px;
max-width: 175px;
padding-bottom: 15px;
}
.secondary-500 h6 {
margin: 0px;
padding: 20px 20px 5px 20px;
color: #D0021B;
}
.secondary-500 a {
color: #333;
}
.secondary-500 div {
padding: 5px 20px 5px 20px;
}
</style>
<template>
<paper-card>
<div class="secondary-500">
<template is="dom-repeat" items="{{ navigationList }}">
<h6>{{ item.title }}</h6>
<template is="dom-repeat" items="{{ item.linkList }}">
<div>
<a href="{{ item.url }}" on-click="_sendGaEvent">{{ item.name }}</a>
</div>
</template>
</template>
</div>
</paper-card>
</template>
<script>
Polymer({
is: 'pratilipi-navigation',
properties: {
navigationList: { type: Array },
},
_sendGaEvent: function() {
}
});
</script>
</dom-module><dom-module id="pratilipi-rating">
<style>
.standard iron-icon {
color: #D0021B;
width: 20px;
height: 20px;
}
.mini {
display: inline-block;
}
.mini iron-icon {
width: 20px;
height: 16px;
margin: -4px;
}
</style>
<template>
<div class="rating-stars">
<iron-icon icon="{{ icon1 }}"></iron-icon>
<iron-icon icon="{{ icon2 }}"></iron-icon>
<iron-icon icon="{{ icon3 }}"></iron-icon>
<iron-icon icon="{{ icon4 }}"></iron-icon>
<iron-icon icon="{{ icon5 }}"></iron-icon>
<content></content>
</div>
<br class="pratilipi-break"/>
</template>
<script>
Polymer({
is: 'pratilipi-rating',
properties: {
value: { type: Number, observer:"_setValue" },
mini: { type: Boolean, value: false }
},
_setZero: function() {
for( var i = 1; i <= 5; i++ )
this.set( "icon" + i, "star-border" );
},
_setValue: function( value ) {
this._setZero();
jQuery( this.querySelector( '.rating-stars' ) ).addClass( this.mini == true ? "mini" : "standard" );
if( this.value >= 0.01 )
this.set( "icon1" , "star-half" );
if( this.value >= 0.51 )
this.set( "icon1" , "star" );
if( this.value >= 1.01 )
this.set( "icon2" , "star-half" );
if( this.value >= 1.51 )
this.set( "icon2" , "star" );
if( this.value >= 2.01 )
this.set( "icon3" , "star-half" );
if( this.value >= 2.51 )
this.set( "icon3" , "star" );
if( this.value >= 3.01 )
this.set( "icon4" , "star-half" );
if( this.value >= 3.51 )
this.set( "icon4" , "star" );
if( this.value >= 4.01 )
this.set( "icon5" , "star-half" );
if( this.value >= 4.51 )
this.set( "icon5" , "star" );
},
ready: function() {
this._setValue();
}
});
</script>
</dom-module>
<dom-module id="pratilipi-card">
<style>
:host {
display: inline-block;
width: 100%;
}
paper-card {
height: 200px;
width: 100%;
--paper-card-header: { display: none };
}
paper-menu {
--paper-menu-color: #333;
--paper-menu-focused-item: {
color: #107FE5;
};
}
paper-menu-button {
position: absolute;
top: 0px;
right: 0px;
}
paper-icon-button {
color: #333;
}
paper-item {
cursor: pointer;
}
</style>
<template>
<paper-card>
<div class="media pratilipi-card-media">
<div class="media-left">
<a href="{{ pratilipi.pageUrl }}">
<iron-image class="pratilipi-shadow"
width="100" height="150"
style="background-color: #f5f5f5"
fade preload
sizing="cover"
src="{{ pratilipiCoverImage }}"
alt="{{ pratilipi.title }}"
title="{{ pratilipi.title }}"></iron-image>
</a>
</div>
<div class="media-body">
<div class="contain-title ellipsed pratilipi-red">
<a class="pratilipi-card-heading pratilipi-red" data-toggle="tooltip" data-placement="top" title="{{ pratilipi.title }}" href="{{ pratilipi.pageUrl }}">{{ pratilipi.title }}</a>
</div>
<template is="dom-if" if="{{ pratilipi.author }}">
<template is="dom-if" if="{{ !draftsActive }}">
<h6><a class="pratilipi-card-author" href="{{ pratilipi.author.pageUrl }}">{{ pratilipi.author.name }}</a></h6>
</template>
</template>
<template is="dom-if" if="{{ showRating }}">
<pratilipi-rating value="{{ pratilipi.averageRating }}">
<span class="rating-text">&nbsp;
{{ pratilipi.ratingCount }}
<iron-icon style="width: 16px; height: 16px;" icon="social:people"></iron-icon>
</span>
</pratilipi-rating>
</template>
<template is="dom-if" if="{{ draftsActive }}">
<paper-menu-button horizontal-align="right" class="pull-right">
<paper-icon-button class="dropdown-trigger" icon="more-vert" noink="true"></paper-icon-button>
<paper-menu class="dropdown-content">
<paper-item on-click="redirectToReader">വായിക്കൂ</paper-item>
</paper-menu>
</paper-menu-button>
</template>
<template is="dom-if" if="{{ publishedActive }}">
<paper-menu-button horizontal-align="right" class="pull-right">
<paper-icon-button class="dropdown-trigger" icon="more-vert" noink="true"></paper-icon-button>
<paper-menu class="dropdown-content">
<paper-item on-click="redirectToWriter">രചന തിരുത്തൂ</paper-item>
<paper-item on-click="moveToDrafts">ഡ്രാഫ്റ്റുകളിലേക്ക് മാറ്റൂ</paper-item>
</paper-menu>
</paper-menu-button>
</template>
<div style="position: absolute; bottom: 25px; display: inline-block;">
<template is="dom-if" if="{{ draftsActive }}">
<a on-click="publishNow" class="pratilipi-light-blue-button">പ്രസിദ്ധീകരിക്കൂ.</a>
<br class="pratilipi-break" />
<a on-click="redirectToWriter" class="pratilipi-light-blue-button">രചന തിരുത്തൂ</a>
</template>
<template is="dom-if" if="{{ ! draftsActive }}">
<a on-click="redirectToReader" class="pratilipi-light-blue-button">വായിക്കൂ</a>
</template>
</div>
</div>
</div>
</paper-card>
<iron-ajax
id="AjaxPost"
url="/api/pratilipi?_apiVer=2"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_handleAjaxPostResponse"
on-error="_handleAjaxPostError"
></iron-ajax>
<iron-ajax
id="userpratilipiPost"
url="/api/userpratilipi/library"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_handleUserPratilipiPostResponse"
on-error="_handleUserPratilipiPostError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-card',
properties: {
pratilipi: { type: Object },
draftsActive: { type: Boolean, value: false, observer: "init" },
publishedActive: { type: Boolean, value: false },
hideAddToLibraryButton: { type: Boolean, value: false },
showRemoveFromLibraryButton: { type: Boolean, value: false }
},
redirectToReader: function() {
window.location.href = this.pratilipi.readPageUrl + "&ret=" + window.location.pathname + encodeURIComponent( window.location.search );
},
redirectToWriter: function() {
window.location.href = this.pratilipi.writePageUrl + "&ret=" + window.location.pathname;
},
addToLibrary: function() {
if( document.querySelector( 'pratilipi-user' ).getCurrentUser().isGuest ) {
document.querySelector( 'pratilipi-user' ).logIn();
} else {
this.$.userpratilipiPost.body = ( "pratilipiId=" + this.pratilipi.pratilipiId + "&" + "addedToLib=true" );
this.$.userpratilipiPost.generateRequest();
}
},
removeFromLibrary: function() {
this.$.userpratilipiPost.body = ( "pratilipiId=" + this.pratilipi.pratilipiId + "&" + "addedToLib=false" );
this.$.userpratilipiPost.generateRequest();
},
_handleUserPratilipiPostResponse: function( event ) {
// If remove option
if( this.showRemoveFromLibraryButton )
document.querySelector( 'pratilipi-library-page' ).removePratilipiById( this.pratilipi.pratilipiId );
alert( "Success!" );
},
_handleUserPratilipiPostError: function( event ) {
alert( "Error at server, please try again!" );
},
attached: function() {
if( this.pratilipi.coverImageUrl.indexOf( '?' ) == -1 )
this.pratilipiCoverImage = this.pratilipi.coverImageUrl + "?" + "width=100";
else
this.pratilipiCoverImage = this.pratilipi.coverImageUrl + "&" + "width=100";
jQuery( this.querySelector( '.ellipsed' ) ).width( jQuery( this ).width() - 130 );
$('[data-toggle="tooltip"]').tooltip();
$("[data-placement=top]").hover(function(){
$( '.tooltip' ).css( 'left','130px' )
$( '.tooltip' ).css( 'white-space','normal' )
});
if( this.pratilipi.ratingCount != null && this.pratilipi.ratingCount > 0 )
this.showRating = true;
else
this.showRating = false;
},
init: function() {
if( this.pratilipi == null )
return;
this.async( function() {
jQuery( this.querySelector( '.ellipsed' ) ).width( jQuery( this ).width() - 130 );
}, 30 );
},
publishNow: function() {
this.$.AjaxPost.body = jQuery.param( { "pratilipiId": this.pratilipi.pratilipiId, "state": "PUBLISHED" } );
this.$.AjaxPost.generateRequest();
},
moveToDrafts: function() {
this.$.AjaxPost.body = jQuery.param( { "pratilipiId": this.pratilipi.pratilipiId, "state": "DRAFTED" } );
this.$.AjaxPost.generateRequest();
},
_handleAjaxPostResponse: function( event ) {
var pratilipi = event.detail.response;
// Move to Published Section if drafts is already active
if( this.draftsActive ) {
document.querySelector( 'pratilipi-author-books' ).addToPublishedList( pratilipi );
document.querySelector( 'pratilipi-author-books' ).removeFromDraftedList( pratilipi );
document.querySelector( 'pratilipi-author-books' ).publishedClicked();
}
// Move to Drafted Section if published is already active
else if( this.publishedActive ) {
document.querySelector( 'pratilipi-author-books' ).addToDraftedList( pratilipi );
document.querySelector( 'pratilipi-author-books' ).removeFromPublishedList( pratilipi );
document.querySelector( 'pratilipi-author-books' ).draftsClicked();
}
},
_handleAjaxPostError: function( event ) {
if( event.detail.request.xhr.status === 400 || event.detail.request.xhr.status === 401 || event.detail.request.xhr.status === 500 )
alert( event.detail.request.xhr.response.message );
else
alert( "എന്തോ സാങ്കേതിക പ്രശ്നം സംഭവിച്ചിരിക്കുന്നു. വീണ്ടും ശ്രമിക്കൂ" );
}
});
</script>
</dom-module>
<dom-module id="pratilipi-card-grid">
<style>
:host {
display: block;
}
paper-card.add-card {
width: 100%;
height: 200px;
background: #E0E0E0;
--paper-card-header: { display: none };
}
paper-card.zero-results {
width: 100%;
text-align: center;
padding: 50px 15px;
margin-bottom: 10px;
}
iron-icon {
--iron-icon-height: 64px;
--iron-icon-width: 64px;
}
iron-icon.zero-results-icon {
color: #545454;
width: 64px;
height: 64px;
}
h5.zero-results-h5 {
color: #545454;
font-size: 18px;
line-height: 32px;
margin-top: 24px;
}
paper-spinner.pratilipi-spinner {
--paper-spinner-layer-1-color: #D0021B;
--paper-spinner-layer-2-color: #107FE5;
--paper-spinner-layer-3-color: #D0021B;
--paper-spinner-layer-4-color: #107FE5;
}
/* Specific to card-grid */
.row {
margin-right: -3px;
margin-left: -3px;
}
.col-xs-12, .col-sm-6, .col-md-6, .col-lg-6 {
padding-left: 4px;
padding-right: 4px;
}
</style>
<template>
<!-- Card Grid Heading -->
<template is="dom-if" if="{{ heading }}">
<div class="secondary-500 pratilipi-shadow pratilipi-card-grid-heading pratilipi-red">
<template is="dom-if" if="[[ !headingUrl ]]">
{{ heading }}
</template>
<template is="dom-if" if="{{ headingUrl }}">
<a class="pratilipi-red" style="font-size: 22px;" href="{{ headingUrl }}">{{ heading }}</a>
<a href="{{ headingUrl }}" class="link pull-right pratilipi-blue">കൂടുതല്‍ കാണൂ...</a>
</template>
</div>
<br class="pratilipi-break"/>
</template>
<!-- No Books found in case of no results -->
<template is="dom-if" if="[[ zeroSearchResults ]]">
<paper-card class="zero-results">
<iron-icon icon="icons:search" class="zero-results-icon"></iron-icon>
<h5 class="zero-results-h5">ക്ഷമിക്കണം! താങ്കളുടെ തിരച്ചിലിന് യോജിക്കുന്ന ഫലങ്ങള്‍ ഒന്നും കണ്ടെത്താനായില്ല. ദയവായി തിരച്ചിലിന് മറ്റൊരു വാക്ക് ഉപയോഗിക്കുക!</h5>
</paper-card>
</template>
<template is="dom-if" if="[[ zeroAuthorBooks ]]">
<paper-card class="zero-results">
<iron-icon icon="icons:info-outline" class="zero-results-icon"></iron-icon>
<h5 class="zero-results-h5">ക്ഷമിക്കണം! ഈ രചയിതാവ് രചനകള് ഒന്നും തന്നെ പ്രസിദ്ധീകരിച്ചിട്ടില്ല.</h5>
</paper-card>
</template>
<!-- List of Books -->
<div class="row">
<template is="dom-repeat" id="repeatPratilipiList" items="[[ pratilipiList ]]">
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<pratilipi-card
hide-add-to-library-button="{{ hideAddToLibraryButton }}"
show-remove-from-library-button="{{ showRemoveFromLibraryButton }}"
pratilipi="[[ item ]]"
drafts-active="[[ draftsActive ]]"
published-active="[[ publishedActive ]]"></pratilipi-card>
</div>
</template>
</div>
<!-- Spinner when Loading more books -->
<template is="dom-if" if="{{ isLoading }}">
<paper-spinner class="pratilipi-spinner pratilipi-spinner-center" active></paper-spinner>
</template>
<!-- Show More Button in case of network call failure -->
<template is="dom-if" if="{{ includeShowMoreButton }}">
<button style="width: 100%;" class="pratilipi-new-blue-button" on-click="loadMore">കൂടുതല്‍ രചനകള്‍ കാണിക്കുക.</button>
</template>
<iron-ajax
id="AjaxGet"
url="/api/pratilipi/list"
method="GET"
params="[[ filter ]]"
content-type="application/json"
handle-as="json"
on-response="_handleAjaxGetResponse"
on-error="_handleAjaxGetError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-card-grid',
properties: {
authorId: { type: String, value: null },
heading: { type: String },
headingUrl: { type: String, value: null },
pratilipiList: { type: Array, notify: true },
searchQuery: { type: String },
filter: { type: Object },
cursor: { type: String },
isLoading: { type: Boolean, value: false },
isFinished: { type: Boolean, value: false },
includeShowMoreButton: { type: Boolean, value: false },
draftsActive: { type: Boolean, value: false },
publishedActive: { type: Boolean, value: false },
zeroSearchResults: { type: Boolean, value: false },
zeroAuthorBooks: { type: Boolean, value: false },
hideAddToLibraryButton: { type: Boolean, value: false },
showRemoveFromLibraryButton: { type: Boolean, value: false }
},
setSearchQuery: function( query ) {
this.set( 'searchQuery', query );
this.reset();
},
pushToPratilipiList: function( pratilipiList ) {
for( var i = 0; i < pratilipiList.length; i++ )
this.push( 'pratilipiList', pratilipiList[i] );
},
checkForZeroResults: function() {
if( this.pratilipiList.length != 0 ) {
this.zeroSearchResults = false;
this.zeroAuthorBooks = false;
return;
}
if( this.searchQuery != null )
this.zeroSearchResults = true;
if( ! this.includeAddCard && this.$.AjaxGet.params.authorId != null )
this.zeroAuthorBooks = true;
},
reset: function() {
var ajaxGet = this.$.AjaxGet;
if( ajaxGet.lastRequest )
ajaxGet.lastRequest.abort();
this.set( "pratilipiList", [] );
// Setting the flags and clearing the cursor.
this.cursor = null;
this.isLoading = true;
this.isFinished = false;
this.zeroSearchResults = false;
this.zeroAuthorBooks = false;
// Set params and make ajax GET call. Filters already set when element initialised.
if( this.searchQuery != null )
ajaxGet.params.searchQuery = this.searchQuery;
if( ajaxGet.params.state == null )
ajaxGet.params.state = "PUBLISHED";
delete ajaxGet.params.cursor;
ajaxGet.params._apiVer = "2";
this.async( function() { ajaxGet.generateRequest(); });
},
loadMore: function() {
if( !this.isLoading && !this.isFinished )
this.includeShowMoreButton = true;
// Return if there is an active call or cursor = null.
if( this.isLoading || this.isFinished || this.cursor == null || this.cursor == "" )
return;
// Check for window height.
var reqHeight = jQuery( window ).scrollTop()
- jQuery( this ).position().top
+ jQuery( window ).height()
+ 3 * jQuery( window ).height();
if( jQuery( this ).outerHeight( true ) >= reqHeight )
return;
// Spinner Active and disable show more button.
this.isLoading = true;
this.includeShowMoreButton = false;
// Set params and make ajax GET call. Filters already set when element initialised.
var ajaxGet = this.$.AjaxGet;
if( this.searchQuery != null )
ajaxGet.params.searchQuery = this.searchQuery;
// Set state = PUBLISHED iff state is null. ( Might be set in filters )
if( ajaxGet.params.state == null )
ajaxGet.params.state = "PUBLISHED";
ajaxGet.params.cursor = this.cursor;
ajaxGet._apiVer = "2";
this.async( function() { ajaxGet.generateRequest(); });
ga_CA( 'Pratilipi', 'LoadMore' );
},
_handleAjaxGetResponse: function( request ) {
// Disable spinner
this.isLoading = false;
// Call didn't succeed.
if( ! request.detail.response )
return;
var pratilipiList = request.detail.response.pratilipiList;
this.pushToPratilipiList( pratilipiList );
if( request.detail.response.cursor == null || pratilipiList.length < 20 ) {
this.includeShowMoreButton = false;
this.isFinished = true;
}
else
this.cursor = request.detail.response.cursor;
this.checkForZeroResults();
},
_handleAjaxGetError: function() {
this.isLoading = false;
this.includeShowMoreButton = true;
},
attached: function() {
if( this.pratilipiList.length < 20 || this.cursor == "" )
this.isFinished = true;
this.checkForZeroResults();
}
});
</script>
</dom-module><dom-module id="pratilipi-card-mini">
<style>
:host {
display: inline-block;
text-align:center;
margin-bottom: 16px;
}
.pratilipi-card {
border-top: 1px solid #d3d3d3;
display: flex;
}
.pratilipi-card .pratilipi-title {
font-weight: 700;
}
.pratilipi-card .pratilipi-title-mini {
margin-bottom: 12px;
}
.pratilipi-card iron-image {
position: absolute;
z-index: 0;
display: block;
width: inherit;
height: inherit;
}
.pratilipi-card paper-fab.library-icon {
position: absolute;
width: 24px;
height: 24px;
--paper-fab-background: #F5F5F5;
opacity: 0.8;
padding: 0;
--paper-fab-iron-icon: {
color: #333;
width: 15px;
height: 15px;
};
}
.pratilipi-card paper-fab.share-icon {
position: absolute;
width: 24px;
height: 24px;
--paper-fab-background: #F5F5F5;
opacity: 0.75;
padding: 0;
--paper-fab-iron-icon: {
color: #333;
width: 15px;
height: 15px;
};
}
.pratilipi-card paper-fab.edit-icon {
position: absolute;
width: 22px;
height: 22px;
z-index: 1;
--paper-fab-background: transparent;
padding: 0;
--paper-fab-iron-icon: {
color: #333;
width: 15px;
height: 15px;
};
}
.pratilipi-card .centered-div {
align-self: center;
margin: auto;
padding-left: 8px;
padding-right: 8px;
}
.pratilipi-card .centered-div h6 {
margin: 0;
margin-bottom: 8px;
font-size: 14px;
line-height: 18px;
font-weight: 500;
}
.pratilipi-card .centered-div button {
display: block;
cursor: pointer;
margin: 4px auto;
font-size: 12px;
}
.pratilipi-card .centered-div .btn {
white-space: normal;
border-radius: 4px;
outline: none;
}
.pratilipi-card paper-icon-button.close-button {
position: absolute;
top: 1px;
}
.ellipsed, a.ellipsed:hover, a.ellipsed:focus {
text-align: left;
color: #000;
display: block;
}
.white-snippet, .white-snippet-reduced {
text-decoration: none;
float: left;
width: inherit;
text-align: center;
color: #333;
position: relative;
z-index: 0;
background: #fbfbfb;
background: -moz-linear-gradient(to bottom, rgba(255, 255, 255, 0.65) 0%, #fbfbfb 100%);
background: -webkit-linear-gradient(top, rgba(255, 255, 255, 0.65) 0%, #fbfbfb 100%);
background: -o-linear-gradient(top, rgba(255, 255, 255, 0.65) 0%, #fbfbfb 100%);
background: -ms-linear-gradient(top, rgba(255, 255, 255, 0.65) 0%, #fbfbfb 100%);
background: linear-gradient(to bottom, rgba(255, 255, 255, 0.65) 0%, #fbfbfb 100%);
}
.white-snippet {
height: 60px;
padding: 4px 8px;
}
.white-snippet-reduced {
height: 45px;
padding: 8px;
}
.meta-container {
color: #7e7e7e;
text-align: left;
background: #fbfbfb;
position: relative;
}
.read-rating-count iron-icon {
width: 15px;
height: 15px;
margin-top: -2px;
}
.share-popup .share-menu-item {
margin:32px 16px;
display: block;
text-align: left;
}
.share-popup .share-menu-item a {
color: inherit;
}
.share-popup .share-menu-item span.icon {
float: left;
}
.share-popup .share-menu-item span.text {
font-size: 15px;
margin-left: 12px;
line-height: 32px;
}
.library-popup .library-item-menu {
padding: 30px 4px;
padding-top: 64px;
}
.library-popup .library-item-menu h6 {
float: left;
}
.library-popup .library-item-menu paper-toggle-button {
--paper-toggle-button-checked-bar-color: #107fe5;
--paper-toggle-button-checked-button-color: #107fe5;
--paper-toggle-button-checked-ink-color: #107fe5;
--paper-toggle-button-unchecked-bar-color: #d0021b;
--paper-toggle-button-unchecked-button-color: #d0021b;
--paper-toggle-button-unchecked-ink-color: #d0021b;
}
@media only screen and (max-width: 599px) {
:host {
width: 110px;
}
.pratilipi-card {
width: 110px;
height: 165px;
}
.pratilipi-card .pratilipi-title {
font-size: 11px;
line-height: 13px;
}
.pratilipi-card paper-fab.library-icon {
top: 8px;
margin-left: 4px;
}
.pratilipi-card paper-fab.share-icon {
top: 8px;
margin-left: 83px;
}
.pratilipi-card paper-fab.edit-icon {
top: 104px;
margin-left: 85px;
}
.pratilipi-card .centered-div button {
word-break: break-all;
}
.white-snippet {
margin-top: calc( 165px - 60px - 24px );
}
.white-snippet-reduced {
margin-top: calc( 165px - 45px - 24px );
}
.meta-container {
height: 28px;
margin-top: -27px;
}
.ellipsed, a.ellipsed:hover, a.ellipsed:focus {
width: 80px;
}
.read-rating-count {
font-size: 12px;
}
.pratilipi-card paper-icon-button.close-button {
top: 0px;
margin-left: 82px;
height: 32px;
width: 32px;
}
}
@media only screen and (min-width: 600px) {
:host {
width: 160px;
}
.pratilipi-card {
width: 160px;
height: 240px;
}
.pratilipi-card .pratilipi-title {
font-size: 13px;
line-height: 20px;
}
.pratilipi-card paper-fab.library-icon {
top: 10px;
margin-left: 4px;
}
.pratilipi-card paper-fab.share-icon {
top: 10px;
margin-left: 132px;
}
.pratilipi-card paper-fab.edit-icon {
top: 184px;
margin-left: 132px;
}
.pratilipi-card .centered-div button {
word-break: normal;
}
.white-snippet {
margin-top: calc( 240px - 60px - 20px );
}
.white-snippet-reduced {
margin-top: calc( 240px - 45px - 20px );
}
.meta-container {
height: 24px;
margin-top: -23px;
}
.ellipsed, a.ellipsed:hover, a.ellipsed:focus {
width: 120px;
}
.read-rating-count {
font-size: 14px;
}
.pratilipi-card paper-icon-button.close-button {
margin-left: 124px;
}
}
</style>
<template>
<div class="pratilipi-shadow">
<template is="dom-if" if="{{ showContent }}">
<a href="{{ pratilipi.pageUrl }}">
<span class="pratilipi-card" style="cursor: pointer;" title="{{ fullTitle }}">
<iron-image class="pratilipi-shadow"
style="background-color: #f5f5f5"
fade preload
sizing="contain"
src="{{ pratilipiCoverImage }}"
alt="{{ pratilipi.title }}"
title="{{ pratilipi.title }}"></iron-image>
<template is="dom-if" if="{{ showShareAndLibraryOptions }}">
<paper-fab mini class="library-icon" icon="icons:book" on-click="openLibraryDialog"></paper-fab>
<paper-fab mini class="share-icon" icon="social:share" on-click="openShareDialog" onclick="ga_CA( 'Pratilipi', 'Share' )"></paper-fab>
</template>
<template is="dom-if" if="{{ showEditOption }}">
<paper-fab mini class="edit-icon" icon="icons:create" on-click="showEditFunction"></paper-fab>
</template>
<template is="dom-if" if="{{ pratilipi.author }}">
<div class="white-snippet">
<div class="contain-title ellipsed pratilipi-title">{{ title }}</div>
<a href="{{ pratilipi.author.pageUrl }}"><span class="contain-title ellipsed">{{ pratilipi.author.name }}</span></a>
</div>
</template>
<template is="dom-if" if="{{ !pratilipi.author }}">
<div class="white-snippet-reduced">
<div class="contain-title ellipsed pratilipi-title">{{ title }}</div>
</div>
</template>
</span>
</a>
</template>
<template is="dom-if" if="{{ showEditContent }}">
<div style="background: #fbfbfb;" class="pratilipi-card">
<paper-icon-button class="close-button" icon="icons:close" on-click="cancelEditFunction"></paper-icon-button>
<div class="centered-div">
<div class="pratilipi-title pratilipi-title-mini">{{ fullTitle }}</div>
<template is="dom-if" if="{{ canMoveToDrafts }}">
<button class="btn btn-primary" on-click="confirmMoveContentToDrafts">ഡ്രാഫ്റ്റുകളിലേക്ക് മാറ്റൂ</button>
</template>
<template is="dom-if" if="{{ canPublish }}">
<button class="btn btn-success" on-click="publishContent">പ്രസിദ്ധീകരിക്കൂ.</button>
</template>
<template is="dom-if" if="{{ canDelete }}">
<button class="btn btn-danger" on-click="confirmDeleteContent">നീക്കം ചെയ്യൂ</button>
</template>
</div>
</div>
</template>
<template is="dom-if" if="{{ showDraftsContent }}">
<div style="background: #fbfbfb;" class="pratilipi-card">
<paper-icon-button class="close-button" icon="icons:close" on-click="cancelEditFunction"></paper-icon-button>
<div class="centered-div">
<div class="pratilipi-title pratilipi-title-mini">{{ fullTitle }}</div>
<h6>ഡ്രാഫ്റ്റുകളിലേക്ക് മാറ്റട്ടേ ?</h6>
<button class="btn btn-danger" on-click="moveContentToDrafts">ശരി</button>
</div>
</div>
</template>
<template is="dom-if" if="{{ showDeleteContent }}">
<div style="background: #fbfbfb;" class="pratilipi-card">
<paper-icon-button class="close-button" icon="icons:close" on-click="cancelEditFunction"></paper-icon-button>
<div class="centered-div">
<div class="pratilipi-title pratilipi-title-mini">{{ fullTitle }}</div>
<h6>ഈ രചന നീക്കം ചെയ്യട്ടേ?</h6>
<button class="btn btn-danger" on-click="deleteContent">ശരി</button>
</div>
</div>
</template>
<div class="meta-container">
<span class="read-rating-count pull-left" style="margin-left: 8px;">
<iron-icon icon="icons:visibility"></iron-icon>
{{ readText }}
</span>
<template is="dom-if" if="{{ showRating }}">
<span class="read-rating-count pull-right" style="margin-right: 8px;">
{{ averageRating }}
<iron-icon icon="icons:star"></iron-icon>
</span>
</template>
</div>
</div>
<div class="modal fade share-popup" tabindex="-1">
<div class="modal-dialog" width="400px;">
<div class="modal-content">
<div class="modal-body">
<paper-icon-button class="pull-right" icon="icons:close" data-dismiss="modal"></paper-icon-button>
<div class="share-menu-item">
<a on-click="shareOnFacebook">
<span class="icon icon-facebook"></span>
<span class="text">ഫേസ്ബുക്കില്‍ ഷെയര്‍ ചെയ്യൂ</span>
</a>
</div>
<div class="share-menu-item">
<a on-click="shareOnTwitter">
<span class="icon icon-twitter"></span>
<span class="text">ട്വിറ്ററില്‍ ഷെയര്‍ ചെയ്യൂ</span>
</a>
</div>
<div class="share-menu-item">
<a on-click="shareOnGplus">
<span class="icon icon-google-plus"></span>
<span class="text">ഗൂഗിള്‍ പ്ലസില്‍ ഷെയര്‍ ചെയ്യൂ</span>
</a>
</div>
</div>
</div>
</div>
</div>
<div class="modal fade library-popup" tabindex="-1">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-body">
<paper-icon-button class="pull-right" icon="icons:close" data-dismiss="modal"></paper-icon-button>
<div class="library-item-menu">
<h6>ലൈബ്രറിയിലേക്ക് രചനകള്‍ ചേര്‍ക്കൂ</h6>
<paper-toggle-button noink class="pull-right" checked="{{ addedToLib }}" on-change="switchLibraryState"></paper-toggle-button>
</div>
</div>
</div>
</div>
</div>
<iron-ajax
id="UserPratilipiLibraryApi"
url="/api/userpratilipi/library"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_userPratilipiLibraryApiResponse"
on-error="_userPratilipiLibraryApiError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-card-mini',
properties: {
pratilipi: { type: Object, observer: "_pratilipiObserver" },
state: { type: String, observer: "_stateObserver" },
showEditOption: { type: Boolean, value: false },
showContent: { type: Boolean, value: true },
showEditContent: { type: Boolean, value: false },
showDraftsContent: { type: Boolean, value: false },
showDeleteContent: { type: Boolean, value: false },
shareDialogOpened: { type: Boolean, value: false },
libraryDialogOpened: { type: Boolean, value: false }
},
_stateObserver: function() {
this.set( 'canMoveToDrafts', this.state != "DRAFTED" );
this.set( 'canPublish', this.state != "PUBLISHED" );
this.set( 'canDelete', this.state != "DELETED" && this.state != "PUBLISHED" );
},
_pratilipiObserver: function() {
if( this.pratilipi.title != null && this.pratilipi.title.trim() != "" && this.pratilipi.titleEn != null && this.pratilipi.titleEn.trim() != null )
this.set( 'fullTitle', this.pratilipi.title + " | " + this.pratilipi.titleEn );
else if( this.pratilipi.title != null && this.pratilipi.title.trim() != "" )
this.set( 'fullTitle', this.pratilipi.title );
else
this.set( 'fullTitle', this.pratilipi.titleEn );
this.set( 'title', this.pratilipi.title != null && this.pratilipi.title.trim() != "" ? this.pratilipi.title : this.pratilipi.titleEn );
var width = jQuery( window ).width() >= 600 ? "160" : "110";
this.set( 'pratilipiCoverImage', this.pratilipi.coverImageUrl + ( this.pratilipi.coverImageUrl.indexOf( '?' ) == -1 ? "?" : "&" ) + "width=" + width );
this.set( 'averageRating', Math.round( this.pratilipi.averageRating * 10 ) / 10 );
this.set( 'readText', abbrNum( this.pratilipi.readCount, 1 ) );
this.set( 'showRating', this.pratilipi.averageRating > 0 );
this.set( 'hasAccessToUpdate', this.pratilipi.hasAccessToUpdate );
this.set( 'showEditOption', this.pratilipi.hasAccessToUpdate && this.showEditOption );
this.set( 'showShareAndLibraryOptions', this.state != "DRAFTED" );
this.set( 'addedToLib', this.pratilipi.addedToLib );
},
redirectToContentPage: function() {
if( this.shareDialogOpened ) {
this.set( 'shareDialogOpened', false );
return;
}
if( this.libraryDialogOpened ) {
this.set( 'libraryDialogOpened', false );
return;
}
if( this.showEditContent )
return;
window.location.href = this.pratilipi.pageUrl;
},
showEditFunction: function( e ) {
e.preventDefault();
e.stopPropagation();
this.set( 'showContent', false );
this.set( 'showEditContent', true );
},
cancelEditFunction: function() {
this.set( 'showEditContent', false );
this.set( 'showDraftsContent', false );
this.set( 'showDeleteContent', false );
this.set( 'showContent', true );
},
confirmMoveContentToDrafts: function() {
this.set( 'showEditContent', false );
this.set( 'showDraftsContent', true );
},
confirmDeleteContent: function() {
this.set( 'showEditContent', false );
this.set( 'showDeleteContent', true );
},
moveContentToDrafts: function() {
this.domHost.moveContentToDrafts( this.pratilipi.pratilipiId );
},
publishContent: function() {
this.domHost.publishContent( this.pratilipi.pratilipiId );
},
deleteContent: function() {
this.domHost.deleteContent( this.pratilipi.pratilipiId );
},
openShareDialog: function( e ) {
e.preventDefault();
e.stopPropagation();
this.set( 'shareDialogOpened', true );
jQuery( this.querySelector( '.share-popup' ) ).modal();
},
openLibraryDialog: function( e ) {
e.preventDefault();
e.stopPropagation();
this.set( 'libraryDialogOpened', true );
jQuery( this.querySelector( '.library-popup' ) ).modal();
},
_getShareUrl: function( utm_source ) {
if( utm_source == null ) return;
var utm_parent = "pratilipi";
if( document.querySelector( 'pratilipi-author-page' ) != null )
utm_parent = "profile";
else if( document.querySelector( 'pratilipi-event-page' ) != null )
utm_parent = "event";
else if( document.querySelector( 'pratilipi-library-page' ) != null )
utm_parent = "library";
var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
return encodeURIComponent(
"http://malayalam.pratilipi.com" + this.pratilipi.pageUrl
+ ( this.pratilipi.pageUrl.indexOf( '?' ) == -1 ? "?" : "&" )
+ "utm_language=malayalam" + "&"
+ "utm_version=standard" + "&"
+ "utm_device=" + ( width < 600 ? "mobile" : "desktop" ) + "&"
+ "utm_parent=" + utm_parent + "&"
+ "utm_location=card" + "&"
+ "utm_action=share" + "&"
+ "utm_source=" + utm_source
);
},
shareOnFacebook: function() {
clevertapShareContentOnFacebook( this.pratilipi.title, this.pratilipi.pratilipiId );
window.open( "http://www.facebook.com/sharer.php?u=" + this._getShareUrl( "facebook" ),
"share", "width=1100,height=500,left=70px,top=60px" );
},
shareOnTwitter: function() {
window.open( "http://twitter.com/share?url=" + this._getShareUrl( "twitter" ),
"share", "width=1100,height=500,left=70px,top=60px" );
},
shareOnGplus: function() {
window.open( "https://plus.google.com/share?url=" + this._getShareUrl( "gplus" ),
"share", "width=1100,height=500,left=70px,top=60px" );
},
switchLibraryState: function() {
if( document.querySelector( 'pratilipi-user' ).getCurrentUser().isGuest ) {
this.async( function() {
this.set( 'addedToLib', ! this.addedToLib );
}, 120 );
this.async( function() {
jQuery( this.querySelector( '.library-popup' ) ).modal( 'hide' );
document.querySelector( 'pratilipi-user' ).logIn( true, "താങ്കളുടെ ലൈബ്രറിയിലേക്ക് രചനകള്‍ ചേര്‍ക്കാന്‍ ലോഗിന്‍ ചെയ്യൂ" );
}, 250 );
return;
}
this.$.UserPratilipiLibraryApi.body = ( "pratilipiId=" + this.pratilipi.pratilipiId + "&" + "addedToLib=" + this.addedToLib );
this.$.UserPratilipiLibraryApi.generateRequest();
ga_CA( 'Pratilipi', 'Add To Library' );
},
_userPratilipiLibraryApiResponse: function( response ) {
if( this.addedToLib != response.detail.response.addedToLib )
this.set( 'addedToLib', response.detail.response.addedToLib );
},
_userPratilipiLibraryApiError: function( response ) {
this.set( 'addedToLib', ! this.addedToLib );
}
});
</script>
</dom-module><dom-module id="pratilipi-follow-author">
<style>
:host {
display: block;
}
.follow-author {
padding: 14px 12px;
display: flex;
}
.follow-author .follow-author-image {
float: left;
text-align: center;
align-self: center;
margin-right: 16px;
}
.follow-author .follow-author-name {
float: left;
width: 100%;
text-align: left;
align-self: center;
font-size: 13px;
}
.follow-author .follow-author-name a, .follow-author .follow-author-name a:hover, .follow-author .follow-author-name a:focus {
color: #333;
display: inline-block;
}
.follow-author .follow-author-name .follow-count {
font-size: 12px;
white-space: nowrap;
}
.follow-author .follow-author-buttons-holder {
margin-left: 8px;
float: right;
white-space: nowrap;
text-align: center;
align-self: center;
}
.pratilipi-author-follow-button {
margin: 0;
border-radius: 4px;
font-weight: 400;
font-size: 12px;
letter-spacing: 0;
background: #FFFFFF;
border: 1px solid #d0021b;
box-shadow: 0px 1px 1px 0px rgba(0, 0, 0, 0.05);
display: inline-block;
outline: none;
padding: 4px 8px;
}
.pratilipi-author-follow-button iron-icon {
color: #d0021b;
width: 20px;
height: 20px;
}
.pratilipi-author-unfollow-button {
margin: 0;
border-radius: 4px;
font-weight: 400;
font-size: 12px;
letter-spacing: 0;
background: #d41b31;
border: 1px solid #fff;
box-shadow: 0px 1px 1px 0px rgba(0, 0, 0, 0.05);
display: inline-block;
outline: none;
padding: 4px 8px;
}
.pratilipi-author-unfollow-button iron-icon {
color: #fff;
width: 20px;
height: 20px;
}
</style>
<template>
<div class="follow-author">
<div class="follow-author-image">
<a href="{{ pageUrl }}"><iron-image style="background-color: #ddd; width: 48px; height: 48px;"
src="{{ imageUrl }}" class="img-circle pratilipi-shadow" ></iron-image></a>
</div>
<div class="follow-author-name contain-title ellipsed">
<a href="{{ pageUrl }}">{{ name }}</a>
<template is="dom-if" if="{{ showFollowCount }}">
<div class="follow-count">{{ followCount }}&nbsp;ഫോളോവേഴ്സ്</div>
</template>
</div>
<template is="dom-if" if="{{ canFollow }}">
<div class="follow-author-buttons-holder pull-right">
<template is="dom-if" if="{{ !following }}">
<button class="pratilipi-author-follow-button" on-click="followAuthor"><iron-icon icon="social:person-add"></button>
</template>
<template is="dom-if" if="{{ following }}">
<button class="pratilipi-author-unfollow-button" on-click="unFollowAuthor"><iron-icon icon="icons:done"></button>
</template>
</div>
</template>
</div>
<iron-ajax
id="UserAuthorFollowApi"
url="/api/userauthor/follow"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_userAuthorFollowApiResponse"
on-error="_userAuthorFollowApiError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-follow-author',
properties: {
followObject: { type: Object, notify: true },
authorId: { type: String },
name: { type: String },
pageUrl: { type: String },
followCount: { type: Number },
imageUrl: { type: String },
following: { type: Boolean },
canFollow: { type: Boolean }
},
observers: [
'_followObjectObserver(followObject.following)'
],
_followObjectObserver: function() {
this.set( 'authorId', this.followObject.authorId );
this.set( 'name', this.followObject.name );
this.set( 'pageUrl', this.followObject.pageUrl );
this.set( 'followCount', this.followObject.followCount );
this.set( 'showFollowCount', this.followObject.followCount > 0 );
this.set( 'imageUrl', this.followObject.imageUrl + ( this.followObject.imageUrl.indexOf( "?" ) == -1 ? "?" : "&" ) + "width=48" );
this.set( 'following', this.followObject.following );
this.set( 'canFollow', this.followObject.canFollow );
},
_makeFollowApiCall: function( following ) {
if( document.querySelector( 'pratilipi-user' ).getCurrentUser().isGuest ) {
document.querySelector( 'pratilipi-user' ).logIn( true );
return;
}
this._swapFollowingState();
this._disableFollowButtons();
var body = { authorId: this.authorId, following: following };
this.$.UserAuthorFollowApi.body = jQuery.param( body );
this.$.UserAuthorFollowApi.generateRequest();
ga_CA( 'Author', following ? 'Follow' : 'UnFollow' );
},
followAuthor: function() {
this._makeFollowApiCall( true );
},
unFollowAuthor: function() {
this._makeFollowApiCall( false );
},
_userAuthorFollowApiResponse: function( event ) {
if( event.detail.response.following != this.following ) {
this._swapFollowingState();
}
this._enableFollowButtons();
},
_userAuthorFollowApiError: function( event ) {
this._swapFollowingState();
this._enableFollowButtons();
if( event != null && event.detail.request.xhr.response.message != null ) {
document.querySelector( 'pratilipi-alert' ).alert( event.detail.request.xhr.response.message, false );
} else {
document.querySelector( 'pratilipi-alert' ).alert( "എന്തോ സാങ്കേതിക പ്രശ്നം സംഭവിച്ചിരിക്കുന്നു. വീണ്ടും ശ്രമിക്കൂ", false );
}
},
_disableFollowButtons: function() {
this.async( function() {
jQuery( this.querySelector( '.follow-author-buttons-holder .pratilipi-author-follow-button' ) ).prop( 'disabled', true );
jQuery( this.querySelector( '.follow-author-buttons-holder .pratilipi-author-unfollow-button' ) ).prop( 'disabled', true );
});
},
_enableFollowButtons: function() {
jQuery( this.querySelector( '.follow-author-buttons-holder .pratilipi-author-follow-button' ) ).prop( 'disabled', false );
jQuery( this.querySelector( '.follow-author-buttons-holder .pratilipi-author-unfollow-button' ) ).prop( 'disabled', false );
},
_swapFollowingState: function() {
this.set( 'followObject.followCount', this.following ? ( this.followCount - 1 ) : ( this.followCount + 1 ) );
this.set( 'followObject.following', !this.following );
}
});
</script>
</dom-module><dom-module id="pratilipi-follow-author-popup">
<style>
.modal-dialog {
overflow-y: initial !important
}
.modal-body {
height: 100%;
overflow-y: auto;
}
.vertical-alignment-helper {
display: table;
padding-top: 16px;
padding-bottom: 16px;
height: 100%;
width: 100%;
pointer-events: none;
}
.vertical-align-center {
display: table-cell;
vertical-align: middle;
pointer-events: none;
}
.modal-header {
padding: 10px 16px;
}
.modal-content {
width: inherit;
height: inherit;
margin: 0 auto;
pointer-events: all;
border-radius: 0;
}
.number-found {
font-size: 13px;
margin-top: 3px;
}
.close-button {
position: absolute;
right: 4px;
top: 8px;
}
@media only screen and (max-width: 768px) {
.vertical-alignment-helper {
padding: 0;
}
.modal-body {
width: auto;
height: auto;
max-height: 100%;
}
}
pratilipi-follow-author {
display: block;
}
.load-more-button {
position: absolute;
bottom: 12px;
left: 8px;
right: 8px;
background: #F1F8FB;
padding: 16px;
text-align: center;
color: #0C68BD;
cursor: pointer;
font-size: 16px;
font-weight: 700;
letter-spacing: 0.3px;
line-height: 16px;
text-shadow: 0px 1px 2px #FFFFFF;
}
</style>
<template>
<div class="modal fade" id="pratilipi-follow-author" tabindex="-1" role="dialog" aria-labelledby="pratilipiFollowAuthor" aria-hidden="true">
<div class="vertical-alignment-helper">
<div class="modal-dialog vertical-align-center">
<div class="modal-content">
<div class="modal-header">
<paper-icon-button noink class="close-button" icon="icons:close" data-dismiss="modal"></paper-icon-button>
<h6 class="modal-title pratilipi-red">{{ title }}</h6>
<div class="number-found">{{ numberFound }} പേര്‍</div>
</div>
<div class="modal-body">
<template is="dom-repeat" items="{{ followList }}">
<pratilipi-follow-author follow-object="{{ item }}"></pratilipi-follow-author>
</template>
<template is="dom-if" if="{{ !isFinished }}">
<div class="load-more-button" on-click="loadMore">കൂടുതല്‍ കാണിക്കൂ</button>
</template>
</div>
</div>
</div>
</div>
</div>
</template>
<script>
Polymer({
is: 'pratilipi-follow-author-popup',
properties: {
followList: { type: Array },
numberFound: { type: Number },
title: { type: String },
isFinished: { type: Boolean }
},
openModal: function() {
jQuery( this.querySelector( '#pratilipi-follow-author' ) ).modal();
},
loadMore: function() {
this.domHost.loadMore();
}
});
</script>
</dom-module>
<dom-module id="pratilipi-follow-author-grid">
<style>
:host {
display: block;
margin-top: 6px;
}
.author-follow {
padding: 8px;
}
.author-follow .author-follow-header {
padding-top: 8px;
}
.author-follow .author-follow-header h6 {
font-weight: 700;
text-align: center;
}
.author-follow .author-follow-header h6 paper-icon-button {
position: absolute;
margin-top: -16px;
width: 48px;
height: 48px;
}
.author-follow .author-follow-header .follow-text {
font-size: 14px;
}
.author-follow .more-button {
margin-top: 16px;
background: #F1F8FB;
padding: 16px;
text-align: center;
color: #0C68BD;
cursor: pointer;
font-size: 14px;
font-weight: 700;
line-height: 14px;
text-shadow: 0px 1px 2px #FFFFFF;
}
.author-follow .empty-list-message {
font-size: 15px;
text-align: center;
padding: 48px 12px;
padding-top: 32px;
font-weight: 500;
color: #333;
}
.author-follow .empty-list-message iron-icon {
display: block;
margin: auto;
margin-bottom: 16px;
width: 46px;
height: 46px;
}
hr {
margin-top: 0.5em;
margin-bottom: 0.8em;
margin-left: 8px;
margin-right: 8px;
border: 0;
border-top: 2px solid #eee;
}
/* Bootstrap overrides */
.row {
margin-left: -12px;
margin-right: -12px;
padding-bottom: 8px;
}
.col-xs-12, .col-sm-12, .col-md-6, .col-lg-6 {
padding-left: 12px;
padding-right: 12px;
}
.follow-grid {
max-height: 160px;
overflow: hidden;
}
paper-spinner.pratilipi-spinner {
display: block;
margin: 64px auto;
--paper-spinner-layer-1-color: #D0021B;
--paper-spinner-layer-2-color: #107FE5;
--paper-spinner-layer-3-color: #D0021B;
--paper-spinner-layer-4-color: #107FE5;
}
</style>
<template>
<div class="secondary-500 pratilipi-shadow author-follow">
<div class="author-follow-header">
<h6 class="pratilipi-red" on-click="openModal">
{{ title }}
<template is="dom-if" if="{{ showModalButton }}">
<paper-icon-button noink icon="icons:chevron-right"></paper-icon-button>
</template>
</h6>
<template is="dom-if" if="{{ !emptyList }}">
<div class="follow-text text-center">{{ numberFound }} പേര്‍</div>
</template>
</div>
<hr/>
<div hidden$="[[ !isLoading ]]">
<paper-spinner class="pratilipi-spinner" active></paper-spinner>
</div>
<div hidden$="[[ isLoading ]]">
<template is="dom-if" if="{{ !emptyList }}">
<div class="row follow-grid">
<template is="dom-repeat" items="{{ followList }}">
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<pratilipi-follow-author follow-object="{{ item }}"></pratilipi-follow-author>
</div>
</template>
</div>
<pratilipi-follow-author-popup
follow-list="{{ followList }}"
number-found="{{ numberFound }}"
title="{{ title }}"
is-finished="{{ isFinished }}"></pratilipi-follow-author-popup>
</template>
<template is="dom-if" if="{{ emptyList }}">
<div class="empty-list-message">
<iron-icon icon="icons:info-outline"></iron-icon>
{{ emptyListMessage }}
</div>
</template>
</div>
</div>
</template>
<script>
Polymer({
is: 'pratilipi-follow-author-grid',
properties: {
followList: { type: Array },
numberFound: { type: Number },
title: { type: String },
emptyList: { type: Boolean },
emptyListMessage: { type: String },
showModalButton: { type: Boolean },
isLoading: { type: Boolean },
isFinished: { type: Boolean }
},
openModal: function() {
if( this.showModalButton )
this.querySelector( 'pratilipi-follow-author-popup' ).openModal();
},
loadMore: function() {
this.domHost.loadMore();
}
});
</script>
</dom-module><dom-module id="pratilipi-footer">
<style>
:host {
display: block;
}
paper-card {
width: 100%;
display: block;
padding-top: 8px;
padding-bottom: 1px;
@apply(--layout-center);
--paper-card-header: { display: none };
}
.pratilipi-footer {
color: #333;
font-weight: 700;
}
.footer-icon-holder {
vertical-align: middle;
white-space: nowrap;
display: inline-block;
}
.footer-icon-holder img {
margin-right: 4px;
}
.static-links > span {
margin-left: 16px;
}
@media only screen and (max-width: 640px) {
.static-links > span {
margin: 0 auto;
margin-bottom: 12px;
display: block;
}
}
/* Override */
.row {
width: 100%
}
.padding-left-right {
padding-left: 10px;
padding-right: 10px;
}
</style>
<template>
<paper-card>
<div class="parent-container">
<div class="row pratilipi-footer">
<div class="col-xs-12 col-sm-12 col-md-7 col-lg-7" style="padding: 4px;">
<a class="link" href="mailto:malayalam@pratilipi.com">malayalam@pratilipi.com</a>
&nbsp;&nbsp;
<a class="link" href="tel:+919036506463">+91 9036506463</a>
</div>
<div class="col-xs-12 col-sm-12 col-md-5 col-lg-5" onclick="ga_CA( 'Footer', 'Company Social Media' )">
സോഷ്യല്‍ മീഡിയയില്‍ ഫോളോ ചെയ്യൂ&nbsp;
<div class="footer-icon-holder">
<a href="https://www.facebook.com/pratilipimalayalam/" target="_blank"><span class="icon icon-facebook"></span></a>
<a href="https://twitter.com/TeamPratilipi" target="_blank"><span class="icon icon-twitter"></span></a>
<a href="https://plus.google.com/+PratilipiTeam" target="_blank"><span class="icon icon-google-plus"></span></a>
<a href="https://www.linkedin.com/company/pratilipi" target="_blank"><span class="icon icon-linkedin"></span></a>
</div>
</div>
</div>
</div>
</paper-card>
<div style="margin-top: 12px;" class="margin-top-bottom padding-left-right">
<div class="row">
<div class="col-xs-12 col-sm-12 col-md-8 col-lg-9 static-links" onclick="ga_CA( 'Footer', 'About Us' )">
<span><a class="link" href="/about/pratilipi">ഞങ്ങളെക്കുറിച്ച്</a></span>
<span><a class="link" href="/work-with-us">തൊഴിലവസരങ്ങള്‍</a></span>
<span><a class="link" href="/privacy-policy">പ്രൈവസി പോളിസി</a></span>
<span><a class="link" href="/terms-of-service">നിബന്ധനകള്‍</a></span>
</div>
<div class="col-xs-12 col-sm-12 col-md-4 col-lg-3">
<span class="link">&copy;&nbsp;2017 Nasadiya Tech. Pvt. Ltd.</span>
</div>
</div>
</div>
</template>
<script>
Polymer({
is: 'pratilipi-footer',
behaviors: [
Polymer.IronResizableBehavior
],
listeners: {
'iron-resize': '_onIronResize'
},
_onIronResize: function() {
var windowsize = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
if( windowsize > 991 )
jQuery( '.pratilipi-footer' ).css( 'text-align', 'left' );
else
jQuery( '.pratilipi-footer' ).css( 'text-align', 'center' );
}
});
</script>
</dom-module><dom-module id="pratilipi-input">
<style>
paper-input.pratilipi-blue {
--paper-input-container-color: #107FE5;
--paper-input-container-focus-color: #107FE5;
--paper-input-container-input-color: #333;
--paper-input-container-input: {
font-family: inherit;
text-align: left;
};
--paper-input-container-label: {
font-size: 15px;
font-family: inherit;
text-align: left;
};
--paper-input-container-disabled: {
opacity: 0.9;
};
}
paper-input.pratilipi-blue iron-icon {
color: #107FE5;
margin-right: 5px;
}
paper-input.pratilipi-black {
--paper-input-container-color: #333;
--paper-input-container-focus-color: #333;
--paper-input-container-input-color: #333;
--paper-input-container-input: {
font-family: inherit;
text-align: left;
};
--paper-input-container-label: {
font-size: 15px;
font-family: inherit;
text-align: left;
};
--paper-input-container-disabled: {
opacity: 0.9;
};
}
paper-input.pratilipi-black iron-icon {
color: #333;
margin-right: 5px;
}
</style>
<template>
<paper-input name="{{ name }}"
id="pratilipiInput"
class="pratilipi-blue"
label="{{ label }}"
placeholder="{{ placeholder }}"
value="{{ value::input }}"
type="{{ type }}"
disabled="{{ disabled }}"
always-float-label="{{ alwaysFloatLabel }}"
on-click="_click"
on-focus="_focus"
on-blur="_blur">
<template is="dom-if" if="{{ icon }}">
<iron-icon icon="{{ icon }}" prefix></iron-icon>
</template>
</paper-input>
</template>
<script>
Polymer({
is: 'pratilipi-input',
properties: {
label: { type: String },
placeholder: { type: String },
value: { type: String, notify: true },
disabled: { type: Boolean, value: false },
alwaysFloatLabel: { type: Boolean, value: false },
makeTransliterable: { type: Boolean, value: false },
icon: { type: String, value: null },
type: { type: String, value: "text" },
required: { type: Boolean, value: false },
color: { type: String }
},
ready: function() {
if( this.color == "black" ) {
jQuery( this.querySelector( 'paper-input' ) ).removeClass( 'pratilipi-blue' );
jQuery( this.querySelector( 'paper-input' ) ).addClass( 'pratilipi-black' );
}
this.set( 'name', this.makeTransliterable ? 'pratilipiInputTransliterable' : 'pratilipiInput' );
},
_focus: function() {
this.$.pratilipiInput.alwaysFloatLabel = true;
},
_click: function () {
if( this.$.pratilipiInput.focused )
this._focus();
},
_blur: function() {
if( this.$.pratilipiInput.focused && ! this.alwaysFloatLabel )
this.$.pratilipiInput.alwaysFloatLabel = false;
}
});
</script>
</dom-module><dom-module id="pratilipi-alert">
<style>
.modal-content {
border-radius: 1px;
}
button {
border-radius: 2px;
}
</style>
<template>
<div id="pratilipiAlert" class="modal fade">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-body" style="padding: 15px 40px;">
<div style="margin-top: 50px; margin-bottom: 20px; text-align: center;">
<h6 style="line-height: 2em;" id="pratilipi-alert-message">{{ message }}</h6>
</div>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">ശരി</button>
</div>
</div>
</div>
</div>
</template>
<script>
Polymer({
is: 'pratilipi-alert',
properties: {
message: { type: String },
timeout: { type: Number },
isSuccessMessage: { type: Boolean }
},
alert: function( message, isSuccessMessage, timeout ) {
this.message = message != null ? message : "വിജയകരമായി പൂര്‍ത്തീകരിച്ചിരിക്കുന്നു!";
this.isSuccessMessage = isSuccessMessage != null ? isSuccessMessage : true;
this.timeout = timeout != null ? timeout : 2500;
this.open();
},
open: function() {
if( this.isSuccessMessage )
jQuery( '#pratilipi-alert-message' ).removeClass( 'text-danger' );
else
jQuery( '#pratilipi-alert-message' ).addClass( 'text-danger' );
this.async( function() {
jQuery( "#pratilipiAlert" ).modal();
});
}
});
</script>
</dom-module>
<dom-module id="pratilipi-confirm-action">
<template>
<div class="modal fade" id="pratilipiConfirmAction">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h6 class="modal-heading">{{ modalTitle }}</h6>
<span class="modal-close-button"><paper-icon-button noink icon="close" data-dismiss="modal"></paper-icon-button></span>
</div>
<div class="modal-body">
{{ modalContent }}
</div>
<div class="modal-footer">
<template is="dom-if" if="{{ invertButtons }}">
<button id="okayButton" class="btn btn-danger pull-left" on-click="setTrue">{{ modalOkayButton }}</button>
<button id="cancelButton" class="btn btn-primary pull-right" on-click="setFalse">{{ modalCancelButton }}</button>
</template>
<template is="dom-if" if="{{ !invertButtons }}">
<button style="margin-top: 12px;" id="cancelButton" class="btn btn-danger pull-left" on-click="setFalse">{{ modalCancelButton }}</button>
<button style="margin-top: 12px;" id="okayButton" class="btn btn-primary pull-right" on-click="setTrue">{{ modalOkayButton }}</button>
</template>
</div>
</div>
</div>
</div>
</template>
<script>
Polymer({
is: 'pratilipi-confirm-action',
properties: {
value: { type: Boolean, notify: true },
modalTitle: { type: String },
modalContent: { type: String },
modalOkayButton: { type: String, value: "ശരി" },
modalCancelButton: { type: String, value: "വേണ്ടെന്നു വയ്ക്കുക" },
invertButtons: { type: Boolean, value: false }
},
setTrue: function() {
this.set( 'value', true );
this.close();
},
setFalse: function() {
this.set( 'value', false );
this.close();
},
open: function() {
this.async( function() {
jQuery( "#pratilipiConfirmAction" ).modal();
});
},
close: function() {
this.async( function() {
jQuery( "#pratilipiConfirmAction" ).modal( 'hide' );
}, 100 );
}
});
</script>
</dom-module>
<dom-module id="pratilipi-malayalam-carousel">
<style>
:host {
display: block;
}
.carousel-indicators li {
visibility: hidden;
}
img {
width: 100%;
height: 100%;
}
</style>
<template>
<paper-card>
<div id="carousel" class="carousel slide" data-ride="carousel">
<!-- Menu -->
<ol class="carousel-indicators">
<li data-target="#carousel" data-slide-to="0" class="active"></li>
<li data-target="#carousel" data-slide-to="1"></li>
<li data-target="#carousel" data-slide-to="2"></li>
<li data-target="#carousel" data-slide-to="3"></li>
<li data-target="#carousel" data-slide-to="4"></li>
</ol>
<!-- Items -->
<div class="carousel-inner">
<div class="item active">
<a href="https://play.google.com/store/apps/details?id=com.pratilipi.mobile.android&referrer=utm_source%3Dpratilipi_main_web%26utm_medium%3Dweb_main_banner%26utm_campaign%3Dapp_download" target="_blank"><img src="{{ image1 }}" /></a>
</div>
<div class="item">
<a href="/5kreads" target="_blank"><img src="{{ image2 }}" /></a>
</div>
<div class="item">
<a on-click="write"><img src="{{ image3 }}" /></a>
</div>
<div class="item">
<a href="/love" target="_blank"><img src="{{ image4 }}" /></a>
</div>
<div class="item">
<a href="/mystery" target="_blank"><img src="{{ image5 }}" /></a>
</div>
</div>
<a href="#carousel" class="left carousel-control" data-slide="prev">
<span class="glyphicon glyphicon-chevron-left"></span>
</a>
<a href="#carousel" class="right carousel-control" data-slide="next">
<span class="glyphicon glyphicon-chevron-right"></span>
</a>
</div>
</paper-card>
</template>
<script>
Polymer({
is: 'pratilipi-malayalam-carousel',
behaviors: [
Polymer.IronResizableBehavior
],
listeners: {
'iron-resize': '_onIronResize'
},
properties: {
image1: { type: Image },
image2: { type: Image },
image3: { type: Image },
image4: { type: Image },
image5: { type: Image }
},
_onIronResize: function() {
$( '.carousel' ).carousel();
var windowsize = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
if( windowsize > 560 ) {
this.image1 = "https://0.ptlp.co/resource-ml/home-page-banner/pratilipi-malayalam-carousel-23.jpg";
this.image2 = "https://0.ptlp.co/resource-ml/home-page-banner/pratilipi-malayalam-carousel-32a.jpg";
this.image3 = "https://0.ptlp.co/resource-ml/home-page-banner/pratilipi-malayalam-carousel-33a.jpg";
this.image4 = "https://1.ptlp.co/resource-ml/home-page-banner/pratilipi-malayalam-carousel-34a.jpg";
this.image5 = "https://2.ptlp.co/resource-ml/home-page-banner/pratilipi-malayalam-carousel-35a.jpg";
} else {
this.image1 = "https://0.ptlp.co/resource-ml/home-page-banner/pratilipi-malayalam-carousel-23-small.jpg";
this.image2 = "https://0.ptlp.co/resource-ml/home-page-banner/pratilipi-malayalam-carousel-32a-small.jpg";
this.image3 = "https://0.ptlp.co/resource-ml/home-page-banner/pratilipi-malayalam-carousel-33a-small.jpg";
this.image4 = "https://1.ptlp.co/resource-ml/home-page-banner/pratilipi-malayalam-carousel-34a-small.jpg";
this.image5 = "https://2.ptlp.co/resource-ml/home-page-banner/pratilipi-malayalam-carousel-35a-small.jpg";
}
},
write: function() {
document.querySelector( 'pratilipi-header' ).write();
}
});
</script>
</dom-module>
<dom-module id="pratilipi-home-page">
<style>
paper-spinner.pratilipi-spinner {
--paper-spinner-layer-1-color: #D0021B;
--paper-spinner-layer-2-color: #107FE5;
--paper-spinner-layer-3-color: #D0021B;
--paper-spinner-layer-4-color: #107FE5;
}
</style>
<template>
<pratilipi-user user='{{ user }}' user-data="[[ userData ]]"></pratilipi-user>
<pratilipi-write language-map="[[ languageMap ]]" pratilipi-types='[[ pratilipiTypes ]]'></pratilipi-write>
<pratilipi-alert></pratilipi-alert>
<div class="header-pos">
<pratilipi-android-launch-test></pratilipi-android-launch-test> </div>
<main>
<pratilipi-header language-map="[[ languageMap ]]" user='[[ user ]]'></pratilipi-header>
<div class="parent-container margin-top-bottom">
<div class="container">
<pratilipi-navigation
class='pull-left hidden-xs hidden-sm'
navigation-list='[[ navigationList ]]'
></pratilipi-navigation>
<!-- Navigation & Search bar for extra-small & small screens. -->
<pratilipi-navigation-drawer with-backdrop navigation-list='[[ navigationList ]]'></pratilipi-navigation-drawer>
<div style="overflow:hidden; padding: 0 2px;">
<div id="androidLaunchBottom">
<pratilipi-malayalam-carousel style="text-align: center;"></pratilipi-malayalam-carousel>
<br class="pratilipi-break"/>
<paper-spinner class="pratilipi-spinner pratilipi-spinner-center" active="{{ loadingSections }}" hidden$="{{ !loadingSections }}"></paper-spinner>
<template is="dom-repeat" items="[[ sectionsList ]]">
<pratilipi-card-grid
heading='[[ item.title ]]'
pratilipi-list='[[ item.pratilipiList ]]'
heading-url='[[ item.listPageUrl ]]'
></pratilipi-card-grid>
<br class="pratilipi-break"/>
</div>
</template>
</div>
</div>
</div>
</main>
<footer>
<pratilipi-footer></pratilipi-footer>
</footer>
<div class="scroll-top-button">
<a id="scrollToTop" on-click="scrollToTop"><paper-fab mini noink style="background: #c0c0c0;" icon="icons:arrow-upward"></paper-fab></a>
</div>
<iron-ajax
id="InitApi"
url="/api/init"
params='{"language": "MALAYALAM", "_apiVer": "2" }'
method="GET"
content-type="application/json"
handle-as="json"
on-response="_handleInitApiResponse"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-home-page',
properties: {
userData: { type: Object },
sectionsList: { type: Array },
loadingSections: { type: Boolean, value: true },
navigationList: { type: Array },
pratilipiTypes: { types: Object },
languageMap: { type: Object },
lastScrollTop: { type: Number, value: 0 },
},
scrollToTop: function() {
$( 'html, body' ).animate( { scrollTop : 0 },800 );
},
ready: function() {
jQuery( '#scrollToTop' ).css( "display", "none" );
this.$.InitApi.generateRequest();
},
_handleInitApiResponse: function( event ) {
this.set( 'loadingSections', false );
this.set( 'sectionsList', event.detail.response.sections );
},
scrollHandler: function( st ) {
if( st > this.lastScrollTop || st < 100 )
jQuery( '#scrollToTop' ).fadeOut();
else
jQuery( '#scrollToTop' ).fadeIn();
this.lastScrollTop = st;
}
});
</script>
</dom-module><dom-module id="pratilipi-userpratilipi">
<template>
<iron-ajax
id="AjaxGet"
url="/api/userpratilipi"
method="GET"
content-type="application/json"
handle-as="json"
on-response="_handleAjaxGetResponse"
on-error="_handleAjaxGetError"
></iron-ajax>
<iron-ajax
id="AjaxPost"
url="/api/userpratilipi/library"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_handleAjaxPostResponse"
on-error="_handleAjaxPostError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-userpratilipi',
properties: {
user: { type: Object, observer: '_userChangeObserver' },
pratilipiId: { type: Number },
userpratilipi: { type: Object, notify: true },
userpratilipiData: { type: Object }
},
setUserPratilipi: function( userPratilipi ) {
this.set( 'userpratilipi', userPratilipi );
},
ready: function() {
this.setUserPratilipi( this.userpratilipiData );
},
addToLibrary: function( pratilipiId ) {
this.$.AjaxPost.body = ( "pratilipiId=" + pratilipiId + "&" + "addedToLib=true" );
this.$.AjaxPost.generateRequest();
},
removeFromLibrary: function( pratilipiId ) {
this.$.AjaxPost.body = ( "pratilipiId=" + pratilipiId + "&" + "addedToLib=false" );
this.$.AjaxPost.generateRequest();
},
_handleAjaxPostResponse: function( event ) {
if( event.detail.xhr.status != 200 )
this._handleAjaxPostError( event );
else
this.setUserPratilipi( event.detail.response );
},
_handleAjaxPostError: function( event ) {
alert( "എന്തോ സാങ്കേതിക പ്രശ്നം സംഭവിച്ചിരിക്കുന്നു. വീണ്ടും ശ്രമിക്കൂ" );
},
_userChangeObserver: function() {
if( this.user.isGuest ) {
this.setUserPratilipi( {} );
} else if( this.userpratilipi == null || jQuery.isEmptyObject( this.userpratilipi ) ) {
var ajaxGet = this.$.AjaxGet;
ajaxGet.params.pratilipiId = this.pratilipiId;
ajaxGet.generateRequest();
}
},
_handleAjaxGetResponse: function( event ) {
if( event.detail.xhr.status != 200 ) {
this.async( function() {
this._userChangeObserver();
}, 10000 );
} else {
this.setUserPratilipi( event.detail.response );
}
},
_handleAjaxGetError: function( event ) {
this.async( function() {
this._userChangeObserver();
}, 10000 );
}
});
</script>
</dom-module><dom-module id="pratilipi-social">
<style>
i, .fb{
color: #3b5998;
}
i, .tw {
color: #00aced;
}
i, .google {
color: #dd4b39;
}
ul, li {
float: left;
}
</style>
<template>
<div style="position: absolute; margin-left: 0px;">
<div class="fb-like" data-href="{{ shareUrl }}" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
<template is="dom-if" if="{{ showLikeCount }}">
<div style="display: inline-block;
height: 20px;
padding-left: 5px;
padding-right: 5px;
font-size: 11px;
font-family: helvetica, arial, sans-serif;
color: #141823;
border: 1px solid grey;
border-radius: 2px;
text-align: center;
vertical-align: bottom;
opacity: 0.9;"><div style="margin-top: -2px;">{{ likeCount }}</div></div>
</template>
</div>
<template is="dom-if" if="{{ share }}">
<div class="drop_menu" style="margin-left: 100px; position: absolute;">
<a class="link" href="#" class="dropdown-toggle" data-toggle="dropdown">
ഷെയര്‍
<b class="caret"></b>
</a>
<ul class="dropdown-menu" role="menu">
<li>
<a href="{{__hack__}}#" title="On Facebook" on-click="_share_facebook">
<span class="icon icon-facebook"></span>
</a>
</li>
<li>
<a href="{{__hack__}}#" title="On Twitter" on-click="_share_twitter">
<span class="icon icon-twitter"></span>
</a>
</li>
<li>
<a href="{{__hack__}}#" title="On Google Plus" on-click="_share_google_plus">
<span class="icon icon-google-plus"></span>
</a>
</li>
</ul>
</div>
</template>
</template>
<script>
Polymer({
is: 'pratilipi-social',
properties: {
share: { type: Boolean, value: false },
shareUrl: { type: String },
showLikeCount: { type: Boolean, value: false },
likeCount: { type: Number }
},
ready: function() {
if( typeof(FB) == 'undefined' ) {
(function(d, s, id) {
var js, fjs = d.getElementsByTagName(s)[0];
if (d.getElementById(id)) return;
js = d.createElement(s); js.id = id;
js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.6";
fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
}
},
_share_facebook: function() {
window.open( "http://www.facebook.com/sharer.php?u=" + this.shareUrl, "share", "width=1100,height=500,left=70px,top=60px" );
},
_share_twitter: function() {
window.open( "http://twitter.com/share?url=" + this.shareUrl, "share", "width=1100,height=500,left=70px,top=60px" );
},
_share_google_plus: function() {
window.open( "https://plus.google.com/share?url=" + this.shareUrl, "share", "width=1100,height=500,left=70px,top=60px" );
},
attached: function() {
if( this.shareUrl != null )
this.shareUrl = "http://www.pratilipi.com" + this.shareUrl;
else
this.shareUrl = window.location.href;
}
});
</script>
</dom-module>
<dom-module id="pratilipi-pratilipi">
<style>
:host {
display: block;
}
paper-card {
width: 100%;
--paper-card-header: { display: none };
}
paper-menu {
padding: 0;
--paper-menu-color: #333;
--paper-menu-focused-item: {
color: #107FE5;
};
}
.share-menu paper-item {
padding: 0 8px;
}
paper-item {
cursor: pointer;
font-family: inherit;
font-size: 13px;
}
.col-right-mobile table {
margin: 0 auto;
text-align: left;
white-space: nowrap;
}
.col-right-widescreen table td, .col-right-widescreen table th, .col-right-mobile table td, .col-right-mobile table th {
white-space: nowrap;
font-weight: 700;
color: #333;
height: 30px;
}
.col-right-widescreen table td, .col-right-mobile table td {
padding-left: 10px;
}
#more, #less {
color: #333;
}
.less {
max-height: 190px;
overflow: hidden;
}
.more {
max-height: auto;
overflow: visible;
}
th {
font-weight: 400;
font-size: 14px;
}
td {
font-weight: 400;
font-size: 14px;
}
.pratilipi-file-upload {
width: 150px;
}
paper-spinner.pratilipi-spinner {
display: block;
position: absolute;
top: 40%;
left: 40%;
--paper-spinner-layer-1-color: #D0021B;
--paper-spinner-layer-2-color: #107FE5;
--paper-spinner-layer-3-color: #D0021B;
--paper-spinner-layer-4-color: #107FE5;
}
paper-spinner.pratilipi-spinner-absolute {
display: block;
position: fixed;
top: 50%;
left: 50%;
--paper-spinner-layer-1-color: #D0021B;
--paper-spinner-layer-2-color: #107FE5;
--paper-spinner-layer-3-color: #D0021B;
--paper-spinner-layer-4-color: #107FE5;
}
.summary-container {
padding: 10px 20px 20px 20px;
}
@media only screen and (max-width: 768px) {
.summary-container {
text-align: left;
}
}
@media only screen and (min-width: 769px) {
.summary-container {
text-align: justify;
}
}
</style>
<template>
<paper-card>
<paper-menu-button hidden$="{{ !canShare }}" vertical-offset=38 style="position: absolute; right: 2px;" horizontal-align="right" vertical-align="top">
<iron-icon icon="social:share" class="dropdown-trigger" onclick="ga_CA( 'Pratilipi', 'Share' )"></iron-icon>
<paper-menu class="dropdown-content share-menu">
<paper-item on-click="sharePratilipiOnFacebook"><span class="icon icon-facebook"></span></paper-item>
<paper-item on-click="sharePratilipiOnTwitter"><span class="icon icon-twitter"></span></paper-item>
<paper-item on-click="sharePratilipiOnGplus"><span class="icon icon-google-plus"></span></paper-item>
<template is="dom-if" if="{{ isMobile() }}">
<paper-item on-click="sharePratilipiOnWhatsapp"><span class="icon icon-whatsapp"></span></paper-item>
</template>
</paper-menu>
</paper-menu-button>
<div id="pratilipi-row">
<div id="pratilipi-col-left" style="padding: 20px 0px 10px 10px;">
<template is="dom-if" if="{{ ! hasAccessToUpdate }}">
<iron-image class="pratilipi-shadow"
width="150" height="225"
style="background-color: #f5f5f5; margin: 0 auto;"
fade preload
sizing="cover"
src="{{ pratilipiCoverImageUrl }}"
alt="{{ title }}"
title="{{ title }}"></iron-image>
</template>
<template is="dom-if" if="{{ hasAccessToUpdate }}">
<div style="position: absolute; top: -1000px;">
<form id="uploadImage" method="post" enctype="multipart/form-data" action="/api/pratilipi/cover?pratilipiId={{ pratilipi.pratilipiId }}" target="upload_target">
<input id="uploadImageInput" type="file" on-change="uploadImage" name="{{ pratilipi.pratilipiId }}" accept="image/*">
</form>
<iframe id="upload_target" name="upload_target" style="display: none;" on-load="_onchangeiframe"></iframe>
</div>
<div class="pratilipi-file-upload">
<div style="width: 150px; height: 225px;" class="pratilipi-shadow">
<template is="dom-if" if="{{ !imageUploaded }}">
<img class="pratilipi-shadow"
width="150" height="225"
style="background-color: #f5f5f5; margin: 0 auto;"
src="{{ pratilipiCoverImageUrl }}"
alt="{{ title }}"
title="{{ title }}" />
</template>
<template is="dom-if" if="{{ imageUploaded }}">
<paper-spinner class="pratilipi-spinner" active></paper-spinner>
</template>
</div>
<iron-icon icon="image:photo-camera"></iron-icon>
<div class="pratilipi-file-upload-caption" on-click="_chooseFile">
<iron-icon icon="image:photo-camera"></iron-icon>
<strong>ഫോട്ടോ അപ് ലോഡ് ചെയ്യൂ</strong>
</div>
</div>
</template>
<div style="width: 150px; margin: 0px auto 15px auto; display: block; padding: 15px 0px;">
<pratilipi-social share-url="/pratilipi/{{ pratilipi.pratilipiId }}" show-like-count like-count="[[ pratilipiData.fbLikeShareCount ]]"></pratilipi-social>
</div>
</div>
<div id="pratilipi-col-right" style="padding: 20px;">
<h5 style="margin: 0px; display: inline-block; line-height: 24px;" class="pratilipi-red">
{{ title }}
<span hidden$="{{ !hasAccessToUpdate }}" class="dropdown">
<paper-icon-button style="color: #333; height: 34px; width: 34px; margin-top: -12px;" class="dropdown-trigger" icon="icons:create" noink type="button" data-toggle="dropdown"></paper-icon-button>
<ul class="dropdown-menu pull-right">
<li>
<a style="padding: 0; margin: 0;" on-click="openPratilipiEdit">
<paper-item>
<paper-icon-item><iron-icon style="margin-right: 4px; width: 22px;" icon="editor:mode-edit"></iron-icon></paper-icon-item>
<paper-item-body>വിവരങ്ങള്‍ തിരുത്തൂ</paper-item-body>
</paper-item>
</a>
</li>
<li>
<a style="padding: 0; margin: 0;" on-click="openWriterPanel">
<paper-item>
<paper-icon-item><iron-icon style="margin-right: 4px; width: 22px;" icon="icons:description"></iron-icon></paper-icon-item>
<paper-item-body>രചന തിരുത്തൂ</paper-item-body>
</paper-item>
</a>
</li>
</ul>
</span>
</h5>
<template is="dom-if" if="{{ pratilipi.author }}">
<div style="display: block;">
<a style="display: inline-block; color: #333;" href="{{ pratilipi.author.pageUrl }}" onclick="ga_CA( 'Author', 'Open' )" target="_blank">
{{ pratilipi.author.name }}
<iron-icon icon="icons:open-in-new" style="margin-left: 6px; margin-top: -4px; width: 16px; height: 16px;"></iron-icon>
</a>
</div>
</template>
<template is="dom-if" if="{{ zeroRating }}">
<a class="link" style="text-decoration: underline;" on-click="showReviewInput">റിവ്യൂ ചെയ്യുന്ന ആദ്യത്തെ ആളാവൂ</a>
</template>
<template is="dom-if" if="{{ !zeroRating }}">
<pratilipi-rating style="cursor: pointer; display: inline-block;" on-click="showReviewInput" value="{{ averageRating }}" onclick="ga_CA( 'Review', 'Rating Init' )">
<span class="rating-text">&nbsp;
{{ ratingCount }}
<iron-icon style="width: 16px; height: 16px;" icon="social:people"></iron-icon>
</span>
</pratilipi-rating>
</template>
<h6 style="margin-top: 10px;">{{ type }}</h6>
<table style="margin-top: 15px; margin-bottom: 25px;">
<tr> <th>ചേര്‍ത്ത ദിവസം</th><td>:</td><td>{{ listingDate }}</td> </tr>
<tr> <th>വായിച്ചവര്‍</th><td>:</td><td>{{ readCount }}</td> </tr>
<template is="dom-if" if="{{ showLastUpdatedDate }}">
<tr> <th>അവസാനമായി തിരുത്തിയ ദിവസം</th><td>:</td><td>{{ lastUpdatedDate }}</td> </tr>
</template>
</table>
<div style="position: relative; display: inline-block;">
<button on-click="redirectToReader" onclick="ga_CA( 'Pratilipi', 'Read' )" style="margin-bottom: 4px;" class="pratilipi-light-blue-button">വായിക്കൂ</button>
<template is="dom-if" if="{{ canMoveToDrafts }}">
<button disabled="{{ requestOnFlight }}" on-click="moveToDrafts" class="pratilipi-grey-button">ഡ്രാഫ്റ്റുകളിലേക്ക് മാറ്റൂ</button>
</template>
<template is="dom-if" if="{{ canPublish }}">
<button disabled="{{ requestOnFlight }}" on-click="publishPratilipi" class="pratilipi-light-blue-button">പ്രസിദ്ധീകരിക്കൂ.</button>
</template>
<template is="dom-if" if="{{ canDelete }}">
<button disabled="{{ requestOnFlight }}" on-click="deleteContent" class="pratilipi-grey-button">നീക്കം ചെയ്യൂ</button>
</template>
<template is="dom-if" if="{{ canAddToLibrary }}">
<template is="dom-if" if="{{ !userpratilipi.addedToLib }}">
<button on-click="addToLibrary" onclick="ga_CA( 'Pratilipi', 'Add To Library' )" class="pratilipi-light-blue-button">എന്‍റെ ലൈബ്രറിയില്‍ ചേര്‍ക്കുക</button>
</template>
<template is="dom-if" if="{{ userpratilipi.addedToLib }}">
<button on-click="removeFromLibrary" onclick="ga_CA( 'Pratilipi', 'Add To Library' )" class="pratilipi-grey-button">എന്‍റെ ലൈബ്രറിയില്‍ നിന്ന്‍ ഒഴിവാക്കുക</button>
</template>
</template>
</div>
</div>
</div>
</paper-card>
<br class="pratilipi-break" />
<!-- Displaying author summary if.. -->
<div id="pratilipi-summary">
<paper-card>
<div class="summary-container">
<h4 style="display: inline-block;" class="pratilipi-red">
സംഗ്രഹം
</h4>
<iron-icon hidden$="{{ !hasAccessToUpdate }}" style="margin-top: -4px; width: 20px; cursor: pointer;" icon="icons:create" on-click="toggleSummary"></iron-icon>
<div hidden$="{{ !hasAccessToUpdate }}">
<div hidden$="{{ toggleSummaryBoolean }}" style="margin: 10px 0px;">
<template is="dom-if" if="{{ !hasSummary }}"><div style="cursor: pointer;" on-click="toggleSummary">സംഗ്രഹം ചേർക്കാൻ ഇവിടെ ക്ലിക്ക് ചെയ്യുക</div></template>
<template is="dom-if" if="{{ hasSummary }}"><div style="white-space: pre-wrap;">{{ summary }}</div></template>
</div>
<div hidden$="{{ !toggleSummaryBoolean }}" style="height: 200px;" class="input-summary">
<textarea id="summaryTextbox" value="{{ summary::input }}" style="line-height: 1.5em; font-family: inherit !important; font-size: 14px; width: 100%; height: 150px;"></textarea>
<button disabled="{{ requestOnFlight }}" class="pratilipi-light-blue-button pull-right" on-click="updateSummary">മാറ്റങ്ങള്‍ സേവ് ചെയ്യുക</button>
<button disabled="{{ requestOnFlight }}" style="margin-top: 0;" class="pratilipi-grey-button pull-right" on-click="closeSummaryEdit">വേണ്ടെന്നു വയ്ക്കുക</button>
</div>
</div>
<div hidden$="{{ hasAccessToUpdate }}">
<div id="pratilipi-summary-text" style="margin-top: 10px; white-space:pre-wrap;">{{ summary }}</div>
<div style="text-align: center; padding-top: 10px;">
<a id="more" style="font-size: 14px; font-weight: 700;" on-click="_toggleSnippet">(കൂടുതല്‍ കാണിക്കൂ)</a>
<a id="less" style="font-size: 14px; font-weight: 700;" on-click="_toggleSnippet">(കുറച്ചു മാത്രം കാണിക്കൂ)</a>
</div>
</div>
</div>
</paper-card>
<br class="pratilipi-break" />
</div>
<paper-spinner class="pratilipi-spinner-absolute" active="{{ requestOnFlight }}"></paper-spinner>
<pratilipi-alert></pratilipi-alert>
<pratilipi-confirm-action
value="{{ moveToDraftsBoolean }}"
modal-title="ഡ്രാഫ്റ്റുകളിലേക്ക് മാറ്റുന്നു"
modal-content="ഈ രചന ഡ്രാഫ്റ്റുകളിലേക്ക് മാറ്റട്ടേ ?"
modal-okay-button="അതെ, ഡ്രാഫ്റ്റുകളിലേക്ക് മാറ്റൂ!"
modal-cancel-button="വേണ്ട, ഡ്രാഫ്റ്റുകളിലേക്ക് മാറ്റരുത്!"
invert-buttons></pratilipi-confirm-action>
<iron-ajax
id="AjaxGet"
url="/api/pratilipi"
method="GET"
params='{"_apiVer": "2"}'
content-type="application/json"
handle-as="json"
on-response="_handleAjaxGetResponse"
></iron-ajax>
<iron-ajax
id="AjaxPost"
url="/api/pratilipi?_apiVer=2"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_handleAjaxPostResponse"
on-error="_handleAjaxPostError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-pratilipi',
behaviors: [
Polymer.IronResizableBehavior
],
listeners: {
'iron-resize': '_onIronResize'
},
properties: {
user: { type: Object, observer: "_loadPratilipi" },
pratilipi: { type:Object, notify: true },
pratilipiData: { type: Object },
userpratilipi: { type: Object },
pratilipiTypes: { types: Object },
stage: { type: String },
mobile: { type: Boolean },
imageUploaded: { type: Boolean, value: false },
moveToDraftsBoolean: { type: Boolean, observer: "_moveToDrafts" },
summary: { type: String, observer: "_summaryObserver" },
hasSummary: { type: Boolean },
toggleSummaryBoolean: { type: Boolean, value: false },
requestOnFlight: { type: Boolean, value: false },
canAddToLibrary: { type: Boolean, value: true }
},
isMobile: function() {
return isMobile() && this.mobile;
},
updateUserRating: function( userpratilipi ) {
if( userpratilipi.reviewState == "DELETED" || userpratilipi.reviewState == "BLOCKED"
|| userpratilipi.rating == null || userpratilipi.rating == 0 )
return;
var rating = userpratilipi.rating;
var totalRating = this.averageRating * this.ratingCount;
if( this.userpratilipi.rating == null || this.userpratilipi.rating == 0 )
this.set( 'ratingCount', this.ratingCount + 1 );
this.set( 'averageRating', ( totalRating
- ( this.userpratilipi.rating != null ? this.userpratilipi.rating : 0 )
+ userpratilipi.rating ) / this.ratingCount );
this.set( 'zeroRating', false );
},
showReviewInput: function() {
document.querySelector( 'pratilipi-review-list' ).showReviewInput();
},
openPratilipiEdit: function() {
document.querySelector( 'pratilipi-write' ).editExistingPratilipi( this.pratilipi );
},
openWriterPanel: function() {
if( isMobile() ) {
document.querySelector( 'pratilipi-alert' ).alert( 'പ്രതിലിപിയില്‍ എഴുതാന്‍ ,താങ്കളുടെ കമ്പ്യൂട്ടറില്‍ നിന്നും malayalam.pratilipi.com എന്ന വെബ്സൈറ്റില്‍ ലോഗിന്‍ ചെയ്യുക.' );
return;
}
if( this.stage == "gamma" )
window.location.href = "/pratilipi-write?id=" + this.pratilipi.pratilipiId + "&ret=" + window.location.pathname;
else
window.location.href = this.pratilipi.writePageUrl + "&ret=" + window.location.pathname;
},
redirectToReader: function() {
trackPixelEvents( "ReadOnSummaryPage" );
window.location.href = this.pratilipi.readPageUrl + "&ret=" + window.location.pathname;
},
addToLibrary: function() {
if( this.user.isGuest ) {
document.querySelector( 'pratilipi-user' ).logIn( true, "താങ്കളുടെ ലൈബ്രറിയിലേക്ക് രചനകള്‍ ചേര്‍ക്കാന്‍ ലോഗിന്‍ ചെയ്യൂ" );
} else {
document.querySelector( 'pratilipi-userpratilipi' ).addToLibrary( this.pratilipi.pratilipiId );
}
},
removeFromLibrary: function() {
document.querySelector( 'pratilipi-userpratilipi' ).removeFromLibrary( this.pratilipi.pratilipiId );
},
_onIronResize: function() {
var windowsize = this.clientWidth;
if( windowsize > 600 ) {
this.mobile = false;
jQuery( '#pratilipi-row' ).removeClass( 'row-mobile' );
jQuery( '#pratilipi-col-left' ).removeClass( 'col-left-mobile' );
jQuery( '#pratilipi-col-right' ).removeClass( 'col-right-mobile' );
jQuery( '#pratilipi-row' ).addClass( 'row-widescreen' );
jQuery( '#pratilipi-col-left' ).addClass( 'col-left-widescreen' );
jQuery( '#pratilipi-col-right' ).addClass( 'col-right-widescreen' );
}
else {
this.mobile = true;
jQuery( '#pratilipi-row' ).removeClass( 'row-widescreen' );
jQuery( '#pratilipi-col-left' ).removeClass( 'col-left-widescreen' );
jQuery( '#pratilipi-col-right' ).removeClass( 'col-right-widescreen' );
jQuery( '#pratilipi-row' ).addClass( 'row-mobile' );
jQuery( '#pratilipi-col-left' ).addClass( 'col-left-mobile' );
jQuery( '#pratilipi-col-right' ).addClass( 'col-right-mobile' );
}
},
updatePratilipi: function( pratilipi ) {
if( window.location.pathname != pratilipi.pageUrl )
window.location.href = pratilipi.pageUrl;
this.set( 'pratilipi', pratilipi );
this.set( 'title', ( pratilipi.title != null && pratilipi.title.trim() != "" ) ? pratilipi.title : pratilipi.titleEn );
this.set( 'averageRating', pratilipi.averageRating != null ? pratilipi.averageRating : 0 );
this.set( 'ratingCount', pratilipi.ratingCount != null ? pratilipi.ratingCount : 0 );
this.set( 'readCount', pratilipi.readCount != null ? commaSeparatedNumber( pratilipi.readCount ) : 0 );
this.set( 'pratilipiCoverImageUrl', pratilipi.coverImageUrl + ( pratilipi.coverImageUrl.indexOf( '?' ) == -1 ? "?" : "&" ) + "width=150" );
this.set( 'zeroRating', false );
this.set( 'listingDate', convertDate( pratilipi.listingDateMillis ) );
this.set( 'showLastUpdatedDate', pratilipi.lastUpdatedMillis != null );
this.set( 'lastUpdatedDate', pratilipi.lastUpdatedMillis != null ? convertDate( pratilipi.lastUpdatedMillis ) : null );
this.set( 'hasAccessToUpdate', pratilipi.hasAccessToUpdate );
this.set( 'canMoveToDrafts', pratilipi.state != null && pratilipi.state != "DRAFTED" && pratilipi.hasAccessToUpdate );
this.set( 'canPublish', pratilipi.state != null && pratilipi.state != "PUBLISHED" && pratilipi.hasAccessToUpdate );
this.set( 'canDelete', pratilipi.state != null && pratilipi.state != "DELETED" && this.state != "PUBLISHED" && false && pratilipi.hasAccessToUpdate );
this.set( 'summary', pratilipi.summary != null && pratilipi.summary.trim() != "" ? pratilipi.summary : null );
this.set( 'canShare', pratilipi.state == "PUBLISHED" );
var user = document.querySelector( 'pratilipi-user' ).getCurrentUser();
this.set( "canAddToLibrary", this.pratilipi.state == "PUBLISHED" && ( user.isGuest || pratilipi.author.authorId != user.author.authorId ) );
if( pratilipi.type != null )
this.set( 'type', this.pratilipiTypes[ pratilipi.type.toUpperCase() ].name );
},
_summaryObserver: function() {
this.set( 'hasSummary', this.summary != null );
if( this.hasAccessToUpdate ) {
document.getElementById( "pratilipi-summary" ).style.display = "block";
document.getElementById( "less" ).style.display = "none";
document.getElementById( "more" ).style.display = "none";
} else {
if( this.summary == null ) {
document.getElementById( "pratilipi-summary" ).style.display = "none";
} else {
document.getElementById( "pratilipi-summary" ).style.display = "block";
jQuery( '#pratilipi-summary-text' ).removeClass( 'less' );
jQuery( '#pratilipi-summary-text' ).removeClass( 'more' );
var height = jQuery( "#pratilipi-summary-text" ).height();
if( height > 190 ) {
jQuery( '#pratilipi-summary-text' ).addClass( 'less' );
document.getElementById( "less" ).style.display = "none";
document.getElementById( "more" ).style.display = "block";
} else {
document.getElementById( "less" ).style.display = "none";
document.getElementById( "more" ).style.display = "none";
}
}
}
},
toggleSummary: function() {
this.set( 'toggleSummaryBoolean', true );
},
closeSummaryEdit: function() {
this.set( 'summary', this.pratilipi.summary != null && this.pratilipi.summary.trim() != "" ? this.pratilipi.summary : null );
this.set( 'toggleSummaryBoolean', false );
},
attached: function() {
this.pratilipiTypes = jQuery.parseJSON( this.pratilipiTypes );
this.updatePratilipi( this.pratilipiData );
},
_toggleSnippet: function() {
jQuery( '#pratilipi-summary-text' ).toggleClass( 'less' );
jQuery( '#pratilipi-summary-text' ).toggleClass( 'more' );
if( document.getElementById( "more" ).style.display === "block" )
document.getElementById( "more" ).style.display = "none";
else
document.getElementById( "more" ).style.display = "block";
if( document.getElementById( "less" ).style.display === "block" )
document.getElementById( "less" ).style.display = "none";
else
document.getElementById( "less" ).style.display = "block";
},
_loadPratilipi: function() {
if( this.pratilipi == null )
return;
var ajaxGet = this.$.AjaxGet;
ajaxGet.params.pratilipiId = this.pratilipi.pratilipiId;
ajaxGet.generateRequest();
},
_handleAjaxGetResponse: function( event ) {
this.updatePratilipi( event.detail.response );
// In case of image upload.
this.async( function() {
this.imageUploaded = false;
}, 30 );
},
publishPratilipi: function() {
this.$.AjaxPost.body = jQuery.param( { "pratilipiId": this.pratilipi.pratilipiId, "state": "PUBLISHED" } );
this.set( 'requestOnFlight', true );
this.$.AjaxPost.generateRequest();
},
deleteContent: function() {
this.$.AjaxPost.body = jQuery.param( { "pratilipiId": this.pratilipi.pratilipiId, "state": "DELETED" } );
this.set( 'requestOnFlight', true );
this.$.AjaxPost.generateRequest();
},
_moveToDrafts: function() {
if( !this.moveToDraftsBoolean ) return;
this.$.AjaxPost.body = jQuery.param( { "pratilipiId": this.pratilipi.pratilipiId, "state": "DRAFTED" } );
this.set( 'requestOnFlight', true );
this.$.AjaxPost.generateRequest();
},
moveToDrafts: function() {
if( this.moveToDraftsBoolean != null )
this.set( 'moveToDraftsBoolean', null );
this.querySelector( 'pratilipi-confirm-action' ).open();
},
updateSummary: function() {
this.$.AjaxPost.body = jQuery.param( { "pratilipiId": this.pratilipi.pratilipiId, "summary": this.summary } );
this.set( 'requestOnFlight', true );
this.$.AjaxPost.generateRequest();
},
_handleAjaxPostResponse: function( event ) {
var pratilipi = event.detail.response;
this.updatePratilipi( pratilipi );
document.querySelector( 'pratilipi-alert' ).alert( "വിജയകരമായി പൂര്‍ത്തീകരിച്ചിരിക്കുന്നു !", true, 1500 );
this.closeSummaryEdit();
this.set( 'requestOnFlight', false );
},
_handleAjaxPostError: function( event ) {
if( event.detail.request.xhr.status === 400 || event.detail.request.xhr.status === 401 || event.detail.request.xhr.status === 500 )
alert( event.detail.request.xhr.response.message );
else
alert( "എന്തോ സാങ്കേതിക പ്രശ്നം സംഭവിച്ചിരിക്കുന്നു. വീണ്ടും ശ്രമിക്കൂ" );
this.set( 'requestOnFlight', false );
},
_chooseFile: function() {
document.getElementById( "uploadImageInput" ).click();
},
_onchangeiframe: function() {
if( this.imageUploaded )
this._loadPratilipi();
},
uploadImage: function() {
document.getElementById( "uploadImage" ).submit();
this.imageUploaded = true;
},
_getShareUrl: function( utm_source ) {
if( utm_source == null ) return;
if( utm_source == "whatsapp" ) {
return encodeURIComponent(
"http://malayalam.pratilipi.com" + this.pratilipi.pageUrl
+ ( this.pratilipi.pageUrl.indexOf( '?' ) == -1 ? "?" : "&" )
+ "utm_source=web_standard"
+ "&utm_component=content_share" );
}
var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
return encodeURIComponent(
"http://malayalam.pratilipi.com" + this.pratilipi.pageUrl
+ ( this.pratilipi.pageUrl.indexOf( '?' ) == -1 ? "?" : "&" )
+ "utm_language=malayalam" + "&"
+ "utm_version=standard" + "&"
+ "utm_device=" + ( width < 600 ? "mobile" : "desktop" ) + "&"
+ "utm_parent=content" + "&"
+ "utm_action=share" + "&"
+ "utm_source=" + utm_source
);
},
sharePratilipiOnFacebook: function() {
clevertapShareContentOnFacebook( this.pratilipi.title, this.pratilipi.pratilipiId );
window.open( "http://www.facebook.com/sharer.php?u=" + this._getShareUrl( "facebook" ),
"share", "width=1100,height=500,left=70px,top=60px" );
},
sharePratilipiOnTwitter: function() {
window.open( "http://twitter.com/share?url=" + this._getShareUrl( "twitter" ),
"share", "width=1100,height=500,left=70px,top=60px" );
},
sharePratilipiOnGplus: function() {
window.open( "https://plus.google.com/share?url=" + this._getShareUrl( "gplus" ),
"share", "width=1100,height=500,left=70px,top=60px" );
},
sharePratilipiOnWhatsapp: function() {
var text = "%22" + this.pratilipi.title + "%22%2C%20%E0%B4%8E%E0%B4%A8%E0%B5%8D%E0%B4%A8%20%20%E0%B4%B0%E0%B4%9A%E0%B4%A8%20%E0%B4%AA%E0%B5%8D%E0%B4%B0%E0%B4%A4%E0%B4%BF%E0%B4%B2%E0%B4%BF%E0%B4%AA%E0%B4%BF%E0%B4%AF%E0%B4%BF%E0%B4%B2%E0%B5%8D%E2%80%8D%20%E0%B4%B5%E0%B4%BE%E0%B4%AF%E0%B4%BF%E0%B4%95%E0%B5%8D%E0%B4%95%E0%B5%82%3A%20" + this._getShareUrl( "whatsapp" ) +"%0Aഇന്ത്യന്‍ ഭാഷകളിലുള്ള ഏറെ കഥകളും കവിതകളും ലേഖനങ്ങളുമെല്ലാം സൗജന്യമായി വായിക്കൂ !";
window.open( "whatsapp://send?text=" + text );
}
});
</script>
</dom-module>
<dom-module id="pratilipi-review">
<style>
:host {
display: block;
}
paper-card#reviewcard {
width: 100%;
margin-bottom: 5px;
padding: 20px;
}
.user-name {
color: #333;
text-transform: capitalize;
display: inline-block;
margin: 0px;
font-size: 15px;
}
.user-dp {
width: 64px;
height: 64px;
float: left;
}
.reviewText {
text-align: justify;
white-space:pre-wrap;
font-size: 15px;
padding: 16px 0px 16px 8px;
clear: both;
}
a.reply-text {
margin-right: 16px;
font-size: 15px;
margin-left: 10px;
}
a.expand-comments {
font-size: 13px;
}
a.expand-comments iron-icon {
margin-left: -4px;
width: 16px;
}
.reply-section {
margin-left: 10px;
margin-bottom: 16px;
}
paper-menu-button {
padding: 0px;
}
paper-menu {
cursor: pointer;
--paper-menu-color: #333;
--paper-menu-focused-item: {
color: #107FE5;
};
}
paper-item {
cursor: pointer;
font-family: inherit;
font-size: 13px;
}
.review-liked, .review-liked * {
color: #de4d5f;
}
.review-none, .review-none * {
color: grey;
}
</style>
<template>
<paper-card id="reviewcard">
<div hidden$="{{ !hasAccessToUpdate }}" class="dropdown">
<paper-icon-button style="color: #333;" class="dropdown-trigger pull-right" icon="icons:more-horiz" noink type="button" data-toggle="dropdown"></paper-icon-button>
<ul style="margin-top: 0; margin-right: -12px;" class="dropdown-menu pull-right">
<li>
<a style="padding: 0; margin: 0;" on-click="showReviewInput">
<paper-item>
<paper-icon-item><iron-icon style="margin-right: 4px; width: 22px;" icon="editor:mode-edit"></iron-icon></paper-icon-item>
<paper-item-body>റിവ്യൂ തിരുത്തുക</paper-item-body>
</paper-item>
</a>
</li>
<li>
<a style="padding: 0; margin: 0;" on-click="openDeleteReview">
<paper-item>
<paper-icon-item><iron-icon style="margin-right: 4px; width: 22px;" icon="icons:delete"></iron-icon></paper-icon-item>
<paper-item-body>റിവ്യൂ നീക്കം ചെയ്യുക</paper-item-body>
</paper-item>
</a>
</li>
</ul>
</div>
<div>
<a href="{{ review.userProfilePageUrl }}">
<img class="img-circle user-dp pratilipi-shadow" src="{{ reviewUserImageUrl }}" alt="{{ user.userName }}" title="{{ user.userName }}"/>
</a>
<div style="display: inline-block; margin-left: 16px;">
<a class="user-name" href="{{ review.userProfilePageUrl }}">{{ review.userName }}</a>
<template is="dom-if" if="{{ showRating }}">
<pratilipi-rating value="{{ review.rating }}" />
</template>
<span style="display: block;">{{ reviewDateMillis }}</span>
</div>
</div>
<div class="reviewText">{{ reviewText }}</div>
<div class="reply-section">
<div id="review-like-{{ review.userPratilipiId }}" style="display: inline-block;">
<a on-click="likeDislikeReview">
<iron-icon style="width: 16px; height: 16px; margin-top: -2px;" icon="icons:thumb-up"></iron-icon>
</a>
<template is="dom-if" if="{{ showLikeCount }}">
<span style="margin-left: 8px; font-size: 15px;">
{{ likeCount }}
</span>
</template>
</div>
<iron-icon icon="icons:add-circle" style="width: 4px; height: 4px; margin-left: 8px; color: grey;"></iron-icon>
<a class="reply-text" style="color: grey;" on-click="writeComment" onclick="ga_CA( 'Review', 'Add Comment' )">
മറുപടി എഴുതൂ
</a>
<br/>
<template is="dom-if" if="{{ showCommentCount }}">
<a class="expand-comments pratilipi-red" on-click="showOrHideComments">
<iron-icon icon="icons:unfold-more"></iron-icon>
{{ commentCount }}&nbsp;{{ commentNumberText }}
</a>
</template>
</div>
<pratilipi-comment-list
id="comment-{{ review.userPratilipiId }}"
comment-count="{{ commentCount }}"
user="{{ user }}"
parent-id="{{ review.userPratilipiId }}"
parent-type="REVIEW"></pratilipi-comment-list>
</paper-card>
<iron-ajax
id="AjaxPost"
url="/api/vote"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_handleAjaxPostResponse"
on-error="_handleAjaxPostError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-review',
properties: {
user: { type: Object },
review: { type: Object, observer: "ready" },
reviewUserImageUrl: { type: String, value: "https://0.ptlp.co/author/image?width=64" },
hasAccessToUpdate: { type: Boolean, value: false },
commentCount: { type: Number, observer: "_commentCountObserver" },
showCommentCount: { type: Boolean, value: false },
likeCount: { type: Number, observer: "_likeCountObserver" },
showLikeCount: { type: Boolean, value: false },
isLiked: { type: Boolean, observer: "_isLikedObserver" }
},
ready: function() {
if( this.review == null || jQuery.isEmptyObject( this.review ) )
return;
if( this.review.review == null || this.review.review.trim() == "" ) {
this.$.reviewcard.style.display = 'none';
return;
}
this.$.reviewcard.style.display = 'block';
this.set( 'reviewText', this.review.review );
if( this.review.userImageUrl ) {
this.set( 'reviewUserImageUrl', this.review.userImageUrl
+ ( this.review.userImageUrl.indexOf( '?' ) == -1 ? "?" : "&" )
+ "width=64" );
}
if( this.review.reviewDateMillis )
this.reviewDateMillis = convertDate( this.review.reviewDateMillis );
this.showRating = this.review.rating > 0;
this.commentCount = this.review.commentCount;
this.likeCount = this.review.likeCount;
this.isLiked = this.review.isLiked != null ? this.review.isLiked : false;
},
_commentCountObserver: function() {
this.showCommentCount = this.commentCount != null && this.commentCount > 0;
this.commentNumberText = this.commentCount != null && this.commentCount > 1 ?
"മറുപടികള്‍" : "മറുപടി";
},
_likeCountObserver: function() {
this.showLikeCount = this.likeCount != null && this.likeCount > 0;
},
_isLikedObserver: function() {
jQuery( this.querySelector( '#review-like-' + this.review.userPratilipiId ) ).removeClass( this.isLiked ? "review-none" : "review-liked" );
jQuery( this.querySelector( '#review-like-' + this.review.userPratilipiId ) ).addClass( this.isLiked ? "review-liked" : "review-none" );
},
writeComment: function() {
this.querySelector( 'pratilipi-comment-list#comment-' + this.review.userPratilipiId ).writeComment();
},
showOrHideComments: function() {
this.querySelector( 'pratilipi-comment-list#comment-' + this.review.userPratilipiId ).showOrHideComments();
},
likeDislikeReview: function( event ) {
if( this.user.isGuest ) {
document.querySelector( 'pratilipi-user' ).logIn( true );
return;
}
if( this.isLiked ) {
this.isLiked = false;
this.likeCount --;
} else {
this.isLiked = true;
this.likeCount ++;
}
// When called from _handleAjaxPostError
if( event == null )
return;
// Make Ajax call
var body = {
parentType: "REVIEW",
parentId: this.review.userPratilipiId,
type: this.isLiked ? "LIKE" : "NONE"
};
this.$.AjaxPost.body = jQuery.param( body );
this.$.AjaxPost.generateRequest();
ga_CA( 'Review', this.isLiked ? 'Review Like' : 'Review UnLike' );
},
_handleAjaxPostResponse: function( event ) {
if( event.detail.xhr.status == 0 ) {
document.querySelector( 'pratilipi-alert' ).alert( "സെര്‍വറുമായി ബന്ധം സ്ഥാപിക്കാനാവുന്നില്ല!", false );
this._handleAjaxPostError();
return;
}
},
_handleAjaxPostError: function( event ) {
if( event != null && event.detail.request.xhr.response.message != null )
document.querySelector( 'pratilipi-alert' ).alert( event.detail.request.xhr.response.message, false );
else
document.querySelector( 'pratilipi-alert' ).alert( "എന്തോ സാങ്കേതിക പ്രശ്നം സംഭവിച്ചിരിക്കുന്നു. വീണ്ടും ശ്രമിക്കൂ", false );
// Reverting it
this.likeDislikeReview();
},
showReviewInput: function() {
this.domHost.showReviewInput();
},
openDeleteReview: function() {
this.domHost.openDeleteReview();
}
});
</script>
</dom-module>
<dom-module id="pratilipi-rating-input">
<style>
:host {
display: inline-block;
}
div > div {
direction: rtl;
cursor: pointer;
}
.glyphicon {
color: #278be7;
}
.glyphicon:hover ~ .glyphicon, .glyphicon:hover {
color: #107FE5;
}
iron-icon {
width: 32px;
height: 32px;
}
</style>
<template>
<div>
<div style="display: block; float: left; margin-top: 20px;">
<strong class="pratilipi-blue" style="cursor: default; font-size: 20px; float: right; margin-top: 7px; margin-left: 12px;">{{ text }}</strong>
<iron-icon icon="{{ icon5 }}" class="glyphicon" on-mouseover="showFiveStars" on-mouseout="init" on-click="rateFiveStars"></iron-icon>
<iron-icon icon="{{ icon4 }}" class="glyphicon" on-mouseover="showFourStars" on-mouseout="init" on-click="rateFourStars"></iron-icon>
<iron-icon icon="{{ icon3 }}" class="glyphicon" on-mouseover="showThreeStars" on-mouseout="init" on-click="rateThreeStars"></iron-icon>
<iron-icon icon="{{ icon2 }}" class="glyphicon" on-mouseover="showTwoStars" on-mouseout="init" on-click="rateTwoStars"></iron-icon>
<iron-icon icon="{{ icon1 }}" class="glyphicon" on-mouseover="showOneStar" on-mouseout="init" on-click="rateOneStar"></iron-icon>
</div>
</div>
</template>
<script>
Polymer({
is: 'pratilipi-rating-input',
properties: {
value: { type: Number, notify: true, observer: 'init' }
},
init: function() {
this.setRating( this.value );
switch( this.value ) {
case 0:
this.text = null;
break;
case 1:
this.showOneStar();
break;
case 2:
this.showTwoStars();
break;
case 3:
this.showThreeStars();
break;
case 4:
this.showFourStars();
break;
case 5:
this.showFiveStars();
break;
}
},
setRating: function( value ) {
this.set( 'value', value != null ? value : 0 );
this.setStar( this.value );
},
setStar: function( n ) {
for( var i = 1; i <= 5; i++ )
this.set( "icon" + i, "star-border" );
for( var i = 1; i <= n; i++ )
this.set( "icon" + i, "star" );
ga_CA( 'Review', 'Star Rating' );
},
showOneStar: function() {
this.text = 'മോശം';
},
showTwoStars: function() {
this.text = 'കൊള്ളാം';
},
showThreeStars: function() {
this.text = 'നല്ലത്‌';
},
showFourStars: function() {
this.text = 'വളരെ നല്ലത്‌';
},
showFiveStars: function() {
this.text = 'മികച്ചത്';
},
rateOneStar: function() {
this.set( 'value', 1 );
this.setStar(1);
},
rateTwoStars: function() {
this.set( 'value', 2 );
this.setStar(2);
},
rateThreeStars: function() {
this.set( 'value', 3 );
this.setStar(3);
},
rateFourStars: function() {
this.set( 'value', 4 );
this.setStar(4);
},
rateFiveStars: function() {
this.set( 'value', 5 );
this.setStar(5);
}
});
</script>
</dom-module>
<dom-module id="pratilipi-review-input">
<style>
:host {
display: block;
}
paper-textarea.pratilipi-blue {
display: block;
--paper-input-container-color: #107FE5;
--paper-input-container-focus-color: #107FE5;
--paper-input-container-input-color: #333;
--paper-input-container-input: {
font-family: inherit;
};
--paper-input-container-label: {
font-size: 15px;
font-family: inherit;
text-align: left;
};
}
.modal-fullscreen .modal-dialog .modal-content {max-width: 900px;padding-top:5px;}
.modal-fullscreen-heading{line-height: 2;}
</style>
<template>
<div class="modal modal-fullscreen fade" id="pratilipiReviewInput" role="dialog">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-fullscreen-close-button">
<paper-icon-button noink icon="close" data-dismiss="modal"></paper-icon-button>
</div>
<img title="പ്രതിലിപി" alt="പ്രതിലിപി" src="http://public.pratilipi.com/pratilipi-logo/png/Logo-2C-RGB-80px.png" />
<h6 class="modal-fullscreen-heading">{{ pratilipi.title }} - ഒരു റിവ്യൂ എഴുതൂ</h6>
<p class="text-muted text-center">താങ്കളുടെ അഭിപ്രായം പങ്കുവെയ്ക്കുക. എന്താണ് ഈ രചനയെ മികച്ചതാക്കിയത്? എന്താണ് ഇതിനെ വ്യത്യസ്തവും പ്രചോദനാത്മകവുമാക്കിയത്? മറ്റു വായനക്കാരെ നല്ലൊരു രചന തിരഞ്ഞെടുക്കാന്‍ സഹായിക്കൂ!</p>
<div style="height: 2px; background-color: #FFF; text-align: center; margin-top: 20px; margin-bottom: 10px;"></div>
<div id="pratilipi-review-row">
<div id="pratilipi-review-col-left" style="max-width: 175px;">
<img style="max-width: 175px;" class="pratilipi-shadow" src="{{ pratilipiCoverImageUrl }}" alt="{{ pratilipi.title }}" title="{{ pratilipi.titleEn }}"/>
<h6 style="font-weight: 700; text-align: center;" class="text-muted">{{ pratilipi.title }}</h6>
<h6 style="font-weight: 400; text-align: center;" class="text-muted">{{ pratilipi.author.name }}</h6>
</div>
<div style="padding-left: 15px; padding-right: 15px;" id="pratilipi-review-col-right">
<pratilipi-rating-input value="{{ rating }}"></pratilipi-rating-input>
<div style="margin-top: 10px; margin-bottom: 5px; text-align: left;"><span style="font-size: 14px;">താങ്കളുടെ റിവ്യൂ</span></div>
<textarea style="width: 100%; height: 185px;" id="reviewInput" value="{{ review::input }}"></textarea>
</div>
</div>
</div>
</div>
<div class="modal-footer">
<div class="display-message-div"><p>{{ message }}</p></div>
<button id="editReviewButton" style="position: fixed; bottom: 15px; right: 15px;" class="pratilipi-dark-blue-button" type="button" on-click="createOrEditReview">സമര്‍പ്പിക്കുക</button>
</div>
</div>
<div class="modal fade" id="deleteReview">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h6 class="modal-heading">റിവ്യൂ നീക്കം ചെയ്യുക</h6>
<span class="modal-close-button"><paper-icon-button noink icon="close" data-dismiss="modal"></paper-icon-button></span>
</div>
<div class="modal-body">
താങ്കളുടെ റിവ്യൂ ഉറപ്പായും നീക്കം ചെയ്യേണമോ?
</div>
<div class="modal-footer">
<button id="deleteReviewButton" class="btn btn-danger pull-left" on-click="deleteReview">അതെ,റിവ്യൂ നീക്കം ചെയ്യുക!</button>
<button class="btn btn-primary pull-right" on-click="closeDeleteReview">വേണ്ട!</button>
</div>
</div>
</div>
</div>
<iron-ajax
id="AjaxPost"
url="/api/userpratilipi/review"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_handleAjaxPostResponse"
on-error="_handleAjaxPostError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-review-input',
properties: {
// Display Object
pratilipi: { type: Object },
// Userpratilipi
pratilipiId: { type: String },
rating: { type: Number },
review: { type: String },
reviewState: { type: String },
// Specific to modal message.
message: { type: String }
},
behaviors: [
Polymer.IronResizableBehavior
],
listeners: {
'iron-resize': '_onIronResize'
},
_onIronResize: function() {
var windowsize = this.clientWidth;
if( windowsize > 600 ) {
jQuery( '#pratilipi-review-row' ).removeClass( 'row-mobile' );
jQuery( '#pratilipi-review-col-left' ).removeClass( 'col-left-mobile' );
jQuery( '#pratilipi-review-col-right' ).removeClass( 'col-right-mobile' );
jQuery( '#pratilipi-review-row' ).addClass( 'row-widescreen' );
jQuery( '#pratilipi-review-col-left' ).addClass( 'col-left-widescreen' );
jQuery( '#pratilipi-review-col-right' ).addClass( 'col-right-widescreen' );
}
else {
jQuery( '#pratilipi-review-row' ).removeClass( 'row-widescreen' );
jQuery( '#pratilipi-review-col-left' ).removeClass( 'col-left-widescreen' );
jQuery( '#pratilipi-review-col-right' ).removeClass( 'col-right-widescreen' );
jQuery( '#pratilipi-review-row' ).addClass( 'row-mobile' );
jQuery( '#pratilipi-review-col-left' ).addClass( 'col-left-mobile' );
jQuery( '#pratilipi-review-col-right' ).addClass( 'col-right-mobile' );
}
},
attached: function() {
this.pratilipiCoverImageUrl = this.pratilipi.coverImageUrl
+ ( this.pratilipi.coverImageUrl.indexOf( "?" ) == -1 ? "?" : "&" )
+ "width=175";
},
process: function( userpratilipi ) {
this.pratilipiId = userpratilipi.pratilipiId == null ? this.pratilipi.pratilipiId : userpratilipi.pratilipiId;
this.rating = userpratilipi.rating == null ? null : userpratilipi.rating;
this.reviewState = userpratilipi.reviewState == "PUBLISHED" ? null : userpratilipi.reviewState;
this.review = userpratilipi.review != null ? userpratilipi.review : null;
},
openReviewInput: function( userpratilipi ) {
this.process( userpratilipi != null ? userpratilipi : {} );
this.async( function() {
jQuery( "#pratilipiReviewInput" ).modal();
});
},
openDeleteReview: function( pratilipiId ) {
this.pratilipiId = pratilipiId;
this.async( function() {
jQuery( "#deleteReview" ).modal();
});
},
closeReviewInput: function() {
jQuery( "#pratilipiReviewInput" ).modal( 'hide' );
},
closeDeleteReview: function() {
jQuery( "#deleteReview" ).modal( 'hide' );
},
deleteReview: function() {
// Change state and make Post call.
jQuery( '#deleteReviewButton' ).prop( 'disabled', true );
var body = { pratilipiId: this.pratilipiId, reviewState: "DELETED" };
this.$.AjaxPost.body = jQuery.param( body );
this.$.AjaxPost.generateRequest();
},
createOrEditReview: function( event ) {
if( this.rating == null || this.rating == 0 ) {
this.message = "താങ്കളുടെ റേറ്റിംഗ് ചേര്‍ക്കൂ";
var stars = jQuery( this.querySelector( 'pratilipi-rating-input' ) );
for( var i = 0; i < 3; i ++ ) {
stars.animate( { opacity: '0.4'}, 100 );
stars.animate( { opacity: '1'}, 50 );
}
return;
}
this.message = "സേവ് ചെയ്തുകൊണ്ടിരിക്കുന്നു. . .";
jQuery( '#editReviewButton' ).prop( 'disabled', true );
var body = {
pratilipiId : this.pratilipiId,
rating: this.rating
};
if( this.review != null )
body.review = this.review;
this.$.AjaxPost.body = jQuery.param( body );
this.$.AjaxPost.generateRequest();
ga_CA( 'Review', 'Add Rating' );
},
_handleAjaxPostResponse: function( event ) {
if( event.detail.xhr.status == 0 ) {
this.message = "Could not connect to server !";
} else if( document.querySelector( 'pratilipi-pratilipi-page' ) != null ) {
this.message = "വിജയകരമായി പൂര്‍ത്തീകരിച്ചിരിക്കുന്നു !";
document.querySelector( 'pratilipi-pratilipi' ).updateUserRating( event.detail.response );
document.querySelector( 'pratilipi-userpratilipi' ).setUserPratilipi( event.detail.response );
this.async( function() {
this.message = null;
jQuery( '#editReviewButton' ).prop( 'disabled', false );
jQuery( '#deleteReviewButton' ).prop( 'disabled', false );
this.closeReviewInput();
this.closeDeleteReview();
}, 2000 );
} else if( document.querySelector( 'pratilipi-reader-page' ) != null ) {
this.message = "വിജയകരമായി പൂര്‍ത്തീകരിച്ചിരിക്കുന്നു !";
document.querySelector( 'pratilipi-reader-page' ).updateUserPratilipi( event.detail.response );
this.async( function() {
this.message = null;
jQuery( '#editReviewButton' ).prop( 'disabled', false );
this.closeReviewInput();
}, 2000 );
}
},
_handleAjaxPostError: function( event ) {
jQuery( '#editReviewButton' ).prop( 'disabled', false );
jQuery( '#deleteReviewButton' ).prop( 'disabled', false );
if( event.detail.request.xhr.status == 400 ) {
this.message = event.detail.request.xhr.response;
} else if( event.detail.request.xhr.status == 401 ) {
this.message = null;
this.closeReviewInput();
this.closeDeleteReview();
document.querySelector( 'pratilipi-user' ).logIn( true );
} else {
this.message = event.detail.request.xhr.response.message;
}
}
});
</script>
</dom-module>
<dom-module id="pratilipi-review-list">
<style>
:host {
display: block;
}
.secondary-500 {
width: 100%;
padding: 10px;
margin-bottom: 4px;
}
.secondary-500 h5 {
margin: 0px;
padding: 10px;
display: inline-block;
}
.secondary-500 a {
margin-bottom: 6px;
}
paper-spinner.pratilipi-spinner {
--paper-spinner-layer-1-color: #D0021B;
--paper-spinner-layer-2-color: #107FE5;
--paper-spinner-layer-3-color: #D0021B;
--paper-spinner-layer-4-color: #107FE5;
}
paper-card.zero-results {
width: 100%;
text-align: center;
padding: 50px 15px;
margin-bottom: 10px;
}
iron-icon.zero-results-icon {
color: #545454;
width: 64px;
height: 64px;
}
h5.zero-results-h5 {
color: #545454;
font-size: 18px;
line-height: 32px;
margin-top: 24px;
}
</style>
<template>
<div class="secondary-500 pratilipi-shadow">
<h5 class="pratilipi-red">റിവ്യൂസ്</h5>
<template is="dom-if" if="{{ user.isGuest }}">
<a class="pratilipi-grey-button" role="button" on-click="showReviewInput">ഒരു റിവ്യൂ എഴുതൂ</a>
</template>
<template is="dom-if" if="{{ userpratilipi.hasAccessToReview }}">
<template is="dom-if" if="{{ !reviewAvailable }}">
<a class="pratilipi-grey-button" role="button" on-click="showReviewInput">ഒരു റിവ്യൂ എഴുതൂ</a>
</template>
</template>
</div>
<pratilipi-review-input
id="ReviewInput"
pratilipi="[[ pratilipi ]]"
></pratilipi-review-input>
<!-- No Reviews found in case of no results -->
<template is="dom-if" if="[[ zeroReviewResults ]]">
<paper-card class="zero-results">
<iron-icon icon="icons:info-outline" class="zero-results-icon"></iron-icon>
<h5 class="zero-results-h5">ഈ രചനയ്ക്ക് ഇത് വരെ റിവ്യൂസ് ഒന്നും ഇല്ല</h5>
</paper-card>
</template>
<div>
<template is="dom-if" if="{{ reviewAvailable }}">
<pratilipi-review id="review-{{ userpratilipi.userPratilipiId }}" user="{{ user }}" review="{{ userpratilipi }}" has-access-to-update></pratilipi-review>
</template>
<template is="dom-repeat" id="repeatReviewList" items="[[reviewList]]" as="review">
<pratilipi-review id="review-{{ review.userPratilipiId }}" user="{{ user }}" review="[[ review ]]"></pratilipi-review>
</template>
</div>
<template is="dom-if" if="{{ isLoading }}">
<paper-spinner class="pratilipi-spinner pratilipi-spinner-center" active></paper-spinner>
</template>
<iron-ajax
id="AjaxGet"
url="/api/userpratilipi/review/list"
method="GET"
content-type="application/json"
handle-as="json"
on-response="_handleAjaxGetResponse"
on-error="_handleAjaxGetError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-review-list',
properties: {
user: { type: Object, observer:"_userChanged" },
pratilipi: { type: Object },
userpratilipi: { type: Object, observer:"_userPratilipiChanged" },
reviewList: { type: Array, value: [], notify: true },
zeroReviewResults: { type: Boolean, value: false },
cursor: { type: String, value: null },
resultCount: { type: Number, value: 20 },
isLoading: { type: Boolean, value: false },
isFinished: { type: Boolean, value: false },
reviewAvailable: { type: Boolean, value: false, observer: "checkForZeroResults" },
reviewButtonClicked: { type: Boolean, value: false }
},
_userChanged: function() {
// Called when user is set
if( this.user == null || this.pratilipi == null )
return;
// To reload the page - to load comments
this.reset();
},
_userPratilipiChanged: function() {
// Guest user clicked on "Write Review Button" and logged in.
if( this.user != null && ! this.user.isGuest && this.reviewButtonClicked ) {
this.reviewButtonClicked = false;
this.showReviewInput();
}
// Checking if user has review
this.set( 'reviewAvailable', this.userpratilipi != null && this.userpratilipi.reviewState != "BLOCKED" && this.userpratilipi.reviewState != "DELETED"
&& this.userpratilipi.review != null && this.userpratilipi.review.trim() != "" )
if( ! this.reviewAvailable )
return;
// Removing user's review from review list.
var index = -1;
for( var i = 0; i < this.reviewList.length; i++ ) {
if( this.userpratilipi.userPratilipiId == this.reviewList[i].userPratilipiId ) {
index = i;
break;
}
}
if( index != -1 )
this.splice( 'reviewList', index, 1 );
},
showReviewInput: function() {
if( this.user.isGuest ) {
document.querySelector( 'pratilipi-user' ).logIn( true );
this.reviewButtonClicked = true;
} else if( this.userpratilipi != null && this.userpratilipi.hasAccessToReview ) {
this.querySelector( 'pratilipi-review-input' ).openReviewInput( this.userpratilipi );
} else {
/* alert( "ക്ഷമിക്കണം! താങ്കള്‍ക്ക് ഈ രചനയ്ക്ക് റിവ്യൂ എഴുതാന്‍ സാധിക്കില്ല!" ); */
}
},
openDeleteReview: function() {
this.querySelector( 'pratilipi-review-input' ).openDeleteReview( this.userpratilipi.pratilipiId );
},
checkForZeroResults: function() {
if( this.reviewAvailable || ! this.isFinished ) {
this.set( 'zeroReviewResults', false );
return;
}
var zeroReviewResults = true;
for( var i = 0; i < this.reviewList.length; i ++ ) {
if( this.reviewList[i].reviewState != "BLOCKED" && this.reviewList[i].reviewState != "DELETED"
&& this.reviewList[i].review != null && this.reviewList[i].review.trim() != ""
&& this.reviewList[i].userPratilipiId != this.userpratilipi.userPratilipiId ) {
zeroReviewResults = false;
break;
}
}
this.set( 'zeroReviewResults', zeroReviewResults );
},
reset: function() {
this.set( 'reviewList', [] );
// Setting the flags and clearing the cursor.
this.cursor = null;
// make ajax GET call.
this._makeAjaxRequest();
},
loadMore: function( scrollTop ) {
// Return if there is an active call or cursor = null.
if( this.isLoading || this.isFinished || this.cursor == null || this.pratilipi == null )
return;
// Check for window height.
var reqHeight = jQuery( window ).scrollTop()
- jQuery( this ).position().top
+ jQuery( window ).height()
+ 3 * jQuery( window ).height();
if( jQuery( this ).outerHeight( true ) >= reqHeight )
return;
// Set params and make ajax GET call.
this._makeAjaxRequest();
ga_CA( 'Review', 'Load Reviews' );
},
_makeAjaxRequest: function() {
// Spinner Active
this.set( 'isLoading', true );
this.set( 'isFinished', false );
this.set( 'zeroReviewResults', false );
if( this.$.AjaxGet.lastRequest )
this.$.AjaxGet.lastRequest.abort();
this.$.AjaxGet.params.pratilipiId = this.pratilipi.pratilipiId;
this.$.AjaxGet.params.resultCount = this.resultCount;
if( this.cursor == null )
delete this.$.AjaxGet.params.cursor;
else
this.$.AjaxGet.params.cursor = this.cursor;
this.$.AjaxGet.generateRequest();
},
_handleAjaxGetResponse: function( event ) {
// Disable spinner
this.set( 'isLoading', false );
// Call didn't succeed.
if( event.detail.xhr.status == 0 )
return;
var reviewList = event.detail.response.reviewList;
for( var i = 0; i < reviewList.length; i++ ) {
if( reviewList[i].reviewState != "BLOCKED" && reviewList[i].reviewState != "DELETED"
&& reviewList[i].review != null && reviewList[i].review.trim() != ""
&& reviewList[i].userPratilipiId != this.userpratilipi.userPratilipiId )
this.push( 'reviewList', reviewList[i] );
}
this.set( 'cursor', event.detail.response.cursor );
this.set( 'isFinished', event.detail.response.cursor == null || reviewList.length < this.resultCount );
this.checkForZeroResults();
},
_handleAjaxGetError: function() {
// Disable spinner
this.set( 'isLoading', false );
},
attached: function() {
this._makeAjaxRequest();
}
});
</script>
</dom-module>
<dom-module id="pratilipi-comment">
<style>
.comment {
padding: 12px 8px 16px 8px;
}
.user-dp {
width: 36px;
height: 36px;
margin-top: 4px;
margin-left: 4px;
float: left;
}
.user-name {
color: inherit;
text-transform: capitalize;
display: inline-block;
margin: 0px;
font-size: 15px;
}
.comment-text {
font-size: 14px;
text-align: justify;
white-space:pre-wrap;
padding: 14px 0px 4px 4px;
letter-spacing: 0.1px;
}
paper-menu-button {
padding: 0px;
}
paper-menu {
cursor: pointer;
--paper-menu-color: #333;
--paper-menu-focused-item: {
color: #107FE5;
};
}
paper-item {
cursor: pointer;
font-family: inherit;
font-size: 13px;
}
button.pratilipi-grey-button {
padding: 6px 8px;
margin: 0px;
margin-top: 4px;
}
.comment-liked, .comment-liked * {
color: #de4d5f;
}
.comment-none, .comment-none * {
color: grey;
}
</style>
<template>
<div class="comment">
<div hidden$="{{ !hasAccessToUpdate }}" class="dropdown">
<paper-icon-button style="color: #333;" class="dropdown-trigger pull-right" icon="icons:more-horiz" noink type="button" data-toggle="dropdown"></paper-icon-button>
<ul style="margin-right: -20px; margin-top: -4px;" class="dropdown-menu pull-right">
<li>
<a style="padding: 0; margin: 0;" on-click="openCommentEdit">
<paper-item>
<paper-icon-item><iron-icon style="margin-right: 8px; width: 20px; height: 20px;" icon="icons:create"></iron-icon></paper-icon-item>
<paper-item-body>കമന്റ് തിരുത്തൂ</paper-item-body>
</paper-item>
</a>
</li>
<li>
<a style="padding: 0; margin: 0;" on-click="_confirmDeleteComment">
<paper-item>
<paper-icon-item><iron-icon style="margin-right: 8px; width: 20px; height: 20px;" icon="icons:delete"></iron-icon></paper-icon-item>
<paper-item-body>കമന്റ് നീക്കം ചെയ്യൂ</paper-item-body>
</paper-item>
</a>
</li>
</ul>
</div>
<button hidden$="{{ !showRestoreComment }}" class="pratilipi-grey-button pull-right" on-click="_restoreComment" class="pull-right">
<iron-icon style="width: 16px; height: 16px; margin-top: -4px;" icon="icons:restore"></iron-icon>
കമന്റ് തിരികെ ചേര്‍ക്കൂ
</button>
<div class="user-details">
<a href="{{ comment.user.profilePageUrl }}">
<img class="img-circle user-dp pratilipi-shadow" src="{{ userProfileImageUrl }}" alt="username" title="username"/>
</a>
<div style="display: inline-block; margin-left: 16px;">
<a class="user-name" href="{{ comment.user.profilePageUrl }}">{{ comment.user.displayName }}</a>
<span style="display: block;">{{ lastUpdatedDate }}</span>
</div>
</div>
<div class="comment-text">{{ content }}</div>
<div id="comment-like-{{ comment.commentId }}" style="display: inline-block;">
<a on-click="likeDislikeComment">
<iron-icon style="width: 16px; height: 16px; margin-top: -2px; margin-left: 6px;" icon="icons:thumb-up"></iron-icon>
</a>
<template is="dom-if" if="{{ showLikeCount }}">
<span style="margin-left: 8px; font-size: 15px;">
{{ likeCount }}
</span>
</template>
</div>
<iron-icon icon="icons:add-circle" style="width: 4px; height: 4px; margin-left: 8px; color: grey;"></iron-icon>
<a class="reply-text" style="color: grey; margin-left: 10px;" on-click="writeComment">
മറുപടി എഴുതൂ
</a>
</div>
<div style="display: none; padding: 16px 10px;" class="delete-comment-confirmation">
<h5 class="text-center">ഈ കമന്റ് നീക്കം ചെയ്യട്ടേ?</h5>
<div class="text-center" style="margin: 16px auto 4px auto;">
<button style="margin-right: 4px; padding-left: 16px; padding-right: 16px; outline: none;" class="btn btn-danger" on-click="_deleteComment">ചെയ്യൂ</button>
<button style="margin-left: 4px; padding-left: 22px; padding-right: 22px; outline: none;" class="btn btn-primary" on-click="_cancelDeleteComment">വേണ്ട</button>
</div>
</div>
<template is="dom-if" if="{{ hasAccessToUpdate }}">
<pratilipi-comment-input
style="display: none;"
edit-comment
user="{{ comment.user }}"
comment-id="{{ comment.commentId }}"
content="{{ content }}"></pratilipi-comment-input>
</template>
<iron-ajax
id="AjaxPost"
url="/api/comment"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_handleAjaxPostResponse"
on-error="_handleAjaxPostError"
></iron-ajax>
<iron-ajax
id="LikeDislikePost"
url="/api/vote"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_likeDislikePostResponse"
on-error="_likeDislikePostError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-comment',
properties: {
user: { type: Object },
comment: { type: Object, observer: "_commentObserver" },
userProfileImageUrl: { type: String, value: "https://0.ptlp.co/author/image?width=36" },
editComment: { type: Boolean, value: false },
deleteComment: { type: Boolean, value: false },
restoreComment: { type: Boolean, value: false },
showRestoreComment: { type: Boolean, value: false },
likeCount: { type: Number, observer: "_likeCountObserver" },
showLikeCount: { type: Boolean, value: false },
isLiked: { type: Boolean, observer: "_isLikedObserver" }
},
_commentObserver: function() {
this.lastUpdatedDate = convertDate( this.comment.lastUpdatedMillis != null ?
this.comment.lastUpdatedMillis : this.comment.creationDateMillis );
if( this.comment && this.comment.user && this.comment.user.profileImageUrl ) {
this.set( 'userProfileImageUrl', this.comment.user.profileImageUrl
+ ( this.comment.user.profileImageUrl.indexOf( "?" ) == -1 ? "?" : "&" )
+ "width=36" )
}
this.hasAccessToUpdate = this.comment.hasAccessToUpdate == null ? false : this.comment.hasAccessToUpdate;
this.content = this.comment.content;
this.likeCount = this.comment.likeCount;
this.isLiked = this.comment.isLiked;
},
_likeCountObserver: function() {
this.showLikeCount = this.likeCount != null && this.likeCount > 0;
},
_isLikedObserver: function() {
jQuery( this.querySelector( '#comment-like-' + this.comment.commentId ) ).removeClass( this.isLiked ? "comment-none" : "comment-liked" );
jQuery( this.querySelector( '#comment-like-' + this.comment.commentId ) ).addClass( this.isLiked ? "comment-liked" : "comment-none" );
},
writeComment: function() {
this.domHost.writeComment();
},
openCommentEdit: function() {
jQuery( this.querySelector( '.comment' ) ).css( 'display', 'none' );
jQuery( this.querySelector( 'pratilipi-comment-input' ) ).css( 'display', 'block' );
},
closeCommentEdit: function() {
jQuery( this.querySelector( 'pratilipi-comment-input' ) ).css( 'display', 'none' );
jQuery( this.querySelector( '.comment' ) ).css( 'display', 'block' );
},
editExistingComment: function( content ) {
if( this.editComment )
return;
this.editComment = true;
var body = {
commentId: this.comment.commentId,
content: content
};
this.$.AjaxPost.body = jQuery.param( body );
this.$.AjaxPost.generateRequest();
},
_confirmDeleteComment: function() {
var height = jQuery( this.querySelector( '.comment' ) ).height() + 24; // 12px padding top and bottom
jQuery( this.querySelector( '.comment' ) ).css( 'display', 'none', 'important' );
jQuery( this.querySelector( '.delete-comment-confirmation' ) ).css( 'display', 'block', 'important' );
jQuery( this.querySelector( '.delete-comment-confirmation' ) ).css( 'min-height', height );
},
_cancelDeleteComment: function() {
jQuery( this.querySelector( '.delete-comment-confirmation' ) ).css( 'display', 'none', 'important' );
jQuery( this.querySelector( '.comment' ) ).css( 'display', 'block', 'important' );
},
_deleteComment: function() {
if( this.deleteComment )
return;
this.deleteComment = true;
var body = {
commentId: this.comment.commentId,
state: "DELETED"
};
this.$.AjaxPost.body = jQuery.param( body );
this.$.AjaxPost.generateRequest();
},
_restoreComment: function() {
if( this.restoreComment )
return;
this.restoreComment = true;
var body = {
commentId: this.comment.commentId,
state: "ACTIVE"
};
this.$.AjaxPost.body = jQuery.param( body );
this.$.AjaxPost.generateRequest();
},
_handleAjaxPostResponse: function( event ) {
var comment = event.detail.response;
if( this.editComment ) {
this.editComment = false;
this.set( 'comment', comment );
this.closeCommentEdit();
} else if( this.deleteComment ) {
this.deleteComment = false;
this.set( 'comment', comment );
jQuery( this.querySelector( '.comment' ) ).css( 'display', 'none' );
this.domHost.decrementCommentCount();
this.async( function() { this.domHost.deleteCommentFromList( comment ); });
} else if( this.restoreComment ) {
this.restoreComment = false;
// Active comment
jQuery( this.querySelector( '.comment' ) ).css( 'color', 'inherit', 'important' );
jQuery( this.querySelector( '.comment' ) ).css( 'background-color', 'inherit', 'important' );
// Disable restoring the comment
this.showRestoreComment = false;
this.set( 'comment', comment );
this.domHost.incrementCommentCount();
}
},
_handleAjaxPostError: function( event ) {
if( event.detail.request.xhr.response.message != null )
document.querySelector( 'pratilipi-alert' ).alert( event.detail.request.xhr.response.message, false );
else
document.querySelector( 'pratilipi-alert' ).alert( "Some error occurred! Please try again!", false );
},
likeDislikeComment: function( event ) {
if( this.user.isGuest ) {
document.querySelector( 'pratilipi-user' ).logIn( true );
return;
}
if( this.isLiked ) {
this.isLiked = false;
this.likeCount --;
} else {
this.isLiked = true;
this.likeCount ++;
}
// When called from _handleAjaxPostError
if( event == null )
return;
// Make Ajax call
var body = {
parentType: "COMMENT",
parentId: this.comment.commentId,
type: this.isLiked ? "LIKE" : "NONE"
};
this.$.LikeDislikePost.body = jQuery.param( body );
this.$.LikeDislikePost.generateRequest();
},
_likeDislikePostResponse: function( event ) {
if( event.detail.xhr.status == 0 ) {
document.querySelector( 'pratilipi-alert' ).alert( "സെര്‍വറുമായി ബന്ധം സ്ഥാപിക്കാനാവുന്നില്ല!", false );
this._handleAjaxPostError();
return;
}
},
_likeDislikePostError: function( event ) {
if( event != null && event.detail.request.xhr.response.message != null )
document.querySelector( 'pratilipi-alert' ).alert( event.detail.request.xhr.response.message, false );
else
document.querySelector( 'pratilipi-alert' ).alert( "എന്തോ സാങ്കേതിക പ്രശ്നം സംഭവിച്ചിരിക്കുന്നു. വീണ്ടും ശ്രമിക്കൂ", false );
// Reverting it
this.likeDislikeComment();
},
});
</script>
</dom-module>
<dom-module id="pratilipi-comment-input">
<style>
.comment-input {
min-height: 120px;
padding: 16px 14px;
}
.arrow-left {
display: inline-block;
margin-left: 8px;
width: 0;
height: 0;
border-top: 10px solid transparent;
border-bottom: 10px solid transparent;
border-right: 10px solid #FFF;
margin-right: -4px;
}
textarea {
border: 1px solid #d3d3d3;
resize: none;
width: 100%;
min-height: 88px;
padding-left: 8px;
padding-right: 8px;
box-sizing: border-box;
margin: 0px;
outline: none;
}
button.pratilipi-grey-button {
margin-top: 0px;
padding: 8px 15px;
}
button.pratilipi-dark-blue-button {
padding: 5px 15px;
margin-right: 8px;
min-width: auto;
height: auto;
}
</style>
<template>
<div class="comment-input">
<div class="row" style="height: 100%;">
<div class="col-xs-12 col-sm-1 col-md-1 col-lg-1" style="margin-bottom: 8px;">
<img class="img-circle" style="margin: 0 auto; width: 36px; height: 36px;" src="{{ userProfileImageUrl }}" alt="{{ user.displayName }}" title="{{ user.displayName }}"/>
<span class="hidden-sm hidden-md hidden-lg">{{ user.displayName }}</span>
</div>
<div class="col-xs-12 col-sm-11 col-md-11 col-lg-11" style="height: 100%;">
<textarea placeholder="മറുപടി എഴുതാന്‍ ഇവിടെ ടൈപ്പ് ചെയ്യൂ" value="{{ content::input }}"></textarea>
</div>
<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
<button id="submitCommentButton" class="pratilipi-dark-blue-button pull-right" on-click="onSubmit" onclick="ga_CA( 'Review', 'Submit Comment' )">സമര്‍പ്പിക്കൂ</button>
<button class="pratilipi-grey-button pull-right" on-click="onCancel" onclick="ga_CA( 'Review', 'Cancel Comment' )">വേണ്ട</button>
</div>
</div>
</div>
<iron-ajax
id="AjaxPost"
url="/api/comment"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_handleAjaxPostResponse"
on-error="_handleAjaxPostError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-comment-input',
properties: {
user: { type: Object },
userProfileImageUrl: { type: String, value: "https://0.ptlp.co/author/image?width=36" },
addComment: { type: Boolean, value: false },
parentType: { type: String },
parentId: { type: Number },
editComment: { type: Boolean, value: false },
commentId: { type: Number },
content: { type: String },
},
attached: function() {
if( this.user.isGuest )
return;
if( this.user.profileImageUrl ) {
this.set( 'userProfileImageUrl', this.user.profileImageUrl
+ ( this.user.profileImageUrl.indexOf( "?" ) == -1 ? "?" : "&" )
+ "width=36" );
}
},
onCancel: function() {
if( this.addComment )
this.domHost.closeCommentAdd();
if( this.editComment )
this.domHost.closeCommentEdit();
},
focusTextarea: function( isFinished ) {
if( isFinished ) {
var offset = jQuery( this.querySelector( '.comment-input' ) ).offset().top;
offset = offset - ( jQuery( window ).height() / 2 );
jQuery( 'html, body' ).animate( { scrollTop: offset }, 500 );
jQuery( this.querySelector( 'textarea' ) ).focus();
} else {
this.async( function() {
jQuery( this.querySelector( 'textarea' ) ).focus();
}, 100 );
}
},
onSubmit: function() {
if( this.addComment ) {
if( this.content == null || this.content.trim() == "" )
return;
if( this.user.isGuest ) {
document.querySelector( 'pratilipi-user' ).logIn( true );
return;
}
var body = {
parentId: this.parentId,
parentType: this.parentType,
content: this.content
};
jQuery( '#submitCommentButton' ).prop( 'disabled', true );
this.$.AjaxPost.body = jQuery.param( body );
this.$.AjaxPost.generateRequest();
}
if( this.editComment ) {
this.domHost.editExistingComment( this.content );
}
},
_handleAjaxPostResponse: function( event ) {
if( this.addComment ) {
var comment = event.detail.response;
comment.user = this.user;
document.querySelector( 'pratilipi-comment-list#comment-'+ this.parentId ).addCommentToList( comment );
this.set( 'content', null );
this.domHost.closeCommentAdd();
jQuery( '#submitCommentButton' ).prop( 'disabled', false );
}
},
_handleAjaxPostError: function( event ) {
jQuery( '#submitCommentButton' ).prop( 'disabled', false );
if( event.detail.request.xhr.response.message != null )
document.querySelector( 'pratilipi-alert' ).alert( event.detail.request.xhr.response.message, false );
else
document.querySelector( 'pratilipi-alert' ).alert( "എന്തോ സാങ്കേതിക പ്രശ്നം സംഭവിച്ചിരിക്കുന്നു. വീണ്ടും ശ്രമിക്കൂ", false );
}
});
</script>
</dom-module>
<dom-module id="pratilipi-comment-list">
<style>
.comment-list {
padding-left: 8px;
}
.comments-loaded {
border-left: 2px solid #d3d3d3;
}
paper-spinner.pratilipi-spinner {
display: block;
margin: 0px auto 12px auto;
--paper-spinner-layer-1-color: #D0021B;
--paper-spinner-layer-2-color: #107FE5;
--paper-spinner-layer-3-color: #D0021B;
--paper-spinner-layer-4-color: #107FE5;
}
</style>
<template>
<div class="comment-list">
<div id="collapse" class="collapse">
<div class="comments-loaded">
<template is="dom-repeat" items="{{ commentList }}" as="comment">
<pratilipi-comment comment="{{ comment }}" user="{{ user }}"></pratilipi-comment>
</template>
</div>
<template is="dom-if" if="{{ isLoading }}">
<paper-spinner class="pratilipi-spinner" active></paper-spinner>
</template>
<pratilipi-comment-input
id="add-comment"
add-comment
user="{{ user }}"
parent-id="{{ parentId }}"
parent-type="{{ parentType }}"></pratilipi-comment-input>
</div>
</div>
<iron-ajax
id="AjaxGet"
url="/api/comment/list"
method="GET"
content-type="application/json"
handle-as="json"
on-response="_handleAjaxGetResponse"
on-error="_handleAjaxGetError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-comment-list',
properties: {
user: { type: Object },
commentCount: { type: Number, notify: true },
parentId: { type: Number },
parentType: { type: String },
cursor: { type: String, value: null },
resultCount: { type: Number },
commentList: { type: Array, value: function() { return []; } },
isLoading: { type: Boolean, value: false },
isFinished: { type: Boolean, value: false },
writeCommentClicked: { type: Boolean, value: false }
},
attached: function() {
this.set( 'commentList', [] );
},
writeComment: function() {
if( this.user.isGuest ) {
this.writeCommentClicked = true;
document.querySelector( 'pratilipi-user' ).logIn( true );
return;
}
if( this.commentCount == 0 )
this.isFinished = true;
if( ! this.isFinished )
this.loadComments();
jQuery( this.querySelector( 'pratilipi-comment-input#add-comment' ) ).css( 'display', 'block' );
this.async( function() { jQuery( this.querySelector( "#collapse" ) ).collapse( 'show' ); } );
this.querySelector( 'pratilipi-comment-input#add-comment' ).focusTextarea( jQuery( this.querySelector( "#collapse" ) ).attr( 'aria-expanded' ) == "true" && this.isFinished );
},
showOrHideComments: function() {
if( this.commentCount == 0 )
this.isFinished = true;
if( ! this.isFinished )
this.loadComments();
this.async( function() {
if( jQuery( this.querySelector( "#collapse" ) ).attr( 'aria-expanded' ) == "true" ) {
jQuery( this.querySelector( "#collapse" ) ).collapse( 'toggle' );
jQuery( this.querySelector( 'pratilipi-comment-input#add-comment' ) ).css( 'display', 'none' );
} else {
jQuery( this.querySelector( 'pratilipi-comment-input#add-comment' ) ).css( 'display', 'none' );
jQuery( this.querySelector( "#collapse" ) ).collapse( 'toggle' );
}
} );
},
closeCommentAdd: function() {
jQuery( this.querySelector( 'pratilipi-comment-input#add-comment' ) ).css( 'display', 'none' );
},
addCommentToList: function( comment ) {
this.push( 'commentList', comment );
this.incrementCommentCount();
},
incrementCommentCount: function( value ) {
this.set( 'commentCount', this.commentCount + ( value != null ? value : 1 ) );
},
decrementCommentCount: function( value ) {
this.set( 'commentCount', this.commentCount - ( value != null ? value : 1 ) );
},
deleteCommentFromList: function( comment ) {
// Removing user's comment from the comment list.
var index = -1;
for( var i = 0; i < this.commentList.length; i++ ) {
if( comment.commentId == this.commentList[i].commentId ) {
index = i;
break;
}
}
if( index != -1 && index < this.commentList.length )
this.splice( 'commentList', index, 1 );
},
loadComments: function() {
if( this.isFinished || this.isLoading )
return;
this.isLoading = true;
this.$.AjaxGet.params.parentId = this.parentId;
this.$.AjaxGet.params.parentType = this.parentType;
/* this.$.AjaxGet.params.cursor = this.cursor; */
this.$.AjaxGet.generateRequest();
},
_handleAjaxGetResponse: function( event ) {
this.isLoading = false;
if( event.detail.xhr.status == 0 )
return;
var commentList = event.detail.response.commentList;
for( var i = commentList.length - 1; i >= 0; i-- )
this.push( 'commentList', commentList[i] );
this.isFinished = true;
},
_handleAjaxGetError: function( event ) {
this.isLoading = false;
if( event.detail.request.xhr.response.message != null )
document.querySelector( 'pratilipi-alert' ).alert( event.detail.request.xhr.response.message, false );
else
document.querySelector( 'pratilipi-alert' ).alert( "എന്തോ സാങ്കേതിക പ്രശ്നം സംഭവിച്ചിരിക്കുന്നു. വീണ്ടും ശ്രമിക്കൂ", false );
this.async( function() {
this.loadComments();
}, 60000 );
},
});
</script>
</dom-module>
<dom-module id="pratilipi-pratilipi-page">
<template>
<pratilipi-user user='{{ user }}' user-data="[[ userData ]]"></pratilipi-user>
<pratilipi-write language-map="[[ languageMap ]]" pratilipi-types='[[ pratilipiTypes ]]'></pratilipi-write>
<pratilipi-alert></pratilipi-alert>
<div class="header-pos">
<pratilipi-android-launch-test></pratilipi-android-launch-test> </div>
<main>
<pratilipi-header language-map="[[ languageMap ]]" user='[[ user ]]'></pratilipi-header>
<div class="parent-container margin-top-bottom">
<div class="container">
<pratilipi-navigation
class='pull-left hidden-xs hidden-sm'
navigation-list='[[ navigationList ]]'
></pratilipi-navigation>
<!-- Navigation & Search bar for extra-small & small screens. -->
<pratilipi-navigation-drawer with-backdrop navigation-list='[[ navigationList ]]'></pratilipi-navigation-drawer>
<div style="overflow:hidden; padding: 0 2px;">
<div id="androidLaunchBottom">
<pratilipi-pratilipi
user='[[ user ]]'
pratilipi='{{ pratilipi }}'
pratilipi-data='[[ pratilipiData ]]'
pratilipi-types='[[ pratilipiTypes ]]'
userpratilipi='[[ userpratilipi ]]'
stage="{{ stage }}"
></pratilipi-pratilipi>
<div style="min-height: 5px;"></div>
<pratilipi-userpratilipi
user='[[ user ]]'
pratilipi-id='[[ pratilipiId ]]'
userpratilipi='{{ userpratilipi }}'
userpratilipi-data='[[ userpratilipiData ]]'
></pratilipi-userpratilipi>
<pratilipi-review-list
id="ReviewSection"
user="[[ user ]]"
pratilipi='[[ pratilipi ]]'
userpratilipi='[[ userpratilipi ]]'
></pratilipi-review-list>
<br class="pratilipi-break" />
</div>
</div>
</div>
</div>
</main>
<footer>
<pratilipi-footer></pratilipi-footer>
</footer>
<div class="scroll-top-button">
<a id="scrollToTop" on-click="scrollToTop"><paper-fab mini noink style="background: #c0c0c0;" icon="icons:arrow-upward"></paper-fab></a>
</div>
</template>
<script>
Polymer({
is: 'pratilipi-pratilipi-page',
properties: {
userData: { type: Object },
pratilipiId: { type: Number },
pratilipiData: { type: Object },
userpratilipiData: { type: Object },
navigationList: { type: Array },
pratilipiTypes: { types: Object },
languageMap: { type: Object },
lastScrollTop: { type: Number, value: 0 },
stage: { type: String }
},
scrollToTop: function() {
$( 'html, body' ).animate( { scrollTop : 0 },800 );
},
ready: function() {
jQuery( '#scrollToTop' ).css( "display", "none" );
},
scrollHandler: function( st ) {
if( st > this.lastScrollTop || st < 100 ) {
jQuery( '#scrollToTop' ).fadeOut();
this.querySelector( 'pratilipi-review-list' ).loadMore( st );
}
else {
jQuery( '#scrollToTop' ).fadeIn();
}
this.lastScrollTop = st;
}
});
</script>
</dom-module>
<dom-module id="pratilipi-author-details">
<style>
:host {
display: block;
margin-bottom: 8px;
}
.cover-image {
display: flex;
justify-content: center;
width: 100%;
height: 350px;
border-radius: 0;
background-image: url(https://0.ptlp.co/author/cover);
background-color: #FFF;
background-repeat: no-repeat;
background-position: top;
background-size: cover;
text-align: center;
}
.author-detail-container {
align-self: center;
padding: 12px 16px;
}
.profile-picture, .pratilipi-file-upload {
width: 150px;
height: 150px;
border: 2px solid #fbfbfb;
border-radius: 50%;
overflow: hidden;
box-shadow: 0 0 8px rgba(0, 0, 0, .8);
-webkit-box-shadow: 0 0 8px rgba(0, 0, 0, .8);
-moz-box-shadow: 0 0 8px rgba(0, 0, 0, .8);
}
.pratilipi-file-upload .pratilipi-file-upload-caption {
transition: none;
}
.pratilipi-file-upload iron-icon, .pratilipi-file-upload .pratilipi-file-upload-caption iron-icon {
left: 32px;
margin: 0;
}
.profile-picture, .pratilipi-file-upload paper-spinner {
width: 146px;
height: 147px;
margin: 0;
--paper-spinner-layer-1-color: #D0021B;
--paper-spinner-layer-2-color: #107FE5;
--paper-spinner-layer-3-color: #D0021B;
--paper-spinner-layer-4-color: #107FE5;
}
.author-name {
margin: 12px auto;
color: #fbfbfb;
font-size: 20px;
font-weight: 700;
text-shadow: 4px 1px 4px rgba(0,0,0,0.50);
}
.follow-author {
clear: both;
}
.follow-author button {
display: block;
margin: 0 auto;
font-weight: 400;
font-size: 13px;
letter-spacing: 0;
border-radius: 4px;
background: #FFFFFF;
color: #d0021b;
border: 1px solid #d0021b;
-webkit-box-shadow: none;
-moz-box-shadow: none;
box-shadow: none;
outline: none;
padding: 4px 8px;
}
.follow-author button iron-icon {
width: 20px;
height: 20px;
color: inherit;
margin-top: -4px;
margin-right: 1px;
}
.user-logout-container span {
font-size: 14px;
color: #FFF;
font-weight: 700;
margin-bottom: 4px;
display: block;
}
.user-logout-container .pratilipi-light-blue-button {
display: block;
margin: 0 auto;
border-radius: 5px;
font-weight: 400;
font-size: 14px;
letter-spacing: 0;
}
.user-logout-container .pratilipi-light-blue-button iron-icon {
width: 20px;
height: 20px;
margin-top: -2px;
}
.edit-profile, .edit-account-info, .notification-settings {
position: absolute;
top: 16px;
}
.edit-profile {
right: 64px;
}
.edit-account-info {
right: 108px;
}
.notification-settings {
right: 152px;
}
paper-fab {
width: 36px!important;
height: 36px!important;
--paper-fab-background: #F5F5F5;
--paper-fab-keyboard-focus-background: #F5F5F5;
--paper-fab-iron-icon: {
color: #333;
}
}
.share-author {
position: absolute;
top: 8px;
right: 8px;
}
.share-author paper-menu-button paper-menu {
padding: 0;
cursor: pointer;
--paper-menu-color: #333;
--paper-menu-focused-item: {
color: #333;
};
}
.share-author paper-item {
padding: 0 8px;
}
.meta-data {
padding: 12px 16px;
margin: 4px auto 0 auto;
text-align: center;
}
.meta-data span {
display: block;
font-size: 13px;
}
.meta-data div.numbers {
font-size: 20px;
font-weight: 500;
}
.upload-cover {
position: absolute;
right: 12px;
bottom: 12px;
}
</style>
<template>
<paper-card class="cover-image pratilipi-shadow" style="background-image: url('{{ coverImageUrl }}');">
<template is="dom-if" if="{{ hasAccessToUpdate }}">
<div class="edit-profile">
<paper-fab mini icon="icons:settings" on-click="editAuthorProfile" onclick="ga_CA( 'User', 'Settings' )"></paper-fab>
</div>
<div class="edit-account-info">
<paper-fab mini icon="social:person" on-click="openAccountSettings"></paper-fab>
</div>
</template>
<div class="share-author">
<paper-menu-button no-animations vertical-offset=48 noink horizontal-align="right" vertical-align="top">
<paper-fab icon="social:share" mini class="dropdown-trigger" onclick="ga_CA( 'Author', 'Share' );"></paper-fab>
<paper-menu class="dropdown-content">
<paper-item on-click="shareAuthorOnFacebook"><span class="icon icon-facebook"></span></paper-item>
<paper-item on-click="shareAuthorOnTwitter"><span class="icon icon-twitter"></span></paper-item>
<paper-item on-click="shareAuthorOnGplus"><span class="icon icon-google-plus"></span></paper-item>
</paper-menu>
</paper-menu-button>
</div>
<div style="position: absolute; top: -1000px;">
<form id="uploadAuthorImage" method="post" enctype="multipart/form-data" action="/api/author/image?authorId={{ author.authorId }}" target="upload_target">
<input id="uploadAuthorImageInput" type="file" on-change="_uploadImage" name="{{ author.authorId }}-image" accept="image/*" />
</form>
<form id="uploadAuthorCover" method="post" enctype="multipart/form-data" action="/api/author/cover?authorId={{ author.authorId }}" target="upload_target">
<input id="uploadAuthorCoverInput" type="file" on-change="_uploadCover" name="{{ author.authorId }}-cover" accept="image/*" />
</form>
<iframe id="upload_target" name="upload_target" style="display: none;" on-load="_onchangeiframe"></iframe>
</div>
<div class="author-detail-container">
<template is="dom-if" if="{{ hasAccessToUpdate }}">
<div class="pratilipi-file-upload">
<template is="dom-if" if="{{ !imageUploaded }}">
<img src="{{ imageUrl }}" alt="{{ author.fullName }}" title="{{ author.fullNameEn }}"/>
</template>
<template is="dom-if" if="{{ imageUploaded }}">
<paper-spinner active></paper-spinner>
</template>
<iron-icon icon="image:photo-camera"></iron-icon>
<div class="pratilipi-file-upload-caption" on-click="_chooseImageFile" onclick="ga_CA( 'User', 'UserProfileImageChange' )">
<iron-icon icon="image:photo-camera"></iron-icon>
</div>
</div>
</template>
<template is="dom-if" if="{{ !hasAccessToUpdate }}">
<iron-image class="profile-picture"
style="background-color: #f5f5f5"
fade preload
sizing="contain"
src="{{ imageUrl }}"
alt="{{ author.fullName }}"
title="{{ author.fullNameEn }}"></iron-image>
</template>
<div class="author-name">{{ name }}</div>
<template is="dom-if" if="{{ hasAccessToFollow }}">
<div class="follow-author">
<template is="dom-if" if="{{ !following }}">
<button class="pratilipi-author-follow-button" on-click="followAuthor">
<iron-icon icon="social:person-add"></iron-icon>
ഫോളോ ചെയ്യൂ{{ followCountAbbr }}
</button>
</template>
<template is="dom-if" if="{{ following }}">
<button class="pratilipi-author-unfollow-button" on-click="unFollowAuthor">
<iron-icon icon="icons:done"></iron-icon>
ഫോളോ ചെയ്തിട്ടുണ്ട്{{ followCountAbbr }}
</button>
</template>
</div>
</template>
<template is="dom-if" if="{{ !hasAccessToFollow }}">
<div class="user-logout-container">
<span>{{ followCount }}&nbsp;ഫോളോവേഴ്സ്</span>
</div>
</template>
</div>
<template is="dom-if" if="{{ hasAccessToUpdate }}">
<div class="upload-cover">
<paper-fab mini icon="image:photo-camera" on-click="_chooseCoverFile" onclick="ga_CA( 'User', 'UserCoverImageChange' )"></paper-fab>
</div>
</template>
</paper-card>
<div class="secondary-500 meta-data pratilipi-shadow">
<div class="row">
<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
<span>കൃതികള്‍</span>
<div class="numbers">{{ contentPublished }}</div>
</div>
<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
<span>വായിച്ചവര്‍</span>
<div class="numbers">{{ totalReadCount }}</div>
</div>
<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
<span>ലൈക്സ്‌</span>
<div class="numbers">{{ totalFbLikeShareCount }}</div>
</div>
</div>
</div>
<iron-ajax
id="UserAuthorFollowPostApi"
url="/api/userauthor/follow"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_userAuthorFollowPostApiResponse"
on-error="_userAuthorFollowPostApiError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-author-details',
properties: {
author: { type: Object, observer: "_authorObserver" },
userAuthor: { type: Object, observer: "_userAuthorObserver" },
followCount: { type: Object, observer: "_followCountObserver" },
imageUploaded: { type: Boolean, value: false },
coverUploaded: { type: Boolean, value: false }
},
attached: function() {
this._authorObserver();
},
_authorObserver: function() {
if( document.querySelector( 'pratilipi-user' ) == null ) return;
this.set( 'hasAccessToFollow', this.author.user == null || this.author.user.userId != document.querySelector( 'pratilipi-user' ).getCurrentUser().userId );
this.set( 'hasAccessToUpdate', this.author.hasAccessToUpdate );
this.set( 'name', this.author.name != null ? this.author.name : this.author.nameEn );
this.set( 'imageUrl', this.author.imageUrl + ( this.author.imageUrl.indexOf( '?' ) == -1 ? "?" : "&" ) + "width=150" );
this.set( 'coverImageUrl', this.author.coverImageUrl );
this.set( 'followCount', this.author.followCount != null ? this.author.followCount : 0 );
this.set( 'contentPublished', commaSeparatedNumber( this.author.contentPublished ) );
this.set( 'totalReadCount', commaSeparatedNumber( this.author.totalReadCount ) );
this.set( 'totalFbLikeShareCount', commaSeparatedNumber( this.author.totalFbLikeShareCount ) );
},
_userAuthorObserver: function( userAuthor ) {
this.set( 'following', ( userAuthor != null && userAuthor.following != null ) ? userAuthor.following : false )
},
_followCountObserver: function() {
this.followCountAbbr = this.followCount > 0 ? ( " | " + abbrNum( this.followCount ) ) : null;
},
_checkUserLoginStatus: function() {
if( document.querySelector( 'pratilipi-user' ).getCurrentUser().isGuest ) {
document.querySelector( 'pratilipi-user' ).logIn( true );
return false;
}
return true;
},
_disableFollowButtons: function() {
this.async( function() {
jQuery( this.querySelector( '.follow-author .pratilipi-author-follow-button' ) ).prop( 'disabled', true );
jQuery( this.querySelector( '.follow-author .pratilipi-author-unfollow-button' ) ).prop( 'disabled', true );
});
},
_enableFollowButtons: function() {
jQuery( this.querySelector( '.follow-author .pratilipi-author-follow-button' ) ).prop( 'disabled', false );
jQuery( this.querySelector( '.follow-author .pratilipi-author-unfollow-button' ) ).prop( 'disabled', false );
},
_postFollowApi: function( following ) {
if( ! this._checkUserLoginStatus() )
return;
this._swapFollowButton();
this._disableFollowButtons();
var body = { authorId: this.author.authorId, following: following };
this.$.UserAuthorFollowPostApi.body = jQuery.param( body );
this.$.UserAuthorFollowPostApi.generateRequest();
},
followAuthor: function() {
this._postFollowApi( true );
ga_CA( 'Author', 'Follow' );
},
unFollowAuthor: function() {
this._postFollowApi( false );
ga_CA( 'Author', 'UnFollow' );
},
_swapFollowButton: function() {
this.set( 'following', ! this.following );
this.set( 'followCount', this.following ? this.followCount + 1 : this.followCount - 1 );
},
_userAuthorFollowPostApiResponse: function( response ) {
var following = response.detail.response.following;
this._enableFollowButtons();
if( this.following != following ) {
this._userAuthorFollowPostApiError();
}
},
_userAuthorFollowPostApiError: function( response ) {
this._swapFollowButton();
this._enableFollowButtons();
if( response != null && response.detail.request.xhr.response.message != null ) {
document.querySelector( 'pratilipi-alert' ).alert( response.detail.request.xhr.response.message, false );
} else {
document.querySelector( 'pratilipi-alert' ).alert( "എന്തോ സാങ്കേതിക പ്രശ്നം സംഭവിച്ചിരിക്കുന്നു. വീണ്ടും ശ്രമിക്കൂ", false );
}
},
editAuthorProfile: function() {
this.domHost.editAuthorProfile();
},
openAccountSettings: function() {
document.querySelector( 'pratilipi-edit-account' ).open();
},
_getShareUrl: function( utm_source ) {
if( utm_source == null ) return;
var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
return encodeURIComponent(
"http://malayalam.pratilipi.com" + this.author.pageUrl
+ ( this.author.pageUrl.indexOf( '?' ) == -1 ? "?" : "&" )
+ "utm_language=malayalam" + "&"
+ "utm_version=standard" + "&"
+ "utm_device=" + ( width < 600 ? "mobile" : "desktop" ) + "&"
+ "utm_parent=profile" + "&"
+ "utm_action=share" + "&"
+ "utm_source=" + utm_source
);
},
shareAuthorOnFacebook: function() {
window.open( "http://www.facebook.com/sharer.php?u=" + this._getShareUrl( "facebook" ),
"share", "width=1100,height=500,left=70px,top=60px" );
},
shareAuthorOnTwitter: function() {
window.open( "http://twitter.com/share?url=" + this._getShareUrl( "twitter" ),
"share", "width=1100,height=500,left=70px,top=60px" );
},
shareAuthorOnGplus: function() {
window.open( "https://plus.google.com/share?url=" + this._getShareUrl( "gplus" ),
"share", "width=1100,height=500,left=70px,top=60px" );
},
_chooseImageFile: function() {
this.querySelector( "#uploadAuthorImageInput" ).click();
},
_chooseCoverFile: function() {
this.querySelector( "#uploadAuthorCoverInput" ).click();
},
_uploadImage: function( event ) {
if( this.imageUploaded ) return;
var FileList = event.target.files;
if( FileList.length != 1 ) return; // No file or more than 1 file is selected.
var file = FileList[0];
if( file == null ) return;
var fileName = file.name.toLowerCase();
if( ! ( fileName.match( ".*\.jpg" ) || fileName.match( ".*\.png" ) ) ) return; // Only jpg and png
this.querySelector( "#uploadAuthorImage" ).submit();
this.imageUploaded = true;
},
_uploadCover: function( event ) {
if( this.coverUploaded ) return;
var FileList = event.target.files;
if( FileList.length != 1 ) return; // No file or more than 1 file is selected.
var file = FileList[0];
if( file == null ) return;
var fileName = file.name.toLowerCase();
if( ! ( fileName.match( ".*\.jpg" ) || fileName.match( ".*\.png" ) ) ) return; // Only jpg and png
this.querySelector( "#uploadAuthorCover" ).submit();
this.coverUploaded = true;
},
_onchangeiframe: function( response ) {
if( this.imageUploaded ) {
this.async( function() { this.imageUploaded = false; }, 500 );
}
if( this.coverUploaded ) {
this.async( function() { this.coverUploaded = false; }, 500 );
}
this.domHost.getAuthor();
}
});
</script>
</dom-module><dom-module id="pratilipi-author-drafted-contents">
<style>
:host {
display: block;
margin-top: 6px;
}
.secondary-500 {
padding: 12px 8px;
}
h6 {
font-weight: 700;
}
hr {
margin-top: 0.5em;
margin-bottom: 1.2em;
border: 0;
border-top: 2px solid #eee;
}
.add-new-card {
text-align: center;
display: block;
cursor: pointer;
margin: 0 auto;
margin-bottom: 16px;
background: linear-gradient(to bottom, #f5f5f5 0%, #d3d3d3 100%);
padding: 0 12px;
}
.add-new-card iron-icon {
display: block;
margin: 0 auto;
margin-bottom: 12px;
}
.add-new-card span {
display: inline-block;
vertical-align: middle;
line-height: 1.5em;
margin-top: 10px;
}
@media only screen and (max-width: 599px) {
.add-new-card {
width: 110px;
height: 165px;
line-height: 165px;
}
.add-new-card iron-icon {
width: 28px;
height: 28px;
}
.add-new-card span {
font-size: 12px;
}
}
@media only screen and (min-width: 600px) {
.add-new-card {
width: 160px;
height: 240px;
line-height: 240px;
}
.add-new-card iron-icon {
width: 48px;
height: 40px;
}
.add-new-card span {
font-size: 14px;
}
}
.more-button {
margin-top: 16px;
background: #F1F8FB;
padding: 16px;
text-align: center;
color: #0C68BD;
cursor: pointer;
font-size: 14px;
font-weight: 700;
line-height: 14px;
text-shadow: 0px 1px 2px #FFFFFF;
}
paper-spinner {
margin: 16px auto;
display: block;
--paper-spinner-layer-1-color: #D0021B;
--paper-spinner-layer-2-color: #107FE5;
--paper-spinner-layer-3-color: #D0021B;
--paper-spinner-layer-4-color: #107FE5;
}
/* Bootstrap overrides */
.row {
margin-left: -8px;
margin-right: -8px;
}
.col-xs-4, .col-sm-3, .col-md-3, .col-lg-3 {
padding-left: 8px;
padding-right: 8px;
}
</style>
<template>
<div class="secondary-500 pratilipi-shadow">
<h6 class="text-center pratilipi-red">
ഡ്രാഫ്റ്റുകള്‍
</h6>
<hr/>
<div class="row text-center">
<div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
<div class="add-new-card pratilipi-shadow" on-click="_write">
<span>
<iron-icon icon="add-circle"></iron-icon>
പുതിയ രചനകള്‍ ചേര്‍ക്കൂ
</span>
</div>
</div>
<template is="dom-repeat" items="{{ pratilipiList }}" as="pratilipi">
<div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
<pratilipi-card-mini show-edit-option state="DRAFTED" pratilipi="{{ pratilipi }}"></pratilipi-card-mini>
</div>
</template>
</div>
<template is="dom-if" if="{{ isLoading }}">
<paper-spinner active></paper-spinner>
</template>
<template is="dom-if" if="{{ showMore }}">
<div class="more-button" on-click="loadMore" onclick="ga_CA( 'Pratilipi', 'LoadMoreDrafts' )">കൂടുതല്‍ കാണിക്കൂ...</div>
</template>
</div>
<iron-ajax
id="PratilipiListApi"
url="/api/pratilipi/list"
method="GET"
params='{"_apiVer": "2"}'
content-type="application/json"
handle-as="json"
on-response="_pratilipiListApiResponse"
on-error="_pratilipiListApiError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-author-drafted-contents',
properties: {
author: { type: Object },
pratilipiList: { type: Array, value: function() { return []; } },
cursor: { type: String, value: null },
showMore: { type: Boolean, value: false }
},
_write: function() {
if( isMobile() )
document.querySelector( 'pratilipi-alert' ).alert( "പ്രതിലിപിയില്‍ എഴുതാന്‍ ,താങ്കളുടെ കമ്പ്യൂട്ടറില്‍ നിന്നും malayalam.pratilipi.com എന്ന വെബ്സൈറ്റില്‍ ലോഗിന്‍ ചെയ്യുക.", false, 10 * 6000 );
else
document.querySelector( 'pratilipi-write' ).createNewPratilipi( this.author.authorId );
},
removeFromPratilipiList: function( pratilipiId ) {
var index = -1;
for( var i = 0; i < this.pratilipiList.length; i++ ) {
if( pratilipiId == this.pratilipiList[i].pratilipiId ) {
index = i;
break;
}
}
if( index != -1 ) {
this.splice( 'pratilipiList', index, 1 );
}
},
getPratilipiById: function( pratilipiId ) {
if( pratilipiId == null ) return null;
var pratilipi = null;
for( var i = 0; i < this.pratilipiList.length; i++ ) {
if( pratilipiId == this.pratilipiList[i].pratilipiId ) {
pratilipi = this.pratilipiList[i];
break;
}
}
return pratilipi;
},
addToPratilipiList: function( pratilipi ) {
this.unshift( 'pratilipiList', pratilipi );
},
processPratilipiListObject: function( pratilipiListObject ) {
var pratilipiList = pratilipiListObject.pratilipiList;
for( var i = 0; i < pratilipiList.length; i++ )
this.push( 'pratilipiList', pratilipiList[i] );
this.set( 'cursor', pratilipiListObject.cursor );
this.set( 'showMore', pratilipiList.length == 20 );
},
ready: function() {
this.loadMore();
},
loadMore: function() {
this.set( 'isLoading', true );
this.set( 'showMore', false );
this.$.PratilipiListApi.params.authorId = this.author.authorId;
this.$.PratilipiListApi.params.state = "DRAFTED";
if( this.cursor != null )
this.$.PratilipiListApi.params.cursor = this.cursor;
else
delete this.$.PratilipiListApi.params.cursor;
this.$.PratilipiListApi.generateRequest();
},
_pratilipiListApiResponse: function( response ) {
this.set( 'isLoading', false );
this.processPratilipiListObject( response.detail.response );
},
_pratilipiListApiError: function( response ) {
this.set( 'isLoading', false );
this.set( 'showMore', true );
var message = response.detail.request.xhr.response.message != null ?
response.detail.request.xhr.response.message : "എന്തോ സാങ്കേതിക പ്രശ്നം സംഭവിച്ചിരിക്കുന്നു. വീണ്ടും ശ്രമിക്കൂ";
document.querySelector( 'pratilipi-alert' ).alert( message, false );
},
publishContent: function( pratilipiId ) {
this.domHost.publishContent( pratilipiId );
},
deleteContent: function( pratilipiId ) {
this.domHost.deleteContent( pratilipiId );
},
});
</script>
</dom-module><dom-module id="pratilipi-author-published-contents">
<style>
:host {
display: block;
margin-top: 6px;
}
.secondary-500 {
padding: 12px 8px;
}
.works-number {
font-size: 14px;
}
h6 {
font-weight: 700;
}
hr {
margin-top: 0.8em;
margin-bottom: 1.2em;
border: 0;
border-top: 2px solid #eee;
}
.more-button {
margin-top: 16px;
background: #F1F8FB;
padding: 18px;
text-align: center;
color: #0C68BD;
cursor: pointer;
font-size: 14px;
font-weight: 700;
line-height: 14px;
text-shadow: 0px 1px 2px #FFFFFF;
}
paper-spinner {
margin: 16px auto;
display: block;
--paper-spinner-layer-1-color: #D0021B;
--paper-spinner-layer-2-color: #107FE5;
--paper-spinner-layer-3-color: #D0021B;
--paper-spinner-layer-4-color: #107FE5;
}
.author-no-works {
text-align: center;
padding: 16px;
display: none;
}
.author-no-works iron-icon {
margin: 16px auto;
width: 46px;
height: 46px;
}
.author-no-works h6 {
font-weight: 500;
line-height: 24px;
font-size: 15px;
}
/* Bootstrap overrides */
.row {
margin-left: -8px;
margin-right: -8px;
}
.col-xs-4, .col-sm-3, .col-md-3, .col-lg-3 {
padding-left: 8px;
padding-right: 8px;
}
</style>
<template>
<div class="secondary-500 pratilipi-shadow">
<h6 class="text-center pratilipi-red">
പ്രസിദ്ധീകരിച്ച രചനകള്‍
</h6>
<div class="works-number text-center">{{ numberFound }} കൃതികള്‍</div>
<hr/>
<div class="row text-center">
<template is="dom-repeat" items="{{ pratilipiList }}" as="pratilipi">
<div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
<pratilipi-card-mini show-edit-option state="PUBLISHED" pratilipi="{{ pratilipi }}"></pratilipi-card-mini>
</div>
</template>
</div>
<template is="dom-if" if="{{ isLoading }}">
<paper-spinner active></paper-spinner>
</template>
<template is="dom-if" if="{{ showMore }}">
<div class="more-button" on-click="loadMore" onclick="ga_CA( 'Pratilipi', 'LoadMore' )">കൂടുതല്‍ കാണിക്കൂ...</div>
</template>
<div class="author-no-works">
<iron-icon icon="icons:info-outline"></iron-icon>
<h6>ക്ഷമിക്കണം! ഈ രചയിതാവ് രചനകള് ഒന്നും തന്നെ പ്രസിദ്ധീകരിച്ചിട്ടില്ല.</h6>
</div>
</div>
<iron-ajax
id="PratilipiListApi"
url="/api/pratilipi/list"
params='{"_apiVer": "2"}'
method="GET"
content-type="application/json"
handle-as="json"
on-response="_pratilipiListApiResponse"
on-error="_pratilipiListApiError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-author-published-contents',
properties: {
author: { type: Object, observer: "_authorObserver" },
pratilipiList: { type: Array, value: function() { return []; } },
cursor: { type: String, value: null },
resultCount: { type: Number, value: 12 },
numberFound: { type: Number, observer: "_numberFoundObserver" },
showMore: { type: Boolean, value: false }
},
_authorObserver: function() {
/* Called before first rendering */
if( this.pratilipiListObject == null ) return;
/* Executed whenever author changes */
this.set( 'pratilipiList', [] );
this.set( 'cursor', null );
this.loadMore();
},
_numberFoundObserver: function() {
jQuery( this ).css( 'display', this.author.hasAccessToUpdate && this.numberFound == 0 ? 'none' : 'block' );
jQuery( this.querySelector( '.works-number' ) ).css( 'display', this.numberFound > 0 ? 'block' : 'none' );
jQuery( this.querySelector( '.author-no-works' ) ).css( 'display', this.numberFound > 0 ? 'none' : 'block' );
},
getPratilipiById: function( pratilipiId ) {
if( pratilipiId == null ) return null;
var pratilipi = null;
for( var i = 0; i < this.pratilipiList.length; i++ ) {
if( pratilipiId == this.pratilipiList[i].pratilipiId ) {
pratilipi = this.pratilipiList[i];
break;
}
}
return pratilipi;
},
removeFromPratilipiList: function( pratilipiId ) {
var index = -1;
for( var i = 0; i < this.pratilipiList.length; i++ ) {
if( pratilipiId == this.pratilipiList[i].pratilipiId ) {
index = i;
break;
}
}
if( index != -1 ) {
this.splice( 'pratilipiList', index, 1 );
this.set( 'numberFound', this.numberFound - 1 );
}
},
addToPratilipiList: function( pratilipi ) {
this.unshift( 'pratilipiList', pratilipi );
this.set( 'numberFound', this.numberFound + 1 );
},
processPratilipiListObject: function( pratilipiListObject ) {
var pratilipiList = pratilipiListObject.pratilipiList;
for( var i = 0; i < pratilipiList.length; i++ )
this.push( 'pratilipiList', pratilipiList[i] );
this.set( 'cursor', pratilipiListObject.cursor != null ? pratilipiListObject.cursor : null );
this.set( 'numberFound', pratilipiListObject.numberFound != null ? pratilipiListObject.numberFound : 0 );
this.set( 'showMore', pratilipiList.length == this.resultCount && this.pratilipiList.length < this.numberFound );
},
ready: function() {
this.loadMore();
},
loadMore: function() {
this.set( 'isLoading', true );
this.set( 'showMore', false );
this.$.PratilipiListApi.params.authorId = this.author.authorId;
this.$.PratilipiListApi.params.state = "PUBLISHED";
this.$.PratilipiListApi.params.resultCount = this.resultCount;
if( this.cursor != null )
this.$.PratilipiListApi.params.cursor = this.cursor;
else
delete this.$.PratilipiListApi.params.cursor;
this.$.PratilipiListApi.generateRequest();
},
_pratilipiListApiResponse: function( response ) {
this.set( 'isLoading', false );
this.processPratilipiListObject( response.detail.response );
},
_pratilipiListApiError: function( response ) {
this.set( 'isLoading', false );
this.set( 'showMore', true );
var message = response.detail.request.xhr.response.message != null ?
response.detail.request.xhr.response.message : "എന്തോ സാങ്കേതിക പ്രശ്നം സംഭവിച്ചിരിക്കുന്നു. വീണ്ടും ശ്രമിക്കൂ";
document.querySelector( 'pratilipi-alert' ).alert( message, false );
},
moveContentToDrafts: function( pratilipiId ) {
this.domHost.moveContentToDrafts( pratilipiId );
},
deleteContent: function( pratilipiId ) {
this.domHost.deleteContent( pratilipiId );
},
});
</script>
</dom-module><dom-module id="pratilipi-author-biography">
<style>
:host {
display: block;
margin-top: 6px;
}
.author-biography {
padding: 8px;
}
.author-biography .author-biography-header h6 {
font-weight: 700;
margin-top: 12px;
margin-bottom: 12px;
text-align: center;
}
.author-details table {
margin-left: 6px;
}
.author-details table th {
padding: 6px 32px 6px 12px;
font-size: 14px;
}
.author-details td {
font-size: 14px;
}
.author-summary-container {
font-family: inherit!important;
font-size: 14px!important;
line-height: 23px!important;
color: #333;
padding: 12px 16px;
}
.author-summary-container h6 {
font-size: 15px;
margin-top: 12px;
font-weight: bold;
}
@media only screen and (max-width: 600px) {
.author-summary-container {
text-align: left;
}
}
@media only screen and (min-width: 601px) {
.author-summary-container {
text-align: justify;
}
}
.more-button {
background: #F1F8FB;
padding: 16px;
text-align: center;
color: #0C68BD;
cursor: pointer;
font-size: 14px;
font-weight: 700;
line-height: 14px;
text-shadow: 0px 1px 2px #FFFFFF;
}
hr {
margin-top: 0.5em;
margin-bottom: 0.8em;
border: 0;
border-top: 2px solid #eee;
}
.complete-summary {
max-height: auto;
overflow: visible;
}
.reduced-summary {
max-height: 46px;
overflow: hidden;
}
</style>
<template>
<div class="secondary-500 author-biography pratilipi-shadow">
<div class="author-biography-header">
<h6 class="pratilipi-red">വിവരണം</h6>
</div>
<hr/>
<div class="author-details">
<table>
<tr>
<th>പ്രതിലിപിയില്‍</th>
<td>{{ registrationDate }}</td>
</tr>
<template is="dom-if" if="{{ hasLocation }}">
<tr>
<th>സ്ഥലം</th>
<td>{{ location }}</td>
</tr>
</template>
<template is="dom-if" if="{{ hasDateOfBirth }}">
<tr>
<th>ജനനത്തിയ്യതി</th>
<td>{{ dateOfBirth }}</td>
</tr>
</template>
</table>
<div class="author-summary-container" id="author-summary-container">
<h6>രചയിതാവിനെക്കുറിച്ച്</h6>
<div id="author-summary"></div>
</div>
<div class="more-button" id="more-button" on-click="toggleSnippet" onclick="ga_CA( 'Author', 'LoadMore' )">കൂടുതല്‍ കാണിക്കൂ...</div>
</div>
</div>
</template>
<script>
Polymer({
is: 'pratilipi-author-biography',
properties: {
author: { type: Object, observer: "_authorObserver" },
summary: { type: String, observer: "_summaryObserver" }
},
_authorObserver: function() {
this.set( 'summary', this.author == null ? null : this.author.summary );
this.set( 'registrationDate', this.author == null ? null : convertDate( this.author.registrationDateMillis ) );
this.set( 'hasLocation', this.author.location != null );
this.set( 'location', this.author.location );
this.set( 'hasDateOfBirth', this.author.dateOfBirth != null );
this.set( 'dateOfBirth', this.author.dateOfBirth == null ? null : convertDate( this.author.dateOfBirth ) );
},
attached: function() {
this._summaryObserver();
},
_summaryObserver: function() {
if( this.summary == null || this.summary.trim() == "" ) {
jQuery( this.querySelector( '.author-summary-container' ) ).css( 'display', 'none' );
jQuery( this.querySelector( '.more-button' ) ).css( 'display', 'none' );
return;
}
jQuery( this.querySelector( '.author-summary-container' ) ).css( 'display', 'block' );
/* Called before DOM is attached */
if( document.getElementById( "author-summary" ) == null )
return;
var author_summary = document.getElementById( "author-summary" );
jQuery( author_summary ).html( this.summary.replace(/\n/g, "<br />") );
// Calculating summary height
var height = 0;
var clone = author_summary.cloneNode( true );
clone.style.position = "absolute";
clone.style.top = "-1000px";
clone.style.width = ( jQuery( 'pratilipi-author-tabs' ).width() - 32 ) + "px"; /* 32px for padding */
document.body.appendChild( clone );
height = clone.clientHeight;
document.body.removeChild( clone );
if( height < 92 ) {
jQuery( this.querySelector( '#author-summary' ) ).removeClass( 'complete-summary' );
jQuery( this.querySelector( '#author-summary' ) ).removeClass( 'reduced-summary' );
jQuery( this.querySelector( '#more-button' ) ).css( 'display', 'none' );
} else {
jQuery( this.querySelector( '#author-summary' ) ).addClass( 'reduced-summary' );
jQuery( this.querySelector( '#author-summary' ) ).removeClass( 'complete-summary' );
jQuery( this.querySelector( '#more-button' ) ).css( 'display', 'block' );
}
},
toggleSnippet: function() {
jQuery( this.querySelector( '#author-summary' ) ).toggleClass( 'reduced-summary' );
jQuery( this.querySelector( '#author-summary' ) ).toggleClass( 'complete-summary' );
jQuery( this.querySelector( '#more-button' ) ).css( 'display', 'none' );
}
});
</script>
</dom-module><dom-module id="pratilipi-author-following">
<template>
<template is="dom-if" if="{{ !noDisplay }}">
<pratilipi-follow-author-grid
follow-list="{{ followList }}"
number-found="{{ numberFound }}"
title="ഇദ്ദേഹം ഫോളോ ചെയ്യുന്നത്"
empty-list="{{ emptyList }}"
empty-list-message="ക്ഷമിക്കണം, ഈ രചയിതാവ് ആരെയും ഫോളോ ചെയ്യുന്നില്ല"
show-modal-button="{{ showModalButton }}"
is-loading="[[ isLoading ]]"
is-finished="{{ isFinished }}"></pratilipi-follow-author-grid>
</template>
<iron-ajax
id="UserAuthorFollowListApi"
url="/api/userauthor/follow/list"
method="GET"
content-type="application/json"
handle-as="json"
on-response="_userAuthorFollowListApiResponse"
on-error="_userAuthorFollowListApiError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-author-following',
properties: {
author: { type: Object, observer: "_authorObserver" },
userId: { type: String },
authorList: { type: Object },
followList: { type: Array, value: function() { return []; } },
cursor: { type: String },
numberFound: { type: Number },
resultCount: { type: Number, value: 20 },
isLoading: { type: Boolean, value: false },
isFinished: { type: Boolean, value: false },
emptyList: { type: Boolean, value: true },
noDisplay: { type: Boolean, value: false }
},
_authorObserver: function() {
/* numberFound will be null only before dom-ready is called */
if( this.numberFound == null ) return;
this.resetList();
},
processAuthorListObject: function( authorListObject ) {
var followList = [];
var authorList = authorListObject.authorList != null ? authorListObject.authorList : [];
for( var i = 0; i < authorList.length; i++ ) {
var author = authorList[i];
var follow = {
authorId: author.authorId,
name: author.name,
pageUrl: author.pageUrl,
followCount: author.followCount,
imageUrl: author.imageUrl,
following: author.following,
canFollow: author.user.userId != document.querySelector( 'pratilipi-user' ).getCurrentUser().userId
};
followList.push( follow );
}
return { followList: followList,
cursor: authorListObject.cursor,
numberFound: authorListObject.numberFound != null ? authorListObject.numberFound : 0 };
},
_pushToFollowList: function( followListObject ) {
var followList = followListObject.followList;
for( var i = 0; i < followList.length; i++ )
this.push( 'followList', followList[i] );
this.set( 'cursor', followListObject.cursor );
this.set( 'numberFound', followListObject.numberFound );
this.set( 'isFinished', followListObject.cursor == null || followList.length < this.resultCount );
this.set( "emptyList", followListObject.numberFound == 0 );
this.set( "showModalButton", followListObject.numberFound > 4 );
},
attached: function() {
this.loadMore();
},
resetList: function() {
this.set( 'followList', [] );
this.set( 'cursor', null );
this.set( 'numberFound', 0 );
this.set( 'isFinished', false );
this.loadMore();
},
loadMore: function() {
this.set( 'isLoading', true );
this.$.UserAuthorFollowListApi.params.userId = this.userId;
if( this.cursor != null )
this.$.UserAuthorFollowListApi.params.cursor = this.cursor;
else
delete this.$.UserAuthorFollowListApi.params.cursor;
this.$.UserAuthorFollowListApi.params.resultCount = this.resultCount;
this.$.UserAuthorFollowListApi.generateRequest();
},
_userAuthorFollowListApiResponse: function( response ) {
this.set( 'isLoading', false );
this._pushToFollowList( this.processAuthorListObject( response.detail.response ) );
},
_userAuthorFollowListApiError: function( response ) {
this.set( 'isLoading', false );
}
});
</script>
</dom-module><dom-module id="pratilipi-author-followers">
<template>
<template is="dom-if" if="{{ !noDisplay }}">
<pratilipi-follow-author-grid
follow-list="{{ followList }}"
number-found="{{ numberFound }}"
title="ഫോളോവേഴ്സ്"
empty-list="{{ emptyList }}"
empty-list-message="ക്ഷമിക്കണം, ഈ രചയിതാവിന് ഫോളോവേര്‍സ് ഒന്നും ഇല്ല"
show-modal-button="{{ showModalButton }}"
is-loading="[[ isLoading ]]"
is-finished="{{ isFinished }}"></pratilipi-follow-author-grid>
</template>
<iron-ajax
id="UserAuthorFollowListApi"
url="/api/userauthor/follow/list"
method="GET"
content-type="application/json"
handle-as="json"
on-response="_userAuthorFollowListApiResponse"
on-error="_userAuthorFollowListApiError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-author-followers',
properties: {
author: { type: Object, observer: "_authorObserver" },
authorId: { type: String },
userList: { type: Object },
followList: { type: Array, value: function() { return []; } },
cursor: { type: String },
numberFound: { type: Number },
resultCount: { type: Number, value: 20 },
isLoading: { type: Boolean, value: false },
isFinished: { type: Boolean, value: false },
emptyList: { type: Boolean, value: true },
noDisplay: { type: Boolean, value: false }
},
_authorObserver: function() {
/* numberFound will be null only before dom-ready is called */
if( this.numberFound == null ) return;
this.resetList();
},
processUserListObject: function( userListObject ) {
var followList = [];
var userList = userListObject.userList != null ? userListObject.userList : [];
for( var i = 0; i < userList.length; i++ ) {
var user = userList[i];
var follow = {
authorId: user.author.authorId,
name: user.author.name,
pageUrl: user.profilePageUrl,
followCount: user.author.followCount,
imageUrl: user.profileImageUrl,
following: user.author.following,
canFollow: user.userId != document.querySelector( 'pratilipi-user' ).getCurrentUser().userId
};
followList.push( follow );
}
return { followList: followList,
cursor: userListObject.cursor,
numberFound: userListObject.numberFound != null ? userListObject.numberFound : 0 };
},
_pushToFollowList: function( followListObject ) {
var followList = followListObject.followList;
for( var i = 0; i < followList.length; i++ )
this.push( 'followList', followList[i] );
this.set( 'cursor', followListObject.cursor );
this.set( 'numberFound', followListObject.numberFound );
this.set( 'isFinished', followListObject.cursor == null || followList.length < this.resultCount );
this.set( "emptyList", followListObject.numberFound == 0 );
this.set( "showModalButton", followListObject.numberFound > 4 );
},
attached: function() {
this.loadMore();
},
resetList: function() {
this.set( 'followList', [] );
this.set( 'cursor', null );
this.set( 'numberFound', 0 );
this.set( 'isFinished', false );
this.loadMore();
},
loadMore: function() {
this.set( 'isLoading', true );
this.$.UserAuthorFollowListApi.params.authorId = this.authorId;
if( this.cursor != null )
this.$.UserAuthorFollowListApi.params.cursor = this.cursor;
else
delete this.$.UserAuthorFollowListApi.params.cursor;
this.$.UserAuthorFollowListApi.params.resultCount = this.resultCount;
this.$.UserAuthorFollowListApi.generateRequest();
},
_userAuthorFollowListApiResponse: function( response ) {
this.set( 'isLoading', false );
this._pushToFollowList( this.processUserListObject( response.detail.response ) );
},
_userAuthorFollowListApiError: function( response ) {
this.set( 'isLoading', false );
}
});
</script>
</dom-module>
<dom-module id="pratilipi-author-tabs">
<style>
:host {
display: block;
margin-bottom: 12px;
}
.nav-tabs>li>a {
font-size: 14px;
line-height: 32px;
border: none;
color: #333;
letter-spacing: 0;
}
.nav-tabs, .nav-tabs>li>a:hover {
border-bottom: none;
border-top: none;
border-left: none;
border-right: none;
background: none;
}
.nav-tabs>li.active>a, .nav-tabs>li.active>a:focus, .nav-tabs>li.active>a:hover {
border-bottom: 3px solid #D0021B;
border-top: none;
border-left: none;
border-right: none;
background: none;
font-weight: 700;
}
.fade {
opacity: 0;
-webkit-transition: opacity 0.05s linear;
-moz-transition: opacity 0.05s linear;
-o-transition: opacity 0.05s linear;
transition: opacity 0.05s linear;
}
.fade.in {
opacity: 1;
-webkit-transition: opacity 0.05s linear;
-moz-transition: opacity 0.05s linear;
-o-transition: opacity 0.05s linear;
transition: opacity 0.05s linear;
}
</style>
<template>
<div class="secondary-500 pratilipi-shadow">
<ul class="nav nav-tabs" role="tablist">
<li id="author-activity-tab" style="width: 50%;" role="presentation" class="active"> <a href="#author-activity" class="text-center" aria-controls="author-activity" role="tab" data-toggle="tab">ആക്റ്റിവിറ്റീസ്</a> </li>
<li id="author-about-tab" style="width: 50%;" role="presentation"> <a href="#author-about" class="text-center" aria-controls="author-about" role="tab" data-toggle="tab">രചയിതാവിനെക്കുറിച്ച്</a> </li>
</ul>
</div>
<div class="tab-content">
<div role="tabpanel" class="tab-pane fade in active" id="author-activity">
<template is="dom-if" if="{{ hasAccessToUpdate }}">
<pratilipi-author-drafted-contents
author="[[ author ]]"></pratilipi-author-drafted-contents>
</template>
<pratilipi-author-published-contents
author="[[ author ]]"></pratilipi-author-published-contents>
</div>
<div role="tabpanel" class="tab-pane fade" id="author-about">
<pratilipi-author-biography author="[[ author ]]"></pratilipi-author-biography>
<template is="dom-if" if="{{ hasUserId }}">
<pratilipi-author-following author="[[ author ]]" user-id="{{ userId }}"></pratilipi-author-following>
</template>
<pratilipi-author-followers author="[[ author ]]" author-id="{{ authorId }}"></pratilipi-author-followers>
</div>
</div>
<iron-ajax
id="PratilipiApi"
url="/api/pratilipi?_apiVer=2"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_pratilipiApiResponse"
on-error="_pratilipiApiError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-author-tabs',
properties: {
author: { type: Object, observer: "_authorObserver" },
},
_authorObserver: function() {
this.set( 'hasAccessToUpdate', this.author.hasAccessToUpdate );
this.set( 'hasUserId', this.author.user != null && this.author.user.userId != null );
this.set( 'userId', this.author.user ? this.author.user.userId : null );
this.set( 'authorId', this.author.authorId );
},
moveContentToDrafts: function( pratilipiId ) {
var pratilipi = this.querySelector( 'pratilipi-author-published-contents' ).getPratilipiById( pratilipiId );
this.querySelector( 'pratilipi-author-published-contents' ).removeFromPratilipiList( pratilipiId );
this.querySelector( 'pratilipi-author-drafted-contents' ).addToPratilipiList( pratilipi );
this._pratilipiApiPostCall( pratilipiId, "DRAFTED" );
},
publishContent: function( pratilipiId ) {
var pratilipi = this.querySelector( 'pratilipi-author-drafted-contents' ).getPratilipiById( pratilipiId );
this.querySelector( 'pratilipi-author-drafted-contents' ).removeFromPratilipiList( pratilipiId );
this.querySelector( 'pratilipi-author-published-contents' ).addToPratilipiList( pratilipi );
this._pratilipiApiPostCall( pratilipiId, "PUBLISHED" );
},
deleteContent: function( pratilipiId ) {
this._pratilipiApiPostCall( pratilipiId, "DELETED" );
},
_pratilipiApiPostCall: function( pratilipiId, state ) {
this.$.PratilipiApi.body = jQuery.param( { "pratilipiId": pratilipiId, "state": state } );
this.$.PratilipiApi.generateRequest();
},
_pratilipiApiResponse: function( response ) {
var pratilipi = response.detail.response;
if( pratilipi.state == "DELETED" ) {
document.querySelector( 'pratilipi-alert' ).alert( "നീക്കം ചെയ്തിരിക്കുന്നു" );
window.location.reload();
}
},
_pratilipiApiError: function( response ) {
document.querySelector( 'pratilipi-alert' ).alert( response != null && response.detail.request.xhr.response.message != null ?
response.detail.request.xhr.response.message : "എന്തോ സാങ്കേതിക പ്രശ്നം സംഭവിച്ചിരിക്കുന്നു. വീണ്ടും ശ്രമിക്കൂ", false );
this.async( function() { window.location.reload(); }, 2000 );
},
switchTabs: function() {
if( jQuery( ".nav-tabs li.active" ).attr( 'id' ) == "author-activity-tab" ) {
jQuery( '.nav-tabs a[href="#author-about"]' ).tab( 'show' );
} else if( jQuery( ".nav-tabs li.active" ).attr( 'id' ) == "author-about-tab" ) {
jQuery( '.nav-tabs a[href="#author-activity"]' ).tab( 'show' );
}
}
});
</script>
</dom-module><dom-module id="pratilipi-author-settings">
<style>
:host {
display: block;
}
.pratilipi-logo {
width: 64px;
height: 64px;
display: block;
margin: auto;
}
textarea {
display: block;
width: 100%;
}
paper-dropdown-menu {
width: 100%;
--paper-dropdown-menu-focus-color: #107FE5;
--paper-dropdown-menu-input-color: #333;
--paper-input-container-input: {
font-family: inherit;
};
--paper-input-container-underline: {
background: #107FE5;
};
--paper-input-container-label: {
font-size: 15px;
font-family: inherit;
text-align: left;
color: #107FE5;
};
}
paper-menu {
--paper-menu-color: #333;
width: 100%;
--paper-menu-focused-item: {
color: #107FE5;
};
}
paper-menu paper-item {
font-size: 15px;
font-family: inherit;
color: #333;
white-space: nowrap;
}
.modal-fullscreen .modal-dialog .modal-content {max-width: 768px;padding-top:5px;}
</style>
<template>
<div class="modal modal-fullscreen fade" id="pratilipiAuthorSettings" role="dialog" tabindex="-1">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-fullscreen-close-button">
<paper-icon-button noink icon="close" data-dismiss="modal"></paper-icon-button>
</div>
<iron-image class="pratilipi-logo"
style="background-color: #f5f5f5"
fade preload
sizing="cover"
src="http://public.pratilipi.com/pratilipi-logo/png/Logo-2C-RGB-80px.png"
alt="പ്രതിലിപി"
title="പ്രതിലിപി"></iron-image>
<h6 class="text-center">{{ author.fullName }}</h6>
<div class="row">
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<pratilipi-input icon="social:person" label="പേര് (മലയാളത്തില്‍)" value="{{ firstName::input }}"></pratilipi-input>
</div>
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<pratilipi-input label="" value="{{ lastName::input }}"></pratilipi-input>
</div>
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<pratilipi-input icon="social:person-outline" label="പേര് (ഇംഗ്ലീഷില്‍))" value="{{ firstNameEn::input }}"></pratilipi-input>
</div>
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<pratilipi-input label="" value="{{ lastNameEn::input }}"></pratilipi-input>
</div>
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<pratilipi-input icon="editor:format-quote" label="തൂലികാനാമം (മലയാളത്തില്‍)" value="{{ penName::input }}"></pratilipi-input>
</div>
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<pratilipi-input label="തൂലികാനാമം (ഇംഗ്ലീഷില്‍)" value="{{ penNameEn::input }}"></pratilipi-input>
</div>
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<paper-dropdown-menu id="authorGender" no-animations noink label="ലിംഗം">
<paper-menu noink selected="[[ selectedGender ]]" class="dropdown-content" style="white-space: nowrap; width: auto;">
<paper-item value="MALE">പുരുഷന്‍</paper-item>
<paper-item value="FEMALE">സ്ത്രീ</paper-item>
<paper-item value="OTHER">മറ്റുള്ളവ</paper-item>
</paper-menu>
</paper-dropdown-menu>
</div>
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<pratilipi-input icon="social:location-city" label="സ്ഥലം" value="{{ location::input }}"></pratilipi-input>
</div>
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<pratilipi-input type="date" icon="icons:date-range" label="ജനനത്തിയതി (mm-dd-yy)" always-float-label value="{{ dateOfBirth::input }}"></pratilipi-input>
</div>
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<paper-dropdown-menu id="authorLanguage" no-animations noink label="ഭാഷ തിരഞ്ഞെടുക്കൂ">
<paper-menu noink selected="[[ selectedLanguage ]]" class="dropdown-content" style="white-space: nowrap; width: auto;">
<paper-item value="BENGALI">ബംഗാളി</paper-item>
<paper-item value="GUJARATI">ഗുജറാത്തി</paper-item>
<paper-item value="HINDI">ഹിന്ദി</paper-item>
<paper-item value="MALAYALAM">മലയാളം</paper-item>
<paper-item value="MARATHI">മറാഠി</paper-item>
<paper-item value="TAMIL">തമിഴ്</paper-item>
<paper-item value="TELUGU">തെലുഗു</paper-item>
<paper-item value="KANNADA">കന്നഡ</paper-item>
</paper-menu>
</paper-dropdown-menu>
</div>
<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
<div style="margin-top: 25px; margin-bottom: 5px; text-align: left;"><span class="pratilipi-blue" style="font-size: 14px;">സംഗ്രഹം (നിര്‍ബന്ധമില്ല)</span></div>
<textarea rows="10" value="{{ summary::input }}"></textarea>
</div>
</div>
</div>
</div>
<div class="modal-footer">
<div class="display-message-div"><p>{{ message }}</p></div>
<button id="authorSaveChangesButton" style="position: fixed; bottom: 15px; right: 15px;" class="pratilipi-dark-blue-button" type="button" on-click="onSubmit">മാറ്റങ്ങള്‍ സേവ് ചെയ്യുക</button>
</div>
</div>
<iron-ajax
id="AuthorApi"
url="/api/author"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_authorApiResponse"
on-error="_authorApiError"
></iron-ajax>
</template>
<script>
function updateObject( o1, o2 ) {
if( o2 == null || typeof(o2) != 'object' ) return o2;
for( var key in o2 ) {
if( o1[key] == null ) o1[key] = new o2[key].constructor()
o1[key] = updateObject( o1[key], o2[key] );
}
return o1;
}
Polymer({
is: 'pratilipi-author-settings',
properties: {
author: { type: Object },
user: { type: Object },
// Specific to input fields
authorId: { type: String },
firstName: { type: String },
lastName: { type: String },
penName: { type: String },
firstNameEn: { type: String },
lastNameEn: { type: String },
penNameEn: { type: String },
gender: { type: String },
dateOfBirth: { type: String },
language: { type: String },
location: { type: String },
summary: { type: String },
// Specific to the modal
selectedLanguage: { type: Number },
selectedGender: { type: Number },
message: { type: String }
},
_processDateOfBirth: function( input ) {
var datePart = input.match(/\d+/g);
if( parseInt( datePart[0] ) < 1800 ) return input;
var year = datePart[0], month = datePart[1], day = datePart[2];
return day+'-'+month+'-'+year;
},
_setDateProcess: function( input ) {
var date = input.split( "-" );
if( date[2] > 1800 ) return date[2] + "-" + date[1] + "-" + date[0];
return input;
},
process: function( author ) {
this.set( 'message', null );
this.set( 'authorId', author.authorId );
this.set( 'firstName', author.firstName );
this.set( 'lastName', author.lastName );
this.set( 'penName', author.penName );
this.set( 'firstNameEn', author.firstNameEn );
this.set( 'lastNameEn', author.lastNameEn );
this.set( 'penNameEn', author.penNameEn );
this.set( 'dateOfBirth', author.dateOfBirth == null ? null : this._setDateProcess( author.dateOfBirth ) );
this.set( 'location', author.location );
this.set( 'summary', author.summary );
// paper-dropdown-menu for language
this.set( 'language', author.language );
this.set( 'selectedLanguage', null );
if( this.language == "BENGALI" )
this.set( 'selectedLanguage', 0 );
else if( this.language == "GUJARATI" )
this.set( 'selectedLanguage', 1 );
else if( this.language == "HINDI" )
this.set( 'selectedLanguage', 2 );
else if( this.language == "MALAYALAM" )
this.set( 'selectedLanguage', 3 );
else if( this.language == "MARATHI" )
this.set( 'selectedLanguage', 4 );
else if( this.language == "TAMIL" )
this.set( 'selectedLanguage', 5 );
else if( this.language == "TELUGU" )
this.set( 'selectedLanguage', 6 );
else if( this.language == "KANNADA" )
this.set( 'selectedLanguage', 7 );
// paper-dropdown-menu for language
this.set( 'gender', author.gender == null ? null : author.gender.toUpperCase() );
this.set( 'selectedGender', null );
if( this.gender == "MALE" )
this.set( 'selectedGender', 0 );
else if( this.gender == "FEMALE" )
this.set( 'selectedGender', 1 );
else if( this.gender == "OTHER" )
this.set( 'selectedGender', 2 );
},
editAuthor: function() {
this.process( this.author );
this.async( function() {
jQuery( "#pratilipiAuthorSettings" ).modal();
});
},
close: function() {
jQuery( "#pratilipiAuthorSettings" ).modal( 'hide' );
},
onSubmit: function( event ) {
/* Mandatory fields */
if( ( this.firstName == null || this.firstName.trim() == "" )
&& ( this.firstNameEn == null || this.firstNameEn.trim() == "" ) ) {
this.message = "താങ്കളുടെ പേര് എഴുതൂ";
return;
}
if( this.$.authorLanguage.selectedItem == null ) {
this.message = "താങ്കളുടെ ഭാഷ ചേര്‍ക്കൂ";
return;
}
this.message = "പ്രവര്‍ത്തിച്ചുകൊണ്ടിരിക്കുന്നു. . .";
jQuery( '#authorSaveChangesButton' ).prop( 'disabled', true );
this.language = this.$.authorLanguage.selectedItem.getAttribute( "value" );
if( this.$.authorGender.selectedItem )
this.gender = this.$.authorGender.selectedItem.getAttribute( "value" );
var body = {
authorId: this.authorId,
language: this.language,
summary: this.summary
};
if( this.firstName != null ) body.firstName = this.firstName;
if( this.lastName != null ) body.lastName = this.lastName;
if( this.penName != null ) body.penName = this.penName;
if( this.firstNameEn != null ) body.firstNameEn = this.firstNameEn;
if( this.lastNameEn != null ) body.lastNameEn = this.lastNameEn;
if( this.penNameEn != null ) body.penNameEn = this.penNameEn;
if( this.gender != null ) body.gender = this.gender;
if( this.dateOfBirth != null ) body.dateOfBirth = this._processDateOfBirth( this.dateOfBirth );
if( this.location != null ) body.location = this.location;
this.$.AuthorApi.body = jQuery.param( body );
this.$.AuthorApi.generateRequest();
},
_authorApiResponse: function( event ) {
this.message = "വിജയകരമായി പൂര്‍ത്തീകരിച്ചിരിക്കുന്നു !";
jQuery( '#authorSaveChangesButton' ).prop( 'disabled', false );
var author = event.detail.response;
author.user = this.author.user;
this.domHost.updateAuthor( author );
this.async( function() {
this.message = null;
this.close();
}, 1000 );
},
_authorApiError: function( event ) {
jQuery( '#authorSaveChangesButton' ).prop( 'disabled', false );
this.message = event.detail.request.xhr.response.message != null ?
event.detail.request.xhr.response.message : "എന്തോ സാങ്കേതിക പ്രശ്നം സംഭവിച്ചിരിക്കുന്നു. വീണ്ടും ശ്രമിക്കൂ";
}
});
</script>
</dom-module>
<dom-module id="pratilipi-author-page">
<style>
:host {
display: block;
}
</style>
<template>
<pratilipi-user user='{{ user }}' user-data="[[ userData ]]"></pratilipi-user>
<pratilipi-edit-account show-logout-button user='[[ user ]]'></pratilipi-edit-account>
<pratilipi-write language-map="[[ languageMap ]]" pratilipi-types='[[ pratilipiTypes ]]'></pratilipi-write>
<pratilipi-alert></pratilipi-alert>
<div class="header-pos">
<pratilipi-android-launch-test></pratilipi-android-launch-test> </div>
<main>
<pratilipi-header language-map="[[ languageMap ]]" user='[[ user ]]'></pratilipi-header>
<div class="parent-container margin-top-bottom">
<div class="container">
<pratilipi-navigation
class='pull-left hidden-xs hidden-sm'
navigation-list='[[ navigationList ]]'
></pratilipi-navigation>
<pratilipi-navigation-drawer with-backdrop navigation-list='[[ navigationList ]]'></pratilipi-navigation-drawer>
<div style="overflow:hidden; padding: 0 2px;">
<div id="androidLaunchBottom">
<pratilipi-author-details
author='[[ author ]]'
user-author='[[ userAuthor ]]'></pratilipi-author-details>
<pratilipi-author-tabs
user="[[ user ]]"
author="[[ author ]]"></pratilipi-author-tabs>
<pratilipi-author-settings author="[[ author ]]" user="[[ user ]]"></pratilipi-author-settings>
</div>
</div>
</div>
</div>
</main>
<footer>
<pratilipi-footer></pratilipi-footer>
</footer>
<div class="scroll-top-button">
<a id="scrollToTop" on-click="scrollToTop"><paper-fab mini noink style="background: #c0c0c0;" icon="icons:arrow-upward"></paper-fab></a>
</div>
<iron-ajax
id="AuthorGetApi"
url="/api/author"
method="GET"
content-type="application/json"
handle-as="json"
on-response="_authorGetApiResponse"
></iron-ajax>
<iron-ajax
id="UserAuthorGetApi"
url="/api/userauthor/follow"
method="GET"
content-type="application/json"
handle-as="json"
on-response="_userAuthorGetApiResponse"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-author-page',
properties: {
userData: { type: Object },
user: { type: Object, observer: "_userObserver" },
author: { type: Object },
userAuthor: { type: Object },
loadUser: { type: Boolean, value: false },
pratilipiTypes: { types: Object },
navigationList: { type: Array },
languageMap: { type: Object },
lastScrollTop: { type: Number, value: 0 }
},
_userObserver: function() {
if( ! this.loadUser ) {
this.loadUser = true;
return;
}
this.getAuthor();
this.getUserAuthor();
},
getAuthor: function() {
if( this.author == null ) return;
this.$.AuthorGetApi.params.authorId = this.author.authorId;
this.$.AuthorGetApi.generateRequest();
},
getUserAuthor: function() {
if( this.author == null ) return;
this.$.UserAuthorGetApi.params.authorId = this.author.authorId;
this.$.UserAuthorGetApi.generateRequest();
},
updateAuthor: function( author ) {
this.set( 'author', author );
},
updateUserAuthor: function( userAuthor ) {
this.set( 'userAuthor', userAuthor );
},
_authorGetApiResponse: function( response ) {
this.updateAuthor( response.detail.response );
},
_userAuthorGetApiResponse: function( response ) {
this.updateUserAuthor( response.detail.response );
},
editAuthorProfile: function() {
this.querySelector( 'pratilipi-author-settings' ).editAuthor();
},
ready: function() {
jQuery( '#scrollToTop' ).css( "display", "none" );
},
scrollToTop: function() {
$( 'html, body' ).animate( { scrollTop : 0 },800 );
},
scrollHandler: function( st ) {
if( st > this.lastScrollTop || st < 100 )
jQuery( '#scrollToTop' ).fadeOut();
else
jQuery( '#scrollToTop' ).fadeIn();
this.lastScrollTop = st;
}
});
</script>
</dom-module><dom-module id="pratilipi-list-page">
<template>
<pratilipi-user user='{{ user }}' user-data="[[ userData ]]"></pratilipi-user>
<pratilipi-write language-map="[[ languageMap ]]" pratilipi-types='[[ pratilipiTypes ]]'></pratilipi-write>
<pratilipi-alert></pratilipi-alert>
<div class="header-pos">
<pratilipi-android-launch-test></pratilipi-android-launch-test> </div>
<main>
<pratilipi-header language-map="[[ languageMap ]]" user='[[ user ]]' query='[[ searchQuery ]]'></pratilipi-header>
<div class="parent-container margin-top-bottom">
<div class="container">
<pratilipi-navigation
class='pull-left hidden-xs hidden-sm'
navigation-list='[[ navigationList ]]'
></pratilipi-navigation>
<!-- Navigation & Search bar for extra-small & small screens. -->
<pratilipi-navigation-drawer with-backdrop navigation-list='[[ navigationList ]]'></pratilipi-navigation-drawer>
<div style="overflow: hidden; padding: 0 2px;">
<div id="androidLaunchBottom">
<pratilipi-card-grid
heading='[[ heading ]]'
search-query='[[ searchQuery ]]'
pratilipi-list='[[ pratilipiList ]]'
filter='[[ filter ]]'
cursor='[[ cursor ]]'
></pratilipi-card-grid>
<br class="pratilipi-break"/>
</div>
</div>
</div>
</div>
</main>
<footer>
<pratilipi-footer></pratilipi-footer>
</footer>
<div class="scroll-top-button">
<a id="scrollToTop" on-click="scrollToTop"><paper-fab mini noink style="background: #c0c0c0;" icon="icons:arrow-upward"></paper-fab></a>
</div>
</template>
<script>
Polymer({
is: 'pratilipi-list-page',
properties: {
userData: { type: Object },
heading: { type: String },
pratilipiList: { type: Array },
navigationList: { type: Array },
pratilipiTypes: { types: Object },
searchQuery: { type: String },
filter: { type: Object },
cursor: { type: String },
languageMap: { type: Object },
lastScrollTop: { type: Number, value: 0 },
},
scrollToTop: function() {
$( 'html, body' ).animate( { scrollTop : 0 },800 );
},
ready: function() {
jQuery( '#scrollToTop' ).css( "display", "none" );
},
scrollHandler: function( st ) {
if( st > this.lastScrollTop || st < 100 ) {
jQuery( '#scrollToTop' ).fadeOut();
this.querySelector( 'pratilipi-card-grid' ).loadMore( st );
}
else {
jQuery( '#scrollToTop' ).fadeIn();
}
this.lastScrollTop = st;
}
});
</script>
</dom-module><dom-module id="pratilipi-reader-header">
<style>
paper-card {
height: 54px;
width: 100%;
opacity: 0.96;
padding: 4px 12px;
--paper-card-header: { display: none };
}
.container, .container div {
display: inline-block;
}
paper-icon-button {
width: 45px;
height: 45px;
}
paper-item {
font-size: 12px;
font-family: inherit;
}
.dropdown-menu {
margin-top: 13px;
min-width: 210px;
}
.open paper-icon-button:after {
top: 34px;
left: 50%;
border: solid transparent;
content: " ";
height: 0;
width: 0;
position: absolute;
pointer-events: none;
border-color: rgba(194, 225, 245, 0);
border-bottom-color: #d3d3d3;
border-width: 8px;
margin-left: -8px;
}
paper-icon-button {
color: #333;
}
.social-share .icon {
float: left;
margin-right: 4px;
}
paper-fab.reading-mode {
display: inline-block;
width: 30px;
height: 30px;
padding: 2px;
margin-top: 6px;
margin-right: 8px;
--paper-fab-iron-icon: {
width: 20px;
height: 20px;
}
}
</style>
<template>
<paper-card id="reader-header">
<table style="min-width: 100%;">
<tr>
<td align="left">
<!-- Back Button -->
<paper-icon-button noink icon="icons:arrow-back" on-click="exitReader"></paper-icon-button>
<!-- Pratilipi Logo -->
<!-- <img style="max-width: 48px; position: relative;" title="പ്രതിലിപി" alt="പ്രതിലിപി" src="http://public.pratilipi.com/pratilipi-logo/png/Logo-2C-RGB-80px.png" /> -->
<!-- Index Button if content has Index -->
<template is="dom-if" if="{{ !hideIndexButton }}">
<div class="dropdown" style="display: inline-block;">
<paper-icon-button icon="icons:list" data-toggle="dropdown"></paper-icon-button>
<ul id="navigationdropdown"
class="dropdown-menu"
style="overflow-y: scroll; left: -56px;">
<template is="dom-repeat" items="{{ index }}" as="entry">
<li>
<a style="padding: 5px; margin: 0; white-space: normal;" on-click="_entryClicked">
<pratilipi-reader-navigation-entry
entry="{{ entry }}"
page-no="{{ pageNo }}"></pratilipi-reader-navigation-entry>
</a>
</li>
</template>
</ul>
</div>
</template>
</td>
<td align="right">
<!-- Increase and Decrease size buttons -->
<!-- In case of PRATILIPI contentType -->
<template is="dom-if" if="{{ pratilipiContentType }}">
<div class="dropdown" style="display: inline-block;">
<paper-icon-button noink icon="editor:format-size" data-toggle="dropdown"></paper-icon-button>
<ul class="dropdown-menu pull-right" style="right: -147px;">
<li>
<a style="padding: 5px; margin: 0;">
<paper-item on-click="increaseFontSize">
<paper-icon-item><iron-icon icon="icons:add"></iron-icon></paper-icon-item>
&nbsp;&nbsp;
<paper-item-body>അക്ഷരങ്ങളുടെ വലിപ്പം കൂട്ടൂ</paper-item-body>
</paper-item>
</a>
</li>
<li>
<a style="padding: 5px; margin: 0;">
<paper-item on-click="decreaseFontSize">
<paper-icon-item><iron-icon icon="icons:remove"></iron-icon></paper-icon-item>
&nbsp;&nbsp;
<paper-item-body>അക്ഷരങ്ങളുടെ വലിപ്പം കുറയ്ക്കൂ</paper-item-body>
</paper-item>
</a>
</li>
<li>
<a style="padding: 5px; margin: 0;">
<paper-item style="padding: 8px;">
<paper-item-body>
<div style="font-size: 13px;">ബാക്ക്ഗ്രൗണ്ട്</div>
<div class="text-center">
<paper-fab mini noink
class="reading-mode"
style="background-color: #FFF; color: #333;"
icon="editor:format-color-text"
on-click="normalReadingMode"></paper-fab>
<paper-fab mini noink
class="reading-mode"
style="background-color: #222; color: #FFF;"
icon="editor:format-color-text"
on-click="nightReadingMode"></paper-fab>
<paper-fab mini noink
class="reading-mode"
style="background-color: #F4ECD8; color: #181715;"
icon="editor:format-color-text"
on-click="sepiaReadingMode"></paper-fab>
</div>
</paper-item-body>
</paper-item>
</a>
</li>
</ul>
</div>
</template>
<!-- In case of IMAGE contentType -->
<template is="dom-if" if="{{ imageContentType }}">
<div class="dropdown" style="display: inline-block;">
<paper-icon-button noink icon="icons:aspect-ratio" data-toggle="dropdown"></paper-icon-button>
<ul class="dropdown-menu pull-right" style="right: -147px;">
<li>
<a style="padding: 5px; margin: 0;">
<paper-item on-click="increaseImageSize">
<paper-icon-item><iron-icon icon="icons:add"></iron-icon></paper-icon-item>
&nbsp;&nbsp;
<paper-item-body>ചിത്രത്തിന്റെ വലിപ്പം കൂട്ടൂ</paper-item-body>
</paper-item>
</a>
</li>
<li>
<a style="padding: 5px; margin: 0;">
<paper-item on-click="decreaseImageSize">
<paper-icon-item><iron-icon icon="icons:remove"></iron-icon></paper-icon-item>
&nbsp;&nbsp;
<paper-item-body>ചിത്രത്തിന്റെ വലിപ്പം കുറയ്ക്കൂ</paper-item-body>
</paper-item>
</a>
</li>
</ul>
</div>
</template>
<!-- Library Section -->
<div class="dropdown" style="display: inline-block;">
<paper-icon-button noink icon="av:library-books" data-toggle="dropdown"></paper-icon-button>
<ul class="dropdown-menu pull-right" style="right: -98px;">
<template is="dom-if" if="{{ canAddToLibrary }}">
<template is="dom-if" if="{{ !addedToLib }}">
<li>
<a style="padding: 5px; margin: 0;">
<paper-item on-click="addToLibrary">
<paper-icon-item><iron-icon icon="av:library-add"></iron-icon></paper-icon-item>
&nbsp;&nbsp;
<paper-item-body>എന്‍റെ ലൈബ്രറിയില്‍ ചേര്‍ക്കുക</paper-item-body>
</paper-item>
</a>
</li>
</template>
<template is="dom-if" if="{{ addedToLib }}">
<li>
<a style="padding: 5px; margin: 0;">
<paper-item on-click="removeFromLibrary">
<paper-icon-item><iron-icon icon="icons:remove-circle"></iron-icon></paper-icon-item>
&nbsp;&nbsp;
<paper-item-body>എന്‍റെ ലൈബ്രറിയില്‍ നിന്ന്‍ ഒഴിവാക്കുക</paper-item-body>
</paper-item>
</a>
</li>
</template>
</template>
<li>
<a style="padding: 5px; margin: 0;">
<paper-item on-click="goToLibrary">
<paper-icon-item><iron-icon icon="maps:local-library"></iron-icon></paper-icon-item>
&nbsp;&nbsp;
<paper-item-body>എന്‍റെ ലൈബ്രറി</paper-item-body>
</paper-item>
</a>
</li>
</ul>
</div>
<!-- Share widget -->
<div hidden$="{{ ! canShare }}" class="dropdown social-share" style="display: inline-block;">
<paper-icon-button noink icon="social:share" data-toggle="dropdown"></paper-icon-button>
<ul class="dropdown-menu pull-right" style="right: -49px;">
<li>
<a style="padding: 5px; margin: 0;">
<paper-item on-click="shareOnFacebook">
<paper-icon-item><span class="icon icon-facebook"></span></paper-icon-item>
&nbsp;&nbsp;
<paper-item-body>ഫേസ്ബുക്കില്‍ ഷെയര്‍ ചെയ്യൂ</paper-item-body>
</paper-item>
</a>
</li>
<li>
<a style="padding: 5px; margin: 0;">
<paper-item on-click="shareOnTwitter">
<paper-icon-item><span class="icon icon-twitter"></span></paper-icon-item>
&nbsp;&nbsp;
<paper-item-body>ട്വിറ്ററില്‍ ഷെയര്‍ ചെയ്യൂ</paper-item-body>
</paper-item>
</a>
</li>
<li>
<a style="padding: 5px; margin: 0;">
<paper-item on-click="shareOnGplus">
<paper-icon-item><span class="icon icon-google-plus"></span></paper-icon-item>
&nbsp;&nbsp;
<paper-item-body>ഗൂഗിള്‍ പ്ലസില്‍ ഷെയര്‍ ചെയ്യൂ</paper-item-body>
</paper-item>
</a>
</li>
</ul>
</div>
<!-- Menu button -->
<div class="dropdown" style="display: inline-block;">
<paper-icon-button noink icon="icons:more-vert" data-toggle="dropdown"></paper-icon-button>
<ul class="dropdown-menu pull-right" style="width: 300px;">
<li>
<paper-item style="padding: 5px 15px; margin: 0; display: block; white-space: normal;">
<h6 class="pratilipi-red text-center" style="text-align: center; white-space: normal; line-height: 1.6em;">{{ title }}</h6>
</paper-item>
</li>
<template is="dom-if" if="{{ canReview }}">
<li>
<a style="padding: 5px; margin: 0;">
<paper-item on-click=writeReview>
<paper-icon-item><iron-icon icon="icons:create"></iron-icon></paper-icon-item>
&nbsp;&nbsp;
<paper-item-body>ഒരു റിവ്യൂ എഴുതൂ</paper-item-body>
</paper-item>
</a>
</li>
</template>
<template is="dom-if" if="{{ canEditContent }}">
<li>
<a style="padding: 5px; margin: 0;">
<paper-item on-click="redirectToWriterPanel">
<paper-icon-item><iron-icon icon="icons:create"></iron-icon></paper-icon-item>
&nbsp;&nbsp;
<paper-item-body>രചന തിരുത്തൂ</paper-item-body>
</paper-item>
</a>
</li>
</template>
<li>
<a style="padding: 5px; margin: 0;" href="{{ pratilipi.pageUrl }}">
<paper-item>
<paper-icon-item><iron-icon icon="icons:chrome-reader-mode"></iron-icon></paper-icon-item>
&nbsp;&nbsp;
<paper-item-body>രചനയുടെ പേജിലേക്ക് പോകൂ</paper-item-body>
</paper-item>
</a>
</li>
<li>
<a style="padding: 5px; margin: 0;" href="{{ pratilipi.author.pageUrl }}">
<paper-item>
<paper-icon-item><iron-icon icon="icons:account-box"></iron-icon></paper-icon-item>
&nbsp;&nbsp;
<paper-item-body>രചയിതാവിന്‍റെ പേജിലേക്ക് പോകൂ</paper-item-body>
</paper-item>
</a>
</li>
<li>
<a style="padding: 5px; margin: 0;" href="/">
<paper-item>
<paper-icon-item><iron-icon icon="icons:home"></iron-icon></paper-icon-item>
&nbsp;&nbsp;
<paper-item-body>വെബ്സൈറ്റ് ഹോം പേജിലേക്ക് പോകൂ</paper-item-body>
</paper-item>
</a>
</li>
<template is="dom-if" if="{{ switchReaderOptions }}">
<template is="dom-if" if="{{ isVersion2 }}">
<li>
<a style="padding: 5px; margin: 0;" target="_blank" href="/read?id={{ pratilipi.pratilipiId }}&_apiVer=1">
<paper-item>
<paper-item-body>Go To Old Reader</paper-item-body>
</paper-item>
</a>
</li>
<li>
<a style="padding: 5px; margin: 0;" on-click="finaliseV2Version">
<paper-item>
<paper-item-body>Everything seems Okay!</paper-item-body>
</paper-item>
</a>
</li>
</template>
<template is="dom-if" if="{{ isVersion1 }}">
<li>
<a style="padding: 5px; margin: 0;" target="_blank" href="/read?id={{ pratilipi.pratilipiId }}&_apiVer=2">
<paper-item>
<paper-item-body>Go To New Reader</paper-item-body>
</paper-item>
</a>
</li>
</template>
</template>
</ul>
</div>
</td>
</tr>
</table>
</paper-card>
<iron-ajax
id="PratilipiApi"
url="/api/pratilipi"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_handlePratilipiApiResponse"
on-error="_handlePratilipiApiError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-reader-header',
properties: {
pratilipi: { type: Object },
hasAccessToUpdate: { type: Boolean },
addedToLib: { type: Boolean, value: false },
hideIndexButton: { type: Boolean },
canEditContent: { type: Boolean, value: false },
index: { type: Array },
pageNo: { type: Number },
contentType: { type: String },
stage: { type: String },
version: { type: String },
canReview: { type: Boolean },
canShare: { type: Boolean, value: true },
canAddToLibrary: { type: Boolean, value: true }
},
_entryClicked: function( event ) {
var entry = event.model.entry;
document.querySelector( 'pratilipi-reader-page' ).setPageNo( entry.pageNo != null ? entry.pageNo : entry.chapterNo );
},
ready: function() {
this.title = this.pratilipi.title != null && this.pratilipi.title.trim() != "" ?
this.pratilipi.title : this.pratilipi.titleEn;
this.pratilipiContentType = this.contentType == "PRATILIPI";
this.imageContentType = this.contentType == "IMAGE";
this.set( "canShare", this.pratilipi.state == "PUBLISHED" );
},
attached: function() {
// Hide Edit Content button in Mobile
var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
var height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
this.set( 'canEditContent', ! isMobile() && this.hasAccessToUpdate && this.pratilipiContentType );
jQuery( "#navigationdropdown" ).css( 'max-height', Math.min( 500, height - 75 ) + "px", "important" );
jQuery( "#navigationdropdown" ).css( 'min-width', Math.min( 300, width - 20 ) + "px", "important" );
jQuery( "#navigationdropdown" ).css( 'max-width', ( width - 20 ) + "px", "important" );
this.set( "switchReaderOptions", this.stage == "gamma" && this.pratilipi.oldContent );
this.set( "isVersion1", this.version == "1" );
this.set( "isVersion2", this.version == "2" );
this.async( function() {
this.set( "canReview", this.domHost.getUser().isGuest || this.domHost.getUserPratilipi().hasAccessToReview );
var user = document.querySelector( 'pratilipi-user' ).getCurrentUser();
this.set( "canAddToLibrary", this.pratilipi.state == "PUBLISHED" && ( user.isGuest || this.pratilipi.author.authorId != user.author.authorId ) );
});
// Hack
if( this.pratilipi.state != "PUBLISHED" )
$( "pratilipi-reader-header .dropdown-menu" ).css( "right", 0 );
},
shareOnFacebook: function() {
document.querySelector( 'pratilipi-reader-page' ).shareOnFacebook( "menu" );
},
shareOnTwitter: function() {
document.querySelector( 'pratilipi-reader-page' ).shareOnTwitter( "menu" );
},
shareOnGplus: function() {
document.querySelector( 'pratilipi-reader-page' ).shareOnGplus( "menu" );
},
increaseFontSize: function() {
document.querySelector( 'pratilipi-reader-content' ).increaseFontSize();
},
decreaseFontSize: function() {
document.querySelector( 'pratilipi-reader-content' ).decreaseFontSize();
},
increaseImageSize: function() {
document.querySelector( 'pratilipi-reader-content' ).increaseImageSize();
},
decreaseImageSize: function() {
document.querySelector( 'pratilipi-reader-content' ).decreaseImageSize();
},
addToLibrary: function() {
document.querySelector( 'pratilipi-reader-page' ).addToLibrary();
},
removeFromLibrary: function() {
document.querySelector( 'pratilipi-reader-page' ).removeFromLibrary();
},
goToLibrary: function() {
document.querySelector( 'pratilipi-reader-page' ).goToLibrary();
},
writeReview: function() {
document.querySelector( 'pratilipi-reader-page' ).writeReview();
},
redirectToWriterPanel: function() {
document.querySelector( 'pratilipi-reader-page' ).redirectToWriterPanel();
},
exitReader: function() {
document.querySelector( 'pratilipi-reader-page' ).exitReader();
},
normalReadingMode: function() {
document.querySelector( 'pratilipi-reader-page' ).normalReadingMode();
},
nightReadingMode: function() {
document.querySelector( 'pratilipi-reader-page' ).nightReadingMode();
},
sepiaReadingMode: function() {
document.querySelector( 'pratilipi-reader-page' ).sepiaReadingMode();
},
finaliseV2Version: function() {
this.$.PratilipiApi.body = jQuery.param( { "pratilipiId": this.pratilipi.pratilipiId, "oldContent": false, "_apiVer": "2" } );
this.$.PratilipiApi.generateRequest();
},
_handlePratilipiApiResponse: function( event ) {
alert( "Success!" );
window.location.reload();
},
_handlePratilipiApiError: function( event ) {
alert( "Some Exception at server! Please try again!" );
}
});
</script>
</dom-module>
<dom-module id="pratilipi-reader-navigation-entry">
<style>
paper-item {
font-size: 14px;
font-family: inherit;
}
paper-item-body.heading {
font-weight: 600;
}
paper-item-body.grey {
color: #707070;
}
paper-item-body.black {
color: #333;
}
paper-item-body.blue {
color: #107FE5;
}
</style>
<template>
<paper-item>
<paper-item-body style="white-space: normal;" id="entry">[[ entry.title ]]</paper-item-body>
</paper-item>
</template>
<script>
Polymer({
is: 'pratilipi-reader-navigation-entry',
properties: {
entry: { type: Object },
pageNo: { type: Number, observer: "_pageNoChanged" }
},
attached: function() {
if( this.entry.level == 0 )
jQuery( this.querySelector( '#entry' ) ).addClass( "heading" );
},
_pageNoChanged: function() {
var pageNo = this.entry.pageNo != null ? this.entry.pageNo : this.entry.chapterNo;
var level = this.entry.level != null ? this.entry.level : this.entry.nesting;
if( this.pageNo == pageNo ) {
jQuery( this.querySelector( '#entry' ) ).removeClass( "black" );
jQuery( this.querySelector( '#entry' ) ).removeClass( "grey" );
jQuery( this.querySelector( '#entry' ) ).addClass( "blue" );
} else {
jQuery( this.querySelector( '#entry' ) ).removeClass( "blue" );
if( level == 0 )
jQuery( this.querySelector( '#entry' ) ).addClass( "black" );
else
jQuery( this.querySelector( '#entry' ) ).addClass( "grey" );
}
}
});
</script>
</dom-module><dom-module id="pratilipi-reader-content">
<style>
:host {
display: block;
overflow: hidden;
}
:host #pager {
margin-bottom: 5px;
padding: 16px 22px;
width: 100%;
}
:host #pager #reader-content {
-webkit-font-smoothing: antialiased;
line-height: 1.6em;
}
@media only screen and (max-width: 768px) {
:host #pager #reader-content {
text-align: left;
}
}
@media only screen and (min-width: 769px) {
:host #pager #reader-content {
text-align: justify;
}
}
/* Bootstrap override */
#reader-alert-box {
color: #333;
background-color: inherit;
border-color: #333;
}
#reader-alert-box .alert-link, #reader-alert-box .alert-link:hover, #reader-alert-box .alert-link:focus {
font-weight: inherit;
color: inherit;
}
.alert .social-icons {
display: flex;
width: 100%;
justify-content: center;
}
.alert .social-icons .icons-holder {
white-space: nowrap;
display: inline-block;
align-self: center;
margin-left: 12px;
}
.hvr-bounce-in {
vertical-align: middle;
-webkit-transform: translateZ(0);
transform: translateZ(0);
box-shadow: 0 0 1px rgba(0, 0, 0, 0);
-webkit-backface-visibility: hidden;
backface-visibility: hidden;
-moz-osx-font-smoothing: grayscale;
-webkit-transition-duration: 0.5s;
transition-duration: 0.5s;
max-width: 95%;
margin: 30px auto;
}
.hvr-bounce-in:hover, .hvr-bounce-in:focus, .hvr-bounce-in:active {
-webkit-transform: scale(1.05);
transform: scale(1.05);
-webkit-transition-timing-function: cubic-bezier(0.47, 2.02, 0.31, -0.36);
transition-timing-function: cubic-bezier(0.47, 2.02, 0.31, -0.36);
}
.fa {
margin-left: 15px;
cursor: pointer;
}
</style>
<template>
<paper-card id="pager">
<div id="reader-content"></div>
<template is="dom-if" if="{{ showContainer }}">
<div id="reader-alert-box" class="alert alert-success hvr-bounce-in" role="alert">
<template is="dom-if" if="{{ canReview }}">
<h3 class="text-center" style="margin-top: 24px;">ഈ രചന ഇഷ്ടപ്പെട്ടോ ?</h3>
<div class="text-center" style="margin: 0 auto;">
<a class="alert-link" on-click="writeReview">
<h6 style="margin: 15px 0px; display: inline-block;">ഒരു റിവ്യൂ എഴുതൂ</h6>
<iron-icon icon="icons:create" style="margin-left: 0px; display: inline-block; width: 20px;"></iron-icon>
</a>
</div>
</template>
<div id="social-icons" class="social-icons text-center" style="margin: 0 auto;">
<h6 style="margin: 15px 0px; display: inline-block;">ഷെയര്‍ ചെയ്യൂ : </h6>
<div class="icons-holder">
<a on-click="shareOnFacebook"><span class="icon icon-facebook"></span></a>
<a on-click="shareOnTwitter"><span class="icon icon-twitter"></span></a>
<a on-click="shareOnGplus"><span class="icon icon-google-plus"></span></a>
</div>
</div>
</div>
</template>
</paper-card>
<iron-ajax
id="AjaxGet"
url="/api/pratilipi/content"
method="GET"
content-type="application/json"
handle-as="json"
on-response="_onResponse"
on-error="_onError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-reader-content',
properties: {
content: { type: String, observer: "_onContentChange" },
contentType: { type: String },
contentMap: { type: Object, value: {} },
pratilipiId: { type: Number },
pratilipiState: { type: String },
fontSize: { type: Number, observer: "_onFontSizeChange" },
imageSize: { type: Number, observer: "_onImageSizeChange" },
pageNo: { type: Number, observer: "_onPageNoChange" },
pageCount: { type: Number },
version: { type: String },
showContainer: { type: Boolean },
canReview: { type: Boolean }
},
// Attached
attached: function() {
jQuery( "#pager" ).css( 'min-height', window.innerHeight + "px" );
this.set( "canReview", this.domHost.getUser().isGuest || this.domHost.getUserPratilipi().hasAccessToReview );
this.set( 'showContainer', this.pageNo == this.pageCount && this.pratilipiState == "PUBLISHED" );
if( this.contentType == "PRATILIPI" ) {
this.contentMap[ this.pageNo ] = this.content;
} else if( this.contentType == "IMAGE" ) {
var chapters = jQuery.parseJSON( this.content )["chapters"];
var c = 1;
for( var i = 0; i < chapters.length; i++ ) {
var pages = chapters[i].pages;
for( var j = 0; j < pages.length; j++ ) {
this.contentMap[ c++ ] = pages[j].pagelets[0].data.name;
}
}
this.set( 'content', this.getImageUrl( this.pageNo ) );
this._setImageSize();
}
this._precache();
},
// Font size
_onFontSizeChange: function() {
this.async( function() {
jQuery( "#reader-content" ).css( 'font-size', this.fontSize, "important" );
jQuery( "#reader-content h2" ).css( 'font-size', this.fontSize + 4, "important" );
jQuery( "#reader-content h1" ).css( 'font-size', this.fontSize + 8, "important" );
} );
},
_setFontSize: function( fontSize ) {
this.set( "fontSize", fontSize == null ? 14 : parseInt( fontSize ) );
setCookie( "fontSize", fontSize, 30, "/read" );
},
increaseFontSize: function() {
// cutoff = 32
if( this.fontSize + 2 <= 32 )
this._setFontSize( this.fontSize + 2 );
},
decreaseFontSize: function() {
// cutoff = 12
if( this.fontSize - 2 >= 12 )
this._setFontSize( this.fontSize - 2 );
},
// Image Size
_onImageSizeChange: function() {
this.async( function() {
jQuery( "#reader-content img" ).css( 'width', this.imageSize + 'px' );
if( jQuery( "#reader-content" ).width() < this.imageSize )
jQuery( "#reader-content" ).css( "overflow", "scroll" );
else
jQuery( "#reader-content" ).css( "overflow", "hidden" );
} );
},
_setImageSize: function( imageSize ) {
this.set( "imageSize", imageSize == null ? jQuery( "#reader-content" ).width() : parseInt( imageSize ) );
},
increaseImageSize: function() {
// cutoff = 1500
if( this.imageSize + 50 <= 1500 )
this._setImageSize( this.imageSize + 50 );
},
decreaseImageSize: function() {
// cutoff = 300
if( this.imageSize - 50 >= 300 )
this._setImageSize( this.imageSize - 50 );
},
// Content
_onContentChange: function() {
if( this.contentType == "IMAGE" && ( this.contentMap == null || jQuery.isEmptyObject( this.contentMap ) ) ) {
jQuery( this.querySelector( '#reader-content' ) ).html( "<paper-spinner class=\"pratilipi-spinner-center\" active></paper-spinner>" );
return;
}
jQuery( this.querySelector( '#reader-content' ) ).html( this.content );
this.async( function() {
if( this.contentType == "PRATILIPI" ) {
jQuery( "#reader-content img" ).css( "cssText", "max-width: 100% !important; display: block !important; text-align: center !important; margin: 8px auto !important;");
jQuery( "#reader-content a" ).css( "cssText", "font-style: italic !important; text-decoration: underline !important; color: #707070 !important;" );
jQuery( "#reader-content a" ).attr( 'target', '_blank' );
jQuery( "#reader-content h1" ).css( "cssText", "text-align: center; margin-bottom: 20px;" );
} else if( this.contentType == "IMAGE" ) {
this._onImageSizeChange();
}
} );
if( jQuery( window ).scrollTop() > 128 ) {
this.async( function() {
jQuery( 'html, body' ).animate( { scrollTop : 0 }, 500 );
} );
}
},
getImageUrl: function( pageNo ) {
return "<img src='/api/pratilipi/content/image?pratilipiId=" +
this.pratilipiId + "&" +
"name=" + this.contentMap[ pageNo ] + "' />";
},
_precache: function() {
if( this.contentType == "PRATILIPI" ) {
// Check pageNo
if( this.pageNo > 1 )
this._loadContent( this.pageNo - 1 );
if( this.pageNo < this.pageCount )
this._loadContent( this.pageNo + 1 );
} else if( this.contentType == "IMAGE" ) {
// Prefetch images
if( this.pageNo > 1 )
jQuery( this.getImageUrl( this.pageNo - 1 ) ).load();
if( this.pageNo < this.pageCount )
jQuery( this.getImageUrl( this.pageNo + 1 ) ).load();
}
},
_onPageNoChange: function() {
// Called before ready function
if( this.contentMap == null || jQuery.isEmptyObject( this.contentMap ) )
return;
if( this.contentType == "PRATILIPI" ) {
if( this.contentMap[ this.pageNo ] != null ) { // Check in Map if exists
this.set( 'content', this.contentMap[ this.pageNo ] );
} else { // Else make api call
this.set( 'content', "<paper-spinner class=\"pratilipi-spinner-center\" active></paper-spinner>" );
this._loadContent( this.pageNo );
}
} else if( this.contentType == "IMAGE" ) {
this.set( 'content', this.getImageUrl( this.pageNo ) );
}
this.set( 'showContainer', this.pageNo == this.pageCount && this.pratilipiState == "PUBLISHED" );
this._precache(); // Load Previous and next pages
},
_loadContent: function( pageNo ) {
if( pageNo == null || this.contentMap[ pageNo ] != null )
return;
var ajaxGet = this.$.AjaxGet;
ajaxGet.params.pratilipiId = this.pratilipiId;
ajaxGet.params.chapterNo = pageNo;
ajaxGet.params.contentType = this.contentType;
ajaxGet.params._apiVer = this.version;
ajaxGet.generateRequest();
},
_onResponse: function( event ) {
var response = event.detail.response;
var content = response != null && response.content != null ? response.content : "";
if( response != null && response.chapterTitle != null )
content = "<h1>" + response.chapterTitle + "</h1>" + content;
var pageNo = response.chapterNo;
// Populate map
this.contentMap[ pageNo ] = content;
// Update content if response page no == this page no
if( this.pageNo == pageNo )
this.set( 'content', content );
},
_onError: function( event ) {
// Show appropriate message
/* alert( "Sorry! Some exception occurred at the server! Try again" ); */
// Try again in 3 seconds
},
writeReview: function() {
document.querySelector( 'pratilipi-reader-page' ).writeReview();
},
shareOnFacebook: function() {
document.querySelector( 'pratilipi-reader-page' ).shareOnFacebook( "container" );
},
shareOnTwitter: function() {
document.querySelector( 'pratilipi-reader-page' ).shareOnTwitter( "container" );
},
shareOnGplus: function() {
document.querySelector( 'pratilipi-reader-page' ).shareOnGplus( "container" );
},
});
</script>
</dom-module><dom-module id="pratilipi-reader-footer">
<style>
:host {
display: block;
}
paper-slider.pratilipi-slider {
margin-top: 2px;
width: 100%;
--paper-slider-active-color: #D0021B;
--paper-slider-knob-color: #D0021B;
--paper-slider-knob-start-color: #D0021B;
--paper-slider-pin-start-color: #D0021B;
}
paper-fab.pratilipi-red {
--paper-fab-background: #FFF;
--paper-fab-keyboard-focus-background: #FFF;
}
paper-input.normal-mode {
color: #333 !important;
--paper-input-container-color: #333 !important;
--paper-input-container-focus-color: #333 !important;
--paper-input-container-invalid-color: #333 !important;
--paper-input-container-input-color: #333 !important;
}
paper-input.night-mode {
color: #fff !important;
--paper-input-container-color: #fff !important;
--paper-input-container-focus-color: #fff !important;
--paper-input-container-invalid-color: #fff !important;
--paper-input-container-input-color: #fff !important;
}
paper-input.sepia-mode {
color: #181715 !important;
--paper-input-container-color: #181715 !important;
--paper-input-container-focus-color: #181715 !important;
--paper-input-container-invalid-color: #181715 !important;
--paper-input-container-input-color: #181715 !important;
}
</style>
<template>
<div id="reader-footer-holder" class="parent-container margin-top-bottom">
<div class="container" style="text-align: center; margin: 0 auto;">
<template is="dom-if" if="{{ showSlider }}">
<paper-fab class="pratilipi-red"
style="display: inline-block; margin-right: 40px;"
mini
icon="icons:chevron-left" title="Previous Page"
disabled="{{ prevButtonDisabled }}"
on-click="showPrevious"></paper-fab>
</template>
<paper-input id="pageNoInputHolder"
type="number"
style="display: inline-block; width: 75px;"
value="{{ pageNoInput }}"
on-change="_inputObserver">
<div suffix>/ {{ pageCount }}</div>
</paper-input>
<template is="dom-if" if="{{ showSlider }}">
<paper-fab class="pratilipi-red"
style="display: inline-block;margin-left: 40px;"
mini
icon="icons:chevron-right" title="Next Page"
disabled="{{ nextButtonDisabled }}"
on-click="showNext"></paper-fab>
</template>
</div>
<template is="dom-if" if="{{ showSlider }}">
<div class="container" style="margin: 0 auto;">
<div class="horizontal layout center">
<paper-slider
id="pageNoSlider"
stop-keyboard-event-propagation
class="flex pratilipi-slider"
min="1" max="{{ pageCount }}"
value="{{ pageNoSlider }}"
on-change="_sliderObserver"
disabled="{{ sliderDisabled }}"></paper-slider>
</div>
</div>
</template>
</div>
</template>
<script>
Polymer({
is: 'pratilipi-reader-footer',
properties: {
pageNo: { type:Number, observer: "_pageNoChanged" },
pageNoInput: { type: Number },
pageNoSlider: { type: Number },
pageCount: { type:Number },
showSlider: { type: Boolean },
sliderDisabled: { type:Boolean },
prevButtonDisabled: { type:Boolean },
nextButtonDisabled: { type:Boolean },
},
_pageNoChanged: function() {
if( this.pageCount == null || this.pageNo == null )
return;
this.set( 'pageNoInput', this.pageNo );
this.set( 'pageNoSlider', this.pageNo );
this.set( 'prevButtonDisabled', this.pageNo <= 1 );
this.set( 'nextButtonDisabled', ( this.pageCount <= 1 || this.pageNo >= this.pageCount ) )
},
showPrevious: function() {
document.querySelector( 'pratilipi-reader-page' ).showPrevious();
},
showNext: function() {
document.querySelector( 'pratilipi-reader-page' ).showNext();
},
ready: function() {
this.sliderDisabled = this.pageCount <= 1;
this.set( 'showSlider', this.pageCount > 1 );
this._pageNoChanged();
},
_inputObserver: function() {
if( this.pageNoInput >= 1 && this.pageNoInput <= this.pageCount && this.pageNo != this.pageNoInput )
document.querySelector( 'pratilipi-reader-page' ).setPageNo( this.pageNoInput );
else
this.pageNoInput = this.pageNo;
},
_sliderObserver: function() {
if( this.pageNo != this.pageNoSlider )
document.querySelector( 'pratilipi-reader-page' ).setPageNo( this.pageNoSlider );
},
isInputFocused: function() {
return this.$.pageNoSlider != null
? this.$.pageNoInputHolder.focused && this.$.pageNoSlider.focused
: this.$.pageNoInputHolder.focused;
},
readingMode: function( class_name ) {
if( class_name == 'normal-mode' ) {
jQuery( this.querySelector( '#pageNoInputHolder' ) ).removeClass( 'night-mode' );
jQuery( this.querySelector( '#pageNoInputHolder' ) ).removeClass( 'sepia-mode' );
jQuery( this.querySelector( '#pageNoInputHolder' ) ).addClass( 'normal-mode' );
} else if( class_name == 'night-mode' ) {
jQuery( this.querySelector( '#pageNoInputHolder' ) ).removeClass( 'normal-mode' );
jQuery( this.querySelector( '#pageNoInputHolder' ) ).removeClass( 'sepia-mode' );
jQuery( this.querySelector( '#pageNoInputHolder' ) ).addClass( 'night-mode' );
} else if( class_name == 'sepia-mode' ) {
jQuery( this.querySelector( '#pageNoInputHolder' ) ).removeClass( 'normal-mode' );
jQuery( this.querySelector( '#pageNoInputHolder' ) ).removeClass( 'night-mode' );
jQuery( this.querySelector( '#pageNoInputHolder' ) ).addClass( 'sepia-mode' );
}
this.updateStyles();
}
});
</script>
</dom-module>
<dom-module id="pratilipi-reader-page">
<template>
<header>
<pratilipi-reader-header
pratilipi="{{ pratilipi }}"
has-access-to-update="[[ pratilipi.hasAccessToUpdate ]]"
added-to-lib="[[ addedToLib ]]"
hide-index-button="[[ hideIndexButton ]]"
page-no="[[ pageNo ]]"
index="{{ index }}"
content-type="{{ contentType }}"
stage="{{ stage }}"
version="{{ version }}"></pratilipi-reader-header>
</header>
<pratilipi-user user='{{ user }}' user-data="[[ userData ]]"></pratilipi-user>
<pratilipi-alert></pratilipi-alert>
<pratilipi-review-input pratilipi="[[ pratilipi ]]"></pratilipi-review-input>
<div style="margin-top: 60px;">
<div class="parent-container">
<div class="container" style="margin: 0 auto;">
<div style="overflow:hidden;">
<pratilipi-reader-content
content-type="{{ contentType }}"
content="{{ content }}"
font-size="{{ fontSize }}"
page-no="{{ pageNo }}"
page-count="{{ pageCount }}"
pratilipi-id="{{ pratilipi.pratilipiId }}"
pratilipi-state="{{ pratilipi.state }}"
version="{{ version }}"></pratilipi-reader-content>
</div>
</div>
</div>
</div>
<footer>
<pratilipi-reader-footer
page-no="[[ pageNo ]]"
page-count="{{ pageCount }}"></pratilipi-reader-footer>
</footer>
<iron-ajax
id="AjaxPost"
url="/api/userpratilipi/library"
method="POST"
content-type="application/x-www-form-urlencoded"
handle-as="json"
on-response="_handleAjaxPostResponse"
on-error="_handleAjaxPostError"
></iron-ajax>
<iron-ajax
id="GetUserPratilipi"
url="/api/userpratilipi"
method="GET"
content-type="application/json"
handle-as="json"
on-response="_getUserPratilipiResponse"
on-error="_getUserPratilipiError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-reader-page',
properties: {
userData: { type: Object },
user: { type: Object, observer: "_userChanged" },
pratilipi: { type: Object },
userpratilipi: { type: Object },
addedToLib: { type: Boolean },
fontSize: { type: Number },
pageNo: { type: Number },
pageCount: { type: Number },
contentType: { type: String },
content: { types: String },
index: { types: Array, value: [] },
version: { type: String },
stage: { type: String },
addToLibClicked: { type: Boolean, value: false },
goToLibraryBoolean: { type: Boolean, value: false },
reviewButtonClicked: { type: Boolean, value: false },
hideIndexButton: { type: Boolean, value: true },
},
// Ready function
ready: function() {
var index = this.index;
index = jQuery.parseJSON( index );
index = JSON.parse( index );
if( index != null ) {
if( index.length > 0 )
this.set( 'hideIndexButton', false );
for( var i = 0; i < index.length; i++ )
if( index[i].title == null )
index[i].title = "അദ്ധ്യായം " + index[i].chapterNo;
this.set( 'index', index );
}
this.set( 'addedToLib', this.userpratilipi != null ? this.userpratilipi.addedToLib : false );
},
attached: function() {
// Color modes available only on PRATILIPI contents
if( this.contentType == "PRATILIPI" ) {
if( getCookie( "PREFERRED_READING_MODE" ) == null || getCookie( "PREFERRED_READING_MODE" ) == "NORMAL_MODE" )
this.normalReadingMode();
else if( getCookie( "PREFERRED_READING_MODE" ) == "NIGHT_MODE" )
this.nightReadingMode();
else if( getCookie( "PREFERRED_READING_MODE" ) == "SEPIA_MODE" )
this.sepiaReadingMode();
}
},
// Setting Page Number
setPageNo: function( pageNo ) {
if( pageNo != this.pageNo && pageNo >= 1 && pageNo <= this.pageCount ) {
this.set( 'pageNo', parseInt( pageNo ) );
//Set cookie
setCookie( "reader_page_number_" + this.pratilipi.pratilipiId, pageNo, 30, "/read" );
}
},
showPrevious: function() {
this.setPageNo( this.pageNo - 1 );
},
showNext: function() {
this.setPageNo( this.pageNo + 1 );
},
keyupHandler: function( keyCode ) {
// paper-input at footer active
if( this.querySelector( 'pratilipi-reader-footer' ).isInputFocused() )
return;
// Left - 37 ; Right - 39
if( parseInt( keyCode ) == 37 )
this.showPrevious();
else if( parseInt( keyCode ) == 39 )
this.showNext();
},
// Review and Share
writeReview: function() {
if( this.user.isGuest ) {
this.reviewButtonClicked = true;
document.querySelector( 'pratilipi-user' ).logIn( true );
} else {
this.querySelector( 'pratilipi-review-input' ).openReviewInput( this.userpratilipi );
}
},
_getShareUrl: function( utm_location, utm_source ) {
if( utm_location == null || utm_source == null ) return;
var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
return encodeURIComponent(
"http://malayalam.pratilipi.com" + this.pratilipi.pageUrl
+ ( this.pratilipi.pageUrl.indexOf( '?' ) == -1 ? "?" : "&" )
+ "utm_language=malayalam" + "&"
+ "utm_version=standard" + "&"
+ "utm_device=" + ( width < 600 ? "mobile" : "desktop" ) + "&"
+ "utm_parent=reader" + "&"
+ "utm_location=" + utm_location + "&"
+ "utm_action=share" + "&"
+ "utm_source=" + utm_source
);
},
shareOnFacebook: function( utm_location ) {
clevertapShareContentOnFacebook( this.pratilipi.title, this.pratilipi.pratilipiId );
window.open( "http://www.facebook.com/sharer.php?u=" + this._getShareUrl( utm_location, "facebook" ),
"share", "width=1100,height=500,left=70px,top=60px" );
},
shareOnTwitter: function( utm_location ) {
window.open( "http://twitter.com/share?url=" + this._getShareUrl( utm_location, "twitter" ),
"share", "width=1100,height=500,left=70px,top=60px" );
},
shareOnGplus: function( utm_location ) {
window.open( "https://plus.google.com/share?url=" + this._getShareUrl( utm_location, "gplus" ),
"share", "width=1100,height=500,left=70px,top=60px" );
},
// Library
_userChanged: function() {
if( this.user.isGuest )
return;
if( this.addToLibClicked ) {
this.addToLibClicked = false;
this.async( function() { this.addToLibrary(); }, 1500 );
} else if( this.goToLibraryBoolean ) {
this.goToLibraryBoolean = false;
this.goToLibrary();
} else if( this.reviewButtonClicked ) {
// Load UserPratilipi
var getUserPratilipi = this.$.GetUserPratilipi;
getUserPratilipi.params.pratilipiId = this.pratilipi.pratilipiId;
getUserPratilipi.generateRequest();
}
},
updateUserPratilipi: function( userpratilipi ) {
this.set( 'userpratilipi', userpratilipi );
},
_getUserPratilipiResponse: function( event ) {
this.reviewButtonClicked = false;
this.updateUserPratilipi( event.detail.response );
this.writeReview();
},
_getUserPratilipiError: function( event ) {
this.async( function() { this._userChanged(); }, 3000 );
},
addToLibrary: function() {
if( this.user.isGuest ) {
this.addToLibClicked = true;
document.querySelector( 'pratilipi-user' ).logIn( true, "താങ്കളുടെ ലൈബ്രറിയിലേക്ക് രചനകള്‍ ചേര്‍ക്കാന്‍ ലോഗിന്‍ ചെയ്യൂ" );
} else {
this.$.AjaxPost.body = ( "pratilipiId=" + this.pratilipi.pratilipiId + "&" + "addedToLib=true" );
this.$.AjaxPost.generateRequest();
}
},
removeFromLibrary: function() {
this.$.AjaxPost.body = ( "pratilipiId=" + this.pratilipi.pratilipiId + "&" + "addedToLib=false" );
this.$.AjaxPost.generateRequest();
},
_handleAjaxPostResponse: function( event ) {
if( event.detail.xhr.status != 200 )
this._handleAjaxPostError( event );
else {
this.set( 'addedToLib', Boolean( event.detail.response.addedToLib ) );
document.querySelector( 'pratilipi-alert' ).alert( event.detail.response.addedToLib ?
"വിജയകരമായി ലൈബ്രറിയിലേക്ക് ചേര്‍ത്തിരിക്കുന്നു" : "വായനശാലയില്‍ നിന്നും ഒഴിവാക്കിയിരിക്കുന്നു" );
}
},
_handleAjaxPostError: function( event ) {
document.querySelector( 'pratilipi-alert' ).alert( "എന്തോ സാങ്കേതിക പ്രശ്നം സംഭവിച്ചിരിക്കുന്നു. വീണ്ടും ശ്രമിക്കൂ", false );
},
goToLibrary: function() {
if( this.user.isGuest ) {
this.goToLibraryBoolean = true;
document.querySelector( 'pratilipi-user' ).logIn( true, "താങ്കളുടെ ലൈബ്രറിയിലേക്ക് രചനകള്‍ ചേര്‍ക്കാന്‍ ലോഗിന്‍ ചെയ്യൂ" );
} else {
window.location.href = "/library";
}
},
// Reader functions
redirectToWriterPanel: function() {
if( isMobile() ) {
document.querySelector( 'pratilipi-alert' ).alert( 'പ്രതിലിപിയില്‍ എഴുതാന്‍ ,താങ്കളുടെ കമ്പ്യൂട്ടറില്‍ നിന്നും malayalam.pratilipi.com എന്ന വെബ്സൈറ്റില്‍ ലോഗിന്‍ ചെയ്യുക.' );
return;
}
if( this.stage == "gamma" ) {
window.location.href = "/pratilipi-write?id=" + this.pratilipi.pratilipiId;
} else {
window.location.href = this.pratilipi.writePageUrl +
( this.pratilipi.writePageUrl.indexOf( "?" ) != -1 ? "&" : "?" ) +
"ret=" +
( getUrlParameter( "ret" ) != null ? getUrlParameter( "ret" ) : this.pratilipi.pageUrl );
}
},
exitReader: function() {
window.location.href = getUrlParameter( "ret" ) != null ? decodeURIComponent( getUrlParameter( "ret" ) ) : this.pratilipi.pageUrl;
},
// Ignore this
scrollHandler: function( st ) {},
normalReadingMode: function() {
jQuery( 'body' ).removeClass( 'night-mode' );
jQuery( 'body' ).removeClass( 'sepia-mode' );
jQuery( 'body' ).addClass( 'normal-mode' );
/* For paper input in footer */
this.querySelector( 'pratilipi-reader-footer' ).readingMode( 'normal-mode' );
/* Setting cookie */
setCookie( "PREFERRED_READING_MODE", "NORMAL_MODE", 30, "/read" );
},
nightReadingMode: function() {
jQuery( 'body' ).removeClass( 'normal-mode' );
jQuery( 'body' ).removeClass( 'sepia-mode' );
jQuery( 'body' ).addClass( 'night-mode' );
/* For paper input in footer */
this.querySelector( 'pratilipi-reader-footer' ).readingMode( 'night-mode' );
/* Setting cookie */
setCookie( "PREFERRED_READING_MODE", "NIGHT_MODE", 30, "/read" );
},
sepiaReadingMode: function() {
jQuery( 'body' ).removeClass( 'normal-mode' );
jQuery( 'body' ).removeClass( 'night-mode' );
jQuery( 'body' ).addClass( 'sepia-mode' );
/* For paper input in footer */
this.querySelector( 'pratilipi-reader-footer' ).readingMode( 'sepia-mode' );
/* Setting cookie */
setCookie( "PREFERRED_READING_MODE", "SEPIA_MODE", 30, "/read" );
},
getUser: function() {
return this.user;
},
getUserPratilipi: function() {
return this.userpratilipi;
}
});
</script>
</dom-module><dom-module id="pratilipi-blog-page">
<style>
.secondary-500 {
margin-bottom: 5px;
}
paper-card.blogpost-content {
width: 100%;
padding: 15px 20px;
margin-bottom: 10px;
--paper-card-header: { display: none };
}
paper-icon-button, iron-icon {
color: #107FE5;
}
</style>
<template>
<pratilipi-user user='{{ user }}' user-data="[[ userData ]]"></pratilipi-user>
<pratilipi-write language-map="[[ languageMap ]]" pratilipi-types='[[ pratilipiTypes ]]'></pratilipi-write>
<pratilipi-alert></pratilipi-alert>
<div class="header-pos">
<pratilipi-android-launch-test></pratilipi-android-launch-test> </div>
<main>
<pratilipi-header language-map="[[ languageMap ]]" user='[[ user ]]'></pratilipi-header>
<div class="parent-container margin-top-bottom">
<div class="container">
<pratilipi-navigation
class='pull-left hidden-xs hidden-sm'
navigation-list='[[ navigationList ]]'
></pratilipi-navigation>
<!-- Navigation & Search bar for extra-small & small screens. -->
<pratilipi-navigation-drawer with-backdrop navigation-list='[[ navigationList ]]'></pratilipi-navigation-drawer>
<div style="overflow:hidden; padding: 0 2px;">
<div id="androidLaunchBottom">
<div class="secondary-500 pratilipi-shadow pratilipi-card-grid-heading pratilipi-red">
{{ title }}
<div style="display: inline-block;" class="fb-like" data-href="http://www.pratilipi.com/blogpost/{{ blogpost.blogPostId }}" data-layout="button_count" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
<template is="dom-if" if="{{ blogpost.hasAccessToUpdate }}">
<paper-icon-button class="pull-right" style="margin-top: -8px;" on-click="editBlogpost" icon="create" noink></paper-icon-button>
</template>
</div>
<paper-card class="blogpost-content">
<div id="pratilipi-blogpost-content"></div>
</paper-card>
</div>
</div>
</div>
</div>
</main>
<footer>
<pratilipi-footer></pratilipi-footer>
</footer>
<div class="scroll-top-button">
<a id="scrollToTop" on-click="scrollToTop"><paper-fab mini noink style="background: #c0c0c0;" icon="icons:arrow-upward"></paper-fab></a>
</div>
</template>
<script>
Polymer({
is: 'pratilipi-blog-page',
properties: {
userData: { type: Object },
blogpost: { type: Object, observer: "_processBlogPost" },
navigationList: { type: Array },
pratilipiTypes: { types: Object },
showPratilipiList: { type: Boolean, value: true },
languageMap: { type: Object },
lastScrollTop: { type: Number, value: 0 },
},
_processBlogPost: function() {
this.title = this.blogpost.title;
var jSummary = jQuery( "#pratilipi-blogpost-content" );
jSummary.html( this.blogpost.content );
jQuery( "#pratilipi-blogpost-content img" ).css( "max-width", "100%", "important" );
},
updateBlogpost: function( blogpost ) {
if( blogpost.pageUrl != null && blogpost.pageUrl != window.location.pathname )
window.location.href = blogpost.pageUrl;
this.set( 'blogpost', blogpost );
},
editBlogpost: function() {
window.location.href = "/edit-blog?id=" + this.blogpost.blogPostId + "&blogId=" + this.blogpost.blogId;
},
scrollToTop: function() {
$( 'html, body' ).animate( { scrollTop : 0 },800 );
},
ready: function() {
jQuery( '#scrollToTop' ).css( "display", "none" );
},
scrollHandler: function( st ) {
if( st > this.lastScrollTop || st < 100 )
jQuery( '#scrollToTop' ).fadeOut();
else
jQuery( '#scrollToTop' ).fadeIn();
this.lastScrollTop = st;
}
});
</script>
</dom-module><dom-module id="pratilipi-blog-list-page">
<template>
<pratilipi-user user='{{ user }}' user-data="[[ userData ]]"></pratilipi-user>
<pratilipi-write language-map="[[ languageMap ]]" pratilipi-types='[[ pratilipiTypes ]]'></pratilipi-write>
<pratilipi-alert></pratilipi-alert>
<div class="header-pos">
<pratilipi-android-launch-test></pratilipi-android-launch-test> </div>
<main>
<pratilipi-header language-map="[[ languageMap ]]" user='[[ user ]]'></pratilipi-header>
<div class="parent-container margin-top-bottom">
<div class="container">
<pratilipi-navigation
class='pull-left hidden-xs hidden-sm'
navigation-list='[[ navigationList ]]'
></pratilipi-navigation>
<!-- Navigation & Search bar for extra-small & small screens. -->
<pratilipi-navigation-drawer with-backdrop navigation-list='[[ navigationList ]]'></pratilipi-navigation-drawer>
<div style="overflow:hidden; padding: 0 2px;">
<div id="androidLaunchBottom">
<template is="dom-if" if="{{ hasAccessToAdd }}">
<div class="secondary-500 pratilipi-shadow pratilipi-card-grid-heading pratilipi-red">
Drafted Entries
</div>
<br class="pratilipi-break">
<paper-card style="display: block; padding: 45px 20px; margin: 0 auto; text-align: center;">
<div style="text-align: center;">
<a on-click="createNewBlog">
<iron-icon style="width: 64px; height: 64px;" icon="add-circle"></iron-icon>
</a>
<a on-click="createNewBlog">
<h6 style="margin-top: 10px;">Add a new blog</h6>
</a>
</div>
</paper-card>
<br class="pratilipi-break">
<template is="dom-repeat" items="[[ draftedBlogpostList ]]">
<pratilipi-bloglist-snippet blogpost="{{ item }}"></pratilipi-bloglist-snippet>
</template>
<br>
<div class="secondary-500 pratilipi-shadow pratilipi-card-grid-heading pratilipi-red">
Published Entries
</div>
<br class="pratilipi-break">
</template>
<template is="dom-repeat" items="[[ blogpostList ]]">
<pratilipi-bloglist-snippet blogpost="{{ item }}"></pratilipi-bloglist-snippet>
</template>
<!-- Spinner when Loading more books -->
<template is="dom-if" if="{{ isLoading }}">
<paper-spinner class="pratilipi-spinner pratilipi-spinner-center" active></paper-spinner>
</template>
<!-- Show More Button in case of network call failure -->
<template is="dom-if" if="{{ includeShowMoreButton }}">
<button style="width: 100%;" class="pratilipi-new-blue-button" on-click="loadMore">കൂടുതല്‍ കാണൂ</button>
</template>
</div>
</div>
</div>
</div>
</main>
<footer>
<pratilipi-footer></pratilipi-footer>
</footer>
<div class="scroll-top-button">
<a id="scrollToTop" on-click="scrollToTop"><paper-fab mini noink style="background: #c0c0c0;" icon="icons:arrow-upward"></paper-fab></a>
</div>
<iron-ajax
id="AjaxGet"
url="/api/blogpost/list"
method="GET"
params="[[ filter ]]"
content-type="application/json"
handle-as="json"
on-response="_handleAjaxGetResponse"
on-error="_handleAjaxGetError"
></iron-ajax>
<iron-ajax
id="DraftedList"
url="/api/blogpost/list"
method="GET"
params="[[ filter ]]"
content-type="application/json"
handle-as="json"
on-response="_handleDraftedListResponse"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-blog-list-page',
properties: {
userData: { type: Object },
userLoaded: { type: Boolean, value: false },
user: { type: Object, observer: "_userObserver" },
blogId: { type: String },
hasAccessToAdd: { types: Boolean, value: false },
blogpostList: { type: Array },
draftedBlogpostList: { type: Array, value: function() { return []; } },
filter: { type: Object },
cursor: { type: String },
isLoading: { type: Boolean, value: false },
isFinished: { type: Boolean, value: false },
includeShowMoreButton: { type: Boolean, value: false },
navigationList: { type: Array },
pratilipiTypes: { types: Object },
languageMap: { type: Object },
lastScrollTop: { type: Number, value: 0 },
},
_userObserver: function() {
if( ! this.userLoaded ) {
this.userLoaded = true;
return;
}
this.async( function() {
window.location.reload();
}, 2000 );
},
createNewBlog: function() {
window.location.href = "/edit-blog?blogId=" + this.blogId;
},
loadDraftedList: function() {
var draftedList = this.$.DraftedList;
draftedList.params.state = "DRAFTED";
draftedList.generateRequest();
},
_handleDraftedListResponse: function( response ) {
var draftedBlogpostList = response.detail.response.blogPostList;
for( var i = 0; i < draftedBlogpostList.length; i++ )
this.push( 'draftedBlogpostList', draftedBlogpostList[i] );
},
loadMore: function() {
if( !this.isLoading && !this.isFinished )
this.includeShowMoreButton = true;
// Return if there is an active call or cursor = null.
if( this.isLoading || this.isFinished || this.cursor == null )
return;
// Check for window height.
var reqHeight = jQuery( window ).scrollTop()
- jQuery( this ).position().top
+ jQuery( window ).height()
+ 2 * jQuery( window ).height();
if( jQuery( this ).outerHeight( true ) >= reqHeight )
return;
// Spinner Active and disable show more button.
this.isLoading = true;
this.includeShowMoreButton = false;
// Set params and make ajax GET call. Filters already set when element initialised.
var ajaxGet = this.$.AjaxGet;
ajaxGet.params.cursor = this.cursor;
ajaxGet.generateRequest();
},
_handleAjaxGetResponse: function( request ) {
// Disable spinner
this.isLoading = false;
// Call didn't succeed.
if( ! request.detail.response )
return;
var blogpostList = request.detail.response.blogPostList;
for( var i = 0; i < blogpostList.length; i++ )
this.push( 'blogpostList', blogpostList[i] );
if( request.detail.response.cursor == null || blogpostList.length < 10 ) {
this.includeShowMoreButton = false;
this.isFinished = true;
}
else
this.cursor = request.detail.response.cursor;
},
_handleAjaxGetError: function() {
this.isLoading = false;
this.includeShowMoreButton = true;
},
scrollToTop: function() {
$( 'html, body' ).animate( { scrollTop : 0 },800 );
},
ready: function() {
jQuery( '#scrollToTop' ).css( "display", "none" );
this.hasAccessToAdd = jQuery.parseJSON( this.hasAccessToAdd );
if( this.hasAccessToAdd )
this.loadDraftedList();
},
attached: function() {
if( this.blogpostList.length < 10 || this.cursor == null || this.cursor.trim() == "" )
this.isFinished = true;
},
scrollHandler: function( st ) {
if( st > this.lastScrollTop || st < 100 ) {
jQuery( '#scrollToTop' ).fadeOut();
this.loadMore();
}
else
jQuery( '#scrollToTop' ).fadeIn();
this.lastScrollTop = st;
}
});
</script>
</dom-module>
<dom-module id="pratilipi-bloglist-snippet">
<style>
paper-card {
display: block;
padding: 16px 5px;
margin-bottom: 8px;
--paper-card-header: { display: none };
}
.title-holder {
margin: 4px 0px 8px 0px;
}
.title-holder .blog-title {
font-size: 18px;
margin-right: 12px;
}
.title-holder iron-icon {
width: 18px;
height: 18px;
margin-top: -4px;
margin-left: 4px;
opacity: 0.8;
}
.content-summary {
padding-left: 16px;
padding-right: 16px;
text-align: justify;
font-size: 14px;
line-height: 20px;
}
.content-summary .view-more {
white-space: nowrap;
margin-left: 8px;
font-size: 14px;
line-height: 20px;
color: #111;
}
</style>
<template>
<paper-card style="padding: 16px 12px;">
<div class="title-holder">
<a class="pratilipi-red blog-title" target="_blank" href="[[ blogpost.pageUrl ]]" onclick="ga_CA( window.location.pathname == '/blog' ? 'Blog' : 'AuthorInterview', 'Open' );">
[[ blogpost.title ]]
<iron-icon icon="icons:open-in-new"></iron-icon>
</a>
</div>
<div class="text-muted content-summary">{{ content }}<a class="view-more" href="{{ blogpost.pageUrl }}" onclick="ga_CA( window.location.pathname == '/blog' ? 'Blog' : 'AuthorInterview', 'Open' );">( കൂടുതല്‍ കാണൂ )</a></div>
</paper-card>
</template>
<script>
Polymer({
is: 'pratilipi-bloglist-snippet',
properties: {
blogpost: { type: Object },
content: { type: String }
},
ready: function() {
if( this.blogpost.content != null ) {
var content = this.blogpost.content.replace(/&nbsp;/g, " " ).trim();
this.set( 'content', content.substring( 0, Math.min( 600, content.length ) ) + "..." );
}
}
});
</script>
</dom-module><dom-module id="pratilipi-event-page">
<style>
.secondary-500 {
padding: 12px 8px;
margin-bottom: 6px;
}
paper-card.event-banner {
width: 100%;
padding: 0px;
margin-bottom: 10px;
--paper-card-header: { display: none };
}
paper-card.event-description {
width: 100%;
padding: 15px 20px;
margin-bottom: 10px;
--paper-card-header: { display: none };
}
paper-icon-button, iron-icon {
color: #107FE5;
}
paper-spinner {
margin: 16px auto;
display: block;
--paper-spinner-layer-1-color: #D0021B;
--paper-spinner-layer-2-color: #107FE5;
--paper-spinner-layer-3-color: #D0021B;
--paper-spinner-layer-4-color: #107FE5;
}
/* Bootstrap overrides */
.row {
margin-left: -8px;
margin-right: -8px;
}
.col-xs-4, .col-sm-3, .col-md-3, .col-lg-3 {
padding-left: 8px;
padding-right: 8px;
}
</style>
<template>
<pratilipi-user user='{{ user }}' user-data="[[ userData ]]"></pratilipi-user>
<pratilipi-write language-map="[[ languageMap ]]" pratilipi-types='[[ pratilipiTypes ]]'></pratilipi-write>
<pratilipi-alert></pratilipi-alert>
<div class="header-pos">
<pratilipi-android-launch-test></pratilipi-android-launch-test> </div>
<main>
<pratilipi-header language-map="[[ languageMap ]]" user='[[ user ]]'></pratilipi-header>
<div class="parent-container margin-top-bottom">
<div class="container">
<pratilipi-navigation
class='pull-left hidden-xs hidden-sm'
navigation-list='[[ navigationList ]]'
></pratilipi-navigation>
<!-- Navigation & Search bar for extra-small & small screens. -->
<pratilipi-navigation-drawer with-backdrop navigation-list='[[ navigationList ]]'></pratilipi-navigation-drawer>
<div style="overflow:hidden; padding: 0 2px;">
<div id="androidLaunchBottom">
<div class="secondary-500 pratilipi-shadow pratilipi-card-grid-heading pratilipi-red">
{{ event.name }}
<template is="dom-if" if="{{ event.hasAccessToUpdate }}">
<paper-icon-button on-click="editEvent" icon="create" noink></paper-icon-button>
</template>
</div>
<paper-card class="event-banner">
<template is="dom-if" if="{{ !event.hasAccessToUpdate }}">
<img style="width: 100%;" src="{{ eventBannerImageUrl }}" alt="{{ event.name }}" />
</template>
<template is="dom-if" if="{{ event.hasAccessToUpdate }}">
<div style="position: absolute; top: -1000px;">
<form id="uploadImage" method="post" enctype="multipart/form-data" action="/api/event/banner?eventId={{ event.eventId }}" target="upload_target">
<input id="uploadImageInput" type="file" on-change="uploadImage" name="{{ event.eventId }}" accept="image/*">
</form>
<iframe id="upload_target" name="upload_target" style="display: none;" on-load="_onchangeiframe"></iframe>
</div>
<div class="pratilipi-file-upload">
<img style="width: 100%;" src="{{ eventBannerImageUrl }}" alt="{{ event.name }}"/>
<iron-icon icon="icons:cloud-upload"></iron-icon>
<div class="pratilipi-file-upload-caption" on-click="_chooseFile">
<iron-icon icon="icons:cloud-upload"></iron-icon>
<strong>Upload Photo</strong>
</div>
</div>
</template>
</paper-card>
<paper-card class="event-description">
<div id="pratilipi-event-description"></div>
</paper-card>
<template is="dom-if" if="{{ showPratilipiList }}">
<div class="secondary-500 pratilipi-shadow pratilipi-card-grid-heading pratilipi-red">
മത്സര എന്‍ട്രികള്‍
</div>
<div id="event-entries" class="secondary-500 pratilipi-shadow">
<div class="row text-center">
<template is="dom-repeat" items="{{ pratilipiList }}" as="pratilipi">
<div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
<pratilipi-card-mini state="PUBLISHED" pratilipi="{{ pratilipi }}"></pratilipi-card-mini>
</div>
</template>
</div>
<template is="dom-if" if="{{ isLoading }}">
<paper-spinner active></paper-spinner>
</template>
</div>
</template>
</div>
</div>
</div>
</div>
</main>
<footer>
<pratilipi-footer></pratilipi-footer>
</footer>
<div class="scroll-top-button">
<a id="scrollToTop" on-click="scrollToTop"><paper-fab mini noink style="background: #c0c0c0;" icon="icons:arrow-upward"></paper-fab></a>
</div>
<iron-ajax
id="PratilipiListApi"
url="/api/pratilipi/list"
method="GET"
params='{"_apiVer": "2"}'
content-type="application/json"
handle-as="json"
on-response="_pratilipiListApiResponse"
on-error="_pratilipiListApiError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-event-page',
properties: {
userData: { type: Object },
event: { type: Object, observer: "_eventObserver" },
pratilipiListObject: { type: Object },
pratilipiList: { type: Array, value: function() { return []; } },
cursor: { type: String, value: null },
resultCount: { type: Number, value: 12 },
isLoading: { type: Boolean, value: false },
isFinished: { type: Boolean, value: false },
showPratilipiList: { type: Boolean, value: true },
navigationList: { type: Array },
pratilipiTypes: { types: Object },
languageMap: { type: Object },
lastScrollTop: { type: Number, value: 0 },
},
_eventObserver: function() {
var jSummary = jQuery( "#pratilipi-event-description" );
jSummary.html( this.event.description );
this.set( 'eventBannerImageUrl', this.event.bannerImageUrl +
( this.event.bannerImageUrl.indexOf( '?' ) == -1 ? "?" : "&" ) + "width=1000" )
},
_processEventObject: function( pratilipiListObject ) {
var pratilipiList = pratilipiListObject.pratilipiList != null ? pratilipiListObject.pratilipiList : [];
for( var i = 0; i < pratilipiList.length; i++ )
this.push( 'pratilipiList', pratilipiList[i] );
this.set( 'cursor', pratilipiListObject.cursor );
this.set( 'isFinished', pratilipiList.length < this.resultCount );
this.set( 'showPratilipiList', this.pratilipiList.length > 0 );
this.set( 'numberFound', pratilipiListObject.numberFound != null ? pratilipiListObject.numberFound : 0 );
},
loadMore: function( forceLoad ) {
if( ! forceLoad ) {
if( this.isLoading || this.isFinished )
return;
// Check for window height.
var reqHeight = jQuery( window ).scrollTop()
- jQuery( '#event-entries' ).position().top
+ 3 * jQuery( window ).height();
if( jQuery( '#event-entries' ).outerHeight( true ) >= reqHeight )
return;
}
this.set( 'isLoading', true );
this.$.PratilipiListApi.params.eventId = this.event.eventId;
this.$.PratilipiListApi.params.state = "PUBLISHED";
this.$.PratilipiListApi.params.resultCount = this.resultCount;
if( this.cursor != null )
this.$.PratilipiListApi.params.cursor = this.cursor;
else
delete this.$.PratilipiListApi.params.cursor;
this.$.PratilipiListApi.generateRequest();
ga_CA( 'Pratilipi', 'LoadMore' );
},
_pratilipiListApiResponse: function( response ) {
this.set( 'isLoading', false );
this._processEventObject( response.detail.response );
},
_pratilipiListApiError: function( response ) {
this.set( 'isLoading', false );
var message = response.detail.request.xhr.response.message != null ?
response.detail.request.xhr.response.message : "എന്തോ സാങ്കേതിക പ്രശ്നം സംഭവിച്ചിരിക്കുന്നു. വീണ്ടും ശ്രമിക്കൂ";
document.querySelector( 'pratilipi-alert' ).alert( message, false );
},
updateEvent: function( event ) {
if( event.pageUrl != null && event.pageUrl != window.location.pathname )
window.location.href = event.pageUrl;
this.set( 'event', event );
},
editEvent: function() {
window.location.href = "/edit-event?id=" + this.event.eventId;
},
scrollToTop: function() {
$( 'html, body' ).animate( { scrollTop : 0 },800 );
},
ready: function() {
jQuery( '#scrollToTop' ).css( "display", "none" );
this.loadMore( true );
},
scrollHandler: function( st ) {
if( st > this.lastScrollTop || st < 100 ) {
jQuery( '#scrollToTop' ).fadeOut();
this.loadMore();
} else {
jQuery( '#scrollToTop' ).fadeIn();
}
this.lastScrollTop = st;
},
_chooseFile: function() {
document.getElementById( "uploadImageInput" ).click();
},
_onchangeiframe: function() {
if( this.imageUploaded ) {
this.imageUploaded = false;
this.async( function() {
this.eventBannerImageUrl = this.eventBannerImageUrl + "&" + "version=" + new Date().getTime();
}, 30 );
}
},
uploadImage: function() {
document.getElementById( "uploadImage" ).submit();
this.imageUploaded = true;
}
});
</script>
</dom-module><dom-module id="pratilipi-event-list-page">
<template>
<pratilipi-user user='{{ user }}' user-data="[[ userData ]]"></pratilipi-user>
<pratilipi-write language-map="[[ languageMap ]]" pratilipi-types='[[ pratilipiTypes ]]'></pratilipi-write>
<pratilipi-alert></pratilipi-alert>
<div class="header-pos">
<pratilipi-android-launch-test></pratilipi-android-launch-test> </div>
<main>
<pratilipi-header language-map="[[ languageMap ]]" user='[[ user ]]'></pratilipi-header>
<div class="parent-container margin-top-bottom">
<div class="container">
<pratilipi-navigation
class='pull-left hidden-xs hidden-sm'
navigation-list='[[ navigationList ]]'
></pratilipi-navigation>
<!-- Navigation & Search bar for extra-small & small screens. -->
<pratilipi-navigation-drawer with-backdrop navigation-list='[[ navigationList ]]'></pratilipi-navigation-drawer>
<div style="overflow:hidden; padding: 0 2px;">
<div id="androidLaunchBottom">
<template is="dom-if" if="{{ hasAccessToAdd }}">
<paper-card style="display: block; padding: 45px 20px; margin: 0 auto; text-align: center;">
<div style="text-align: center;">
<a on-click="createNewEvent">
<iron-icon style="width: 64px; height: 64px;" icon="add-circle"></iron-icon>
</a>
<a on-click="createNewEvent">
<h6 style="margin-top: 10px;">Create New Event</h6>
</a>
</div>
</paper-card>
<br class="pratilipi-break">
</template>
<template is="dom-repeat" items="[[ eventList ]]">
<pratilipi-event-snippet event="[[ item ]]"></pratilipi-event-snippet>
<br class="pratilipi-break">
</template>
</div>
</div>
</div>
</div>
</main>
<footer>
<pratilipi-footer></pratilipi-footer>
</footer>
<div class="scroll-top-button">
<a id="scrollToTop" on-click="scrollToTop"><paper-fab mini noink style="background: #c0c0c0;" icon="icons:arrow-upward"></paper-fab></a>
</div>
</template>
<script>
Polymer({
is: 'pratilipi-event-list-page',
properties: {
userData: { type: Object },
eventList: { type: Array },
hasAccessToAdd: { types: Boolean, value: false },
navigationList: { type: Array },
pratilipiTypes: { types: Object },
languageMap: { type: Object },
lastScrollTop: { type: Number, value: 0 },
},
createNewEvent: function() {
window.location.href = "/edit-event";
},
scrollToTop: function() {
$( 'html, body' ).animate( { scrollTop : 0 },800 );
},
ready: function() {
jQuery( '#scrollToTop' ).css( "display", "none" );
this.hasAccessToAdd = jQuery.parseJSON( this.hasAccessToAdd );
},
scrollHandler: function( st ) {
if( st > this.lastScrollTop || st < 100 )
jQuery( '#scrollToTop' ).fadeOut();
else
jQuery( '#scrollToTop' ).fadeIn();
this.lastScrollTop = st;
}
});
</script>
</dom-module>
<dom-module id="pratilipi-event-snippet">
<style>
paper-card {
display: block;
padding: 16px 5px;
--paper-card-header: { display: none };
}
.title-holder {
margin: 4px 0px 8px 0px;
}
.title-holder .event-title {
max-width: calc( 100% - 36px );
font-size: 18px;
}
.title-holder .open-in-new {
float: right;
}
.title-holder .open-in-new iron-icon {
width: 24px;
height: 24px;
color: #094c89;
}
.description-summary {
max-height: 120px;
overflow: hidden;
padding-right: 16px;
text-align: justify;
font-size: 14px;
line-height: 20px;
}
</style>
<template>
<paper-card>
<div class="row">
<div class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
<a href="[[ event.pageUrl ]]" onclick="ga_CA( 'Event', 'Open' )">
<iron-image class="pratilipi-shadow"
style="width: 200px; height: 150px; margin: 5px auto; display: block; background-color: #f5f5f5;"
fade preload sizing="cover"
src="[[ eventBannerImageUrl ]]"
alt="[[ event.name ]]" title="[[ event.name ]]" ></iron-image>
</a>
</div>
<div style="padding-left: 30px; padding-right: 20px;" class="col-xs-12 col-sm-12 col-md-9 col-lg-9">
<div class="title-holder">
<a class="pratilipi-red event-title" href="[[ event.pageUrl ]]" onclick="ga_CA( 'Event', 'Open' )">{{ event.name }}</a>
<a class="open-in-new" target="_blank" href="[[ event.pageUrl ]]" onclick="ga_CA( 'Event', 'Open' )"><iron-icon icon="icons:open-in-new"></iron-icon></a>
</div>
<div class="text-muted description-summary">{{ description }}</div>
</div>
</div>
</paper-card>
</template>
<script>
Polymer({
is: 'pratilipi-event-snippet',
properties: {
event: { type: Object },
description: { type: String }
},
ready: function() {
this.eventBannerImageUrl = this.event.bannerImageUrl +
( this.event.bannerImageUrl.indexOf( '?' ) == -1 ? "?" : "&" ) + "width=400";
if( this.event.description != null ) {
var description = this.event.description.replace(/&nbsp;/g, " " ).trim();
this.set( 'description', description );
}
}
});
</script>
</dom-module><dom-module id="pratilipi-followers-list-page">
<style>
:host {
display: block;
}
@media only screen and (max-width: 767px) {
main {
padding-top: 85px;
}
}
@media only screen and (min-width: 768px) {
main {
padding-top: 52px;
}
}
paper-card.follow-grid {
margin: 4px 0 6px 0;
width: 100%;
--paper-card-header: { display: none };
}
.card-heading {
padding: 12px 16px;
}
.card-heading h6 {
margin-top: 8px;
margin: 0;
margin-bottom: 6px;
}
.card-heading div {
font-size: 13px;
}
.load-more-button {
margin-top: 4px;
background: #F1F8FB;
padding: 18px;
text-align: center;
color: #0C68BD;
cursor: pointer;
font-size: 14px;
font-weight: 700;
line-height: 14px;
text-shadow: 0px 1px 2px #FFFFFF;
border: 1px solid #0C68BD;
border-radius: 4px;
}
paper-spinner.pratilipi-spinner {
line-height: 52px;
--paper-spinner-layer-1-color: #D0021B;
--paper-spinner-layer-2-color: #107FE5;
--paper-spinner-layer-3-color: #D0021B;
--paper-spinner-layer-4-color: #107FE5;
}
.alert-message {
padding: 24px;
text-align: center;
margin: auto;
font-weight: bold;
}
.alert-message iron-icon {
width: 48px;
height: 48px;
margin-bottom: 12px;
}
</style>
<template>
<pratilipi-user user='{{ user }}' user-data="[[ userData ]]"></pratilipi-user>
<pratilipi-edit-account user='[[ user ]]'></pratilipi-edit-account>
<pratilipi-write language-map="[[ languageMap ]]" pratilipi-types='[[ pratilipiTypes ]]'></pratilipi-write>
<pratilipi-alert></pratilipi-alert>
<div class="header-pos">
<pratilipi-android-launch-test></pratilipi-android-launch-test> </div>
<main>
<pratilipi-header language-map="[[ languageMap ]]" user='[[ user ]]'></pratilipi-header>
<div class="parent-container margin-top-bottom">
<div class="container">
<pratilipi-navigation
class='pull-left hidden-xs hidden-sm'
navigation-list='[[ navigationList ]]'
></pratilipi-navigation>
<pratilipi-navigation-drawer with-backdrop navigation-list='[[ navigationList ]]'></pratilipi-navigation-drawer>
<div style="overflow:hidden; padding: 0 2px;">
<div id="androidLaunchBottom">
<pratilipi-author-followers no-display></pratilipi-author-followers>
<div class="secondary-500 pratilipi-shadow card-heading">
<h6 class="pratilipi-red">ഫോളോവേഴ്സ്</h6>
<template is="dom-if" if="{{ hasFollowers }}">
<div>{{ numberFound }} പേര്‍</div>
</template>
</div>
<template is="dom-if" if="{{ noFollowers }}">
<paper-card class="follow-grid">
<div class="alert-message">
<iron-icon icon="icons:info-outline"></iron-icon>
<div>ക്ഷമിക്കണം! താങ്കളെ ആരും ഫോളോ ചെയ്യുന്നില്ല!</div>
</div>
</paper-card>
</template>
<template is="dom-if" if="{{ guestUser }}">
<paper-card class="follow-grid">
<div class="alert-message">
<iron-icon icon="icons:info-outline"></iron-icon>
<div><a class="pratilipi-blue" on-click="_login">താങ്കളെ ഫോളോ ചെയ്യുന്നവരെ കാണാന്‍ ലോഗിന്‍ ചെയ്യുക!</a></div>
</div>
</paper-card>
</template>
<paper-card class="row follow-grid secondary-500 pratilipi-shadow">
<template is="dom-repeat" items="{{ followList }}">
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<pratilipi-follow-author follow-object="{{ item }}"></pratilipi-follow-author>
</div>
</template>
</paper-card>
<template is="dom-if" if="{{ hasMore }}">
<template is="dom-if" if="{{ !isLoading }}">
<div class="load-more-button" on-click="_loadMore">കൂടുതല്‍ രചനകള്‍ കാണിക്കുക....</div>
</template>
</template>
<template is="dom-if" if="{{ isLoading }}">
<paper-spinner class="pratilipi-spinner pratilipi-spinner-center" active></paper-spinner>
</template>
</div>
</div>
</div>
</div>
</main>
<footer>
<pratilipi-footer></pratilipi-footer>
</footer>
<div class="scroll-top-button">
<a id="scrollToTop" on-click="scrollToTop"><paper-fab mini noink style="background: #c0c0c0;" icon="icons:arrow-upward"></paper-fab></a>
</div>
<iron-ajax
id="UserAuthorFollowListApi"
url="/api/userauthor/follow/list"
method="GET"
content-type="application/json"
handle-as="json"
on-response="_userAuthorFollowListApiResponse"
on-error="_userAuthorFollowListApiError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-followers-list-page',
properties: {
userData: { type: Object },
user: { type: Object, observer: "_userObserver" },
userLoaded: { type: Boolean },
guestUser: { type: Boolean },
author: { type: Object },
followersObject: { type: Object },
followList: { type: Array, value: function() { return []; } },
cursor: { type: String },
numberFound: { type: Number },
isLoading: { type: Boolean, value: false },
pratilipiTypes: { types: Object },
navigationList: { type: Array },
languageMap: { type: Object },
lastScrollTop: { type: Number, value: 0 }
},
_userObserver: function() {
this.set( 'guestUser', this.user.isGuest );
var followObject = this.querySelector( 'pratilipi-author-followers' ).processUserListObject( this.followersObject );
this.set( 'hasFollowers', ! this.user.isGuest && followObject != null && followObject.numberFound != null && followObject.numberFound > 0 );
this.set( 'noFollowers', ! this.user.isGuest && ( followObject == null || followObject.numberFound == null || followObject.numberFound == 0 ) );
this._processFollowObject( followObject );
if( this.userLoaded == null ) {
this.userLoaded = true;
return;
}
window.location.reload();
},
ready: function() {
jQuery( '#scrollToTop' ).css( "display", "none" );
},
_processFollowObject: function( followObject ) {
var followList = followObject.followList;
for( var i = 0; i < followList.length; i++ )
this.push( 'followList', followList[i] );
this.set( 'cursor', followObject.cursor );
this.set( 'numberFound', followObject.numberFound );
this.set( 'hasMore', followList.length == 20 && followObject.cursor != null );
},
_loadMore: function() {
this.set( 'isLoading', true );
this.$.UserAuthorFollowListApi.params.authorId = this.author.authorId;
this.$.UserAuthorFollowListApi.params.cursor = this.cursor;
this.$.UserAuthorFollowListApi.generateRequest();
},
_userAuthorFollowListApiResponse: function( response ) {
this.set( 'isLoading', false );
this._processFollowObject( this.querySelector( 'pratilipi-author-followers' ).processUserListObject( response.detail.response ) );
},
_userAuthorFollowListApiError: function( response ) {
this.set( 'isLoading', false );
},
_login: function() {
this.querySelector( 'pratilipi-user' ).logIn();
},
scrollToTop: function() {
$( 'html, body' ).animate( { scrollTop : 0 },800 );
},
scrollHandler: function( st ) {
if( st > this.lastScrollTop || st < 100 )
jQuery( '#scrollToTop' ).fadeOut();
else
jQuery( '#scrollToTop' ).fadeIn();
this.lastScrollTop = st;
}
});
</script>
</dom-module><dom-module id="pratilipi-following-list-page">
<style>
:host {
display: block;
}
@media only screen and (max-width: 767px) {
main {
padding-top: 85px;
}
}
@media only screen and (min-width: 768px) {
main {
padding-top: 52px;
}
}
paper-card.follow-grid {
margin: 4px 0 6px 0;
width: 100%;
--paper-card-header: { display: none };
}
.card-heading {
padding: 12px 16px;
}
.card-heading h6 {
margin-top: 8px;
margin-bottom: 6px;
}
.card-heading div {
font-size: 13px;
}
.load-more-button {
margin-top: 4px;
background: #F1F8FB;
padding: 18px;
text-align: center;
color: #0C68BD;
cursor: pointer;
font-size: 14px;
font-weight: 700;
line-height: 14px;
text-shadow: 0px 1px 2px #FFFFFF;
border: 1px solid #0C68BD;
border-radius: 4px;
}
paper-spinner.pratilipi-spinner {
line-height: 52px;
--paper-spinner-layer-1-color: #D0021B;
--paper-spinner-layer-2-color: #107FE5;
--paper-spinner-layer-3-color: #D0021B;
--paper-spinner-layer-4-color: #107FE5;
}
.alert-message {
padding: 24px;
text-align: center;
margin: auto;
font-weight: bold;
}
.alert-message iron-icon {
width: 48px;
height: 48px;
margin-bottom: 12px;
}
</style>
<template>
<pratilipi-user user='{{ user }}' user-data="[[ userData ]]"></pratilipi-user>
<pratilipi-edit-account user='[[ user ]]'></pratilipi-edit-account>
<pratilipi-write language-map="[[ languageMap ]]" pratilipi-types='[[ pratilipiTypes ]]'></pratilipi-write>
<pratilipi-alert></pratilipi-alert>
<div class="header-pos">
<pratilipi-android-launch-test></pratilipi-android-launch-test> </div>
<main>
<pratilipi-header language-map="[[ languageMap ]]" user='[[ user ]]'></pratilipi-header>
<div class="parent-container margin-top-bottom">
<div class="container">
<pratilipi-navigation
class='pull-left hidden-xs hidden-sm'
navigation-list='[[ navigationList ]]'
></pratilipi-navigation>
<pratilipi-navigation-drawer with-backdrop navigation-list='[[ navigationList ]]'></pratilipi-navigation-drawer>
<div style="overflow:hidden; padding: 0 2px;">
<div id="androidLaunchBottom">
<pratilipi-author-following no-display></pratilipi-author-following>
<div class="secondary-500 pratilipi-shadow card-heading">
<h6 class="pratilipi-red">ഇദ്ദേഹം ഫോളോ ചെയ്യുന്നത്</h6>
<template is="dom-if" if="{{ hasFollowing }}">
<div>{{ numberFound }} പേര്‍</div>
</template>
</div>
<template is="dom-if" if="{{ noFollowing }}">
<paper-card class="follow-grid">
<div class="alert-message">
<iron-icon icon="icons:info-outline"></iron-icon>
<div>ക്ഷമിക്കണം! താങ്കള്‍ ആരെയും ഫോളോ ചെയ്യുന്നില്ല!</div>
</div>
</paper-card>
</template>
<template is="dom-if" if="{{ guestUser }}">
<paper-card class="follow-grid">
<div class="alert-message">
<iron-icon icon="icons:info-outline"></iron-icon>
<div><a class="pratilipi-blue" on-click="_login">താങ്കള്‍ ഫോളോ ചെയ്യുന്നവരെ കാണാന്‍ ലോഗിന്‍ ചെയ്യുക!</a></div>
</div>
</paper-card>
</template>
<paper-card class="row follow-grid secondary-500 pratilipi-shadow">
<template is="dom-repeat" items="{{ followList }}">
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<pratilipi-follow-author follow-object="{{ item }}"></pratilipi-follow-author>
</div>
</template>
</paper-card>
<template is="dom-if" if="{{ hasMore }}">
<template is="dom-if" if="{{ !isLoading }}">
<div class="load-more-button" on-click="_loadMore">കൂടുതല്‍ രചനകള്‍ കാണിക്കുക....</div>
</template>
</template>
<template is="dom-if" if="{{ isLoading }}">
<paper-spinner class="pratilipi-spinner pratilipi-spinner-center" active></paper-spinner>
</template>
</div>
</div>
</div>
</div>
</main>
<footer>
<pratilipi-footer></pratilipi-footer>
</footer>
<div class="scroll-top-button">
<a id="scrollToTop" on-click="scrollToTop"><paper-fab mini noink style="background: #c0c0c0;" icon="icons:arrow-upward"></paper-fab></a>
</div>
<iron-ajax
id="UserAuthorFollowListApi"
url="/api/userauthor/follow/list"
method="GET"
content-type="application/json"
handle-as="json"
on-response="_userAuthorFollowListApiResponse"
on-error="_userAuthorFollowListApiError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-following-list-page',
properties: {
userData: { type: Object },
user: { type: Object, observer: "_userObserver" },
userLoaded: { type: Boolean },
guestUser: { type: Boolean },
author: { type: Object },
followingObject: { type: Object },
followList: { type: Array, value: function() { return []; } },
cursor: { type: String },
numberFound: { type: Number },
isLoading: { type: Boolean, value: false },
pratilipiTypes: { types: Object },
navigationList: { type: Array },
languageMap: { type: Object },
lastScrollTop: { type: Number, value: 0 }
},
_userObserver: function() {
this.set( 'guestUser', this.user.isGuest );
var followObject = this.querySelector( 'pratilipi-author-following' ).processAuthorListObject( this.followingObject );
this.set( 'hasFollowing', ! this.user.isGuest && followObject != null && followObject.numberFound != null && followObject.numberFound > 0 );
this.set( 'noFollowing', ! this.user.isGuest && ( followObject == null || followObject.numberFound == null || followObject.numberFound == 0 ) );
this._processFollowObject( followObject );
if( this.userLoaded == null ) {
this.userLoaded = true;
return;
}
window.location.reload();
},
ready: function() {
jQuery( '#scrollToTop' ).css( "display", "none" );
},
_processFollowObject: function( followObject ) {
var followList = followObject.followList;
for( var i = 0; i < followList.length; i++ )
this.push( 'followList', followList[i] );
this.set( 'cursor', followObject.cursor );
this.set( 'numberFound', followObject.numberFound );
this.set( 'hasMore', followList.length == 20 && followObject.cursor != null );
},
_loadMore: function() {
this.set( 'isLoading', true );
this.$.UserAuthorFollowListApi.params.userId = this.author.user.userId;
this.$.UserAuthorFollowListApi.params.cursor = this.cursor;
this.$.UserAuthorFollowListApi.generateRequest();
},
_userAuthorFollowListApiResponse: function( response ) {
this.set( 'isLoading', false );
this._processFollowObject( this.querySelector( 'pratilipi-author-following' ).processAuthorListObject( response.detail.response ) );
},
_userAuthorFollowListApiError: function( response ) {
this.set( 'isLoading', false );
},
_login: function() {
this.querySelector( 'pratilipi-user' ).logIn();
},
scrollToTop: function() {
$( 'html, body' ).animate( { scrollTop : 0 },800 );
},
scrollHandler: function( st ) {
if( st > this.lastScrollTop || st < 100 )
jQuery( '#scrollToTop' ).fadeOut();
else
jQuery( '#scrollToTop' ).fadeIn();
this.lastScrollTop = st;
}
});
</script>
</dom-module><dom-module id="pratilipi-author-library-contents">
<style>
:host {
display: block;
margin-bottom: 4px;
}
:host paper-card {
display: block;
width: 100%;
padding: 12px 8px;
--paper-card-header: { display: none };
}
h6 {
font-weight: 700;
}
hr {
margin-top: 1em;
margin-bottom: 1.2em;
border: 0;
border-top: 2px solid #eee;
}
.more-button {
margin-top: 16px;
background: #F1F8FB;
padding: 16px;
text-align: center;
color: #0C68BD;
cursor: pointer;
font-size: 14px;
font-weight: 700;
line-height: 14px;
text-shadow: 0px 1px 2px #FFFFFF;
}
paper-spinner {
margin: 16px auto;
display: block;
--paper-spinner-layer-1-color: #D0021B;
--paper-spinner-layer-2-color: #107FE5;
--paper-spinner-layer-3-color: #D0021B;
--paper-spinner-layer-4-color: #107FE5;
}
.empty-library {
padding: 32px 16px;
text-align: center;
}
.empty-library iron-icon {
height: 46px;
width: 46px;
margin-bottom: 16px;
}
.empty-library h6 {
font-size: 15px;
line-height: 24px;
font-weight: 500;
}
/* Bootstrap overrides */
.row {
margin-left: -8px;
margin-right: -8px;
}
.col-xs-4, .col-sm-3, .col-md-3, .col-lg-3 {
padding-left: 8px;
padding-right: 8px;
}
</style>
<template>
<paper-card>
<h6 class="text-center pratilipi-red">
എന്‍റെ ലൈബ്രറി
</h6>
<hr/>
<div class="row text-center">
<template is="dom-repeat" items="{{ pratilipiList }}" as="pratilipi">
<div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
<pratilipi-card-mini pratilipi="{{ pratilipi }}"></pratilipi-card-mini>
</div>
</template>
</div>
<template is="dom-if" if="{{ isLoading }}">
<paper-spinner active></paper-spinner>
</template>
<template is="dom-if" if="{{ !isFinished }}">
<div class="more-button" on-click="loadMore">കൂടുതല്‍ കാണിക്കൂ...</div>
</template>
<template is="dom-if" if="{{ !hasContent }}">
<div class="empty-library">
<iron-icon icon="icons:info-outline"></iron-icon>
<h6>ക്ഷമിക്കണം! താങ്കളുടെ വായനശാലയില്‍ രചനകള്‍ ഒന്നും തന്നെ ഇല്ല, താങ്കള്‍ക്ക് വേണ്ട രചനയുടെ പേജില്‍ പോയി വായനശാലയിലേക്ക് ചേര്‍ക്കാവുന്നതാണ്.</h6>
</div>
</template>
</paper-card>
<iron-ajax
id="UserPratilipiLibraryListApi"
url="/api/userpratilipi/library/list"
method="GET"
content-type="application/json"
handle-as="json"
on-response="_userPratilipiLibraryListApiResponse"
on-error="_userPratilipiLibraryListApiError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-author-library-contents',
properties: {
pratilipiList: { type: Array },
cursor: { type: String, value: null },
resultCount: { type: Number, value: 20 },
isLoading: { type: Boolean, value: false },
isFinished: { type: Boolean, value: false },
hasContent: { type: Boolean }
},
processPratilipiListObject: function( pratilipiListObject ) {
var pratilipiList = pratilipiListObject.pratilipiList;
for( var i = 0; i < pratilipiList.length; i++ )
this.push( 'pratilipiList', pratilipiList[i] );
this.set( 'cursor', pratilipiListObject.cursor );
this.set( 'isFinished', pratilipiList.length < this.resultCount );
this.set( 'hasContent', this.pratilipiList.length > 0 );
},
ready: function() {
this.set( 'isFinished', this.pratilipiList.length < this.resultCount );
},
loadMore: function() {
// Return if there is an active call or cursor = null.
if( this.isLoading || this.isFinished || this.cursor == null || this.cursor == "" )
return;
// Check for window height.
var reqHeight = jQuery( window ).scrollTop()
- jQuery( this ).position().top
+ jQuery( window ).height()
+ 2 * jQuery( window ).height();
if( jQuery( this ).outerHeight( true ) >= reqHeight )
return;
this.set( 'isLoading', true );
this.set( 'isFinished', false );
if( this.cursor != null )
this.$.UserPratilipiLibraryListApi.params.cursor = this.cursor;
else
delete this.$.UserPratilipiLibraryListApi.params.cursor;
this.$.UserPratilipiLibraryListApi.params.resultCount = this.resultCount;
this.$.UserPratilipiLibraryListApi.generateRequest();
ga_CA( 'Pratilipi', 'LoadMore' );
},
_userPratilipiLibraryListApiResponse: function( response ) {
this.set( 'isLoading', false );
this.processPratilipiListObject( response.detail.response );
},
_userPratilipiLibraryListApiError: function( response ) {
this.set( 'isLoading', false );
this.set( 'isFinished', false );
var message = response.detail.request.xhr.response.message != null ?
response.detail.request.xhr.response.message : "എന്തോ സാങ്കേതിക പ്രശ്നം സംഭവിച്ചിരിക്കുന്നു. വീണ്ടും ശ്രമിക്കൂ";
document.querySelector( 'pratilipi-alert' ).alert( message, false );
}
});
</script>
</dom-module>
<dom-module id="pratilipi-library-page">
<template>
<pratilipi-user user='{{ user }}' user-data="[[ userData ]]"></pratilipi-user>
<pratilipi-write language-map="[[ languageMap ]]" pratilipi-types='[[ pratilipiTypes ]]'></pratilipi-write>
<pratilipi-alert></pratilipi-alert>
<div class="header-pos">
<pratilipi-android-launch-test></pratilipi-android-launch-test> </div>
<main>
<pratilipi-header language-map="[[ languageMap ]]" user='[[ user ]]'></pratilipi-header>
<div class="parent-container margin-top-bottom">
<div class="container">
<pratilipi-navigation
class='pull-left hidden-xs hidden-sm'
navigation-list='[[ navigationList ]]'
></pratilipi-navigation>
<!-- Navigation & Search bar for extra-small & small screens. -->
<pratilipi-navigation-drawer with-backdrop navigation-list='[[ navigationList ]]'></pratilipi-navigation-drawer>
<div style="overflow: hidden; padding: 0 2px;">
<div id="androidLaunchBottom">
<pratilipi-author-library-contents pratilipi-list="[[ pratilipiList ]]" cursor="[[ cursor ]]">
</pratilipi-author-library-contents>
</div>
</div>
</div>
</div>
</main>
<footer>
<pratilipi-footer></pratilipi-footer>
</footer>
<div class="scroll-top-button">
<a id="scrollToTop" on-click="scrollToTop"><paper-fab mini noink style="background: #c0c0c0;" icon="icons:arrow-upward"></paper-fab></a>
</div>
</template>
<script>
Polymer({
is: 'pratilipi-library-page',
properties: {
userData: { type: Object },
user: { type: Object, observer: "_userChanged" },
pratilipiList: { type: Array },
navigationList: { type: Array },
pratilipiTypes: { types: Object },
languageMap: { type: Object },
lastScrollTop: { type: Number, value: 0 },
cursor: { type: String },
isLoading: { type: Boolean, value: false },
isFinished: { type: Boolean, value: false },
includeShowMoreButton: { type: Boolean, value: false },
},
_userChanged: function() {
if( this.user.isGuest )
window.location.href = "/";
},
scrollToTop: function() {
$( 'html, body' ).animate( { scrollTop : 0 },800 );
},
ready: function() {
jQuery( '#scrollToTop' ).css( "display", "none" );
},
scrollHandler: function( st ) {
if( st > this.lastScrollTop || st < 100 ) {
jQuery( '#scrollToTop' ).fadeOut();
this.querySelector( 'pratilipi-author-library-contents' ).loadMore( st );
}
else {
jQuery( '#scrollToTop' ).fadeIn();
}
this.lastScrollTop = st;
}
});
</script>
</dom-module><dom-module id="pratilipi-notification-settings">
<style>
:host {
display: block;
}
.pratilipi-logo {
width: 64px;
height: 64px;
display: block;
margin: auto;
margin-bottom: 12px;
}
paper-dropdown-menu.pratilipi-blue {
width: 100%;
--paper-dropdown-menu-focus-color: #107fe5;
--paper-dropdown-menu-input-color: #107fe5;
--primary-text-color: #107fe5;
--paper-input-container: {
color: #107fe5;
};
--paper-input-container-input: {
font-family: inherit;
color: #333;
};
--paper-input-container-underline: {
background: #333;
color: #333;
};
--paper-input-container-label: {
font-size: 15px;
font-family: inherit;
text-align: left;
color: #333;
};
--paper-input-container-focus:{
color: #333;
};
}
paper-menu {
--paper-menu-color: #333;
width: 100%;
--paper-menu-focused-item: {
color: #333;
};
--paper-item-focused-before: {
color: #333;
background: #fff;
};
}
paper-menu paper-item {
font-size: 15px;
font-family: inherit;
color: #333;
white-space: nowrap;
}
paper-checkbox.pratilipi-blue {
align-self: center;
--paper-checkbox-checked-color: #107fe5;
--paper-checkbox-checked-ink-color: #333;
--paper-checkbox-unchecked-color: #107fe5;
--paper-checkbox-unchecked-ink-color: #333;
--paper-checkbox-label-color: #333;
--paper-checkbox-label-spacing: 0;
--paper-checkbox-margin: 0 8px 8px 0;
--paper-checkbox-vertical-align: top;
}
.settings-group {
padding-top: 20px;
}
.settings-group h6 {
color: #000;
}
paper-spinner.new-spinner {
position: absolute;
top: 0;
left: 0;
right: 0;
bottom: 0;
margin: auto;
--paper-spinner-layer-1-color: #D0021B;
--paper-spinner-layer-2-color: #107FE5;
--paper-spinner-layer-3-color: #D0021B;
--paper-spinner-layer-4-color: #107FE5;
}
.row {padding-left: 10px;padding-right: 10px;}
.modal-body{padding-bottom: 0;}
.modal-content {border-radius: 0;}
.pull-center {display:block;margin-left:auto;margin-right:auto;text-align:center;}
.modal-fullscreen .modal-dialog .modal-content {max-width: 768px;padding-top:16px;}
</style>
<template>
<div class="modal modal-fullscreen fade" id="pratilipiNotificationSettings" role="dialog" tabindex="-1">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-fullscreen-close-button">
<paper-icon-button noink icon="close" data-dismiss="modal"></paper-icon-button>
</div>
<iron-image class="pratilipi-logo"
style="background-color: #f5f5f5"
fade preload
sizing="cover"
src="http://public.pratilipi.com/pratilipi-logo/png/Logo-2C-RGB-80px.png"
alt="പ്രതിലിപി"
title="പ്രതിലിപി"></iron-image>
<h6 class="text-center">നോട്ടിഫിക്കേഷന്‍ സെറ്റിംഗ്സ്</h6>
<paper-spinner class="new-spinner" active="{{ spinnerActive }}"></paper-spinner>
<paper-dropdown-menu id="selectEmailFrequency" noink label="ഇമെയില്‍ അയക്കേണ്ട രീതി" vertical-align="top" horizontal-align="right" class="pratilipi-blue">
<paper-menu selected="{{ selectedEmailFrequency }}" noink class="dropdown-content" style="white-space: nowrap; width: auto;">
<paper-item value="IMMEDIATELY">ഉടനെ</paper-item>
<paper-item value="DAILY">ദിവസത്തില്‍ ഒരിക്കല്‍</paper-item>
<paper-item value="WEEKLY">ആഴ്ചയില്‍ ഒരിക്കല്‍</paper-item>
<paper-item value="MONTHLY">മാസത്തില്‍ ഒരിക്കല്‍</paper-item>
<paper-item value="NEVER">ഒരിക്കലും വേണ്ട</paper-item>
</paper-menu>
</paper-dropdown-menu>
<div class="settings-group">
<h6>രചന</h6>
<div class="row">
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<paper-checkbox value="USER_PRATILIPI_REVIEW" class="pratilipi-blue" noink>പുതിയ റിവ്യൂ</paper-checkbox>
</div>
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<paper-checkbox value="COMMENT_REVIEW_REVIEWER" class="pratilipi-blue" noink>പുതിയ കമന്റ്</paper-checkbox>
</div>
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<paper-checkbox value="VOTE_REVIEW_REVIEWER" class="pratilipi-blue" noink>റിവ്യൂയ്ക്ക് ലൈക്ക്</paper-checkbox>
</div>
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<paper-checkbox value="VOTE_COMMENT_REVIEW_COMMENTOR" class="pratilipi-blue" noink>കമന്റിന് പുതിയ ലൈക്ക്</paper-checkbox>
</div>
</div>
</div>
<div class="settings-group">
<h6>നെറ്റ് വര്‍ക്ക്</h6>
<div class="row">
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<paper-checkbox value="AUTHOR_FOLLOW" class="pratilipi-blue" noink>പുതിയ ഫോളോവര്‍</paper-checkbox>
</div>
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<paper-checkbox value="PRATILIPI_PUBLISHED_FOLLOWER" class="pratilipi-blue" noink>നിങ്ങള്‍ ഫോളോ ചെയ്യുന്നവരില്‍ നിന്നും പുതിയ രചന</paper-checkbox>
</div>
<div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
<paper-checkbox value="GENERIC" class="pratilipi-blue" noink>പ്രതിലിപിയുടെ അപ്ഡേറ്റുകളും ഓഫറുകളും</paper-checkbox>
</div>
</div>
</div>
</div>
</div>
<div class="modal-footer">
<div class="display-message-div"><p>{{ message }}</p></div>
<button disabled="{{ !canSaveChanges }}" style="position: fixed; bottom: 15px; right: 15px;" class="pratilipi-new-blue-button" type="button" on-click="onSubmit" onclick="ga_CA( 'Notification', 'Update' )">മാറ്റങ്ങള്‍ സേവ് ചെയ്യൂ</button>
</div>
</div>
</template>
<script>
function firebaseCallback( preferences ) {
document.querySelector( 'pratilipi-notification-settings' ).firebaseCallback( preferences );
}
Polymer({
is: 'pratilipi-notification-settings',
properties: {
selectedEmailFrequency: { type: Number },
message: { type: String },
canSaveChanges: { type: Boolean }
},
stopUserInteraction: function() {
// Enable spinner and disable button
this.set( 'canSaveChanges', false );
this.set( 'spinnerActive', true );
},
resumeUserInteration: function() {
// Enable button and disable spinner
this.set( 'canSaveChanges', true );
this.set( 'spinnerActive', false );
},
open: function() {
jQuery( "#pratilipiNotificationSettings" ).modal();
this.stopUserInteraction();
getNotificationPreferences( firebaseCallback );
},
close: function() {
jQuery( "#pratilipiNotificationSettings" ).modal( 'hide' );
},
firebaseCallback: function( preferences ) {
var emailFrequency = preferences[ "emailFrequency" ] != null ? preferences[ "emailFrequency" ] : "IMMEDIATELY";
var i = 0;
$( "pratilipi-notification-settings #selectEmailFrequency paper-menu paper-item" ).each( function() {
if( $( this ).attr( "value" ) === emailFrequency ) {
return false;
} i++;
});
this.set( 'selectedEmailFrequency', i );
var notificationSubscriptions = preferences[ "notificationSubscriptions" ] != null ?
preferences[ "notificationSubscriptions" ] : {};
$( "pratilipi-notification-settings #pratilipiNotificationSettings paper-checkbox" ).each( function() {
$( this ).prop( 'checked', notificationSubscriptions[ $( this ).val() ] != null ?
notificationSubscriptions[ $( this ).val() ] : true );
});
this.resumeUserInteration();
},
onSubmit: function() {
var preferences = {};
preferences[ "emailFrequency" ] = this.$.selectEmailFrequency.selectedItem.getAttribute( "value" );
preferences[ "notificationSubscriptions" ] = {};
$( "pratilipi-notification-settings #pratilipiNotificationSettings paper-checkbox" ).each( function() {
preferences[ "notificationSubscriptions" ][ $( this ).val() ] = this.checked;
});
this.stopUserInteraction();
setNotificationPreferences( preferences );
// Feedback here
this.set( "message", "വിജയകരമായി പൂര്‍ത്തീകരിച്ചിരിക്കുന്നു!" );
this.async( function() {
this.resumeUserInteration();
this.set( "message", null );
this.close();
ga_CA( 'User', 'SubmitNotification' );
}, 1000 );
}
});
</script>
</dom-module>
<dom-module id="pratilipi-notification-grid">
<style>
:host {
display: block;
width: 100%;
margin-bottom: 4px;
}
paper-card.notifications-heading {
width: 100%;
margin-bottom: 6px;
background: #fff;
padding: 12px 16px;
font-size: 15px;
font-weight: 700;
}
paper-card.notifications-heading h5 {
font-weight: 700;
}
.load-more-button {
margin-top: 4px;
background: #F1F8FB;
padding: 18px;
text-align: center;
color: #0C68BD;
cursor: pointer;
font-size: 14px;
font-weight: 700;
line-height: 14px;
text-shadow: 0px 1px 2px #FFFFFF;
border: 1px solid #0C68BD;
border-radius: 4px;
}
paper-spinner.pratilipi-spinner {
line-height: 52px;
--paper-spinner-layer-1-color: #D0021B;
--paper-spinner-layer-2-color: #107FE5;
--paper-spinner-layer-3-color: #D0021B;
--paper-spinner-layer-4-color: #107FE5;
}
paper-card.alert-message {
display: block;
width: 100%;
margin: 0;
padding: 24px;
text-align: center;
font-weight: bold;
}
paper-card.alert-message iron-icon {
width: 48px;
height: 48px;
margin-bottom: 12px;
}
paper-icon-button.settings-icon {
--paper-fab-background: #333;
margin-top: -38px;
}
</style>
<template>
<paper-card class="notifications-heading">
<h5 class="pratilipi-red">നോട്ടിഫിക്കേഷന്‍സ്</h5>
<paper-icon-button hidden$="{{ isGuest }}" noink icon="icons:settings"
class="settings-icon pull-right"
on-click="openNotificationSettings" onclick="ga_CA( 'Notification', 'Settings' )"></paper-icon-button>
</paper-card>
<template is="dom-if" if="{{ isGuest }}">
<paper-card class="alert-message">
<iron-icon icon="icons:info-outline"></iron-icon>
<div><a class="pratilipi-blue" on-click="_login">താങ്കള്‍ ഫോളോ ചെയ്യുന്നവരില്‍ നിന്നും നോട്ടിഫിക്കേഷന്‍സ് ലഭിക്കാന്‍ ലോഗിന്‍ ചെയ്യൂ</a></div>
</paper-card>
</template>
<template is="dom-if" if="{{ emptyNotificationList }}">
<paper-card class="alert-message">
<iron-icon icon="icons:info-outline"></iron-icon>
<div>ക്ഷമിക്കണം, താങ്കള്‍ക്ക് ഇപ്പോള്‍ നോട്ടിഫിക്കേഷന്‍സ് ഒന്നുമില്ല! പിന്നീട് നോക്കൂ!</div>
</paper-card>
</template>
<template is="dom-repeat" items="{{ notificationList }}" as="notification">
<template is="dom-if" if="{{ notification.message }}">
<pratilipi-notification-snippet notification="{{ notification }}"></pratilipi-notification-snippet>
</template>
</template>
<template is="dom-if" if="{{ hasMore }}">
<template is="dom-if" if="{{ !isLoading }}">
<div class="load-more-button" on-click="_loadMore" onclick="ga_CA( 'Notification', 'Load More' )">കൂടുതല്‍ കാണൂ...</div>
</template>
</template>
<template is="dom-if" if="{{ isLoading }}">
<paper-spinner class="pratilipi-spinner pratilipi-spinner-center" active></paper-spinner>
</template>
<iron-ajax
id="NotificationListApi"
url="/api/notification/list"
method="GET"
content-type="application/json"
handle-as="json"
on-response="_notificationListApiResponse"
on-error="_notificationListApiError"
></iron-ajax>
</template>
<script>
Polymer({
is: 'pratilipi-notification-grid',
properties: {
notificationObject: { type: Object },
notificationList: { type: Array, value: function() { return []; } },
cursor: { type: String, value: null },
isLoading: { type: Boolean, value: false },
isGuest: { type: Boolean }
},
_processNotificationObject: function( notificationObject ) {
var notificationList = notificationObject.notificationList;
for( var i = 0; i < notificationList.length; i++ )
this.push( 'notificationList', notificationList[i] );
this.set( 'cursor', notificationObject.cursor );
this.set( 'hasMore', notificationList.length == 20 && this.cursor != null );
},
_loadMore: function() {
this.set( 'isLoading', true );
this.$.NotificationListApi.params.cursor = this.cursor;
this.$.NotificationListApi.generateRequest();
},
_notificationListApiResponse: function( response ) {
this._processNotificationObject( response.detail.response );
this.set( 'isLoading', false );
},
_notificationListApiError: function( response ) {
this.set( 'isLoading', false );
},
ready: function() {
this._processNotificationObject( this.notificationObject );
},
attached: function() {
this.set( 'isGuest', document.querySelector( 'pratilipi-user' ).getCurrentUser().isGuest );
this.set( 'emptyNotificationList', ! this.isGuest && this.notificationList.length == 0 )
},
_login: function() {
document.querySelector( 'pratilipi-user' ).logIn( true, "താങ്കള്‍ ഫോളോ ചെയ്യുന്നവരില്‍ നിന്നും നോട്ടിഫിക്കേഷന്‍സ് ലഭിക്കാന്‍ ലോഗിന്‍ ചെയ്യൂ" );
},
openNotificationSettings: function() {
this.domHost.openNotificationSettings();
}
});
</script>
</dom-module>
<dom-module id="pratilipi-notification-page">
<style>
:host {
display: block;
}
@media only screen and (max-width: 767px) {
main {
padding-top: 85px;
}
}
@media only screen and (min-width: 768px) {
main {
padding-top: 52px;
}
}
</style>
<template>
<pratilipi-user user='{{ user }}' user-data="[[ userData ]]"></pratilipi-user>
<pratilipi-edit-account user='[[ user ]]'></pratilipi-edit-account>
<pratilipi-write language-map="[[ languageMap ]]" pratilipi-types='[[ pratilipiTypes ]]'></pratilipi-write>
<pratilipi-alert></pratilipi-alert>
<pratilipi-notification-settings></pratilipi-notification-settings>
<div class="header-pos">
<pratilipi-android-launch-test></pratilipi-android-launch-test> </div>
<main>
<pratilipi-header language-map="[[ languageMap ]]" user='[[ user ]]'></pratilipi-header>
<div class="parent-container margin-top-bottom">
<div class="container">
<pratilipi-navigation
class='pull-left hidden-xs hidden-sm'
navigation-list='[[ navigationList ]]'
></pratilipi-navigation>
<pratilipi-navigation-drawer with-backdrop navigation-list='[[ navigationList ]]'></pratilipi-navigation-drawer>
<div style="overflow:hidden; padding: 0 2px;">
<div id="androidLaunchBottom">
<pratilipi-notification-grid
notification-object="{{ notificationObject }}"></pratilipi-notification-grid>
</div>
</div>
</div>
</div>
</main>
<footer>
<pratilipi-footer></pratilipi-footer>
</footer>
<div class="scroll-top-button">
<a id="scrollToTop" on-click="scrollToTop"><paper-fab mini noink style="background: #c0c0c0;" icon="icons:arrow-upward"></paper-fab></a>
</div>
</template>
<script>
Polymer({
is: 'pratilipi-notification-page',
properties: {
userData: { type: Object },
user: { type: Object, observer: "_userObserver" },
userLoaded: { type: Boolean },
guestUser: { type: Boolean },
notificationObject: { type: Object },
navigationList: { type: Array },
pratilipiTypes: { types: Object },
languageMap: { type: Object },
lastScrollTop: { type: Number, value: 0 }
},
_userObserver: function() {
this.set( 'guestUser', this.user.isGuest );
if( this.userLoaded == null ) {
this.userLoaded = true;
return;
}
window.location.reload();
},
_login: function() {
document.querySelector( 'pratilipi-user' ).logIn( true, "താങ്കള്‍ ഫോളോ ചെയ്യുന്നവരില്‍ നിന്നും നോട്ടിഫിക്കേഷന്‍സ് ലഭിക്കാന്‍ ലോഗിന്‍ ചെയ്യൂ" );
},
openNotificationSettings: function() {
if( this.guestUser ) {
this._login();
return;
}
this.querySelector( "pratilipi-notification-settings" ).open();
},
attached: function() {
if( this.guestUser ) {
this._login();
return;
}
var action = getUrlParameter( "action" );
if( action == "settings" ) {
this.openNotificationSettings();
return;
}
},
scrollHandler: function( st ) {
if( st > this.lastScrollTop || st < 100 )
jQuery( '#scrollToTop' ).fadeOut();
else
jQuery( '#scrollToTop' ).fadeIn();
this.lastScrollTop = st;
}
});
</script>
</dom-module><dom-module id="pratilipi-android-launch">
<style>
.android-banner {
border-radius: 1px;
cursor: pointer;
padding: 0;
display: none;
color: #fff;
background-color: #1e1e1e;
border-color: #1e1e1e;
margin-bottom: 4px;
}
@media only screen and (max-width: 991px) {
.android-banner {
position: fixed;
z-index: 1049;
left: 0;
width: 100%;
margin: 0;
/* width: 98%;
margin-left: 1%;
margin-bottom: 0; */
}
}
</style>
<template>
<div id="androidAlert" class="alert alert-dismissible fade in android-banner" role="alert">
<button style="outline: none; right: 6px; opacity: 1; color: #fff!important; line-height: 64px;" type="button" class="close pull-right" data-dismiss="alert" aria-label="Close" onclick="androidBannerCrossed();" on-click="hide">
<iron-icon style="color: #fff;" icon="icons:close"></iron-icon>
</button>
<div style="padding: 7px 2px; width: 95%; width: calc(100% - 32px); display: flex;" onclick="androidBannerClicked(); window.open( 'https://play.google.com/store/apps/details?id=com.pratilipi.mobile.android&referrer=utm_source%3Dpratilipi_main_web%26utm_medium%3Dweb_bottom_strip%26utm_campaign%3Dapp_download' );">
<span style="font-weight: 400; align-self: center;">
<span style="font-size: 20px; line-height: 26px; padding-left: 8px;">ആപ്പ് ഡൗണ്‍ലോഡ് ചെയ്യൂ</span>
</span>
<img style="width: 40px; height: 40px; margin-right: 12px; align-self: center; margin-left: auto;" src="https://0.ptlp.co/resource-all/home-page/google_playstore_40.png"/>
</div>
</div>
</template>
<script>
Polymer({
is: 'pratilipi-android-launch',
behaviors: [
Polymer.IronResizableBehavior
],
listeners: {
'iron-resize': '_onIronResize'
},
created: function() {
this._onIronResize();
},
ready: function() {
var showBanner = getCookie( "USER_NOTIFIED_APP_LAUNCHED" ) == null || getCookie( "USER_NOTIFIED_APP_LAUNCHED" ) == "true";
if( showBanner ) {
$( this.querySelector( '#androidAlert' ) ).css( "display", "block" );
ga( 'send', 'event', 'app_download_strip', 'app_strip_show', 'android_app_download' );
}
},
_onIronResize: function() {
var windowsize = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
var mainDiv = document.getElementsByTagName( "main" );
var androidSubscribeAlert = $( this.querySelector( '#androidAlert' ) );
var button = $( this.querySelector( '#androidAlert button' ) );
if( $( androidSubscribeAlert ).css( "display" ) == "none" )
$( mainDiv ).css( "padding-top", 0 );
else
$( mainDiv ).css( "padding-top", $( androidSubscribeAlert ).height() );
$( button ).css( "line-height", $( androidSubscribeAlert ).height() + "px" );
},
hide: function() {
$( this.querySelector( '#androidAlert' ) ).css( "display", "none" );
this._onIronResize();
}
});
</script>
</dom-module><dom-module id="pratilipi-android-launch-test-hindi">
<style>
@media only screen and (min-width: 991px) {
.android-alert {
display: none !important;
}
}
</style>
<template>
<div style="display: none;background-color: white;padding: 10px;box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);" id="androidAlert" class="alert alert-dismissible fade in android-banner" role="alert">
<button style="outline: none; top:0;right: 0px; opacity: 1;" type="button" class="close pull-right" data-dismiss="alert" aria-label="Close" onclick="androidBannerCrossed();" on-click="hide">
<iron-icon icon="icons:close"></iron-icon>
</button>
<div style="display: flex">
<img style="width: 44px; height: 44px; align-self: center;" onclick="androidBannerClicked(); window.open( 'https://play.google.com/store/apps/details?id=com.pratilipi.mobile.android&referrer=utm_source%3Dpratilipi_main_web%26utm_medium%3Dweb_bottom_strip%26utm_campaign%3Dapp_download' );" src="http://public.pratilipi.com/pratilipi-logo/png/Logo-2C-RGB-80px.png"/>
<div class="">
<h4 style="margin-top: 5px;margin-bottom: 0;font-size: 20px;" onclick="androidBannerClicked(); window.open( 'https://play.google.com/store/apps/details?id=com.pratilipi.mobile.android&referrer=utm_source%3Dpratilipi_main_web%26utm_medium%3Dweb_bottom_strip%26utm_campaign%3Dapp_download' );">प्रतिलिपि एंड्राइड एप्लीकेशन </h4>
<img style="width: 90px;height: 18px;" src="http://public.pratilipi.com/images/Stars-for-App-Install-Strip.png" alt="">
</div>
</div>
<h5 style="color: rgba(0, 0, 0, 0.541);font-size: 16px;">बिना इन्टरनेट के भी अपनी मनपसंद कहानियां पढ़ें</h5>
<button type="button" name="button" class="pratilipi-light-blue-button" style="width: 100%;font-size: 16px;border: 0;background: #00a651;color: white;text-shadow: none;" onclick="androidBannerClicked(); window.open( 'https://play.google.com/store/apps/details?id=com.pratilipi.mobile.android&referrer=utm_source%3Dpratilipi_main_web%26utm_medium%3Dweb_bottom_strip%26utm_campaign%3Dapp_download' );">डाउनलोड करें</button>
</div>
</template>
<script>
Polymer({
is: 'pratilipi-android-launch-test-hindi',
behaviors: [
Polymer.IronResizableBehavior
],
listeners: {
'iron-resize': '_onIronResize'
},
created: function() {
this._onIronResize();
},
ready: function() {
var iOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
var windowsize = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
var showBanner = getCookie( "USER_NOTIFIED_APP_LAUNCHED" ) == null || getCookie( "USER_NOTIFIED_APP_LAUNCHED" ) == "true";
if( showBanner && isAndroid() ) {
$( this.querySelector( '#androidAlert' ) ).css( "display", "block" );
ga( 'send', 'event', 'app_download_strip', 'app_strip_show', 'android_app_download' );
}
},
_onIronResize: function() {
var windowsize = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
var mainDiv = document.getElementsByTagName( "main" );
var androidSubscribeAlert = $( this.querySelector( '#androidAlert' ) );
var button = $( this.querySelector( '#androidAlert button' ) );
if( $( androidSubscribeAlert ).css( "display" ) == "none" )
$( mainDiv ).css( "padding-top", 0 );
else
$( mainDiv ).css( "padding-top", $( androidSubscribeAlert ).outerHeight() + 4 );
},
hide: function() {
$( this.querySelector( '#androidAlert' ) ).css( "display", "none" );
this._onIronResize();
}
});
</script>
</dom-module><dom-module id="pratilipi-android-launch-test-gujarati">
<style>
@media only screen and (min-width: 991px) {
.android-alert {
display: none !important;
}
}
</style>
<template>
<div style="display: none;background-color: white;padding: 10px;box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);" id="androidAlert" class="alert alert-dismissible fade in android-banner" role="alert">
<button style="outline: none; top:0;right: 0px; opacity: 1;" type="button" class="close pull-right" data-dismiss="alert" aria-label="Close" onclick="androidBannerCrossed();" on-click="hide">
<iron-icon icon="icons:close"></iron-icon>
</button>
<div style="display: flex">
<img style="width: 44px; height: 44px; align-self: center;" onclick="androidBannerClicked(); window.open( 'https://play.google.com/store/apps/details?id=com.pratilipi.mobile.android&referrer=utm_source%3Dpratilipi_main_web%26utm_medium%3Dweb_bottom_strip%26utm_campaign%3Dapp_download' );" src="http://public.pratilipi.com/pratilipi-logo/png/Logo-2C-RGB-80px.png"/>
<div class="">
<h4 style="margin-top: 5px;margin-bottom: 0;font-size: 20px;" onclick="androidBannerClicked(); window.open( 'https://play.google.com/store/apps/details?id=com.pratilipi.mobile.android&referrer=utm_source%3Dpratilipi_main_web%26utm_medium%3Dweb_bottom_strip%26utm_campaign%3Dapp_download' );">પ્રતિલિપિ એંડ્રોઇડ એપ્લિકેશન</h4>
<img style="width: 90px;height: 18px;" src="http://public.pratilipi.com/images/Stars-for-App-Install-Strip.png" alt="">
</div>
</div>
<h5 style="color: rgba(0, 0, 0, 0.541);font-size: 16px;">ઈન્ટરનેટ વિના પણ મનપસંદ વાર્તાઓ વાંચો</h5>
<button type="button" name="button" class="pratilipi-light-blue-button" style="width: 100%;font-size: 16px;border: 0;background: #00a651;color: white;text-shadow: none;" onclick="androidBannerClicked(); window.open( 'https://play.google.com/store/apps/details?id=com.pratilipi.mobile.android&referrer=utm_source%3Dpratilipi_main_web%26utm_medium%3Dweb_bottom_strip%26utm_campaign%3Dapp_download' );">ડાઉનલોડ કરો</button>
</div>
</template>
<script>
Polymer({
is: 'pratilipi-android-launch-test-gujarati',
behaviors: [
Polymer.IronResizableBehavior
],
listeners: {
'iron-resize': '_onIronResize'
},
created: function() {
this._onIronResize();
},
ready: function() {
var iOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
var windowsize = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
var showBanner = getCookie( "USER_NOTIFIED_APP_LAUNCHED" ) == null || getCookie( "USER_NOTIFIED_APP_LAUNCHED" ) == "true";
if( showBanner && isAndroid() ) {
$( this.querySelector( '#androidAlert' ) ).css( "display", "block" );
ga( 'send', 'event', 'app_download_strip', 'app_strip_show', 'android_app_download' );
}
},
_onIronResize: function() {
var windowsize = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
var mainDiv = document.getElementsByTagName( "main" );
var androidSubscribeAlert = $( this.querySelector( '#androidAlert' ) );
var button = $( this.querySelector( '#androidAlert button' ) );
if( $( androidSubscribeAlert ).css( "display" ) == "none" )
$( mainDiv ).css( "padding-top", 0 );
else
$( mainDiv ).css( "padding-top", $( androidSubscribeAlert ).outerHeight() + 4 );
},
hide: function() {
$( this.querySelector( '#androidAlert' ) ).css( "display", "none" );
this._onIronResize();
}
});
</script>
</dom-module><dom-module id="pratilipi-android-launch-test">
<style>
@media only screen and (min-width: 991px) {
.android-alert {
display: none !important;
}
}
</style>
<template>
<div style="display: none;background-color: white;padding: 10px;box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);" id="androidAlert" class="alert alert-dismissible fade in android-banner" role="alert">
<button style="outline: none; top:0;right: 0px; opacity: 1;" type="button" class="close pull-right" data-dismiss="alert" aria-label="Close" onclick="androidBannerCrossed();" on-click="hide">
<iron-icon icon="icons:close"></iron-icon>
</button>
<div style="display: flex">
<img style="width: 44px; height: 44px; align-self: center;" onclick="androidBannerClicked(); window.open( 'https://play.google.com/store/apps/details?id=com.pratilipi.mobile.android&referrer=utm_source%3Dpratilipi_main_web%26utm_medium%3Dweb_bottom_strip%26utm_campaign%3Dapp_download' );" src="http://public.pratilipi.com/pratilipi-logo/png/Logo-2C-RGB-80px.png"/>
<div class="">
<h4 style="margin-top: 5px;margin-bottom: 0;font-size: 16px;" onclick="androidBannerClicked(); window.open( 'https://play.google.com/store/apps/details?id=com.pratilipi.mobile.android&referrer=utm_source%3Dpratilipi_main_web%26utm_medium%3Dweb_bottom_strip%26utm_campaign%3Dapp_download' );">പ്രതിലിപി ആന്‍ഡ്രോയിഡ് ആപ്പ്</h4>
<img style="width: 90px;height: 18px;" src="http://public.pratilipi.com/images/Stars-for-App-Install-Strip.png" alt="">
</div>
</div>
<h5 style="color: rgba(0, 0, 0, 0.541);font-size: 16px;">വായിക്കൂ, നിങ്ങളുടെ പ്രിയ കഥകള്‍...</h5>
<button type="button" name="button" class="pratilipi-light-blue-button" style="width: 100%;font-size: 16px;border: 0;background: #00a651;color: white;text-shadow: none;" onclick="androidBannerClicked(); window.open( 'https://play.google.com/store/apps/details?id=com.pratilipi.mobile.android&referrer=utm_source%3Dpratilipi_main_web%26utm_medium%3Dweb_bottom_strip%26utm_campaign%3Dapp_download' );">ഡൗണ്‍ലോഡ് ചെയ്യൂ</button>
</div>
</template>
<script>
Polymer({
is: 'pratilipi-android-launch-test',
behaviors: [
Polymer.IronResizableBehavior
],
listeners: {
'iron-resize': '_onIronResize'
},
created: function() {
this._onIronResize();
},
ready: function() {
var iOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
var windowsize = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
var showBanner = getCookie( "USER_NOTIFIED_APP_LAUNCHED" ) == null || getCookie( "USER_NOTIFIED_APP_LAUNCHED" ) == "true";
if( showBanner && isAndroid() ) {
$( this.querySelector( '#androidAlert' ) ).css( "display", "block" );
ga( 'send', 'event', 'app_download_strip', 'app_strip_show', 'android_app_download' );
}
},
_onIronResize: function() {
var windowsize = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
var mainDiv = document.getElementsByTagName( "main" );
var androidSubscribeAlert = $( this.querySelector( '#androidAlert' ) );
var button = $( this.querySelector( '#androidAlert button' ) );
if( $( androidSubscribeAlert ).css( "display" ) == "none" )
$( mainDiv ).css( "padding-top", 0 );
else
$( mainDiv ).css( "padding-top", $( androidSubscribeAlert ).outerHeight() + 4 );
},
hide: function() {
$( this.querySelector( '#androidAlert' ) ).css( "display", "none" );
this._onIronResize();
}
});
</script>
</dom-module>